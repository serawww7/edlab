<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 18 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî EAN-13: –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä/–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ç–æ—Ä + —Ç–µ—Å—Ç –¥—Ä—É–∫—É + –∂—É—Ä–Ω–∞–ª —Å–∫–∞–Ω—É–≤–∞–Ω—å (–≥—Ä–∞—Ñ—ñ–∫–∏) + —á–µ–∫/CSV</title>
<meta name="description" content="–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ EAN-13, —Ä–µ–Ω–¥–µ—Ä —É Canvas –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥—Ä—É–∫—É, —Ç–µ—Å—Ç-—à–∞–±–ª–æ–Ω –ø—Ä–∏–Ω—Ç–µ—Ä–∞, –∂—É—Ä–Ω–∞–ª —Å–∫–∞–Ω—É–≤–∞–Ω—å, –∂–∏–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ/—á–∞—Å—É, –µ–∫—Å–ø–æ—Ä—Ç CSV/TXT, —á–µ–∫ 58 –º–º."/>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1240px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:90px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
small.mono,.mono{font-family:ui-monospace,monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.35fr 1fr}
@media(max-width:1120px){.grid{grid-template-columns:1fr}}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:280px}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace;white-space:pre}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üè∑Ô∏è</span>
      <div>
        <b>–ü–∞—Ä–∞ 18 ‚Äî –ï—Ç–∏–∫–µ—Ç–∫–∞/–¥—Ä—É–∫: EAN-13</b><br/>
        <span class="badge">–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä ‚Üí –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ç–æ—Ä ‚Üí Canvas-—Ä–µ–Ω–¥–µ—Ä ‚Üí —Ç–µ—Å—Ç –¥—Ä—É–∫—É ‚Üí –∂—É—Ä–Ω–∞–ª —Å–∫–∞–Ω—É–≤–∞–Ω—å ‚Üí –≥—Ä–∞—Ñ—ñ–∫–∏ ‚Üí —á–µ–∫/CSV</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ **–ø—Ä–∞–≤–∏–ª—å–Ω—ñ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∏ EAN-13** (—Ö–∞—Ä—á–æ–≤–∞ –ø—Ä–æ–¥—É–∫—Ü—ñ—è), –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ **—è–∫—ñ—Å—Ç—å –¥—Ä—É–∫—É** (–º–æ–¥—É–ª—å, –∫–æ–Ω—Ç—Ä–∞—Å—Ç, ¬´—Ç–∏—Ö–∞ –∑–æ–Ω–∞¬ª), –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–¥–∏ **—Å–∫–∞–Ω–µ—Ä–æ–º/–∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é**, –≤–µ—Å—Ç–∏ **–∂—É—Ä–Ω–∞–ª —Å–∫–∞–Ω—É–≤–∞–Ω—å** —ñ **–±–∞—á–∏—Ç–∏ –∂–∏–≤—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**.</p>

  <div class="grid">
    <!-- –õ–Ü–í–û: –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä + —Ä–µ–Ω–¥–µ—Ä + –≥—Ä–∞—Ñ—ñ–∫–∏ -->
    <div class="card">
      <h2>üîß –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä EAN-13</h2>
      <div class="row">
        <label style="flex:1">–ü—Ä–µ—Ñ—ñ–∫—Å –∫—Ä–∞—ó–Ω–∏ (3)<input id="pfx" class="input" maxlength="3" value="482"/></label>
        <label style="flex:1">–ö–æ–¥ –≤–∏—Ä–æ–±–Ω–∏–∫–∞ (4‚Äì5)<input id="man" class="input" maxlength="5" value="1234"/></label>
        <label style="flex:1">–ö–æ–¥ —Ç–æ–≤–∞—Ä—É (3‚Äì5)<input id="item" class="input" maxlength="5" value="5678"/></label>
        <label style="flex:1">–ê–≤—Ç–æ–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞<input id="autoChk" type="checkbox" checked/></label>
      </div>
      <div class="row">
        <label style="flex:2">–ü–æ–≤–Ω–∏–π –∫–æ–¥ (13 —Ü–∏—Ñ—Ä, —è–∫—â–æ –≤—Ä—É—á–Ω—É)<input id="full" class="input" placeholder="482123456789?"/></label>
        <button class="btn good" id="gen">‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
        <button class="btn secondary" id="val">‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
        <span id="res" class="badge">–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: ‚Äî</span>
      </div>

      <h3 style="margin-top:10px">üñ®Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥—Ä—É–∫—É/—Ä–µ–Ω–¥–µ—Ä–∞</h3>
      <div class="row">
        <label>–ú–∞—Å—à—Ç–∞–± (magnification, √ó)<input id="mag" class="input" type="number" min="0.8" step="0.05" value="1.00"/></label>
        <label>–ú–æ–¥—É–ª—å (X, –º–º)<input id="mod" class="input" type="number" step="0.01" value="0.33"/></label>
        <label>DPI –ø—Ä–∏–Ω—Ç–µ—Ä–∞<input id="dpi" class="input" type="number" step="1" value="203"/></label>
        <label>–¢–µ–º—Ä—è–≤–∞ (—Å–∏–º—É–ª—è—Ü—ñ—è)%<input id="dark" class="input" type="range" min="0" max="100" value="85"/></label>
        <label>–¢–∏—Ö–∞ –∑–æ–Ω–∞ (–º–º)<input id="quiet" class="input" type="number" step="0.5" value="3.0"/></label>
        <button class="btn" id="draw">üé® –ù–∞–º–∞–ª—é–≤–∞—Ç–∏</button>
      </div>

      <div class="canvasWrap"><canvas id="barcode" width="980" height="180"></canvas></div>
      <small class="muted">–ü–æ—Ä–∞–¥–∞: –¥–ª—è EAN-13 —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ X‚âà0.33 –º–º, magnification ‚â• 80%, quiet zone ‚â• 3.63 –º–º –∫–æ–∂–Ω–æ–≥–æ –±–æ–∫—É; –∑–∞—Å—Ç–æ—Å—É–π –∑–∞–ø–∞—Å ‚â• 4 –º–º.</small>

      <h3 style="margin-top:10px">üìà –ñ–∏–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ (—Å–∫–∞–Ω–∏)</h3>
      <div class="canvasWrap"><canvas id="chart" width="980" height="280"></canvas></div>
      <small class="muted">–°–∏–Ω—ñ–π ‚Äî –≤—ñ–¥—Å–æ—Ç–æ–∫ —É—Å–ø—ñ—à–Ω–∏—Ö —Å–∫–∞–Ω—ñ–≤ (–∫–æ–≤–∑–Ω–µ –≤—ñ–∫–Ω–æ 20 –ø–æ–¥—ñ–π); –ó–µ–ª–µ–Ω–∏–π ‚Äî —á–∞—Å –¥–æ —Å–∫–∞–Ω—É (–º—Å); –ß–µ—Ä–≤–æ–Ω—ñ —Ç–æ—á–∫–∏ ‚Äî –ø–æ–º–∏–ª–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó —Ü–∏—Ñ—Ä–∏/—Ç–∏—Ö–æ—ó –∑–æ–Ω–∏.</small>

      <h3 style="margin-top:10px">üß™ –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ç–æ—Ä/—Å–∫–∞–Ω–µ—Ä</h3>
      <div class="row">
        <input id="scan" class="input" placeholder="–§–æ–∫—É—Å—É–π—Å—è —Ç—É—Ç —ñ —Å–∫–∞–Ω—É–π EAN-13 (–∞–±–æ –≤–≤–µ–¥–∏ –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏)"/>
        <button class="btn secondary" id="clearScan">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –∂—É—Ä–Ω–∞–ª</button>
        <span id="scanStat" class="badge">–°–∫–∞–Ω—ñ–≤: 0 | –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å: 0%</span>
      </div>
      <pre id="alog" class="note" style="max-height:200px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>

      <h3 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç/–¥—Ä—É–∫</h3>
      <div class="row">
        <input id="lot" class="input" placeholder="–õ–æ—Ç/–ø–∞—Ä—Ç—ñ—è –∞–±–æ –Ω–∞–∑–≤–∞ SKU"/>
        <button class="btn" id="saveCsv">üìÑ CSV (–∂—É—Ä–Ω–∞–ª —Å–∫–∞–Ω—ñ–≤)</button>
        <button class="btn" id="saveTxt">üíæ TXT (–∑–≤–µ–¥–µ–Ω–Ω—è)</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="printPage">üñ®Ô∏è –¢–µ—Å—Ç-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–∞</button>
      </div>
      <div id="rc" class="receipt" hidden></div>
    </div>

    <!-- –ü–†–ê–í–û: –ø–æ–∫–∞–∑–Ω–∏–∫–∏ + —Å—Ö–µ–º–∞ + –∑–∞–≤–¥–∞–Ω–Ω—è -->
    <div class="card">
      <h2>üìä –ü–æ–∫–∞–∑–Ω–∏–∫–∏ –¥—Ä—É–∫—É</h2>
      <table class="tbl">
        <tbody>
          <tr><th>EAN-13</th><td id="m_code">‚Äî</td></tr>
          <tr><th>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ü–∏—Ñ—Ä–∞</th><td id="m_chk">‚Äî</td></tr>
          <tr><th>–®–∏—Ä–∏–Ω–∞ –∫–æ–¥—É (–º–º)</th><td id="m_wmm">‚Äî</td></tr>
          <tr><th>–¢–∏—Ö–∞ –∑–æ–Ω–∞ (–º–º)</th><td id="m_qz">‚Äî</td></tr>
          <tr><th>–ü—ñ–∫—Å–µ–ª—å –Ω–∞ –º–æ–¥—É–ª—å</th><td id="m_ppm">‚Äî</td></tr>
          <tr><th>–û—Ü—ñ–Ω–∫–∞ –¥—Ä—É–∫—É</th><td id="m_grade">‚Äî</td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üîå –°—Ö–µ–º–∞ (SVG)</h2>
      <svg viewBox="0 0 820 260" role="img" aria-label="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä ‚Üí –ü—Ä–∏–Ω—Ç–µ—Ä ‚Üí –ü—Ä–æ–¥—É–∫—Ç ‚Üí –°–∫–∞–Ω–µ—Ä ‚Üí –ñ—É—Ä–Ω–∞–ª">
        <rect x="40" y="40" width="180" height="120" rx="12" fill="#0e2a47" stroke="#3b82f6"/>
        <text x="130" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä EAN-13</text>
        <text x="130" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">–∫–æ–Ω—Ç—Ä. —Ü–∏—Ñ—Ä–∞</text>

        <rect x="250" y="40" width="160" height="120" rx="12" fill="#14532d" stroke="#22c55e"/>
        <text x="330" y="80" fill="#dcfce7" font-size="14" text-anchor="middle">–ü—Ä–∏–Ω—Ç–µ—Ä</text>
        <text x="330" y="100" fill="#a7f3d0" font-size="12" text-anchor="middle">DPI/—Ç–µ–º—Ä—è–≤–∞</text>

        <rect x="430" y="40" width="140" height="120" rx="12" fill="#1f2937" stroke="#9ca3af"/>
        <text x="500" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ï—Ç–∏–∫–µ—Ç–∫–∞</text>
        <text x="500" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">quiet zone</text>

        <rect x="590" y="40" width="170" height="120" rx="12" fill="#0b1a2f" stroke="#64748b"/>
        <text x="675" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–°–∫–∞–Ω–µ—Ä/–ñ—É—Ä–Ω–∞–ª</text>
        <text x="675" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">–≥—Ä–∞—Ñ—ñ–∫–∏/CSV</text>

        <line x1="220" y1="100" x2="250" y2="100" stroke="#93c5fd" stroke-width="3"/>
        <line x1="410" y1="100" x2="430" y2="100" stroke="#22c55e" stroke-width="3"/>
        <line x1="570" y1="100" x2="590" y2="100" stroke="#64748b" stroke-width="3"/>
      </svg>

      <h2 style="margin-top:10px">üéØ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
      <ol>
        <li>–ó–≥–µ–Ω–µ—Ä—É–π **EAN-13** –¥–ª—è –¥–≤–æ—Ö SKU (–º–æ–ª–æ–∫–æ/—Å–∏—Ä). –ù–∞–¥—Ä—É–∫—É–π —Ç–µ—Å—Ç-—Å—Ç–æ—Ä—ñ–Ω–∫—É, –æ—Ü—ñ–Ω–∏ **–º–æ–¥—É–ª—å, quiet zone** —Ç–∞ **DPI‚Üíppm**.</li>
        <li>–í–∏–∫–æ–Ω–∞–π ‚â• 30 —Å–∫–∞–Ω—ñ–≤ (—Ä—ñ–∑–Ω—ñ –≤—ñ–¥—Å—Ç–∞–Ω—ñ/–∫—É—Ç–∏). –ï–∫—Å–ø–æ—Ä—Ç—É–π **CSV**, –ø–æ–±—É–¥—É–π **—É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å** —Ç–∞ **—á–∞—Å**; –∑—Ä–æ–±–∏ –≤–∏—Å–Ω–æ–≤–∫–∏ —É <b>TXT</b>.</li>
        <li>–ó–º—ñ–Ω–∏ ¬´–¢–µ–º—Ä—è–≤—É¬ª/¬´–ú–æ–¥—É–ª—å¬ª —Ç–∞–∫, —â–æ–± –∑–º–µ–Ω—à–∏–ª–∞—Å—å —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å: –∑–∞—Ñ—ñ–∫—Å—É–π **—á–µ—Ä–≤–æ–Ω—ñ –ø–æ–¥—ñ—ó** (–ø–æ–º–∏–ª–∫–∏) —Ç–∞ —Å—Ñ–æ—Ä–º—É–π <b>—á–µ–∫ 58 –º–º</b> –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—î—é –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞.</li>
      </ol>
    </div>
  </div>

  <div class="card">
    <h2>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
    <p class="muted small">–ü–µ—Ä—à—ñ EAN-–∫–æ–¥–∏ –∑‚Äô—è–≤–∏–ª–∏—Å—è —É 1970-—Ö ‚Äî —ñ –∑ —Ç–æ–≥–æ —á–∞—Å—É —à—Ç—Ä–∏—Ö-–∫–æ–¥ —Å—Ç–∞–≤ ¬´–ø–∞—Å–ø–æ—Ä—Ç–æ–º¬ª –ø—Ä–æ–¥—É–∫—Ç—É. –Ø–∫—ñ—Å—Ç—å –¥—Ä—É–∫—É –π –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ü–∏—Ñ—Ä–∞ ‚Äî –∑–∞–ø–æ—Ä—É–∫–∞ —Ç–æ–≥–æ, —â–æ —Å–∫–ª–∞–¥/–º–∞–≥–∞–∑–∏–Ω –Ω–µ ¬´–∑–∞–≤–∏—Å–Ω–µ¬ª –Ω–∞ —Ä–∞–º–ø—ñ.</p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function log(msg){const t=new Date().toLocaleTimeString(); const box=$('#alog'); if(box.textContent.startsWith('//')) box.textContent=''; box.textContent+=`[${t}] ${msg}\n`; box.scrollTop=box.scrollHeight;}
function clamp(x,a,b){return Math.max(a,Math.min(b,x));}
function csvEsc(s){return `"${(s??'').toString().replace(/"/g,'""')}"`;}

// ===== EAN-13 –∫–æ–¥–µ—Ä =====
const L={0:'0001101',1:'0011001',2:'0010011',3:'0111101',4:'0100011',5:'0110001',6:'0101111',7:'0111011',8:'0110111',9:'0001011'};
const G={0:'0100111',1:'0110011',2:'0011011',3:'0100001',4:'0011101',5:'0111001',6:'0000101',7:'0010001',8:'0001001',9:'0010111'};
const R={0:'1110010',1:'1100110',2:'1101100',3:'1000010',4:'1011100',5:'1001110',6:'1010000',7:'1000100',8:'1001000',9:'1110100'};
const PARITY={
  0:['L','L','L','L','L','L'],
  1:['L','L','G','L','G','G'],
  2:['L','L','G','G','L','G'],
  3:['L','L','G','G','G','L'],
  4:['L','G','L','L','G','G'],
  5:['L','G','G','L','L','G'],
  6:['L','G','G','G','L','L'],
  7:['L','G','L','G','L','G'],
  8:['L','G','L','G','G','L'],
  9:['L','G','G','L','G','L']
};
function checksum12(s12){ // –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É —Ü–∏—Ñ—Ä—É –¥–ª—è 12 —Ü–∏—Ñ—Ä
  const d=s12.split('').map(x=>+x);
  const sum = d.reduce((acc, val, idx)=> acc + val * ( (idx%2)?3:1 ), 0);
  return (10 - (sum % 10)) % 10;
}
function validateEAN13(code){
  if(!/^\d{13}$/.test(code)) return {ok:false, reason:'–ù–µ 13 —Ü–∏—Ñ—Ä'};
  const chk=+code[12], need=checksum12(code.slice(0,12));
  return {ok: chk===need, chk, need};
}
function buildEAN13(code12or13){
  let s=code12or13.replace(/\D/g,'');
  if(s.length===12){ s += checksum12(s); }
  if(s.length!==13) throw new Error('–ü–æ—Ç—Ä—ñ–±–Ω–æ 12 –∞–±–æ 13 —Ü–∏—Ñ—Ä');
  return s;
}

// ===== –†–µ–Ω–¥–µ—Ä —à—Ç—Ä–∏—Ö-–∫–æ–¥—É =====
const bc=$('#barcode'), bctx=bc.getContext('2d');
function drawBarcode(){
  let code;
  try{
    const full=$('#full').value.trim();
    if(full){ code=buildEAN13(full); }
    else{
      const base=($('#pfx').value+$('#man').value+$('#item').value).replace(/\D/g,'');
      code=buildEAN13(base.padEnd(12,'0').slice(0,12));
    }
  }catch(e){ alert(e.message); return; }

  const mag=parseFloat($('#mag').value)||1;
  const modmm=parseFloat($('#mod').value)||0.33; // –º–æ–¥—É–ª—å X (–º–º)
  const dpi=parseInt($('#dpi').value,10)||203;
  const dark=parseInt($('#dark').value,10)||80;
  const qzmm=parseFloat($('#quiet').value)||3.0;

  // –®–∞–±–ª–æ–Ω–∏
  const first=+code[0];
  const leftPar = PARITY[first];
  const digits = code.split('').map(x=>+x);

  // –ü–æ–±—É–¥–æ–≤–∞ –±—ñ—Ç–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞ (–∑ –æ—Ö–æ—Ä–æ–Ω—Ü—è–º–∏)
  let bits='101'; // start guard
  for(let i=1;i<=6;i++){
    const d=digits[i];
    const p=leftPar[i-1];
    bits += (p==='L'?L[d]:G[d]);
  }
  bits += '01010'; // middle guard
  for(let i=7;i<=12;i++){
    const d=digits[i];
    bits += R[d];
  }
  bits += '101'; // end guard

  // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—ñ–∫—Å–µ–ª—å/–º–º
  const pxPerMM = dpi/25.4;
  const pxPerModule = pxPerMM * modmm * mag;
  const quietPx = Math.round(pxPerMM * qzmm);

  const barW = Math.round(pxPerModule); // –∫–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥ –ø—Ä–∏–Ω—Ç–µ—Ä
  const height = bc.height-40;
  const codeW = bits.length * barW;
  const totalW = codeW + quietPx*2;

  // –û—á–∏—â–µ–Ω–Ω—è —Ç–∞ —Ñ–æ–Ω
  bctx.clearRect(0,0,bc.width,bc.height);
  bctx.fillStyle='#0b1220'; bctx.fillRect(0,0,bc.width,bc.height);
  // –ü–æ–ª–µ –º–∞–ª—é–≤–∞–Ω–Ω—è –ø–æ —Ü–µ–Ω—Ç—Ä—É
  const x0 = Math.floor( (bc.width - totalW)/2 );
  const y0 = 20;

  // –ú–∞–ª—é–≤–∞–Ω–Ω—è —à—Ç—Ä–∏—Ö—ñ–≤
  bctx.fillStyle=`rgba(230,238,249,${clamp(dark/100,0.15,1)})`; // "—Ç–µ–º—Ä—è–≤–∞" = –∞–ª—å—Ñ–∞
  let x=x0+quietPx;
  for(let i=0;i<bits.length;i++){
    if(bits[i]==='1'){ bctx.fillRect(x,y0,barW,height); }
    x+=barW;
  }

  // –¢–µ–∫—Å—Ç —Ü–∏—Ñ—Ä
  bctx.fillStyle='#e6eef9'; bctx.font='16px ui-monospace';
  bctx.fillText(String(digits[0]), x0+quietPx-14, y0+height+16);
  const leftTxt = digits.slice(1,7).join('');
  const rightTxt = digits.slice(7,13).join('');
  bctx.fillText(leftTxt, x0+quietPx+barW*3, y0+height+16);
  bctx.fillText(rightTxt, x0+quietPx+barW*(3+7*6+5), y0+height+16);

  // –û—Ü—ñ–Ω–∫–∞ –¥—Ä—É–∫—É (—Å–ø—Ä–æ—â–µ–Ω–∞ –µ–≤—Ä–∏—Å—Ç–∏–∫–∞)
  const ppm = pxPerModule.toFixed(2);
  const okQZ = qzmm>=3.63 ? 'ok':'warn';
  const okPPM = pxPerModule>=1.2 ? 'ok' : (pxPerModule>=1.0?'warn':'bad');
  const grade = (okQZ==='ok' && okPPM!=='bad') ? '‚â• B (—É–º–æ–≤–Ω–æ)' : (okPPM==='bad'?'D':'C');
  $('#m_code').textContent=code;
  $('#m_chk').textContent=code[12]+' (–æ—á—ñ–∫—É–≤–∞–Ω–∞ '+checksum12(code.slice(0,12))+')';
  $('#m_wmm').textContent=( (codeW)/pxPerMM ).toFixed(2)+' –º–º';
  $('#m_qz').innerHTML=`${qzmm.toFixed(2)} –º–º <b class="${okQZ}">(${okQZ==='ok'?'OK':'–º–∞–ª–æ'})</b>`;
  $('#m_ppm').innerHTML=`${ppm} px/–º–æ–¥—É–ª—å <b class="${okPPM}">${okPPM.toUpperCase()}</b>`;
  $('#m_grade').textContent=grade;

  // –°—Ç–∞—Ç—É—Å
  $('#res').textContent='–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: —Ä–µ–Ω–¥–µ—Ä OK';
}

// ===== –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ =====
$('#gen').addEventListener('click', ()=>{
  try{
    const base=($('#pfx').value+$('#man').value+$('#item').value).replace(/\D/g,'');
    const s12=base.padEnd(12,'0').slice(0,12);
    const chk=checksum12(s12);
    const code = $('#autoChk').checked ? s12+chk : s12+'?';
    $('#full').value = code;
    $('#res').textContent='–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ: '+( $('#autoChk').checked? '–ø–æ–≤–Ω–∏–π –∫–æ–¥' : '–¥–æ–¥–∞–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É' );
  }catch(e){ alert(e.message); }
});
$('#val').addEventListener('click', ()=>{
  const code=$('#full').value.trim();
  const v=validateEAN13(code);
  if(!v.ok){ $('#res').textContent='–ü–æ–º–∏–ª–∫–∞: '+(v.reason||('–æ—á—ñ–∫. '+v.need+', —î '+v.chk)); }
  else { $('#res').textContent='–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: OK'; }
});
$('#draw').addEventListener('click', drawBarcode);

// ===== –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è / –ñ—É—Ä–Ω–∞–ª =====
let SCANS=[]; // {ts, code, ok, ms, reason}
let lastScanStart=null;
const chart=$('#chart'), ctx=chart.getContext('2d');

function pushScan(code, ok, ms, reason=''){
  SCANS.push({ts:Date.now(), code, ok, ms, reason});
  updateScanStat(); drawCharts();
  log(`${ok?'OK':'ERR'} | ${code} | ${ms} –º—Å ${reason?('| '+reason):''}`);
}
function updateScanStat(){
  const okc=SCANS.filter(s=>s.ok).length, all=SCANS.length;
  const pct=all? (okc/all*100).toFixed(1):'0.0';
  $('#scanStat').textContent=`–°–∫–∞–Ω—ñ–≤: ${all} | –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å: ${pct}%`;
}
function drawCharts(){
  const W=chart.width,H=chart.height;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#223049'; ctx.strokeRect(0.5,0.5,W-1,H-1);
  if(!SCANS.length){ ctx.fillStyle='#94a3b8'; ctx.fillText('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö', 14,20); return; }
  const N=SCANS.length;
  const windowN=20;
  const pctSeries=[];
  for(let i=1;i<=N;i++){
    const win=SCANS.slice(Math.max(0,i-windowN), i);
    const p=win.filter(s=>s.ok).length / win.length * 100;
    pctSeries.push({i,p});
  }
  const msSeries=SCANS.map((s,i)=>({i:i+1,ms:s.ms||0,err:!s.ok}));
  const left=40, right=W-10, top=20, mid=H*0.55, bottom=H-20;
  const gx=(right-left)/Math.max(1,N-1);

  // –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å (–≤–µ—Ä—Ö)
  ctx.fillStyle='#94a3b8'; ctx.font='12px ui-monospace'; ctx.fillText('–£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å % (–∫–æ–≤–∑–Ω–µ –≤—ñ–∫–Ω–æ 20)', 8, top+12);
  const yP=v=> (mid-10) - (v/100)*(mid-top-20);
  ctx.beginPath(); ctx.strokeStyle='#38bdf8'; ctx.lineWidth=2;
  pctSeries.forEach((v,k)=>{ const x=left+k*gx; const y=yP(v.p); k?ctx.lineTo(x,y):ctx.moveTo(x,y);}); ctx.stroke();
  // 100/80/60 –ª—ñ–Ω—ñ—ó
  ctx.strokeStyle='#64748b'; [100,80,60].forEach(val=>{ ctx.beginPath(); ctx.setLineDash([4,4]); ctx.moveTo(left,yP(val)); ctx.lineTo(right,yP(val)); ctx.stroke(); ctx.setLineDash([]); });

  // –ß–∞—Å –¥–æ —Å–∫–∞–Ω—É (–Ω–∏–∑)
  ctx.fillStyle='#94a3b8'; ctx.fillText('–ß–∞—Å –¥–æ —Å–∫–∞–Ω—É, –º—Å', 8, mid+16);
  const maxMS=Math.max(1000, ...msSeries.map(v=>v.ms));
  const yM=v=> bottom - (v/maxMS)*(bottom-(mid+24));
  ctx.beginPath(); ctx.strokeStyle='#22c55e'; ctx.lineWidth=2;
  msSeries.forEach((v,k)=>{ const x=left+k*gx; const y=yM(v.ms); k?ctx.lineTo(x,y):ctx.moveTo(x,y);}); ctx.stroke();
  // –ü–æ–º–∏–ª–∫–∏ —è–∫ —á–µ—Ä–≤–æ–Ω—ñ —Ç–æ—á–∫–∏
  ctx.fillStyle='#f87171';
  msSeries.forEach((v,k)=>{ if(SCANS[k].ok) return; const x=left+k*gx; const y=yM(v.ms); ctx.beginPath(); ctx.arc(x,y,4,0,Math.PI*2); ctx.fill(); });
}

$('#scan').addEventListener('focus',()=>{ lastScanStart=performance.now(); });
$('#scan').addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ handleScan($('#scan').value.trim()); $('#scan').value=''; }});
function handleScan(raw){
  if(!raw) return;
  const ms = lastScanStart? Math.max(1, Math.round(performance.now()-lastScanStart)) : 0;
  lastScanStart=null;
  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ü–∏—Ñ—Ä–∞ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å "–æ—á—ñ–∫—É–≤–∞–Ω–æ–º—É" (—è–∫—â–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π)
  const v=validateEAN13(raw);
  let reason='';
  let ok=v.ok;
  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏—Ö–æ—ó –∑–æ–Ω–∏/ppm —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –Ω–µ–º–æ–∂–ª–∏–≤–∞ –∑—ñ —Å–∫–∞–Ω—É ‚Äî —Å–∏–º—É–ª—é—î–º–æ —á–µ—Ä–µ–∑ –ø–æ—Ç–æ—á–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥—Ä—É–∫—É:
  const qz=parseFloat($('#quiet').value)||3.0;
  const dpi=parseInt($('#dpi').value,10)||203;
  const modmm=parseFloat($('#mod').value)||0.33;
  const ppm=(dpi/25.4)*modmm;
  if(qz<3.0){ ok=false; reason+='quiet<3mm '; }
  if(ppm<1.0){ ok=false; reason+='ppm<1 '; }
  pushScan(raw, ok, ms, reason.trim());
}

$('#clearScan').addEventListener('click',()=>{ SCANS.length=0; updateScanStat(); drawCharts(); $('#alog').textContent='// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π'; });

// ===== –ï–∫—Å–ø–æ—Ä—Ç/–¥—Ä—É–∫ =====
$('#saveCsv').addEventListener('click', ()=>{
  if(!SCANS.length) return alert('–ù–µ–º–∞—î —Å–∫–∞–Ω—ñ–≤');
  let csv='ts_iso,code,ok,ms,reason,lot\n';
  const lot=$('#lot').value||'';
  SCANS.forEach(s=>{ csv+=`${new Date(s.ts).toISOString()},${csvEsc(s.code)},${s.ok?1:0},${s.ms},${csvEsc(s.reason)},${csvEsc(lot)}\n`; });
  download('tech_para18_scans_'+stamp()+'.csv', csv, 'text/csv');
});
$('#saveTxt').addEventListener('click', ()=>{
  const lot=$('#lot').value||'‚Äî';
  const okc=SCANS.filter(s=>s.ok).length, all=SCANS.length, pct=all?(okc/all*100).toFixed(1):'0.0';
  const txt=[
    '–ü–∞—Ä–∞ 18 ‚Äî EAN-13: –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —ñ –¥—Ä—É–∫',
    `EAN: ${$('#m_code').textContent||'‚Äî'}`,
    `–ú–æ–¥—É–ª—å X=${$('#mod').value} –º–º; DPI=${$('#dpi').value}; Quiet=${$('#quiet').value} –º–º`,
    `–°–∫–∞–Ω—ñ–≤=${all}; –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å=${pct}%`,
    `–õ–æ—Ç/SKU: ${lot}`,
    '--- –ñ—É—Ä–Ω–∞–ª ---',
    ...($('#alog').textContent.startsWith('//')?[]:$('#alog').textContent.trim().split('\n'))
  ].join('\n');
  download('tech_para18_summary_'+stamp()+'.txt', txt);
});
$('#print58').addEventListener('click', ()=>{
  const lot=$('#lot').value||'‚Äî';
  const okc=SCANS.filter(s=>s.ok).length, all=SCANS.length, pct=all?(okc/all*100).toFixed(1):'0.0';
  const lines=[
    '=== –ß–ï–ö EAN-13 (58–º–º) ===',
    'EAN: '+($('#m_code').textContent||'‚Äî'),
    `–£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å: ${pct}% –∑ ${all}`,
    `X=${$('#mod').value} –º–º | DPI=${$('#dpi').value}`,
    `Quiet=${$('#quiet').value} –º–º`,
    'SKU/–õ–æ—Ç: '+lot,
    '-----------------------------'
  ];
  const rc=$('#rc'); rc.hidden=false; rc.textContent=lines.join('\n');
  download('tech_para18_receipt_'+stamp()+'.txt', rc.textContent);
});

// ===== –¢–µ—Å—Ç-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–∞ =====
$('#printPage').addEventListener('click', ()=>{
  // –í—ñ–¥–∫—Ä–∏—î–º–æ –Ω–æ–≤–µ –≤—ñ–∫–Ω–æ –∑ —á–∏—Å—Ç–∏–º canvas —Ç–∞ –ª—ñ–Ω—ñ–π–∫–∞–º–∏
  const w=window.open('', '_blank', 'width=860,height=1100');
  const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–¢–µ—Å—Ç-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥—Ä—É–∫—É</title>
  <style>body{margin:20px;font-family:ui-monospace;background:white;color:black}</style></head>
  <body><h3>–¢–µ—Å—Ç-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥—Ä—É–∫—É (EAN-13, –ª—ñ–Ω—ñ–π–∫–∏, –≥—Ä–∞–¥—ñ—î–Ω—Ç–∏)</h3>
  <canvas id="p" width="780" height="1040" style="border:1px solid #999"></canvas>
  <script>
  const c=document.getElementById('p'),x=c.getContext('2d');
  x.fillStyle='#fff';x.fillRect(0,0,c.width,c.height);x.fillStyle='#000';x.font='12px monospace';
  // –õ—ñ–Ω—ñ–π–∫–∏ –ø–æ –º–º (96dpi –ø—Ä–∏–±–ª–∏–∑–Ω–æ; —Ç–µ—Å—Ç–æ–≤–∞, –¥–ª—è –∑—Å—É–≤—É ‚Äî –Ω–µ –º–µ—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∞)
  x.fillText('–õ—ñ–Ω—ñ–π–∫–∞ (10 –º–º –∫—Ä–æ–∫) ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä –º–∞—Å—à—Ç–∞–±–∏/–∑—Å—É–≤', 10,20);
  for(let i=0;i<=720;i+=10){x.strokeStyle='#ccc';x.beginPath();x.moveTo(40+i,30);x.lineTo(40+i,60);x.stroke(); if(i%50===0){x.fillText(String(i)+'–º–º', 36+i,72);}}
  // –®—Ç—Ä–∏—Ö-—Å—ñ—Ç–∫–∞ —Ä—ñ–∑–Ω–∏—Ö —á–∞—Å—Ç–æ—Ç
  x.fillText('–®—Ç—Ä–∏—Ö-—Å—ñ—Ç–∫–∞ (1..4 px) ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä ¬´–∑–ª–∏–ø–∞–Ω–Ω—è¬ª —à—Ç—Ä–∏—Ö—ñ–≤',10,100);
  for(let w=1;w<=4;w++){ for(let i=0;i<700;i+=w*2){ x.fillRect(40+i,110+(w-1)*16,w,12);} x.fillText(String(w)+'px', 750, 120+(w-1)*16); }
  // –ì—Ä–∞–¥—ñ—î–Ω—Ç–∏ —Å—ñ—Ä–æ–≥–æ ‚Äî –¥–ª—è ¬´—Ç–µ–º—Ä—è–≤–∏¬ª
  x.fillText('–ì—Ä–∞–¥—ñ—î–Ω—Ç–∏ (0..100%) ‚Äî –ø—ñ–¥–±–µ—Ä–∏ —Ç–µ–º—Ä—è–≤—É –¥—Ä—É–∫—É',10,190);
  for(let g=0; g<10; g++){ const p=g/10; x.fillStyle='rgba(0,0,0,'+p+')'; x.fillRect(40+g*70,200,60,30); x.fillStyle='#000'; x.strokeRect(40+g*70,200,60,30); x.fillText((g*10)+'%', 55+g*70, 245); }
  // –ú—ñ—Å—Ü–µ –ø—ñ–¥ EAN-13 –∑ –ø–æ–ª—è–º–∏ —Ç–∏—à—ñ (–Ω–∞–º–∞–ª—é—î–º–æ —Ä–∞–º–∫—É)
  x.strokeRect(40,300,700,160); x.fillText('–ü–æ–ª–µ –¥–ª—è EAN-13 (–≤—Ä–∞—Ö—É–π quiet zone ‚â•4 –º–º)', 40,295);
  x.fillText('–ü—ñ–¥–ø–∏—Å/–õ–æ—Ç: ___________________________', 40, 500);
  window.print();
  <\/script></body></html>`;
  w.document.write(html); w.document.close();
});

// ===== –ê–≤—Ç–æ-—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
window.addEventListener('load', ()=>{
  $('#scan').placeholder='–§–æ–∫—É—Å—É–π—Å—è —Ç—É—Ç —ñ —Å–∫–∞–Ω—É–π‚Ä¶';
  drawBarcode();
});
</script>
</body>
</html>
