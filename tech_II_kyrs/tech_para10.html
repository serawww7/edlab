<!-- tech_para10.html
     –ü–ê–†–ê 10 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–≤ –∑ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞
     –¢–µ–º–∞: –°–ê–ù–Ü–¢–ê–†–Ü–Ø –¢–ê –ì–Ü–ì–Ü–Ñ–ù–ê ‚Äî SSOP/GMP: –∑–æ–Ω–∏/—Ä–∏–∑–∏–∫–∏, –ø–ª–∞–Ω –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è, —Ä–æ–∑—á–∏–Ω–∏ (–∫–æ–Ω—Ü./–µ–∫—Å–ø–æ–∑–∏—Ü—ñ—è),
           –≥—Ä–∞—Ñ—ñ–∫ —Å–∞–Ω—ñ—Ç–∞—Ä–Ω–∏—Ö –≤—ñ–∫–æ–Ω, ATP/–º—ñ–∫—Ä–æ-—Ç–µ—Å—Ç–∏ (—Å–∏–º—É–ª—è—Ü—ñ—è), –∞—É–¥–∏—Ç —á–µ–∫-–ª–∏—Å—Ç, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC, CSV.
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏; (–æ–ø—Ü.) —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º; NFC-–º—ñ—Ç–∫–∏.

     –ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
     –£–í–ê–ì–ê: –Ω–∞–≤—á–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å. –§–∞–∫—Ç–∏—á–Ω—ñ SSOP –∑–∞—Ç–≤–µ—Ä–¥–∂—É—é—Ç—å—Å—è –Ω–∞ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤—ñ —Ç–∞ –≤ HACCP-–ø–ª–∞–Ω—ñ.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 10 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –°–∞–Ω—ñ—Ç–∞—Ä—ñ—è —Ç–∞ –≥—ñ–≥—ñ—î–Ω–∞: SSOP/GMP, –≥—Ä–∞—Ñ—ñ–∫, —Ç–µ—Å—Ç–∏, –∞—É–¥–∏—Ç, –∫–≤–∏—Ç–æ–∫/NFC/CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  textarea{min-height:84px}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ –≤ Moodle (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
  /* –õ–µ–≥–µ–Ω–¥–∞ —Ä–∏–∑–∏–∫—ñ–≤ */
  .legend span{display:inline-block;margin-right:8px;padding:3px 8px;border-radius:999px;border:1px solid #223049;background:#0d1a2e}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 10 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –ø–µ—Ä–µ—Ä–æ–±–∫–∏</span>
  <h1>üßº –°–∞–Ω—ñ—Ç–∞—Ä—ñ—è —Ç–∞ –≥—ñ–≥—ñ—î–Ω–∞: SSOP/GMP, –≥—Ä–∞—Ñ—ñ–∫, —Ç–µ—Å—Ç–∏, –∞—É–¥–∏—Ç, –∫–≤–∏—Ç–æ–∫/NFC/CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –ø–∞—Ä–∏</h2>
    <p>
      –ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –æ–ø–∏—à—É—Ç—å <b>–≤–∏—Ä–æ–±–Ω–∏—á—ñ –∑–æ–Ω–∏</b> —Ç–∞ —ó—Ö —Ä–∏–∑–∏–∫–∏, (2) —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>SSOP-–ø–ª–∞–Ω –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è</b> –∑ —Ä–æ–∑—á–∏–Ω–∞–º–∏,
      –µ–∫—Å–ø–æ–∑–∏—Ü—ñ—î—é —Ç–∞ –ó–Ü–ó, (3) –ø–æ–±—É–¥—É—é—Ç—å <b>–≥—Ä–∞—Ñ—ñ–∫ —Å–∞–Ω—ñ—Ç–∞—Ä–Ω–∏—Ö –≤—ñ–∫–æ–Ω</b>, (4) –≤–Ω–µ—Å—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ <b>ATP/–º—ñ–∫—Ä–æ-—Ç–µ—Å—Ç—ñ–≤</b> (—Å–∏–º—É–ª—è—Ü—ñ—è),
      (5) –ø—Ä–æ–≤–µ–¥—É—Ç—å <b>–∞—É–¥–∏—Ç GMP</b> –∑–∞ —á–µ–∫-–ª–∏—Å—Ç–æ–º, (6) –æ—Ñ–æ—Ä–º–ª—è—Ç—å <b>CSV</b>, <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b> —Ç–∞ <b>NFC</b>.
    </p>
    <p class="small muted">–ú–æ–¥–µ–ª—å –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è. –ù–∞ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤—ñ ‚Äî –¥–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å —á–∏–Ω–Ω–∏—Ö SSOP/SOP, –∫–∞—Ä—Ç –±–µ–∑–ø–µ–∫–∏ (SDS) —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –¥–µ–∑–∑–∞—Å–æ–±—ñ–≤.</p>
  </div>

  <!-- 1. –ó–û–ù–ò/–†–ò–ó–ò–ö–ò -->
  <div class="card">
    <h2>üè∑Ô∏è –ó–æ–Ω–∏ —Ç–∞ —Ä–∏–∑–∏–∫–∏</h2>
    <div class="legend small muted">
      <span>–†–∏–∑–∏–∫: 1 ‚Äî –Ω–∏–∑—å–∫–∏–π</span><span>2 ‚Äî —Å–µ—Ä–µ–¥–Ω—ñ–π</span><span>3 ‚Äî –≤–∏—Å–æ–∫–∏–π</span>
    </div>
    <div class="row" style="margin-top:6px">
      <button class="btn" onclick="addZone()">‚ûï –î–æ–¥–∞—Ç–∏ –∑–æ–Ω—É</button>
      <button class="btn" onclick="presetZones()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="copyCSV('csvZones')">üìã CSV (zones)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblZones">
        <thead>
          <tr>
            <th>#</th>
            <th>–ó–æ–Ω–∞</th>
            <th class="dark">–¢–∏–ø (RAW/COOK/PKG)</th>
            <th class="dark">–†–∏–∑–∏–∫ (1‚Äì3)</th>
            <th>–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è</th>
            <th>–ö—Ä–∏—Ç–∏—á–Ω—ñ —Ç–æ—á–∫–∏</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyZones"></tbody>
      </table>
    </div>
    <div id="csvZones" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 2. SSOP-–ü–õ–ê–ù –ü–†–ò–ë–ò–†–ê–ù–ù–Ø -->
  <div class="card">
    <h2>üßΩ SSOP ‚Äî –ü–ª–∞–Ω –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è/–¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—ó</h2>
    <div class="row">
      <button class="btn" onclick="addSSOP()">‚ûï –î–æ–¥–∞—Ç–∏ SSOP</button>
      <button class="btn" onclick="presetSSOP()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="copyCSV('csvSSOP')">üìã CSV (ssop)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblSSOP">
        <thead>
          <tr>
            <th>#</th>
            <th>–û–±‚Äô—î–∫—Ç/–ó–æ–Ω–∞</th>
            <th class="dark">–†–æ–∑—á–∏–Ω (–∫–æ–Ω—Ü. %)</th>
            <th class="dark">–ï–∫—Å–ø–æ–∑–∏—Ü—ñ—è, —Ö–≤</th>
            <th class="dark">–ó–Ü–ó</th>
            <th>–ú–µ—Ç–æ–¥/–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodySSOP"></tbody>
      </table>
    </div>
    <div id="csvSSOP" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 3. –ì–†–ê–§–Ü–ö –°–ê–ù–Ü–¢–ê–†–ù–ò–• –í–Ü–ö–û–ù -->
  <div class="card">
    <h2>üóìÔ∏è –ì—Ä–∞—Ñ—ñ–∫ —Å–∞–Ω—ñ—Ç–∞—Ä–Ω–∏—Ö –≤—ñ–∫–æ–Ω</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–ü–æ—á–∞—Ç–æ–∫ (HH:MM)</label><input id="winStart" type="time" value="18:00"></div>
          <div style="flex:1"><label>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å, —Ö–≤</label><input id="winDur" type="number" step="5" value="60"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ö-—Ç—å –≤—ñ–∫–æ–Ω</label><input id="winCount" type="number" step="1" value="2"></div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" onclick="buildWindows()">üßÆ –ü–æ–±—É–¥—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvWin')">üìã CSV (windows)</button>
        </div>
      </div>
      <div class="box">
        <h3>–°–ø–∏—Å–æ–∫ –≤—ñ–∫–æ–Ω</h3>
        <div id="winOut" class="out">‚Äî</div>
      </div>
      <div class="box">
        <h3>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å</h3>
        <div id="assignOut" class="out">‚Äî</div>
      </div>
    </div>
    <div id="csvWin" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 4. ATP/–ú–Ü–ö–†–û-–¢–ï–°–¢–ò -->
  <div class="card">
    <h2>üß´ ATP/–º—ñ–∫—Ä–æ-—Ç–µ—Å—Ç–∏ (—Å–∏–º—É–ª—è—Ü—ñ—è)</h2>
    <div class="row">
      <button class="btn" onclick="addTest()">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç</button>
      <button class="btn" onclick="presetTests()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="evaluateTests()">‚úÖ –ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
      <button class="btn" onclick="copyCSV('csvTests')">üìã CSV (tests)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblTests">
        <thead>
          <tr>
            <th>#</th>
            <th>–ü–æ–≤–µ—Ä—Ö–Ω—è/–æ–±‚Äô—î–∫—Ç</th>
            <th class="dark">–¢–∏–ø (ATP/TPC)</th>
            <th class="dark">–ó–Ω–∞—á–µ–Ω–Ω—è (RLU/CFU)</th>
            <th>–ü–æ—Ä—ñ–≥</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyTests"></tbody>
      </table>
    </div>
    <div id="sumTests" class="out" style="margin-top:8px">‚Äî</div>
    <div id="csvTests" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 5. –ê–£–î–ò–¢ GMP (—á–µ–∫-–ª–∏—Å—Ç) -->
  <div class="card">
    <h2>üìù –ê—É–¥–∏—Ç GMP ‚Äî —á–µ–∫-–ª–∏—Å—Ç</h2>
    <div class="row">
      <button class="btn" onclick="addAudit()">‚ûï –î–æ–¥–∞—Ç–∏ –ø—É–Ω–∫—Ç</button>
      <button class="btn" onclick="presetAudit()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="scoreAudit()">‚úÖ –û—Ü—ñ–Ω–∏—Ç–∏</button>
      <button class="btn" onclick="copyCSV('csvAudit')">üìã CSV (audit)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblAudit">
        <thead>
          <tr>
            <th>#</th>
            <th>–ü—É–Ω–∫—Ç</th>
            <th class="dark">–í–∞–≥–∞ (1‚Äì5)</th>
            <th class="dark">–û—Ü—ñ–Ω–∫–∞ (0‚Äì1)</th>
            <th>–ë–∞–ª</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyAudit"></tbody>
      </table>
    </div>
    <div id="sumAudit" class="out" style="margin-top:8px">‚Äî</div>
    <div id="csvAudit" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 6. –ñ–£–†–ù–ê–õ / –ö–í–ò–¢–û–ö / NFC -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª / –ö–≤–∏—Ç–æ–∫ 58 –º–º / NFC</h2>
    <div class="row">
      <button class="btn" onclick="addLog()">‚ûï –î–æ–¥–∞—Ç–∏ —É –∂—É—Ä–Ω–∞–ª</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (journal)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblLog">
        <thead>
          <tr>
            <th>#</th>
            <th>–ó–∞–≤–¥–∞–Ω–Ω—è (SSOP)</th>
            <th class="dark">–í—ñ–∫–Ω–æ</th>
            <th class="dark">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å</th>
            <th>–¢–µ—Å—Ç–∏ (PASS%)</th>
            <th>–ê—É–¥–∏—Ç (Score%)</th>
            <th>–í–∏—Å–Ω–æ–≤–æ–∫</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyLog"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>

    <div class="grid g2" style="margin-top:12px">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúSSOP TASK CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          <div style="flex:1"><label>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å</label><input id="nfcOper" type="text" value="–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ 58 –º–º ‚Äî ‚ÄúSSOP TASK‚Äù</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>SSOP TASK</h4>
          <p><b>–ó–æ–Ω–∞/–û–±‚Äô—î–∫—Ç:</b> <span id="tObj">‚Äî</span></p>
          <p><b>–†–æ–∑—á–∏–Ω:</b> <span id="tSol">‚Äî</span> ¬∑ <b>–ï–∫—Å–ø.:</b> <span id="tExp">‚Äî</span> —Ö–≤</p>
          <div class="line"></div>
          <p><b>–í—ñ–∫–Ω–æ:</b> <span id="tWin">‚Äî</span></p>
          <p><b>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å:</b> <span id="tOper">‚Äî</span></p>
          <div class="line"></div>
          <p><small>GMP/SSOP: –∑–∞—Å–æ–±–∏ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ö–∏—Å—Ç—É, –±–µ–∑–ø–µ—á–Ω–µ –ø–æ–≤–æ–¥–∂–µ–Ω–Ω—è –∑ —Ö—ñ–º—ñ—î—é, –¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è —É –∂—É—Ä–Ω–∞–ª—ñ.</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 7. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–°—Ç–≤–æ—Ä—ñ—Ç—å 3‚Äì5 –∑–æ–Ω —ñ–∑ —Ä–∏–∑–∏–∫–∞–º–∏ —Ç–∞ —á–∞—Å—Ç–æ—Ç–æ—é –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è.</li>
      <li>–î–æ–¥–∞–π—Ç–µ 4‚Äì8 SSOP-–∑–∞–≤–¥–∞–Ω—å –∑ —Ä–æ–∑—á–∏–Ω–∞–º–∏, –µ–∫—Å–ø–æ–∑–∏—Ü—ñ—î—é, –ó–Ü–ó.</li>
      <li>–ü–æ–±—É–¥—É–π—Ç–µ 1‚Äì3 —Å–∞–Ω—ñ—Ç–∞—Ä–Ω—ñ –≤—ñ–∫–Ω–∞, —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è –ø–æ –≤—ñ–∫–Ω–∞—Ö.</li>
      <li>–í–Ω–µ—Å—ñ—Ç—å 5‚Äì10 ATP/TPC –≤–∏–º—ñ—Ä—ñ–≤, –æ—Ü—ñ–Ω—ñ—Ç—å PASS%.</li>
      <li>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —á–µ–∫-–ª–∏—Å—Ç GMP, –æ—Ç—Ä–∏–º–∞–π—Ç–µ —Å—É–º–∞—Ä–Ω–∏–π –±–∞–ª.</li>
      <li>–î–æ–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å —É –∂—É—Ä–Ω–∞–ª, —Å—Ñ–æ—Ä–º—É–π—Ç–µ NFC —Ç–∞ –∫–≤–∏—Ç–æ–∫, —Å–∫–æ–ø—ñ—é–π—Ç–µ CSV.</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ó–æ–Ω–∏/—Ä–∏–∑–∏–∫–∏ —Ç–∞ SSOP-–ø–ª–∞–Ω</td><td>4</td></tr>
        <tr><td>–ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–∫–æ–Ω + –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å</td><td>2</td></tr>
        <tr><td>ATP/–º—ñ–∫—Ä–æ-—Ç–µ—Å—Ç–∏ —Ç–∞ PASS%</td><td>2</td></tr>
        <tr><td>–ê—É–¥–∏—Ç GMP, –∂—É—Ä–Ω–∞–ª, –∫–≤–∏—Ç–æ–∫/NFC/CSV</td><td>2</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  const pad2 = n => String(n).padStart(2,'0');
  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t);
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t);
  }
  function reindex(tb){ [...tb.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  // ===== 1) –ó–û–ù–ò =====
  const bodyZones = byId('bodyZones');
  function addZone(sample){
    const s=Object.assign({name:'', type:'RAW', risk:2, freq:'—â–æ–∑–º—ñ–Ω–∏', ccp:''}, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${s.name}"></td>
      <td class="dark">
        <select>
          <option ${s.type==='RAW'?'selected':''}>RAW</option>
          <option ${s.type==='COOK'?'selected':''}>COOK</option>
          <option ${s.type==='PKG'?'selected':''}>PKG</option>
        </select>
      </td>
      <td class="dark"><input type="number" min="1" max="3" step="1" value="${s.risk}"></td>
      <td><input type="text" value="${s.freq}"></td>
      <td><input type="text" value="${s.ccp}"></td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyZones); buildCSV_Zones();">‚úñ</button></td>
    `;
    bodyZones.appendChild(tr); reindex(bodyZones); buildCSV_Zones();
  }
  function presetZones(){
    bodyZones.innerHTML='';
    addZone({name:'–ü—Ä–∏–π–º–∞–Ω–Ω—è —Å–∏—Ä–æ–≤–∏–Ω–∏', type:'RAW', risk:3, freq:'—â–æ–∑–º—ñ–Ω–∏', ccp:'–∫–æ–Ω—Ç–∞–º—ñ–Ω. –≤—ñ–¥ —Ç–∞—Ä–∏'});
    addZone({name:'–¢–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∞', type:'COOK', risk:2, freq:'—â–æ–∑–º—ñ–Ω–∏', ccp:'–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç'});
    addZone({name:'–§–∞—Å—É–≤–∞–Ω–Ω—è/–ø–∞–∫—É–≤–∞–Ω–Ω—è', type:'PKG', risk:2, freq:'—â–æ–∑–º—ñ–Ω–∏', ccp:'–∫–æ–Ω—Ç–∞–∫—Ç —ñ–∑ —Ç–∞—Ä–æ—é'});
  }
  function buildCSV_Zones(){
    const rows=[...bodyZones.querySelectorAll('tr')].map(r=>{
      return [
        r.querySelector('.idx').textContent.trim(),
        r.children[1].querySelector('input').value.trim(),
        r.children[2].querySelector('select').value.trim(),
        r.children[3].querySelector('input').value.trim(),
        r.children[4].querySelector('input').value.trim(),
        r.children[5].querySelector('input').value.trim()
      ].join(' | ');
    });
    byId('csvZones').textContent = rows.join('\n') || '‚Äî';
  }

  // ===== 2) SSOP =====
  const bodySSOP = byId('bodySSOP');
  function addSSOP(sample){
    const s=Object.assign({obj:'', sol:'–•–ª–æ—Ä 0.05', exp:15, ppe:'—Ä—É–∫–∞–≤., –æ–∫—É–ª—è—Ä–∏', tool:'—â—ñ—Ç–∫–∞/–ø—ñ–Ω–∞'}, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${s.obj}"></td>
      <td class="dark"><input type="text" value="${s.sol}"></td>
      <td class="dark"><input type="number" step="1" value="${s.exp}"></td>
      <td class="dark"><input type="text" value="${s.ppe}"></td>
      <td><input type="text" value="${s.tool}"></td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodySSOP); buildCSV_SSOP();">‚úñ</button></td>
    `;
    bodySSOP.appendChild(tr); reindex(bodySSOP); buildCSV_SSOP();
  }
  function presetSSOP(){
    bodySSOP.innerHTML='';
    addSSOP({obj:'–°—Ç–æ–ª–∏ –ø–∞–∫—É–≤–∞–Ω–Ω—è', sol:'QAC 0.2', exp:10, ppe:'—Ä—É–∫–∞–≤., —Ñ–∞—Ä—Ç—É—Ö', tool:'–ø—ñ–Ω–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä'});
    addSSOP({obj:'–í—ñ–∑–∫–∏ —Ç–∞ –ª–æ—Ç–∫–∏',  sol:'–•–ª–æ—Ä 0.05', exp:15, ppe:'—Ä—É–∫–∞–≤., –æ–∫—É–ª—è—Ä–∏', tool:'—â—ñ—Ç–∫–∞'});
    addSSOP({obj:'–ü—ñ–¥–ª–æ–≥–∞ COOK-–∑–æ–Ω–∏', sol:'–ü—ñ–Ω–æ—É—Ç–≤–æ—Ä—é–≤–∞—á 2%', exp:20, ppe:'—Ä—É–∫–∞–≤., —á–æ–±–æ—Ç–∏', tool:'—â—ñ—Ç–∫–∞/—à–≤–∞–±—Ä–∞'});
  }
  function buildCSV_SSOP(){
    const rows=[...bodySSOP.querySelectorAll('tr')].map(r=>{
      return [
        r.querySelector('.idx').textContent.trim(),
        r.children[1].querySelector('input').value.trim(),
        r.children[2].querySelector('input').value.trim(),
        r.children[3].querySelector('input').value.trim(),
        r.children[4].querySelector('input').value.trim(),
        r.children[5].querySelector('input').value.trim()
      ].join(' | ');
    });
    byId('csvSSOP').textContent = rows.join('\n') || '‚Äî';
  }

  // ===== 3) –í–Ü–ö–ù–ê + –ü–†–ò–ó–ù–ê–ß–ï–ù–ù–Ø =====
  function parseTime(s){ const m=/^(\d{2}):(\d{2})$/.exec(s||''); if(!m) return null; const d=new Date(); d.setHours(+m[1],+m[2],0,0); return d; }
  function addMinutes(d,m){ const x=new Date(d); x.setMinutes(x.getMinutes()+m); return x; }
  function fmtHHMM(d){ return pad2(d.getHours())+':'+pad2(d.getMinutes()); }
  function buildWindows(){
    const start=parseTime(byId('winStart').value)||parseTime('18:00');
    const dur=+byId('winDur').value||60;
    const n=+byId('winCount').value||1;
    const lines=[], csv=[];
    const ssopRows=[...bodySSOP.querySelectorAll('tr')];
    let idx=0;
    for(let i=0;i<n;i++){
      const s=addMinutes(start, i*dur);
      const e=addMinutes(s,dur);
      const slot=`${fmtHHMM(s)}‚Äì${fmtHHMM(e)}`;
      // –ø—Ä–∏–∑–Ω–∞—á–∞—î–º–æ –¥–æ 2 –∑–∞–≤–¥–∞–Ω—å –Ω–∞ –≤—ñ–∫–Ω–æ
      const tasks=[];
      for(let k=0;k<2 && idx<ssopRows.length;k++,idx++){
        const obj=ssopRows[idx].children[1].querySelector('input').value.trim()||`–û–±‚Äô—î–∫—Ç #${idx+1}`;
        const sol=ssopRows[idx].children[2].querySelector('input').value.trim();
        tasks.push(`${obj} [${sol}]`);
      }
      lines.push(`${slot} ‚Üí ${tasks.join('; ')||'‚Äî'}`);
      csv.push(`WIN|${slot}|tasks=${tasks.join(', ')||'none'}`);
    }
    byId('winOut').textContent = lines.join('\n')||'‚Äî';
    byId('assignOut').textContent = '–ü–æ—Ä–∞–¥–∞: —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ—Ç—å —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ —Ç–∞–∫, —â–æ–± –≤–∏—Å–æ–∫–æ—Ä–∏–∑–∏–∫–æ–≤—ñ –∑–æ–Ω–∏ (3) –≤–∏–∫–æ–Ω—É–≤–∞–ª–∏—Å—å —É –ø–µ—Ä—à–æ–º—É –≤—ñ–∫–Ω—ñ.';
    byId('csvWin').textContent = csv.join('\n')||'‚Äî';

    // –û–Ω–æ–≤–∏—Ç–∏ –∫–≤–∏—Ç–æ–∫ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –≤—ñ–∫–Ω–æ–º/SSOP
    const firstLine = lines[0]||'‚Äî';
    const firstTask = (firstLine.split('‚Üí')[1]||'‚Äî').trim();
    byId('tWin').textContent = firstLine.split('‚Üí')[0]?.trim()||'‚Äî';
    const firstSSOP = ssopRows[0];
    if(firstSSOP){
      const obj=firstSSOP.children[1].querySelector('input').value.trim();
      const sol=firstSSOP.children[2].querySelector('input').value.trim();
      const exp=firstSSOP.children[3].querySelector('input').value.trim();
      byId('tObj').textContent = obj||'‚Äî';
      byId('tSol').textContent = sol||'‚Äî';
      byId('tExp').textContent = exp||'‚Äî';
    }
  }

  // ===== 4) –¢–ï–°–¢–ò =====
  const bodyTests = byId('bodyTests');
  function addTest(sample){
    const s=Object.assign({surf:'', type:'ATP', val:'', thr:200, status:'‚Äî'}, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${s.surf}"></td>
      <td class="dark">
        <select>
          <option ${s.type==='ATP'?'selected':''}>ATP</option>
          <option ${s.type==='TPC'?'selected':''}>TPC</option>
        </select>
      </td>
      <td class="dark"><input type="number" step="0.1" value="${s.val}"></td>
      <td><input type="number" step="1" value="${s.thr}"></td>
      <td class="status">‚Äî</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyTests); buildCSV_Tests();">‚úñ</button></td>
    `;
    bodyTests.appendChild(tr); reindex(bodyTests); buildCSV_Tests();
  }
  function presetTests(){
    bodyTests.innerHTML='';
    addTest({surf:'–°—Ç—ñ–ª PKG', type:'ATP', val:120, thr:200});
    addTest({surf:'–ù—ñ–∂ COOK', type:'ATP', val:260, thr:200});
    addTest({surf:'–õ–æ—Ç–æ–∫', type:'TPC', val:15, thr:50});
    addTest({surf:'–ü—ñ–¥–ª–æ–≥–∞', type:'TPC', val:120, thr:100});
    evaluateTests();
  }
  function evaluateTests(){
    const rows=[...bodyTests.querySelectorAll('tr')];
    let pass=0, n=0;
    rows.forEach(r=>{
      const type=r.children[2].querySelector('select').value;
      const val=Number(r.children[3].querySelector('input').value);
      const thr=Number(r.children[4].querySelector('input').value);
      if(!isNaN(val)&&!isNaN(thr)){ n++;
        const ok = type==='ATP' ? (val<=thr) : (val<=thr);
        r.querySelector('.status').textContent = ok?'PASS':'FAIL';
        r.querySelector('.status').style.color = ok? '#10b981' : '#ef4444';
        if(ok) pass++;
      }else{
        r.querySelector('.status').textContent='–Ω/–¥'; r.querySelector('.status').style.color='#f59e0b';
      }
    });
    const rate = n? Math.round(pass/n*100) : 0;
    byId('sumTests').textContent = `–í–∏–±—ñ—Ä–∫–∞: ${n}; PASS: ${pass}; PASS% = ${rate}%`;
    buildCSV_Tests();
    return rate;
  }
  function buildCSV_Tests(){
    const lines=[...bodyTests.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const s=r.children[1].querySelector('input').value.trim();
      const t=r.children[2].querySelector('select').value.trim();
      const v=r.children[3].querySelector('input').value.trim();
      const thr=r.children[4].querySelector('input').value.trim();
      const st=r.children[5].textContent.trim();
      return [idx,s,t,v,thr,st].join(' | ');
    });
    byId('csvTests').textContent = lines.join('\n') || '‚Äî';
  }

  // ===== 5) –ê–£–î–ò–¢ =====
  const bodyAudit = byId('bodyAudit');
  function addAudit(sample){
    const s=Object.assign({q:'', w:3, s:1}, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${s.q}"></td>
      <td class="dark"><input type="number" min="1" max="5" step="1" value="${s.w}"></td>
      <td class="dark"><input type="number" min="0" max="1" step="0.1" value="${s.s}"></td>
      <td class="pt">‚Äî</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyAudit); buildCSV_Audit();">‚úñ</button></td>
    `;
    bodyAudit.appendChild(tr); reindex(bodyAudit); buildCSV_Audit();
  }
  function presetAudit(){
    bodyAudit.innerHTML='';
    addAudit({q:'–ß–∏—Å—Ç—ñ/—Ü—ñ–ª—ñ –ó–Ü–ó', w:3, s:1});
    addAudit({q:'–°—Ç–∞–Ω —Ä–æ–∑—á–∏–Ω—ñ–≤ (–∫–æ–Ω—Ü./–º–∞—Ä–∫—É–≤–∞–Ω–Ω—è)', w:4, s:0.8});
    addAudit({q:'–†–æ–∑–º–µ–∂—É–≤–∞–Ω–Ω—è RAW/COOK –ø–æ—Ç–æ–∫—ñ–≤', w:5, s:0.9});
    addAudit({q:'–í–µ–¥–µ–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ SSOP', w:3, s:1});
    addAudit({q:'–ì—ñ–≥—ñ—î–Ω–∞ —Ä—É–∫/—Å–∞–Ω.–±–∞—Ä º—î—Ä–∏', w:4, s:0.7});
    scoreAudit();
  }
  function scoreAudit(){
    const rows=[...bodyAudit.querySelectorAll('tr')];
    let wsum=0, pts=0;
    rows.forEach(r=>{
      const w=Number(r.children[2].querySelector('input').value);
      const s=Number(r.children[3].querySelector('input').value);
      const p = (isNaN(w)||isNaN(s))?0: w*s;
      r.querySelector('.pt').textContent = rnd(p,2);
      if(!isNaN(w)) wsum+=w;
      if(!isNaN(p)) pts+=p;
    });
    const score = wsum? rnd(pts/wsum*100,1) : 0;
    byId('sumAudit').textContent = `–°—É–º–∞ –≤–∞–≥: ${wsum}; –ù–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ –±–∞–ª—ñ–≤: ${rnd(pts,2)}; –ü—ñ–¥—Å—É–º–æ–∫: ${score}%`;
    buildCSV_Audit();
    return score;
  }
  function buildCSV_Audit(){
    const lines=[...bodyAudit.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const q=r.children[1].querySelector('input').value.trim();
      const w=r.children[2].querySelector('input').value.trim();
      const s=r.children[3].querySelector('input').value.trim();
      const p=r.children[4].textContent.trim();
      return [idx,q,w,s,p].join(' | ');
    });
    byId('csvAudit').textContent = lines.join('\n') || '‚Äî';
  }

  // ===== 6) –ñ–£–†–ù–ê–õ / –ö–í–ò–¢–û–ö / NFC =====
  const bodyLog = byId('bodyLog');
  function addLog(sample){
    const passRate = evaluateTests();
    const auditScore = scoreAudit();
    // –í—ñ–∑—å–º–µ–º–æ –ø–µ—Ä—à–µ SSOP —Ç–∞ –ø–µ—Ä—à–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É
    const ss = bodySSOP.querySelector('tr');
    const obj = ss? ss.children[1].querySelector('input').value.trim() : '‚Äî';
    const sol = ss? ss.children[2].querySelector('input').value.trim() : '‚Äî';
    const exp = ss? ss.children[3].querySelector('input').value.trim() : '‚Äî';
    const win = (byId('winOut').textContent.split('\n')[0]||'‚Äî').split('‚Üí')[0]?.trim()||'‚Äî';
    const exec = byId('nfcOper').value||'–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢';

    const verdict = (passRate>=80 && auditScore>=85)? 'üü¢ –î–û–ü–£–°–¢–ò–¢–ò' : (passRate>=60 && auditScore>=70)? 'üü† –£–ú–û–í–ù–û' : 'üî¥ –ü–û–í–¢–û–†–ò–¢–ò/CAPA';
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${obj} [${sol}, ${exp} —Ö–≤]"></td>
      <td class="dark">${win}</td>
      <td class="dark">${exec}</td>
      <td>${passRate}%</td>
      <td>${auditScore}%</td>
      <td>${verdict}</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyLog); buildCSV_Log();">‚úñ</button></td>
    `;
    bodyLog.appendChild(tr); reindex(bodyLog); buildCSV_Log();

    // –û–Ω–æ–≤–∏—Ç–∏ –∫–≤–∏—Ç–æ–∫
    byId('tObj').textContent = obj;
    byId('tSol').textContent = sol;
    byId('tExp').textContent = exp;
    byId('tWin').textContent = win;
    byId('tOper').textContent = exec;
  }
  function buildCSV_Log(){
    const rows=[...bodyLog.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const task=r.children[1].querySelector('input').value.trim();
      const win=r.children[2].textContent.trim();
      const oper=r.children[3].textContent.trim();
      const pass=r.children[4].textContent.trim();
      const audit=r.children[5].textContent.trim();
      const v=r.children[6].textContent.trim();
      return [idx,task,win,oper,pass,audit,v].join(' | ');
    });
    byId('csvLog').textContent = rows.join('\n') || '‚Äî';
  }
  function buildTicket(){
    window.scrollTo({top: document.getElementById('ticket').getBoundingClientRect().top + window.scrollY - 60, behavior:'smooth'});
  }
  function buildNFC(){
    const txt = [
      `SSOP_NFC`,
      `OBJ:${byId('tObj').textContent}`,
      `SOL:${byId('tSol').textContent}`,
      `EXP:${byId('tExp').textContent}min`,
      `WIN:${byId('tWin').textContent}`,
      `OPER:${byId('nfcOper').value} CONTACT:${byId('nfcPhone').value}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = txt;
  }

  // ===== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø =====
  (function init(){
    presetZones(); presetSSOP(); buildWindows(); presetTests(); presetAudit();
    document.addEventListener('change', e=>{
      if(e.target.matches('input,select,textarea')){
        if(e.target.closest('#tblZones')) buildCSV_Zones();
        if(e.target.closest('#tblSSOP')) buildCSV_SSOP();
        if(e.target.closest('#tblTests')) evaluateTests();
        if(e.target.closest('#tblAudit')) scoreAudit();
      }
    });
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
