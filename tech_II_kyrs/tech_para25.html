<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 25 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –®–Ü –¥–ª—è –∞—É–¥–∏—Ç—É —Å–∞–Ω—ñ—Ç–∞—Ä—ñ—ó: NLP SSOP/–∂—É—Ä–Ω–∞–ª–∏ ‚Üí –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ ‚Üí CAPA ‚Üí –≥—Ä–∞—Ñ—ñ–∫–∏ ‚Üí —á–µ–∫/CSV/QR</title>
<meta name="description" content="–§—ñ–Ω–∞–ª—å–Ω–∞: –≤—Å—Ç–∞–≤–ª—è–π —Ç–µ–∫—Å—Ç–∏ SSOP/–∂—É—Ä–Ω–∞–ª—ñ–≤, AI –≤–∏—Ç—è–≥–∞—î —Å—É—Ç–Ω–æ—Å—Ç—ñ, –∫–ª–∞—Å–∏—Ñ—ñ–∫—É—î –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ (Minor/Major/Critical), –≥–µ–Ω–µ—Ä—É—î CAPA, –≤–µ–¥–µ –∂—É—Ä–Ω–∞–ª, –±—É–¥—É—î –≥—Ä–∞—Ñ—ñ–∫–∏, —á–µ–∫ 58 –º–º, –µ–∫—Å–ø–æ—Ä—Ç CSV/QR.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1260px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.grid{display:grid;gap:14px;grid-template-columns:1.35fr 1fr}
@media(max-width:1140px){.grid{grid-template-columns:1fr}}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:110px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
small.mono,.mono{font-family:ui-monospace,monospace}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
canvas{display:block;width:100%;height:280px;background:#0b1220;border:1px solid var(--line);border-radius:12px}
.canvasWrap{overflow:hidden;border-radius:12px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace;white-space:pre}
.ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:0 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.small{font-size:.9rem}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
</style>
<link rel="canonical" href="https://edlab.pp.ua/tech_II_kyrs/tech_para25.html"><meta property="og:type" content="article"><meta property="og:title" content="–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞ ‚Äî –ü–∞—Ä–∞ 25"><meta property="og:description" content="–¢–∏ ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥ –∑–º—ñ–Ω–∏ –Ω–∞ –º–æ–ª–æ–∫–æ–ø–µ—Ä–µ—Ä–æ–±–Ω–æ–º—É —Ü–µ—Ö—É. –£ —Ç–µ–±–µ —î SSOP (—Å–∞–Ω—ñ—Ç–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏) —ñ –¥–æ–±–æ–≤—ñ –∂—É—Ä–Ω–∞–ª–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è/–¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—ó. –ó–∞–≤–¥–∞–Ω–Ω—è: –∑–∞–±—Ä–∞—Ç–∏ –∑"><meta property="og:url" content="https://edlab.pp.ua/tech_II_kyrs/tech_para25.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞ ‚Äî –ü–∞—Ä–∞ 25","description":"–¢–∏ ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥ –∑–º—ñ–Ω–∏ –Ω–∞ –º–æ–ª–æ–∫–æ–ø–µ—Ä–µ—Ä–æ–±–Ω–æ–º—É —Ü–µ—Ö—É. –£ —Ç–µ–±–µ —î SSOP (—Å–∞–Ω—ñ—Ç–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏) —ñ –¥–æ–±–æ–≤—ñ –∂—É—Ä–Ω–∞–ª–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è/–¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—ó. –ó–∞–≤–¥–∞–Ω–Ω—è: –∑–∞–±—Ä–∞—Ç–∏ –∑","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/tech_II_kyrs/tech_para25.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üßº</span>
      <div>
        <b>–ü–∞—Ä–∞ 25 ‚Äî –®–Ü –¥–ª—è –∞—É–¥–∏—Ç—É —Å–∞–Ω—ñ—Ç–∞—Ä—ñ—ó (—Ñ—ñ–Ω–∞–ª)</b><br>
        <span class="badge">SSOP/–∂—É—Ä–Ω–∞–ª–∏ ‚Üí –≤–∏—Ç—è–≥ —Å—É—Ç–Ω–æ—Å—Ç–µ–π ‚Üí —Ä–∏–∑–∏–∫ ‚Üí CAPA ‚Üí –≥—Ä–∞—Ñ—ñ–∫–∏ ‚Üí —á–µ–∫/CSV/QR</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <!-- –í–í–Ü–î–ù–Ü –î–ê–ù–Ü / –ú–ï–¢–ê / –ö–û–ù–¢–ï–ö–°–¢ -->
  <div class="card">
    <h2>üìö –í–≤—ñ–¥–Ω—ñ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ (–∫–æ–Ω—Ç–µ–∫—Å—Ç —ñ —â–æ —Ç—É—Ç –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è)</h2>
    <p>
      –¢–∏&nbsp;‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥ –∑–º—ñ–Ω–∏ –Ω–∞ –º–æ–ª–æ–∫–æ–ø–µ—Ä–µ—Ä–æ–±–Ω–æ–º—É —Ü–µ—Ö—É. –£ —Ç–µ–±–µ —î <b>SSOP</b> (—Å–∞–Ω—ñ—Ç–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏) —ñ –¥–æ–±–æ–≤—ñ <b>–∂—É—Ä–Ω–∞–ª–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è/–¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—ó</b>.
      –ó–∞–≤–¥–∞–Ω–Ω—è: –∑–∞–±—Ä–∞—Ç–∏ –∑ —Ç–µ–∫—Å—Ç—ñ–≤ –∫–ª—é—á–æ–≤—ñ —Ñ–∞–∫—Ç–∏ (<b>—Ö—Ç–æ, –¥–µ, –∫–æ–ª–∏, —á–∏–º, —É&nbsp;—è–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö</b>), –≤–∏–∑–Ω–∞—á–∏—Ç–∏ <b>–Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ</b> (Minor/Major/Critical), 
      –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ <b>CAPA-–ø–ª–∞–Ω</b> (—É—Ç—Ä–∏–º–∞–Ω–Ω—è/–∫–æ—Ä—ñ–Ω–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞/–∫–æ—Ä–∏–≥—É—é—á—ñ/–∑–∞–ø–æ–±—ñ–∂–Ω—ñ/–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ), –∑—Ä–æ–±–∏—Ç–∏ <b>–∑–≤—ñ—Ç</b> –∑ 
      <b>–∂–∏–≤–∏–º–∏ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏</b>, <b>—á–µ–∫–æ–º 58&nbsp;–º–º</b>, <b>CSV</b> —Ç–∞ <b>QR</b>-–ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ –¥–æ–∫–∞–∑–∏.
    </p>
    <div class="grid" style="grid-template-columns:repeat(3,minmax(0,1fr))">
      <div class="note">
        <b>üìå –î–∞–Ω—ñ</b><br>–ë–µ—Ä–µ–º–æ —Å–∏—Ä—ñ —Ç–µ–∫—Å—Ç–∏ SSOP/–∂—É—Ä–Ω–∞–ª—ñ–≤: –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, ¬´–ó–æ–Ω–∞ —Ñ–∞—Å—É–≤–∞–Ω–Ω—è, –º–∏–π–∫–∞ –ª—ñ–Ω—ñ—ó –°, 
        –ª—É–∂–Ω–∏–π 2.0 %, 55 ¬∞C, –∫–æ–Ω—Ç–∞–∫—Ç 12 —Ö–≤, –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –û–ö¬ª. –í—Å—Ç–∞–≤–ª—è—î–º–æ –Ω–∏–∂—á–µ.
      </div>
      <div class="note">
        <b>üîé NLP</b><br>–ë—Ä–∞—É–∑–µ—Ä –≤–∏—Ç—è–≥–∞—î —Å—É—Ç–Ω–æ—Å—Ç—ñ: <span class="mono">ZONE, TOOL, CHEM, CONC, TEMP, TIME, ALLERGEN, BIO, DATE, PERSON</span>, 
        –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ª—ñ–º—ñ—Ç–∏ —ñ —à—É–∫–∞—î —Ç—Ä–∏–≥–µ—Ä–∏ —Ä–∏–∑–∏–∫—É.
      </div>
      <div class="note">
        <b>üß† –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è</b><br>–ü—Ä–∞–≤–∏–ª–∞ + —Å–∫–æ—Ä–∏–Ω–≥: <i>Minor</i> (–∫–æ—Å–º–µ—Ç–∏—á–Ω–µ), <i>Major</i> (–º–æ–∂–ª–∏–≤–∏–π –≤–ø–ª–∏–≤ –Ω–∞ —è–∫—ñ—Å—Ç—å), 
        <i>Critical</i> (—Ä–∏–∑–∏–∫ –±–µ–∑–ø–µ–∫–∏ —Ö–∞—Ä—á—ñ–≤: –∞–ª–µ—Ä–≥–µ–Ω–∏/–ø–∞—Ç–æ–≥–µ–Ω–∏/—Å—Ç–µ–∫–ª–æ/–º–µ—Ç–∞–ª/–≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å/–∞–Ω–æ–º–∞–ª—å–Ω–æ –Ω–∏–∑—å–∫—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏).
      </div>
    </div>
  </div>

  <!-- –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="tbl">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–æ –≤–∏—Ç—è–≥–Ω—É—Ç—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ (‚â• 5 —Ç–∏–ø—ñ–≤) —Ç–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π <b>CSV</b></td><td>3</td></tr>
        <tr><td>–í—ñ—Ä–Ω–∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è ‚â• 3 –∫–µ–π—Å—ñ–≤ –∑ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º (Minor/Major/Critical)</td><td>3</td></tr>
        <tr><td>–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π <b>CAPA-–ø–ª–∞–Ω</b> —ñ–∑ 5 –∫—Ä–æ–∫—ñ–≤ + —Ç–µ—Ä–º—ñ–Ω–∏/–≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ</td><td>3</td></tr>
        <tr><td>–ß–µ–∫ 58 –º–º + QR –Ω–∞ –ø–∞–ø–∫—É –¥–æ–∫–∞–∑—ñ–≤</td><td>1</td></tr>
      </tbody>
    </table>
    <p class="muted small">–ü—ñ–¥–∫–∞–∑–∫–∞: —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Å—è –∫–Ω–æ–ø–∫–æ—é ¬´üß™ –ü—Ä–∏–∫–ª–∞–¥–∏¬ª –¥–ª—è —Å—Ç–∞—Ä—Ç—É —ñ ¬´AI-CAPA¬ª –¥–ª—è –∞–≤—Ç–æ-–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è.</p>
  </div>

  <div class="grid">
    <!-- –õ–Ü–í–û: –Ü–ù–¢–ï–†–ê–ö–¢–ò–í -->
    <div class="card">
      <h2>üßæ –í–≤—ñ–¥ —Ç–µ–∫—Å—Ç—ñ–≤ SSOP/–∂—É—Ä–Ω–∞–ª—ñ–≤</h2>
      <div class="row">
        <button class="btn" id="ex1">üß™ –ü—Ä–∏–∫–ª–∞–¥–∏ (3 –∫–µ–π—Å–∏)</button>
        <button class="btn secondary" id="clr">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
        <span class="badge" id="count">–ó–∞–ø–∏—Å—ñ–≤: 0</span>
      </div>
      <textarea id="txt" placeholder="–í—Å—Ç–∞–≤ —Å—é–¥–∏ –∫—ñ–ª—å–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Ä—è–¥–æ–∫ –∞–±–æ —Ä–æ–∑–¥—ñ–ª—è–π –ø—É—Å—Ç–∏–º —Ä—è–¥–∫–æ–º). –ü—Ä–∏–∫–ª–∞–¥: 
2025-10-18 06:40 ¬∑ –ó–æ–Ω–∞ —Ñ–∞—Å—É–≤–∞–Ω–Ω—è (–π–æ–≥—É—Ä—Ç): CIP –ª—ñ–Ω—ñ—ó –°. –õ—É–∂–Ω–∏–π 2.0 %, 55 ¬∞C, 12 —Ö–≤, –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –û–ö. –û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–∏–ª–∏–ø—á—É–∫.
"></textarea>
      <div class="row">
        <label>–õ—ñ–º—ñ—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—ó, % (–ª—É–∂–Ω—ñ/–∫–∏—Å–ª–æ—Ç–Ω—ñ)<input id="limConc" class="input" type="number" step="0.1" value="1.5"></label>
        <label>–õ—ñ–º—ñ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏, ¬∞C<input id="limT" class="input" type="number" step="0.1" value="50"></label>
        <label>–õ—ñ–º—ñ—Ç —á–∞—Å—É –∫–æ–Ω—Ç–∞–∫—Ç—É, —Ö–≤<input id="limMin" class="input" type="number" step="0.5" value="10"></label>
        <button class="btn good" id="an">üîé –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ NLP</button>
      </div>

      <h3 style="margin-top:10px">üî¨ –í–∏—Ç—è–≥–Ω—É—Ç—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ</h3>
      <table class="tbl" id="entTbl">
        <thead>
          <tr>
            <th>#</th><th>–î–∞—Ç–∞</th><th>–ó–æ–Ω–∞</th><th>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä/–ª—ñ–Ω—ñ—è</th><th>–ó–∞—Å—ñ–±</th>
            <th>–ö–æ–Ω—Ü., %</th><th>T, ¬∞C</th><th>–ö–æ–Ω—Ç–∞–∫—Ç, —Ö–≤</th><th>–ê–ª–µ—Ä–≥–µ–Ω–∏/–ë—ñ–æ</th><th>–û—Å–æ–±–∞</th>
          </tr>
        </thead>
        <tbody id="entBody"><tr><td colspan="10" class="muted">‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑‚Äô—è–≤–∏—Ç—å—Å—è —Ç—É—Ç ‚Äî</td></tr></tbody>
      </table>

      <h3 style="margin-top:10px">‚ö†Ô∏è –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Ç–∞ —Ä–∏–∑–∏–∫</h3>
      <table class="tbl" id="ncTbl">
        <thead>
          <tr><th>#</th><th>–¢–∏–ø</th><th>–û–ø–∏—Å</th><th>–†–∏–∑–∏–∫</th><th>–°—Ç—É–ø—ñ–Ω—å</th></tr>
        </thead>
        <tbody id="ncBody"><tr><td colspan="5" class="muted">‚Äî —â–µ –ø–æ—Ä–æ–∂–Ω—å–æ ‚Äî</td></tr></tbody>
      </table>

      <h3 style="margin-top:10px">üß† CAPA-–ø–ª–∞–Ω (–∞–≤—Ç–æ/—Ä—É—á–Ω–∏–π)</h3>
      <div class="row">
        <button class="btn" id="genCapa">ü§ñ AI-CAPA –∑ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç–µ–π</button>
        <input id="lot" class="input" placeholder="–õ–æ—Ç/–ª—ñ–Ω—ñ—è (–Ω–∞–ø—Ä. SSOP_–π–æ–≥—É—Ä—Ç_2025-10-18_B)">
      </div>
      <textarea id="capa" placeholder="1) –£—Ç—Ä–∏–º–∞–Ω–Ω—è/containment: ...
2) –ö–æ—Ä—ñ–Ω–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ (5 —á–æ–º—É): ...
3) –ö–æ—Ä–∏–≥—É—é—á—ñ –¥—ñ—ó (—â–æ —ñ –¥–æ –∫–æ–ª–∏): ...
4) –ó–∞–ø–æ–±—ñ–∂–Ω—ñ –¥—ñ—ó (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏/–Ω–∞–≤—á–∞–Ω–Ω—è/–∫–æ–Ω—Ç—Ä–æ–ª—å): ...
5) –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è (–∞–Ω–∞–ª—ñ–∑–∏/ATP/–∞–ª–µ—Ä–≥–µ–Ω–∏) + –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (—á–µ—Ä–µ–∑ N –¥–Ω—ñ–≤): ..."></textarea>

      <h3 style="margin-top:10px">üõéÔ∏è –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</h3>
      <pre id="alog" class="note" style="max-height:170px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>

      <h3 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç / –¥—Ä—É–∫</h3>
      <div class="row">
        <button class="btn" id="saveCsv">üìÑ CSV (—Å—É—Ç–Ω–æ—Å—Ç—ñ + –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ)</button>
        <button class="btn" id="saveTxt">üíæ TXT (–∑–≤—ñ—Ç + CAPA)</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="qrGen">üîó QR (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –¥–æ–∫–∞–∑–∏)</button>
      </div>
      <div id="rc" class="receipt" hidden=""></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="qr" width="220" height="220"></canvas></div>
      <small class="muted">QR –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ <span class="mono">api.qrserver.com</span>; –æ—Ñ–ª–∞–π–Ω –±—É–¥–µ —Ç–µ–∫—Å—Ç.</small>
    </div>

    <!-- –ü–†–ê–í–û: –ú–ï–¢–†–ò–ö–ò / –ì–†–ê–§–Ü–ö–ò / –°–•–ï–ú–ê -->
    <div class="card">
      <h2>üìä –ú–µ—Ç—Ä–∏–∫–∏ —ñ –ø—ñ–¥—Å—É–º–∫–∏</h2>
      <table class="tbl">
        <tbody>
          <tr><th>–ó–∞–ø–∏—Å—ñ–≤</th><td id="mN">‚Äî</td></tr>
          <tr><th>Minor / Major / Critical</th><td id="mMMC">‚Äî</td></tr>
          <tr><th>–ù–∞–π—á–∞—Å—Ç—ñ—à—ñ –ø—Ä–∏—á–∏–Ω–∏</th><td id="mTop">‚Äî</td></tr>
          <tr><th>–°—Ç–∞–Ω</th><td id="mState">‚Äî</td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üìà –ß–∞—Å—Ç–æ—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</h2>
      <div class="canvasWrap"><canvas id="bar" width="520" height="220"></canvas></div>

      <h2 style="margin-top:10px">üïí –¢–∞–π–º–ª–∞–π–Ω (–¥–∞—Ç–∏/–∫–ª–∞—Å—Ç–µ—Ä–∏ –ø–æ–¥—ñ–π)</h2>
      <div class="canvasWrap"><canvas id="timeline" width="520" height="220"></canvas></div>

      <h2 style="margin-top:10px">üîå –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—É (SVG)</h2>
      <svg viewBox="0 0 820 260" role="img" aria-label="SSOP ‚Üí NLP ‚Üí –†–∏–∑–∏–∫ ‚Üí CAPA ‚Üí –ó–≤—ñ—Ç">
        <rect x="40" y="40" width="160" height="110" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
        <text x="120" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">SSOP / –ñ—É—Ä–Ω–∞–ª–∏</text>
        <text x="120" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">–≤—ñ–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç</text>

        <rect x="220" y="40" width="170" height="110" rx="12" fill="#14532d" stroke="#22c55e"></rect>
        <text x="305" y="80" fill="#dcfce7" font-size="14" text-anchor="middle">NLP –≤–∏—Ç—è–≥</text>
        <text x="305" y="100" fill="#a7f3d0" font-size="12" text-anchor="middle">ZONE/CHEM/TIME/‚Ä¶</text>

        <rect x="410" y="40" width="150" height="110" rx="12" fill="#1f2937" stroke="#9ca3af"></rect>
        <text x="485" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–û—Ü—ñ–Ω–∫–∞ —Ä–∏–∑–∏–∫—É</text>
        <text x="485" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">Minor/Major/Critical</text>

        <rect x="580" y="40" width="180" height="110" rx="12" fill="#0b1a2f" stroke="#64748b"></rect>
        <text x="670" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">CAPA-–ø–ª–∞–Ω</text>
        <text x="670" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">—É—Ç—Ä–∏–º–∞–Ω–Ω—è/5Why/–¥—ñ—ó</text>

        <line x1="200" y1="95" x2="220" y2="95" stroke="#93c5fd" stroke-width="3"></line>
        <line x1="390" y1="95" x2="410" y2="95" stroke="#22c55e" stroke-width="3"></line>
        <line x1="560" y1="95" x2="580" y2="95" stroke="#64748b" stroke-width="3"></line>
      </svg>

      <h2 style="margin-top:10px">üéØ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
      <ol>
        <li>–í—Å—Ç–∞–≤ —â–æ–Ω–∞–π–º–µ–Ω—à–µ <b>6 —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤</b> —ñ–∑ —Ä—ñ–∑–Ω–∏—Ö –∑–æ–Ω (—Ñ–∞—Å—É–≤–∞–Ω–Ω—è/—Ä–æ–∑—Ä—É–±/–º–∏—Ç—Ç—è —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—é/CIP/—à–æ–∫–æ—Ö–æ–ª–æ–¥).</li>
        <li>–ù–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ NLP¬ª, –ø–µ—Ä–µ–≤—ñ—Ä <b>—Å—É—Ç–Ω–æ—Å—Ç—ñ</b> —ñ <b>–Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ</b>, –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π –ª—ñ–º—ñ—Ç–∏ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏.</li>
        <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>CAPA</b> —ñ —É—Ç–æ—á–Ω–∏ —Ç–µ—Ä–º—ñ–Ω–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏—Ö.</li>
        <li>–ï–∫—Å–ø–æ—Ä—Ç—É–π <b>CSV/TXT</b>, –Ω–∞–¥—Ä—É–∫—É–π <b>—á–µ–∫ 58 –º–º</b>, —Å—Ç–≤–æ—Ä–∏ <b>QR</b> –Ω–∞ –ø–∞–ø–∫—É –∑ –¥–æ–∫–∞–∑–∞–º–∏.</li>
      </ol>

      <h2 style="margin-top:10px">üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
      <p class="muted small">–ö–æ–Ω—Ç—Ä–æ–ª—å —Å–∞–Ω—ñ—Ç–∞—Ä—ñ—ó –µ–≤–æ–ª—é—Ü—ñ–æ–Ω—É–≤–∞–≤ –≤—ñ–¥ –ø–∞–ø–µ—Ä–æ–≤–∏—Ö –∂—É—Ä–Ω–∞–ª—ñ–≤ –¥–æ ATP/–∞–ª–µ—Ä–≥–µ–Ω-—Ç–µ—Å—Ç—ñ–≤ —ñ —Ü–∏—Ñ—Ä–æ–≤–∏—Ö –∞—É–¥–∏—Ç—ñ–≤. –ù–∞–≤—ñ—Ç—å ¬´–ª–µ–≥–∫–∏–π¬ª –±—Ä–∞—É–∑–µ—Ä–Ω–∏–π NLP –¥–æ–ø–æ–º–∞–≥–∞—î –∑–∞–∫—Ä–∏—Ç–∏ 80% —Ä—É—Ç–∏–Ω–∏: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü—ñ—è —Ñ–∞–∫—Ç—ñ–≤, –ø—Ä—ñ–æ—Ä–∏—Ç–∏–∑–∞—Ü—ñ—è —Ä–∏–∑–∏–∫—ñ–≤, —à–≤–∏–¥–∫–∏–π CAPA.</p>
    </div>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function log(msg){const t=new Date().toLocaleTimeString();const box=$('#alog');if(box.textContent.startsWith('//'))box.textContent='';box.textContent+=`[${t}] ${msg}\n`;box.scrollTop=box.scrollHeight;}
function num(x){const v=parseFloat(x); return Number.isFinite(v)?v:NaN;}

// ===== –ü—Ä–∏–∫–ª–∞–¥–∏ =====
$('#ex1').addEventListener('click',()=>{
  $('#txt').value = [
'2025-10-18 06:40 ¬∑ –ó–æ–Ω–∞ —Ñ–∞—Å—É–≤–∞–Ω–Ω—è (–π–æ–≥—É—Ä—Ç): CIP –ª—ñ–Ω—ñ—ó –°. –õ—É–∂–Ω–∏–π 2.0 %, 55 ¬∞C, 12 —Ö–≤, –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –û–ö. –û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–∏–ª–∏–ø—á—É–∫.',
'2025-10-18 07:10 ¬∑ –†–æ–∑—Ä—É–±: —Ä—É—á–Ω–∏–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä. –ö–∏—Å–ª–æ—Ç–Ω–∏–π 0.8 %, 42 ¬∞C, –∫–æ–Ω—Ç–∞–∫—Ç 6 —Ö–≤ ‚Äî –ø–æ–∑–Ω–∞—á–µ–Ω–æ ¬´–ø–æ—Å–ø—ñ—Ö¬ª. –í–∏—è–≤–ª–µ–Ω–æ –∞–ª–µ—Ä–≥–µ–Ω: —Å–ª—ñ–¥–∏ –∞—Ä–∞—Ö—ñ—Å—É –Ω–∞ —Å—Ç–æ–ª–∏–∫—É.',
'2025-10-18 08:05 ¬∑ –ú–∏–π–∫–∞ –≤–∞–Ω–Ω: –°–∞–Ω—ñ—Ç–∞–π–∑–µ—Ä QAC 150 ppm, 20 ¬∞C, 15 —Ö–≤. –ü—Ä–∏–º—ñ—Ç–∫–∞: —Ä–ù 9. –û–ø–µ—Ä–∞—Ç–æ—Ä: –ö–æ–≤–∞–ª—å.',
'2025-10-18 08:40 ¬∑ –ü–∞–∫—É–≤–∞–ª—å–Ω–∞: –∫–∞–º–µ—Ä–∞ MAP, –≤–∏—è–≤–ª–µ–Ω–æ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç –Ω–∞ –ª–æ—Ç–∫–∞—Ö. –ü—Ä–æ—Ç–∏–∞–ª–µ—Ä–≥–µ–Ω–Ω–∞ –∑–º—ñ–Ω–∞: –µ—Ç–∏–∫–µ—Ç–∫–∏ –±–µ–∑ ¬´–º–æ–ª–æ–∫–æ¬ª.',
'2025-10-18 09:15 ¬∑ –®–æ–∫–æ—Ö–æ–ª–æ–¥: –Ω–∞–ª—ñ—Ç –ª—å–æ–¥—É –Ω–∞ –≤–∏–ø–∞—Ä–Ω–∏–∫—É, –¥—Ä–µ–Ω–∞–∂ –∑–∞–±–∏—Ç–∏–π. –ü–µ—Å—Ç-–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: —Å–ª—ñ–¥–∏ –≥—Ä–∏–∑—É–Ω—ñ–≤ –±—ñ–ª—è –¥–≤–µ—Ä–µ–π.',
'2025-10-18 10:00 ¬∑ CIP —Å–∏—Ä–Ω–æ—ó –ª—ñ–Ω—ñ—ó –ê: –õ—É–∂–Ω–∏–π 1.0 %, 48 ¬∞C, 9 —Ö–≤. –í—ñ–¥—Å—É—Ç–Ω—ñ–π –∑–∞–ø–∏—Å –ø—Ä–æ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—é. –û–ø–µ—Ä–∞—Ç–æ—Ä: –†–æ–º–∞–Ω–µ–Ω–∫–æ.'
  ].join('\n');
  updCount();
  log('–ü—ñ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ 6 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –∑–∞–ø–∏—Å—ñ–≤');
});
$('#clr').addEventListener('click',()=>{ $('#txt').value=''; updCount(); $('#entBody').innerHTML='<tr><td colspan="10" class="muted">‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑‚Äô—è–≤–∏—Ç—å—Å—è —Ç—É—Ç ‚Äî</td></tr>'; $('#ncBody').innerHTML='<tr><td colspan="5" class="muted">‚Äî —â–µ –ø–æ—Ä–æ–∂–Ω—å–æ ‚Äî</td></tr>'; drawBars([]); drawTimeline([]); setMetrics([],[]); });

function updCount(){ const lines=splitRecs($('#txt').value).length; $('#count').textContent='–ó–∞–ø–∏—Å—ñ–≤: '+lines; }
$('#txt').addEventListener('input', updCount);

// ===== –†–æ–∑–±—ñ—Ä –∑–∞–ø–∏—Å—ñ–≤ —ñ NLP-–≤–∏—Ç—è–≥ =====
function splitRecs(text){
  // —Ä–æ–∑–±–∏–≤–∞—î–º–æ –ø–æ —Ä—è–¥–∫–∞—Ö/–ø–æ—Ä–æ–∂–Ω—ñ—Ö —Ä—è–¥–∫–∞—Ö
  return text.split(/\n+/).map(s=>s.trim()).filter(Boolean);
}

const RX={
  date: /\b(20\d{2}[-./]\d{1,2}[-./]\d{1,2}(?:[ T]\d{1,2}:\d{2})?|\d{1,2}\.\d{1,2}\.\d{2,4})\b/i,
  zone: /(–∑–æ–Ω–∞|–ø–∞–∫—É–≤–∞–ª—å–Ω–∞|—Ä–æ–∑—Ä—É–±|–º–∏–π–∫–∞|—Ñ–∞—Å—É–≤–∞–Ω–Ω—è|CIP|—à–æ–∫–æ—Ö–æ–ª–æ–¥|–∫–∞–º–µ—Ä–∞|–≤–∞–Ω–Ω[–∞–∏]|–≤–∞–Ω–Ω–∞|—Å–∫–ª–∞–¥|—Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∞|–ª—ñ–Ω—ñ—ó?\s*[A-–ØA-Z])/i,
  tool: /(–ª—ñ–Ω—ñ—ó?\s*[A-–ØA-Z]|—ñ–Ω–≤–µ–Ω—Ç–∞—Ä|–Ω–æ–∂[—ñ]|–≤–∞–Ω–Ω–∞|–∫–∞–º–µ—Ä[–∞—ã]|–≤–∏–ø–∞—Ä–Ω–∏–∫|–ª–æ—Ç–∫(–∏|–∞—Ö)|–¥—Ä–µ–Ω–∞–∂|CIP)/i,
  chem: /(–ª—É–∂–Ω(–∏–π|–∞)|–∫–∏—Å–ª–æ—Ç–Ω(–∏–π|–∞)|—Å–∞–Ω—ñ—Ç–∞–π–∑–µ—Ä|QAC|–≥—ñ–ø–æ—Ö–ª–æ—Ä–∏—Ç|–ø–µ—Ä–æ–∫—Å–∏–¥|–ª—É–∂–Ω–∞ –ø—ñ–Ω–∞|–∫–∞—É—Å—Ç–∏–∫|–ü–ê–†)/i,
  concPct: /(\d+(?:[.,]\d+)?)\s?%/,
  ppm: /(\d+(?:[.,]\d+)?)\s?ppm/i,
  temp: /(\d+(?:[.,]\d+)?)\s?(?:¬∞\s?C|C|¬∞)/i,
  timeMin: /(\d+(?:[.,]\d+)?)\s?(?:—Ö–≤|min)/i,
  allerg: /(–∞–ª–µ—Ä–≥–µ–Ω|–∞—Ä–∞—Ö—ñ—Å|gluten|–º–æ–ª–æ–∫–æ|–ª–∞–∫—Ç–æ–∑–∞|—Å–æ—î–≤(–∏–π|—ñ)|—è–π—Ü[—è]|–≥–æ—Ä—ñ—Ö)/i,
  bio: /(Listeria|–°–∞–ª—å–º–æ–Ω–µ–ª|E\.?coli|–∫–∞–º–ø—ñ–ª–æ–±–∞–∫—Ç–µ—Ä|—Ü–≤—ñ–ª(—å|)/i,
  person: /(–û–ø–µ—Ä–∞—Ç–æ—Ä|–º–∞–π—Å—Ç–µ—Ä|–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä)\s*:\s*([A-–Ø–Ü–á–Ñ“ê][–∞-—è—ñ—ó—î“ë']+)/,
  neg: /(–≤—ñ–¥—Å—É—Ç–Ω(—ñ–π|—î)|–±—Ä–∞–∫—É—î|–Ω/–¥|–±–µ–∑ –∑–∞–ø–∏—Å—É|–ø–æ—Å–ø—ñ—Ö|–ø–æ—Ä—É—à–µ–Ω–Ω—è|–∑–∞–±–∏—Ç–∏–π|–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç|—Å–ª—ñ–¥–∏ –≥—Ä–∏–∑—É–Ω—ñ–≤|–Ω–∞–ª—ñ—Ç|—Ç–µ–∫—Ç–∏|–ø—Ä–æ—Ç—ñ–∫)/i
};

function parseRec(text){
  const mDate = text.match(RX.date);
  const date = mDate? mDate[1] : '';
  const zone = (text.match(RX.zone)||['',''])[0];
  const tool = (text.match(RX.tool)||['',''])[0];
  const chem = (text.match(RX.chem)||['',''])[0];
  const conc = (text.match(RX.concPct)||[])[1];
  const ppm  = (text.match(RX.ppm)||[])[1];
  const temp = (text.match(RX.temp)||[])[1];
  const tmin = (text.match(RX.timeMin)||[])[1];
  const allerg = (text.match(RX.allerg)||[])[0] || '';
  const bio = (text.match(RX.bio)||[])[0] || '';
  const person = (text.match(RX.person)||[])[2] || '';
  const neg = RX.neg.test(text);
  // –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —á–∏—Å–µ–ª
  const concN = conc? parseFloat(String(conc).replace(',','.')): NaN;
  const ppmN = ppm? parseFloat(String(ppm).replace(',','.')): NaN;
  const tempN = temp? parseFloat(String(temp).replace(',','.')): NaN;
  const tminN = tmin? parseFloat(String(tmin).replace(',','.')): NaN;

  return {raw:text, date, zone, tool, chem, conc:concN, ppm:ppmN, temp:tempN, tmin:tminN, allerg, bio, person};
}

// ===== –û—Ü—ñ–Ω–∫–∞ —Ä–∏–∑–∏–∫—É (Minor/Major/Critical) =====
function assess(rec, limits){
  // —Ç—Ä–∏–≥–µ—Ä–∏
  const issues=[];
  // –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∏–∂—á–µ –ª—ñ–º—ñ—Ç—ñ–≤
  if(Number.isFinite(rec.conc) && rec.conc < limits.conc) issues.push('–Ω–∏–∑—å–∫–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è');
  if(Number.isFinite(rec.temp) && rec.temp < limits.temp) issues.push('–Ω–∏–∑—å–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞');
  if(Number.isFinite(rec.tmin) && rec.tmin < limits.tmin) issues.push('–Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π —á–∞—Å –∫–æ–Ω—Ç–∞–∫—Ç—É');
  if(Number.isFinite(rec.ppm) && rec.ppm < 100) issues.push('–∑–∞–Ω–∏–∑—å–∫–∏–π QAC ppm');
  // —Ç—Ä–∏–≥–µ—Ä–∏ –∫–ª—é—á–æ–≤–∏—Ö —Ä–∏–∑–∏–∫—ñ–≤
  if(rec.allerg) issues.push('–∞–ª–µ—Ä–≥–µ–Ω–Ω–∏–π —Ä–∏–∑–∏–∫');
  if(rec.bio) issues.push('–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –±—ñ–æ–Ω–µ–±–µ–∑–ø–µ–∫–∞');
  if(/–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç/i.test(rec.raw)) issues.push('–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç –Ω–∞ —É–ø–∞–∫–æ–≤—Ü—ñ/–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—ñ');
  if(/–≥—Ä–∏–∑—É–Ω/i.test(rec.raw)) issues.push('—Å–ª—ñ–¥–∏ —à–∫—ñ–¥–Ω–∏–∫—ñ–≤');
  if(/–∑–∞–±–∏—Ç/i.test(rec.raw)) issues.push('–∑–∞–±–∏—Ç–∏–π –¥—Ä–µ–Ω–∞–∂');
  if(/–±–µ–∑\s*–∑–∞–ø–∏—Å—É|–≤—ñ–¥—Å—É—Ç–Ω/i.test(rec.raw)) issues.push('–≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∑–∞–ø–∏—Å/–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è');

  // –ø—Ä–∞–≤–∏–ª–æ —Å—Ç—É–ø–µ–Ω—è
  let degree='Minor';
  const hasCritical = ['–∞–ª–µ—Ä–≥–µ–Ω–Ω–∏–π —Ä–∏–∑–∏–∫','–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –±—ñ–æ–Ω–µ–±–µ–∑–ø–µ–∫–∞','—Å–ª—ñ–¥–∏ —à–∫—ñ–¥–Ω–∏–∫—ñ–≤'].some(x=>issues.includes(x));
  const bigProcess = ['–Ω–∏–∑—å–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞','–Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π —á–∞—Å –∫–æ–Ω—Ç–∞–∫—Ç—É','–Ω–∏–∑—å–∫–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è','–∑–∞–Ω–∏–∑—å–∫–∏–π QAC ppm'].some(x=>issues.includes(x));
  if(hasCritical) degree='Critical';
  else if(bigProcess || issues.length>=2) degree='Major';
  // –ø–æ—è—Å–Ω–µ–Ω–Ω—è
  const reason = issues.length? issues.join('; '): '–≤—ñ–¥—Ö–∏–ª–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
  return {degree, reason, issues};
}

// ===== –ê–Ω–∞–ª—ñ–∑ –Ω–∞—Ç–∏—Å–∫–æ–º =====
$('#an').addEventListener('click', ()=>{
  const recs = splitRecs($('#txt').value).map(parseRec);
  if(!recs.length){ alert('–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤'); return; }
  const limits = {conc: +$('#limConc').value, temp: +$('#limT').value, tmin: +$('#limMin').value};
  const entsBody=$('#entBody'); entsBody.innerHTML='';
  recs.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(r.date||'‚Äî')}</td><td>${escapeHtml(r.zone||'‚Äî')}</td><td>${escapeHtml(r.tool||'‚Äî')}</td>
      <td>${escapeHtml(r.chem||'‚Äî')}</td><td>${Number.isFinite(r.conc)?r.conc.toFixed(2):'‚Äî'}</td>
      <td>${Number.isFinite(r.temp)?r.temp.toFixed(1):'‚Äî'}</td><td>${Number.isFinite(r.tmin)?r.tmin.toFixed(1):'‚Äî'}</td>
      <td>${escapeHtml((r.allerg+' '+r.bio).trim()||'‚Äî')}</td><td>${escapeHtml(r.person||'‚Äî')}</td>`;
    entsBody.appendChild(tr);
  });

  const ncs=[]; const ncBody=$('#ncBody'); ncBody.innerHTML='';
  recs.forEach((r,i)=>{
    const a=assess(r,limits);
    if(a.reason!=='–≤—ñ–¥—Ö–∏–ª–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'){
      ncs.push({idx:i+1, type:firstType(a), desc:a.reason, degree:a.degree});
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(firstType(a))}</td><td>${escapeHtml(a.reason)}</td>
      <td>${escapeHtml(r.zone||'‚Äî')}</td><td class="${a.degree==='Critical'?'bad':a.degree==='Major'?'warn':'ok'}"><b>${a.degree}</b></td>`;
      ncBody.appendChild(tr);
    }
  });
  if(!ncs.length) ncBody.innerHTML = '<tr><td colspan="5" class="ok">üéâ –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç–µ–π –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ</td></tr>';

  drawBars(ncs);
  drawTimeline(recs);
  setMetrics(recs,ncs);
  log(`–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ ${recs.length} –∑–∞–ø–∏—Å(—ñ–≤), –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç–µ–π: ${ncs.length}`);
});

function firstType(a){
  const pri=['–∞–ª–µ—Ä–≥–µ–Ω–Ω–∏–π —Ä–∏–∑–∏–∫','–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –±—ñ–æ–Ω–µ–±–µ–∑–ø–µ–∫–∞','—Å–ª—ñ–¥–∏ —à–∫—ñ–¥–Ω–∏–∫—ñ–≤','–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç –Ω–∞ —É–ø–∞–∫–æ–≤—Ü—ñ/–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—ñ','–∑–∞–±–∏—Ç–∏–π –¥—Ä–µ–Ω–∞–∂','–Ω–∏–∑—å–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞','–Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π —á–∞—Å –∫–æ–Ω—Ç–∞–∫—Ç—É','–Ω–∏–∑—å–∫–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è','–∑–∞–Ω–∏–∑—å–∫–∏–π QAC ppm','–≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∑–∞–ø–∏—Å/–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è'];
  for(const p of pri) if(a.issues.includes(p)) return p;
  return '–∑–∞–≥–∞–ª—å–Ω–µ';
}

function setMetrics(recs,ncs){
  $('#mN').textContent = recs.length;
  const mmc = {Minor:0,Major:0,Critical:0};
  ncs.forEach(n=>mmc[n.degree]++);
  $('#mMMC').textContent = `Minor ${mmc.Minor} / Major ${mmc.Major} / Critical ${mmc.Critical}`;
  const causes = {};
  ncs.forEach(n=>{ causes[n.type]=(causes[n.type]||0)+1; });
  const top = Object.entries(causes).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([k,v])=>`${k}√ó${v}`).join(', ') || '‚Äî';
  $('#mTop').textContent = top;
  $('#mState').innerHTML = (mmc.Critical>0? `<b class="bad">–ü–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–µ–≥–∞–π–Ω–∞ –¥—ñ—è (—î Critical)</b>`:
                           mmc.Major>0? `<b class="warn">–Ñ Major ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω–∞ CAPA</b>`:
                           `<b class="ok">–°—É—Ç—Ç—î–≤–∏—Ö —Ä–∏–∑–∏–∫—ñ–≤ –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ</b>`);
}

// ===== –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó =====
const bar=$('#bar'), gb=bar.getContext('2d');
function drawBars(ncs){
  const W=bar.width,H=bar.height; gb.clearRect(0,0,W,H);
  gb.strokeStyle='#223049'; gb.strokeRect(0.5,0.5,W-1,H-1);
  const cats=['–Ω–∏–∑—å–∫–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è','–Ω–∏–∑—å–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞','–Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π —á–∞—Å –∫–æ–Ω—Ç–∞–∫—Ç—É','–∑–∞–Ω–∏–∑—å–∫–∏–π QAC ppm','–∞–ª–µ—Ä–≥–µ–Ω–Ω–∏–π —Ä–∏–∑–∏–∫','–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –±—ñ–æ–Ω–µ–±–µ–∑–ø–µ–∫–∞','—Å–ª—ñ–¥–∏ —à–∫—ñ–¥–Ω–∏–∫—ñ–≤','–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç –Ω–∞ —É–ø–∞–∫–æ–≤—Ü—ñ/–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—ñ','–∑–∞–±–∏—Ç–∏–π –¥—Ä–µ–Ω–∞–∂','–≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∑–∞–ø–∏—Å/–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è'];
  const cnt = cats.map(c=> ncs.filter(n=>n.type===c).length);
  const max = Math.max(1,...cnt);
  const left=40,right=W-10,top=20,bottom=H-24; const bw=(right-left)/cats.length;
  for(let i=0;i<cats.length;i++){
    const x=left+i*bw+4; const h=(cnt[i]/max)*(bottom-top);
    gb.fillStyle='#38bdf8'; gb.fillRect(x, bottom-h, bw-8, h);
  }
  gb.fillStyle='#94a3b8'; gb.font='11px ui-monospace';
  gb.fillText('–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó (Top-10)', left, 14);
}

const tl=$('#timeline'), gt=tl.getContext('2d');
function drawTimeline(recs){
  const W=tl.width,H=tl.height; gt.clearRect(0,0,W,H);
  gt.strokeStyle='#223049'; gt.strokeRect(0.5,0.5,W-1,H-1);
  if(!recs.length){ gt.fillStyle='#94a3b8'; gt.fillText('–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤',14,20); return; }
  // –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –¥–∞—Ç–∏
  const toTs=d=>{ const m=(d||'').replace('¬∑',' ').trim(); const t=Date.parse(m)||Date.parse(m.replace(/(\d{1,2})\.(\d{1,2})\.(\d{2,4})/,'$3-$2-$1')); return isNaN(t)?null:t; };
  const arr = recs.map(r=>({t:toTs(r.date), raw:r.raw})).filter(o=>o.t!=null).sort((a,b)=>a.t-b.t);
  const t0=arr[0]?.t||Date.now(), t1=arr[arr.length-1]?.t||t0+1;
  const left=40,right=W-10,top=24,bottom=H-30;
  function xOf(t){ return left + (t-t0)/(t1-t0||1)*(right-left); }
  // –≤—ñ—Å—å
  gt.strokeStyle='#334155'; gt.beginPath(); gt.moveTo(left,bottom); gt.lineTo(right,bottom); gt.stroke();
  // —Ç–æ—á–∫–∏
  arr.forEach((o,i)=>{
    const x=xOf(o.t); const y=bottom - 10 - (i%3)*18;
    gt.fillStyle='#22c55e'; gt.fillRect(x-3,y-3,6,6);
  });
  gt.fillStyle='#94a3b8'; gt.font='11px ui-monospace';
  const fmt=d=>new Date(d).toISOString().slice(0,16).replace('T',' ');
  gt.fillText(fmt(t0), left, H-8); gt.fillText(fmt(t1), right-120, H-8);
}

// ===== CAPA-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä =====
$('#genCapa').addEventListener('click', ()=>{
  const rows=$$('#ncBody tr');
  const items=[];
  rows.forEach(r=>{
    const cells=r.querySelectorAll('td');
    if(!cells.length) return;
    const idx=cells[0].textContent.trim();
    const type=cells[1]?.textContent.trim()||'';
    const desc=cells[2]?.textContent.trim()||'';
    const zone=cells[3]?.textContent.trim()||'';
    const deg=cells[4]?.textContent.trim()||'';
    if(idx) items.push({idx,type,desc,zone,deg});
  });
  if(!items.length){ alert('–ù–µ–º–∞—î –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç–µ–π'); return; }
  const today=new Date();
  const addDays=(n)=>{const d=new Date(today); d.setDate(d.getDate()+n); return d.toISOString().slice(0,10);}
  const lines=[];
  items.forEach((it,k)=>{
    lines.push(`–ö–µ–π—Å #${it.idx} (${it.deg}): ${it.type} ‚Äî ${it.zone}`);
    lines.push(`1) –£—Ç—Ä–∏–º–∞–Ω–Ω—è: —ñ–∑–æ–ª—é–≤–∞—Ç–∏ –∑–æ–Ω—É/–ø–∞—Ä—Ç—ñ—é; –ø–æ–≤—Ç–æ—Ä–Ω–∞ —Å–∞–Ω—ñ—Ç–∞—Ä—ñ—è; –∑–∞–±–æ—Ä–æ–Ω–∞ –ø—É—Å–∫—É –¥–æ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (–¥–µ–¥–ª–∞–π–Ω ${addDays(0)}).`);
    lines.push(`2) 5 —á–æ–º—É: —á–æ–º—É —Å—Ç–∞–ª–æ—Å—è? ‚Üí –ø—Ä–æ—Ü–µ–¥—É—Ä–∞? ‚Üí –Ω–∞–≤—á–∞–Ω–Ω—è? ‚Üí –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è? ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª—å? (–≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π: –º–∞–π—Å—Ç–µ—Ä –∑–º—ñ–Ω–∏).`);
    lines.push(`3) –ö–æ—Ä–∏–≥—É—é—á—ñ: –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (–∫–æ–Ω—Ü./T/—á–∞—Å), —É—Å—É–Ω—É—Ç–∏ –ø—Ä–∏—á–∏–Ω—É (${addDays(2)}).`);
    lines.push(`4) –ó–∞–ø–æ–±—ñ–∂–Ω—ñ: –æ–Ω–æ–≤–∏—Ç–∏ SSOP/—á–µ–∫-–ª–∏—Å—Ç, —Ç—Ä–µ–Ω—ñ–Ω–≥ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤, –¥–æ–¥–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π –ø—É–Ω–∫—Ç (${addDays(7)}).`);
    lines.push(`5) –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è: ATP/–∞–ª–µ—Ä–≥–µ–Ω-—Ç–µ—Å—Ç/–º—ñ–∫—Ä–æ–±—ñ–æ–ª–æ–≥—ñ—è; –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ 14 –¥–Ω—ñ–≤ (${addDays(14)}).`);
    lines.push('');
  });
  $('#capa').value = lines.join('\n').trim();
  log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ CAPA-–ø–ª–∞–Ω');
});

// ===== –ï–∫—Å–ø–æ—Ä—Ç =====
$('#saveCsv').addEventListener('click', ()=>{
  const entRows=$$('#entBody tr'); let csv='idx,date,zone,tool,chem,conc_pct,temp_c,contact_min,allergen_bio,person\n';
  entRows.forEach((tr,i)=>{
    const tds=tr.querySelectorAll('td'); if(!tds.length) return;
    csv+=`${i+1},${clean(tds[1].innerText)},${clean(tds[2].innerText)},${clean(tds[3].innerText)},${clean(tds[4].innerText)},${clean(tds[5].innerText)},${clean(tds[6].innerText)},${clean(tds[7].innerText)},${clean(tds[8].innerText)},${clean(tds[9].innerText)}\n`;
  });
  csv+='\n# nonconformities\nidx,type,desc,zone,degree\n';
  const ncRows=$$('#ncBody tr');
  ncRows.forEach(tr=>{
    const tds=tr.querySelectorAll('td'); if(tds.length<5) return;
    csv+=`${clean(tds[0].innerText)},${clean(tds[1].innerText)},${clean(tds[2].innerText)},${clean(tds[3].innerText)},${clean(tds[4].innerText)}\n`;
  });
  download('tech_para25_nlp_'+stamp()+'.csv', csv, 'text/csv');
});
$('#saveTxt').addEventListener('click', ()=>{
  const lines=[
    '–ü–∞—Ä–∞ 25 ‚Äî –®–Ü –¥–ª—è –∞—É–¥–∏—Ç—É —Å–∞–Ω—ñ—Ç–∞—Ä—ñ—ó: –ø—ñ–¥—Å—É–º–æ–∫',
    '–õ–æ—Ç/–ª—ñ–Ω—ñ—è: '+($('#lot').value||'‚Äî'),
    '–ó–∞–ø–∏—Å—ñ–≤: '+($('#mN').textContent||'‚Äî'),
    'Minor/Major/Critical: '+($('#mMMC').textContent||'‚Äî'),
    '–ù–∞–π—á–∞—Å—Ç—ñ—à—ñ –ø—Ä–∏—á–∏–Ω–∏: '+($('#mTop').textContent||'‚Äî'),
    '–°—Ç–∞–Ω: '+($('#mState').innerText||'‚Äî'),
    '',
    '--- CAPA ---',
    $('#capa').value.trim()||'(–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ)'
  ];
  download('tech_para25_summary_'+stamp()+'.txt', lines.join('\n'));
});
$('#print58').addEventListener('click', ()=>{
  const rc=$('#rc'); rc.hidden=false;
  const lines=[
'=== SSOP AUDIT (58–º–º) ===',
'–õ–æ—Ç: '+($('#lot').value||'‚Äî'),
'–ó–∞–ø–∏—Å—ñ–≤: '+($('#mN').textContent||'‚Äî'),
$('#mMMC').textContent||'‚Äî',
($('#mState').innerText||'‚Äî'),
'--- TOP ---',
$('#mTop').textContent||'‚Äî',
'--------------------------'
  ];
  rc.textContent = lines.join('\n');
  download('tech_para25_receipt_'+stamp()+'.txt', rc.textContent);
});
$('#qrGen').addEventListener('click', ()=>{
  const data = prompt('–í—Å—Ç–∞–≤ URL/—Ç–µ–∫—Å—Ç (–ø–∞–ø–∫–∞ –∑ –∞–∫—Ç–∞–º–∏/—Ñ–æ—Ç–æ):', $('#lot').value || 'ssop-evidence');
  if(data===null) return;
  const url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=2&data='+encodeURIComponent(data);
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.drawImage(img,0,0,220,220); };
  img.onerror=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.fillStyle='#e5e7eb'; q.font='14px ui-monospace'; q.fillText('QR offline', 62,110); q.fillText((data.length>14?data.slice(0,14)+'‚Ä¶':data), 36,132); };
  img.src=url;
});

// ===== –î–æ–ø–æ–º—ñ–∂–Ω—ñ =====
function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
function clean(s){return String(s).replace(/\s+/g,' ').trim();}

// ===== –ü–æ—á–∞—Ç–∫–æ–≤–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è =====
updCount();

// –í–±—É–¥–æ–≤–∞–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è (Moodle/iFrame)
(function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();
</script>


</body></html>