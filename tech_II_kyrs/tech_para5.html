<!-- tech_para5.html
     –ü–ê–†–ê 5 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–≤ –∑ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞
     –¢–µ–º–∞: –ü–†–ò–ô–ú–ê–ù–ù–Ø –°–ò–†–û–í–ò–ù–ò, –¢–ï–ú–ü–ï–†–ê–¢–£–†–ù–ò–ô –ö–û–ù–¢–†–û–õ–¨, FEFO, –õ–û–ö–ê–¶–Ü–á –°–ö–õ–ê–î–£.
           –ê–∫—Ç –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ, –µ—Ç–∏–∫–µ—Ç–∫–∞ –ø–∞–ª–µ—Ç–∏ 58 –º–º, NFC, QR-payload, CSV-–∂—É—Ä–Ω–∞–ª.
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏; (–æ–ø—Ü.) —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º; NFC-–º—ñ—Ç–∫–∏.

     –ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 5 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –ü—Ä–∏–π–º–∞–Ω–Ω—è —Å–∏—Ä–æ–≤–∏–Ω–∏: T-–∫–æ–Ω—Ç—Ä–æ–ª—å, FEFO, –ª–æ–∫–∞—Ü—ñ—ó, –∞–∫—Ç, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC, CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  textarea{min-height:84px}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ –≤ Moodle (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 5 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –ø–µ—Ä–µ—Ä–æ–±–∫–∏</span>
  <h1>üöö –ü—Ä–∏–π–º–∞–Ω–Ω—è —Å–∏—Ä–æ–≤–∏–Ω–∏: T-–∫–æ–Ω—Ç—Ä–æ–ª—å, FEFO, –ª–æ–∫–∞—Ü—ñ—ó, –∞–∫—Ç, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC, CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –ø–∞—Ä–∏</h2>
    <p>
      –ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏ –æ—Ñ–æ—Ä–º–ª—è—Ç—å <b>–ø—Ä–∏–π–º–∞–Ω–Ω—è —Å–∏—Ä–æ–≤–∏–Ω–∏</b>: –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç—å <b>—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É</b>, —Å—Ç—Ä–æ–∫–∏ <b>FEFO</b>,
      –∑–≥–µ–Ω–µ—Ä—É—é—Ç—å <b>–ª–æ–∫–∞—Ü—ñ—é —Å–∫–ª–∞–¥—É</b> —ñ <b>–µ—Ç–∏–∫–µ—Ç–∫—É –ø–∞–ª–µ—Ç–∏ (58 –º–º)</b>, —Å—Ç–≤–æ—Ä—è—Ç—å <b>–∞–∫—Ç –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ</b>, <b>QR/NFC</b> —Ç–∞ <b>CSV-–∂—É—Ä–Ω–∞–ª</b>.
    </p>
    <p class="small muted">–ü—Ä–∞–≤–∏–ª–∞: —Ö–æ–ª–æ–¥–æ–≤–∏–π –ª–∞–Ω—Ü—é–≥, –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Å—É–ø—Ä–æ–≤—ñ–¥ (–≤–µ—Ç–¥–æ–≤—ñ–¥–∫–∞/CoA), –º–∞—Ä–∫—É–≤–∞–Ω–Ω—è –ª–æ—Ç—ñ–≤, FEFO (first expired ‚Äî first out).</p>
  </div>

  <!-- 1. –í–•–Ü–î–ù–Ü –î–ê–ù–Ü –ü–û–°–¢–ê–í–ö–ò -->
  <div class="card">
    <h2>üì¶ –î–∞–Ω—ñ –ø–æ—Å—Ç–∞–≤–∫–∏</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ / —Ç–æ–≤–∞—Ä</h3>
        <div class="row">
          <div style="flex:1"><label>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫</label><input id="supplier" type="text" value="–¢–û–í ‚Äú–ú º—è—Å–¢—Ä–µ–π–¥‚Äù"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
            <select id="category">
              <option value="chilled" selected>–û—Ö–æ–ª–æ–¥–∂–µ–Ω–µ –º º—è—Å–æ</option>
              <option value="frozen">–ó–∞–º–æ—Ä–æ–∂–µ–Ω–µ –º º—è—Å–æ</option>
              <option value="milk">–ú–æ–ª–æ—á–Ω–∞ —Å–∏—Ä–æ–≤–∏–Ω–∞</option>
              <option value="spice">–°–ø–µ—Ü—ñ—ó/–¥–æ–±–∞–≤–∫–∏</option>
              <option value="pack">–ü–∞–∫—É–≤–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</option>
            </select>
          </div>
          <div style="flex:1"><label>–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è</label><input id="item" type="text" value="–°–≤–∏–Ω–∏–Ω–∞ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–∞, –ø—ñ–≤—Ç—É—à–∞"></div>
        </div>
      </div>

      <div class="box">
        <h3>–ü–∞—Ä—Ç—ñ—è —ñ —Å—Ç—Ä–æ–∫–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–õ–æ—Ç</label><input id="lot" type="text" value="S-25041-AC"></div>
          <div style="flex:1"><label>–î–∞—Ç–∞ –≤–∏—Ä–æ–±–Ω.</label><input id="prodDate" type="date"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>‚Äú–í–∂–∏—Ç–∏ –¥–æ‚Äù</label><input id="expDate" type="date"></div>
          <div style="flex:1"><label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å, –∫–≥</label><input id="qtyKg" type="number" step="0.1" value="800"></div>
        </div>
      </div>

      <div class="box">
        <h3>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ / –¥–æ–∫—É–º–µ–Ω—Ç–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–∏ –ø—Ä–∏–π–º–∞–Ω–Ω—ñ, ¬∞C</label><input id="temp" type="number" step="0.1" value="3.0"></div>
          <div style="flex:1"><label>–£–ø–∞–∫—É–≤–∞–Ω–Ω—è</label>
            <select id="pack">
              <option value="bulk">–ù–∞–≤–∞–ª</option>
              <option value="vac" selected>–í–∞–∫—É—É–º</option>
              <option value="map">MAP</option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1">
            <label>–î–æ–∫—É–º–µ–Ω—Ç–∏</label>
            <select id="docs">
              <option value="ok" selected>–ü–æ–≤–Ω—ñ (–≤–µ—Ç–¥–æ–≤—ñ–¥–∫–∞/CoA/–Ω–∞–∫–ª–∞–¥–Ω–∞)</option>
              <option value="partial">–ù –Ω–µ–ø–æ–≤–Ω—ñ</option>
              <option value="missing">–í—ñ–¥—Å—É—Ç–Ω—ñ</option>
            </select>
          </div>
          <div style="flex:1"><label>–í–∏–¥–∏–º–∞ —á–∏—Å—Ç–æ—Ç–∞ —Ç–∞—Ä–∏</label>
            <select id="packClean">
              <option>–¢–∞–∫</option><option>–ù—ñ</option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="calcAll()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="preset()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
          <button class="btn" onclick="copyCSV('csvCore')">üìã CSV</button>
        </div>
        <div id="csvCore" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
    <p class="small muted">–õ—ñ–º—ñ—Ç–∏ T (–Ω–∞–≤—á–∞–ª—å–Ω–æ): –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–µ 0‚Ä¶+4 ¬∞C; –º–æ–ª–æ—á–Ω–∞ —Å–∏—Ä–æ–≤–∏–Ω–∞ 0‚Ä¶+6 ¬∞C; –∑–∞–º–æ—Ä–æ–∂–µ–Ω–µ ‚â§ ‚àí12 ¬∞C.</p>
  </div>

  <!-- 2. FEFO —Ç–∞ –õ–û–ö–ê–¶–Ü–Ø –°–ö–õ–ê–î–£ -->
  <div class="card">
    <h2>üß≠ FEFO —Ç–∞ –ª–æ–∫–∞—Ü—ñ—è</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç FEFO</h3>
        <p>–ó–∞–ª–∏—à–æ–∫ –¥–æ ‚Äú–≤–∂–∏—Ç–∏ –¥–æ‚Äù: <b><span id="daysLeft">‚Äî</span></b> –¥–Ω—ñ–≤</p>
        <p>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤—ñ–¥–±–æ—Ä—É: <b><span id="prio">‚Äî</span></b></p>
        <p>–†–µ–∫–æ–º–µ–Ω–¥. –¥–∞—Ç–∞ –≤—ñ–¥–±–æ—Ä—É (D‚àí2): <b><span id="pickDate">‚Äî</span></b></p>
      </div>
      <div class="box">
        <h3>–õ–æ–∫–∞—Ü—ñ—è —Å–∫–ª–∞–¥—É</h3>
        <p>–ó–æ–Ω–∞: <b><span id="zone">‚Äî</span></b></p>
        <p>–°—Ç–µ–ª–∞–∂/–æ—Å–µ—Ä–µ–¥–æ–∫: <b><span id="bin">‚Äî</span></b></p>
        <p class="small muted">–°—Ö–µ–º–∞: CH-2 (0‚Ä¶+4 ¬∞C), ML-6 (0‚Ä¶+6 ¬∞C), FRZ-18 (‚àí18 ¬∞C), DRY-18 (—Å—É—Ö–∏–π).</p>
      </div>
      <div class="box">
        <h3>–°—Ç–∞—Ç—É—Å –ø—Ä–∏–π–º–∞–Ω–Ω—è</h3>
        <p>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞/–¥–æ–∫—É–º–µ–Ω—Ç–∏: <b><span id="status">‚Äî</span></b></p>
        <p>–ü–æ—è—Å–Ω–µ–Ω–Ω—è: <b><span id="reason">‚Äî</span></b></p>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildDeviation()">üìù –ê–∫—Ç –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ</button>
          <button class="btn" onclick="copyEl('devOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="devOut" class="out">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 3. –ñ–£–†–ù–ê–õ –ü–†–ò–ô–ú–ê–ù–ù–Ø -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª –ø—Ä–∏–π–º–∞–Ω–Ω—è</h2>
    <div class="row">
      <button class="btn" onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
      <button class="btn" onclick="presetRows()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (journal)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblLog">
        <thead>
          <tr>
            <th>#</th>
            <th>–¢–æ–≤–∞—Ä</th>
            <th class="dark">–õ–æ—Ç</th>
            <th class="dark">‚Äú–í–∂–∏—Ç–∏ –¥–æ‚Äù</th>
            <th class="dark">T, ¬∞C</th>
            <th>–ó–æ–Ω–∞</th>
            <th>–û—Å–µ—Ä–µ–¥–æ–∫</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          </tr>
        </thead>
        <tbody id="bodyLog"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 4. –ö–í–ò–¢–û–ö 58 –º–º + NFC + QR -->
  <div class="card">
    <h2>üßæ –ï—Ç–∏–∫–µ—Ç–∫–∞ –ø–∞–ª–µ—Ç–∏ 58 –º–º, NFC —ñ QR-payload</h2>
    <div class="grid g2">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúRAW INBOUND CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç/—Ç–µ—Ö–Ω.</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          <div style="flex:1"><label>–ö-—Ç—å –ø–∞–ª–µ—Ç</label><input id="pallets" type="number" step="1" value="2"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
        <h3 style="margin-top:12px">QR-payload</h3>
        <div class="row">
          <button class="btn" onclick="buildQR()">üß© –ó—ñ–±—Ä–∞—Ç–∏ QR</button>
          <button class="btn" onclick="copyEl('qrOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="qrOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ –¥–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞ 58 –º–º</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>RAW MATERIAL PALLET</h4>
          <p><b>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫:</b> <span id="tSupp">‚Äî</span></p>
          <p><b>–¢–æ–≤–∞—Ä:</b> <span id="tItem">‚Äî</span></p>
          <p><b>–õ–æ—Ç:</b> <span id="tLot">‚Äî</span></p>
          <div class="line"></div>
          <p><b>–í–∏—Ä–æ–±–Ω.:</b> <span id="tProdD">‚Äî</span> ¬∑ <b>–í–∂–∏—Ç–∏ –¥–æ:</b> <span id="tExpD">‚Äî</span></p>
          <p><b>FEFO:</b> <span id="tFEFO">‚Äî</span> ¬∑ <b>–ü—Ä—ñ–æ:</b> <span id="tPrio">‚Äî</span></p>
          <p><b>–ó–æ–Ω–∞:</b> <span id="tZone">‚Äî</span> ¬∑ <b>–û—Å–µ—Ä–µ–¥–æ–∫:</b> <span id="tBin">‚Äî</span></p>
          <div class="line"></div>
          <p><b>T –ø—Ä–∏–π–º.:</b> <span id="tTemp">‚Äî</span> ¬∞C ¬∑ <b>–ö-—Ç—å:</b> <span id="tQty">‚Äî</span> –∫–≥</p>
          <p><b>–°—Ç–∞—Ç—É—Å:</b> <span id="tStatus">‚Äî</span></p>
          <div class="line"></div>
          <p><small id="tNote">–î–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å —Ö–æ–ª–æ–¥–æ–≤–æ–≥–æ –ª–∞–Ω—Ü—é–≥–∞. –í—ñ–¥–±—ñ—Ä –∑–∞ FEFO.</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 5. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–ó–∞–ø–æ–≤–Ω–∏ –¥–∞–Ω—ñ –ø–æ—Å—Ç–∞–≤–∫–∏; –≤–∏–º—ñ—Ä—è–π/–≤–Ω–µ—Å–∏ <b>—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É</b>, –∑–∞–¥–∞–π —Å—Ç—Ä–æ–∫–∏.</li>
      <li>–ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏‚Äù: –ø–µ—Ä–µ–≤—ñ—Ä <b>—Å—Ç–∞—Ç—É—Å</b>, <b>–∑–æ–Ω—É/–æ—Å–µ—Ä–µ–¥–æ–∫</b>, <b>FEFO</b>.</li>
      <li>–ó–∞ –ø–æ—Ç—Ä–µ–±–∏ —Å—Ñ–æ—Ä–º—É–π <b>–∞–∫—Ç –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ</b>.</li>
      <li>–î–æ–¥–∞–π 2‚Äì3 –∑–∞–ø–∏—Å–∏ –≤ <b>–∂—É—Ä–Ω–∞–ª</b>; –∑–≥–µ–Ω–µ—Ä—É–π <b>NFC</b>, <b>QR</b> —Ç–∞ <b>–∫–≤–∏—Ç–æ–∫</b>, —Å–∫–æ–ø—ñ—é–π <b>CSV</b>.</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–∏–π T-–∫–æ–Ω—Ç—Ä–æ–ª—å, FEFO, –∑–æ–Ω–∞/–æ—Å–µ—Ä–µ–¥–æ–∫</td><td>4</td></tr>
        <tr><td>–ñ—É—Ä–Ω–∞–ª –ø—Ä–∏–π–º–∞–Ω–Ω—è + CSV</td><td>3</td></tr>
        <tr><td>–ö–≤–∏—Ç–æ–∫ 58 –º–º, NFC/QR</td><td>2</td></tr>
        <tr><td>–ê–∫—Ç –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ (–∑–∞ –∫–µ–π—Å–æ–º)</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  const bodyLog = byId('bodyLog');

  // –î–æ–ø–æ–º—ñ–∂–Ω—ñ
  function daysBetween(a,b){ return Math.round((b - a)/(1000*60*60*24)); }
  function pad(n){ return String(n).padStart(2,'0'); }
  function fmtDate(d){ return d.toISOString().slice(0,10); }

  // –ù–æ—Ä–º–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä (–Ω–∞–≤—á–∞–ª—å–Ω—ñ)
  const tempLimits = {
    chilled: {min:0, max:4, zone:'CH-2'},
    milk:    {min:0, max:6, zone:'ML-6'},
    frozen:  {min:-25, max:-12, zone:'FRZ-18'},
    spice:   {min:10, max:25, zone:'DRY-18'},
    pack:    {min:10, max:25, zone:'DRY-18'}
  };

  function randomBin(zone){
    // –ü—Ä–æ—Å—Ç–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Å–µ—Ä–µ–¥–∫—É: –∑–æ–Ω–∞-—Å—Ç–µ–ª–∞–∂-—Ä—è–¥-–ø–æ–ª–∏—Ü—è
    const shelf = Math.floor(1+Math.random()*8);
    const row = String.fromCharCode(65 + Math.floor(Math.random()*6)); // A..F
    const lvl = Math.floor(1+Math.random()*4);
    return `${zone}-${shelf}${row}-${lvl}`;
  }

  function calcAll(){
    const cat = byId('category').value;
    const lim = tempLimits[cat] || tempLimits.chilled;

    // –¥–∞—Ç–∏
    const now = new Date();
    const prod = byId('prodDate').value ? new Date(byId('prodDate').value) : now;
    const exp  = byId('expDate').value  ? new Date(byId('expDate').value)  : new Date(now.getFullYear(), now.getMonth(), now.getDate()+7);

    // FEFO
    const daysLeft = daysBetween(now, exp);
    const pick = new Date(exp); pick.setDate(pick.getDate()-2);
    const prio = (daysLeft<=2)?'üî¥ –í–∏—Å–æ–∫–∏–π' : (daysLeft<=5)?'üü† –°–µ—Ä–µ–¥–Ω—ñ–π' : 'üü¢ –ó–≤–∏—á–∞–π–Ω–∏–π';

    // –õ–æ–∫–∞—Ü—ñ—è
    const zone = lim.zone;
    const bin = randomBin(zone);

    // –°—Ç–∞—Ç—É—Å –ø—Ä–∏–π–º–∞–Ω–Ω—è (T + –¥–æ–∫—É–º–µ–Ω—Ç–∏ + —á–∏—Å—Ç–æ—Ç–∞)
    const T = Number(byId('temp').value);
    const docs = byId('docs').value;
    const clean = byId('packClean').value==='–¢–∞–∫';

    let status='üü¢ –î–û–ü–£–°–¢–ò–¢–ò', reason='–£ –º–µ–∂–∞—Ö –Ω–æ—Ä–º';
    if(isNaN(T)) { status='üü† –£–ú–û–í–ù–û'; reason='–ù–µ –≤–∫–∞–∑–∞–Ω–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É'; }
    else if(T<lim.min || T>lim.max) { status='üî¥ –í–Ü–î–•–ò–õ–ï–ù–ù–Ø'; reason=`T=${T}¬∞C –ø–æ–∑–∞ –º–µ–∂–∞–º–∏ ${lim.min}‚Ä¶${lim.max}¬∞C`; }
    if(docs!=='ok'){ status = (status==='üî¥ –í–Ü–î–•–ò–õ–ï–ù–ù–Ø')?'üî¥ –í–Ü–î–•–ò–õ–ï–ù–ù–Ø':'üü† –£–ú–û–í–ù–û'; reason += `; –¥–æ–∫—É–º–µ–Ω—Ç–∏: ${docs}`; }
    if(!clean){ status = (status==='üî¥ –í–Ü–î–•–ò–õ–ï–ù–ù–Ø')?'üî¥ –í–Ü–î–•–ò–õ–ï–ù–ù–Ø':'üü† –£–ú–û–í–ù–û'; reason += '; –∑–∞–±—Ä—É–¥–Ω–µ–Ω–∞ —Ç–∞—Ä–∞'; }

    // –í–∏–≤—ñ–¥
    byId('daysLeft').textContent = daysLeft;
    byId('pickDate').textContent = fmtDate(pick);
    byId('prio').textContent = prio;
    byId('zone').textContent = zone;
    byId('bin').textContent = bin;
    byId('status').textContent = status;
    byId('reason').textContent = reason;

    const csv = [
      `INBOUND|supp=${byId('supplier').value}|cat=${byId('category').value}|item=${byId('item').value}|lot=${byId('lot').value}`,
      `PROD=${byId('prodDate').value||fmtDate(prod)}|EXP=${byId('expDate').value||fmtDate(exp)}|QTY=${byId('qtyKg').value}kg`,
      `TEMP=${isNaN(T)?'NA':T+'C'}|LIMIT=${lim.min}..${lim.max}C|DOCS=${docs}|CLEAN=${clean?'ok':'no'}`,
      `FEFO_daysLeft=${daysLeft}|PRIO=${prio}|ZONE=${zone}|BIN=${bin}|STATUS=${status}|WHY=${reason}`
    ].join('\n');
    byId('csvCore').textContent = csv;

    // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –¥–ª—è —ñ–Ω—à–∏—Ö –±–ª–æ–∫—ñ–≤
    return {zone, bin, status, reason, daysLeft, pickDate:fmtDate(pick)};
  }

  function preset(){
    const now = new Date();
    byId('category').value='frozen';
    byId('item').value='–Ø–ª–æ–≤–∏—á–∏–Ω–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞, –±–ª–æ–∫';
    byId('pack').value='bulk';
    byId('docs').value='partial';
    byId('packClean').value='–¢–∞–∫';
    byId('prodDate').value=fmtDate(new Date(now.getFullYear(), now.getMonth(), now.getDate()-20));
    byId('expDate').value=fmtDate(new Date(now.getFullYear(), now.getMonth(), now.getDate()+120));
    byId('temp').value='-15';
    byId('qtyKg').value='1200';
    calcAll();
  }

  // –ñ—É—Ä–Ω–∞–ª
  function reindex(){ [...bodyLog.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function addRow(sample){
    const r = calcAll();
    const def = {
      item: byId('item').value,
      lot: byId('lot').value,
      exp: byId('expDate').value,
      temp: byId('temp').value,
      zone: r.zone, bin: r.bin,
      status: r.status,
      note: ''
    };
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.item}"></td>
      <td class="dark">${s.lot}</td>
      <td class="dark">${s.exp}</td>
      <td class="dark">${s.temp}</td>
      <td>${s.zone}</td>
      <td>${s.bin}</td>
      <td>${s.status}</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyLog.appendChild(tr); reindex(); buildCSVlog();
  }
  function presetRows(){
    bodyLog.innerHTML='';
    addRow({note:'–ø–∞–ª–µ—Ç–∞ 1'});
    byId('temp').value='5.5'; byId('docs').value='ok'; byId('category').value='milk'; byId('item').value='–ú–æ–ª–æ–∫–æ-—Å–∏—Ä–æ–≤–∏–Ω–∞'; calcAll();
    addRow({note:'–º–æ–ª–æ—á–Ω–∞ —Å–∏—Ä–æ–≤–∏–Ω–∞'});
    buildCSVlog();
  }
  function buildCSVlog(){
    const rows = [...bodyLog.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const item=r.children[1].querySelector('input').value.trim();
      const lot=r.children[2].textContent.trim();
      const exp=r.children[3].textContent.trim();
      const t=r.children[4].textContent.trim();
      const zone=r.children[5].textContent.trim();
      const bin=r.children[6].textContent.trim();
      const status=r.children[7].textContent.trim();
      const note=r.children[8].querySelector('input').value.trim();
      return [idx,item,lot,exp,t,zone,bin,status,note].join(' | ');
    });
    byId('csvLog').textContent = rows.join('\n') || '‚Äî';
  }

  // –ê–∫—Ç –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ
  function buildDeviation(){
    const r = calcAll();
    const txt = [
      `NONCONFORMANCE_REPORT`,
      `DATE:${new Date().toISOString().slice(0,19).replace('T',' ')}`,
      `SUPPLIER:${byId('supplier').value}`,
      `ITEM:${byId('item').value} LOT:${byId('lot').value} QTY:${byId('qtyKg').value}kg`,
      `TEMP:${byId('temp').value}C | LIMIT:${(tempLimits[byId('category').value]||{}).min}..${(tempLimits[byId('category').value]||{}).max}C`,
      `DOCS:${byId('docs').value} | CLEAN:${byId('packClean').value}`,
      `STATUS:${r.status} | REASON:${r.reason}`,
      `ACTION: —ñ–∑–æ–ª—è—Ü—ñ—è/–ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è/–∑–Ω–∏–∂–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å/–∞–Ω–∞–ª—ñ–∑ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞`
    ].join('\n');
    byId('devOut').textContent = txt;
  }

  // –ö–≤–∏—Ç–æ–∫ 58 –º–º
  function buildTicket(){
    const r = calcAll();
    byId('tSupp').textContent = byId('supplier').value;
    byId('tItem').textContent = byId('item').value;
    byId('tLot').textContent  = byId('lot').value;
    byId('tProdD').textContent= byId('prodDate').value || '‚Äî';
    byId('tExpD').textContent = byId('expDate').value  || '‚Äî';
    byId('tFEFO').textContent = byId('pickDate').textContent || '‚Äî';
    byId('tPrio').textContent = byId('prio').textContent || '‚Äî';
    byId('tZone').textContent = r.zone;
    byId('tBin').textContent  = r.bin;
    byId('tTemp').textContent = byId('temp').value || '‚Äî';
    byId('tQty').textContent  = byId('qtyKg').value || '‚Äî';
    byId('tStatus').textContent= r.status;
  }

  // NFC / QR
  function buildNFC(){
    const r = calcAll();
    const txt = [
      `RAW_IN_NFC`,
      `SUPP:${byId('supplier').value}`,
      `ITEM:${byId('item').value}`,
      `LOT:${byId('lot').value} QTY:${byId('qtyKg').value}kg`,
      `PROD:${byId('prodDate').value||'‚Äî'} EXP:${byId('expDate').value||'‚Äî'} FEFO:${byId('pickDate').textContent||'‚Äî'}`,
      `ZONE:${r.zone} BIN:${r.bin} STATUS:${r.status}`,
      `TEMP:${byId('temp').value}C PACK:${byId('pack').value} DOCS:${byId('docs').value}`,
      `CONTACT:${byId('nfcPhone').value}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = txt;
  }
  function buildQR(){
    const payload = {
      supplier: byId('supplier').value,
      item: byId('item').value, lot: byId('lot').value,
      prod: byId('prodDate').value, exp: byId('expDate').value,
      qty_kg: byId('qtyKg').value,
      zone: byId('zone').textContent, bin: byId('bin').textContent,
      status: byId('status').textContent
    };
    byId('qrOut').textContent = JSON.stringify(payload);
  }

  // –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è
  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){
    const now = new Date();
    byId('prodDate').value = fmtDate(new Date(now.getFullYear(), now.getMonth(), now.getDate()-2));
    byId('expDate').value  = fmtDate(new Date(now.getFullYear(), now.getMonth(), now.getDate()+10));
    calcAll();
    document.addEventListener('change', e=>{
      if(e.target.matches('input,select,textarea')) { calcAll(); buildCSVlog(); }
    });
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
