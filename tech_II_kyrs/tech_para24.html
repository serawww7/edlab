<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 24 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∏–π –∑—ñ—Ä —É QC: –¥–µ—Ñ–µ–∫—Ç–∏ –ø–∞–∫—É–≤–∞–Ω–Ω—è, –≤–µ–±–∫–∞–º–µ—Ä–∞, –∞–Ω–æ—Ç–∞—Ü—ñ—ó, ML, –≥—Ä–∞—Ñ—ñ–∫–∏, –∂—É—Ä–Ω–∞–ª, —á–µ–∫/CSV/QR</title>
<meta name="description" content="–í–µ–±–∫–∞–º–µ—Ä–∞ ‚Üí –∞–Ω–æ—Ç–∞—Ü—ñ—ó (OK/–¥–µ—Ñ–µ–∫—Ç–∏) ‚Üí –≤–∏—Ç—è–≥ —Ñ—ñ—á ‚Üí k-NN/–ª–æ–≥—ñ—Å—Ç–∏—á–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è ‚Üí –º–µ—Ç—Ä–∏–∫–∏/–≥—Ä–∞—Ñ—ñ–∫–∏ ‚Üí —á–µ–∫/CSV/QR. –ü—Ä–∞—Ü—é—î –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1260px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
small.mono,.mono{font-family:ui-monospace,monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.45fr 1fr}
@media(max-width:1140px){.grid{grid-template-columns:1fr}}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas, video{display:block;width:100%;height:300px;background:#000}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace;white-space:pre}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
.small{font-size:.9rem}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:0 8px;color:var(--muted);margin-right:6px;margin-top:6px}
</style>
<link rel="canonical" href="https://edlab.pp.ua/tech_II_kyrs/tech_para24.html"><meta property="og:type" content="article"><meta property="og:title" content="–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞ ‚Äî –ü–∞—Ä–∞ 24"><meta property="og:description" content="–ù–∞–≤—á–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –±—É–¥—É–≤–∞—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π QC-–ø–∞–π–ø–ª–∞–π–Ω –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É: –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –∫–∞–¥—Ä—ñ–≤ –∑ –∫–æ–Ω–≤–µ—î—Ä–∞ (–≤–µ–±–∫–∞–º–µ—Ä–∞), —Ä–æ–∑–º—ñ—Ç–∫–∞ –∫–ª–∞—Å—ñ–≤, –≤–∏—Ç—è–≥ —Ñ—ñ—á —É –±—Ä–∞—É–∑–µ—Ä—ñ —Ç–∞ –Ω"><meta property="og:url" content="https://edlab.pp.ua/tech_II_kyrs/tech_para24.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞ ‚Äî –ü–∞—Ä–∞ 24","description":"–ù–∞–≤—á–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –±—É–¥—É–≤–∞—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π QC-–ø–∞–π–ø–ª–∞–π–Ω –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É: –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –∫–∞–¥—Ä—ñ–≤ –∑ –∫–æ–Ω–≤–µ—î—Ä–∞ (–≤–µ–±–∫–∞–º–µ—Ä–∞), —Ä–æ–∑–º—ñ—Ç–∫–∞ –∫–ª–∞—Å—ñ–≤, –≤–∏—Ç—è–≥ —Ñ—ñ—á —É –±—Ä–∞—É–∑–µ—Ä—ñ —Ç–∞ –Ω","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/tech_II_kyrs/tech_para24.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üëÅÔ∏è</span>
      <div>
        <b>–ü–∞—Ä–∞ 24 ‚Äî –ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∏–π –∑—ñ—Ä —É QC</b><br>
        <span class="badge">–∫–∞–º–µ—Ä–∞ ‚Üí –∞–Ω–æ—Ç–∞—Ü—ñ—ó ‚Üí —Ñ—ñ—á—ñ ‚Üí k-NN/LogReg ‚Üí –º–µ—Ç—Ä–∏–∫–∏/–≥—Ä–∞—Ñ—ñ–∫–∏ ‚Üí –∂—É—Ä–Ω–∞–ª ‚Üí —á–µ–∫/CSV/QR</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <!-- –ú–ï–¢–ê + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –∑–∞–Ω—è—Ç—Ç—è</h2>
    <p>–ù–∞–≤—á–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –±—É–¥—É–≤–∞—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π QC-–ø–∞–π–ø–ª–∞–π–Ω –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É: <b>–∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –∫–∞–¥—Ä—ñ–≤</b> –∑ –∫–æ–Ω–≤–µ—î—Ä–∞ (–≤–µ–±–∫–∞–º–µ—Ä–∞), <b>—Ä–æ–∑–º—ñ—Ç–∫–∞ –∫–ª–∞—Å—ñ–≤</b>, <b>–≤–∏—Ç—è–≥ —Ñ—ñ—á</b> —É –±—Ä–∞—É–∑–µ—Ä—ñ —Ç–∞ –Ω–∞–≤—á–∞–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ—ó –º–æ–¥–µ–ª—ñ –¥–ª—è <b>–≤–∏—è–≤–ª–µ–Ω–Ω—è –¥–µ—Ñ–µ–∫—Ç—ñ–≤ –ø–∞–∫—É–≤–∞–Ω–Ω—è/–µ—Ç–∏–∫–µ—Ç–∫–∏</b>.</p>
    <div class="grid" style="grid-template-columns:repeat(3,minmax(0,1fr))">
      <div class="note"><b>üì∑ –ö–∞–º–µ—Ä–∞</b><br>–í—ñ–∑—å–º–µ–º–æ –∫–∞–¥—Ä–∏ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ—ó/USB-–∫–∞–º–µ—Ä–∏. –ö–æ–∂–µ–Ω –∫–∞–¥—Ä ‚Äî PNG + –≤–µ–∫—Ç–æ—Ä —Ñ—ñ—á.</div>
      <div class="note"><b>üß¨ –§—ñ—á—ñ</b><br>–Ø—Å–∫—Ä–∞–≤—ñ—Å—Ç—å, –∫–æ–Ω—Ç—Ä–∞—Å—Ç, —Ä—ñ–∑–∫—ñ—Å—Ç—å (–õ–∞–ø–ª–∞—Å), –Ω–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å, ¬´–∫—Ä–∞—î–≤—ñ—Å—Ç—å¬ª (–°–æ–±–µ–ª—å), –¥–∏—Å–±–∞–ª–∞–Ω—Å –∫–æ–ª—å–æ—Ä—É.</div>
      <div class="note"><b>üß† –ú–æ–¥–µ–ª—å</b><br>k-NN (k=5) –∞–±–æ –ª–æ–≥—ñ—Å—Ç–∏—á–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è (one-vs-rest) –∑ ROC (OK vs defect).</div>
    </div>
  </div>

  <div class="grid">
    <!-- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê -->
    <div class="card">
      <h2>üì• –ö–∞–º–µ—Ä–∞ —Ç–∞ –∞–Ω–æ—Ç–∞—Ü—ñ—ó</h2>
      <div class="row">
        <button class="btn" id="camOn">üé• –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</button>
        <button class="btn secondary" id="snap">üì∏ –ó–Ω—è—Ç–∏ –∫–∞–¥—Ä</button>
        <label>–ö–ª–∞—Å
          <select id="label" class="input">
            <option value="OK" selected="">OK (–ø—Ä–∏–¥–∞—Ç–Ω–æ)</option>
            <option value="NO_LABEL">–ù–µ–º–∞—î/–∑'—ó—Ö–∞–ª–∞ –µ—Ç–∏–∫–µ—Ç–∫–∞</option>
            <option value="DENT">–í–º'—è—Ç–∏–Ω–∞/–∑–º–æ—Ä—à–∫–∞</option>
            <option value="STAIN">–ü–ª—è–º–∞/–±—Ä—É–¥</option>
            <option value="SEAL">–ü—Ä–æ–±–ª–µ–º–∞ –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—ñ</option>
          </select>
        </label>
        <button class="btn" id="clear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞—Ç–∞—Å–µ—Ç</button>
        <span id="stat" class="badge">–ö–∞–¥—Ä—ñ–≤: 0 | OK: 0 | DEF: 0</span>
      </div>
      <div class="canvasWrap"><video id="v" playsinline="" muted=""></video></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="c" width="980" height="300"></canvas></div>
      <small class="muted">–í–≥–æ—Ä—ñ ‚Äî –ø—Ä–µ–≤'—é –∫–∞–º–µ—Ä–∏; –Ω–∏–∂—á–µ ‚Äî –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π –∫–∞–¥—Ä/ROI –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Ñ—ñ—á.</small>

      <h2 style="margin-top:10px">üß† –ù–∞–≤—á–∞–Ω–Ω—è</h2>
      <div class="row">
        <label>–ú–æ–¥–µ–ª—å
          <select id="modelType" class="input">
            <option value="knn" selected="">k-NN (k=5)</option>
            <option value="logreg">–õ–æ–≥—ñ—Å—Ç–∏—á–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è (1-vs-rest)</option>
          </select>
        </label>
        <label>Train/Test, %<input id="split" class="input" type="number" min="50" max="90" step="5" value="70"></label>
        <label>Seed<input id="seed" class="input" type="number" step="1" value="24"></label>
        <button class="btn good" id="train">üöÄ –ù–∞–≤—á–∏—Ç–∏</button>
      </div>

      <h3 style="margin-top:8px">üß™ –ü—Ä–æ–≥–Ω–æ–∑ (–∂–∏–≤–∏–π)</h3>
      <div class="row">
        <button class="btn" id="predictLive">üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –∑ –∫–∞–º–µ—Ä–∏</button>
        <span id="predStat" class="badge">P(OK)=‚Äî | –†—ñ—à–µ–Ω–Ω—è: ‚Äî</span>
      </div>

      <h3 style="margin-top:10px">üìà –°–∫–∞—Ç–µ—Ä–ø–ª–æ—Ç (2 —Ñ—ñ—á—ñ)</h3>
      <div class="row">
        <label>X
          <select id="fx" class="input"></select>
        </label>
        <label>Y
          <select id="fy" class="input"></select>
        </label>
        <button class="btn secondary" id="redraw">üîÅ –ü–µ—Ä–µ–º–∞–ª—é–≤–∞—Ç–∏</button>
      </div>
      <div class="canvasWrap"><canvas id="plot" width="980" height="300"></canvas></div>

      <h3 style="margin-top:10px">üõéÔ∏è –ñ—É—Ä–Ω–∞–ª</h3>
      <pre id="alog" class="note" style="max-height:170px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>

      <h3 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç / –¥—Ä—É–∫</h3>
      <div class="row">
        <input id="lot" class="input" placeholder="–õ–æ—Ç/–ª—ñ–Ω—ñ—è (–Ω–∞–ø—Ä. MAP_–π–æ–≥—É—Ä—Ç_2025-10-18_B)">
        <button class="btn" id="saveCsv">üìÑ CSV (—Ñ—ñ—á—ñ + –∫–ª–∞—Å)</button>
        <button class="btn" id="saveTxt">üíæ TXT (–∑–≤—ñ—Ç/–º–µ—Ç—Ä–∏–∫–∏)</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="qrGen">üîó QR (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –¥–æ–∫–∞–∑–∏)</button>
      </div>
      <div id="rc" class="receipt" hidden=""></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="qr" width="220" height="220"></canvas></div>
      <small class="muted">QR –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ <span class="mono">api.qrserver.com</span>; –æ—Ñ–ª–∞–π–Ω ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–æ–ª–±–µ–∫.</small>
    </div>

    <!-- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê -->
    <div class="card">
      <h2>üìä –ú–µ—Ç—Ä–∏–∫–∏</h2>
      <table class="tbl">
        <tbody>
          <tr><th>Train/Test</th><td id="m_split">‚Äî</td></tr>
          <tr><th>Accuracy (multi)</th><td id="m_acc">‚Äî</td></tr>
          <tr><th>F1 (macro)</th><td id="m_f1">‚Äî</td></tr>
          <tr><th>ROC AUC (OK vs DEF)</th><td id="m_auc">‚Äî</td></tr>
          <tr><th>–ú–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫</th><td id="m_cm">‚Äî</td></tr>
          <tr><th>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ (LogReg)</th><td id="m_w">‚Äî</td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üîå –°—Ö–µ–º–∞ (SVG)</h2>
      <svg viewBox="0 0 820 280" role="img" aria-label="–ö–∞–º–µ—Ä–∞ ‚Üí –§—ñ—á—ñ ‚Üí –ú–æ–¥–µ–ª—å ‚Üí –†—ñ—à–µ–Ω–Ω—è/–ó–≤—ñ—Ç">
        <rect x="40" y="40" width="160" height="120" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
        <text x="120" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ö–∞–º–µ—Ä–∞</text>
        <text x="120" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">–∫–∞–¥—Ä–∏ PNG</text>

        <rect x="220" y="40" width="180" height="120" rx="12" fill="#14532d" stroke="#22c55e"></rect>
        <text x="310" y="80" fill="#dcfce7" font-size="14" text-anchor="middle">–§—ñ—á—ñ</text>
        <text x="310" y="100" fill="#a7f3d0" font-size="12" text-anchor="middle">—è—Å–∫—Ä./–∫–æ–Ω—Ç—Ä–∞—Å—Ç/—Ä—ñ–∑–∫—ñ—Å—Ç—å/–∫—Ä–∞—ó</text>

        <rect x="420" y="40" width="160" height="120" rx="12" fill="#1f2937" stroke="#9ca3af"></rect>
        <text x="500" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ú–æ–¥–µ–ª—å</text>
        <text x="500" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">k-NN / LogReg</text>

        <rect x="600" y="40" width="180" height="120" rx="12" fill="#0b1a2f" stroke="#64748b"></rect>
        <text x="690" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–†—ñ—à–µ–Ω–Ω—è</text>
        <text x="690" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">—á–µ–∫/CSV/QR</text>

        <line x1="200" y1="100" x2="220" y2="100" stroke="#93c5fd" stroke-width="3"></line>
        <line x1="400" y1="100" x2="420" y2="100" stroke="#22c55e" stroke-width="3"></line>
        <line x1="580" y1="100" x2="600" y2="100" stroke="#64748b" stroke-width="3"></line>
      </svg>

      <h2 style="margin-top:10px">üéØ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
      <ol>
        <li>–ó–±–µ—Ä–∏ ‚â• 40 –∫–∞–¥—Ä—ñ–≤ (–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—ñ–≤), –Ω–∞—Ç—Ä–µ–Ω—É–π **k-NN** —ñ –¥–æ—Å—è–≥–Ω–∏ <b>F1 macro ‚â• 0.8</b>.</li>
        <li>–ü–æ—Ä—ñ–≤–Ω—è–π –∑ **LogReg** —Ç–∞ –∑–±–µ—Ä–µ–∂–∏ <b>TXT</b> –∑—ñ —Å–∫—Ä—ñ–Ω–∞–º–∏ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤/–º–∞—Ç—Ä–∏—Ü—ñ.</li>
        <li>–ó—Ä–æ–±–∏ **–ø—Ä–æ–≥–Ω–æ–∑ —É –∂–∏–≤–æ–º—É —Ä–µ–∂–∏–º—ñ** –¥–ª—è 5 —Ä—ñ–∑–Ω–∏—Ö –∑—Ä–∞–∑–∫—ñ–≤, —Ä–æ–∑–¥—Ä—É–∫—É–π **—á–µ–∫ 58 –º–º** —ñ –∑–≥–µ–Ω–µ—Ä—É–π **QR**.</li>
      </ol>

      <h2 style="margin-top:10px">‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="tbl">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–î–∞—Ç–∞—Å–µ—Ç (‚â•40) —ñ–∑ –±–∞–ª–∞–Ω—Å–æ–º –∫–ª–∞—Å—ñ–≤ + –∫–æ—Ä–µ–∫—Ç–Ω–∏–π CSV</td><td>4</td></tr>
          <tr><td>F1 macro ‚â• 0.8 –Ω–∞ —Ç–µ—Å—Ç—ñ (–±—É–¥—å-—è–∫–∞ –º–æ–¥–µ–ª—å)</td><td>3</td></tr>
          <tr><td>–ú–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä —â–æ–¥–æ –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö –∫–ª–∞—Å—ñ–≤</td><td>2</td></tr>
          <tr><td>–ß–µ–∫ 58 –º–º + QR –¥–æ –¥–æ–∫–∞–∑—ñ–≤</td><td>1</td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
      <p class="muted small">–ü–µ—Ä—à—ñ –≤—ñ–∑—É–∞–ª—å–Ω—ñ —ñ–Ω—Å–ø–µ–∫—Ü—ñ—ó —É —Ö–∞—Ä—á—Ç–µ—Ö—ñ (1980-—Ç—ñ) –±—É–ª–∏ –ø–æ—Ä–æ–≥–æ–≤—ñ –π —á—É—Ç–ª–∏–≤—ñ –¥–æ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è. –°—å–æ–≥–æ–¥–Ω—ñ –Ω–∞–≤—ñ—Ç—å –ø—Ä–æ—Å—Ç—ñ —Ñ—ñ—á—ñ —Ç–∞ –±–∞–∑–æ–≤—ñ –º–æ–¥–µ–ª—ñ —É –±—Ä–∞—É–∑–µ—Ä—ñ –≤–∂–µ –¥–∞—é—Ç—å —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π QC –Ω–∞ –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Å—Ç–µ–Ω–¥–∞—Ö.</p>
    </div>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ —Ç–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function log(msg){const t=new Date().toLocaleTimeString();const box=$('#alog');if(box.textContent.startsWith('//'))box.textContent='';box.textContent+=`[${t}] ${msg}\n`;box.scrollTop=box.scrollHeight;}

const LABELS=['OK','NO_LABEL','DENT','STAIN','SEAL'];
const DEF_LABELS=new Set(['NO_LABEL','DENT','STAIN','SEAL']);

// ===== –ö–∞–º–µ—Ä–∞ =====
const v=$('#v'), canvas=$('#c'), ctx=canvas.getContext('2d');
let stream=null;
$('#camOn').addEventListener('click', async()=>{
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{width:980,height:300}, audio:false});
    v.srcObject=stream; await v.play(); log('–ö–∞–º–µ—Ä—É —É–≤—ñ–º–∫–Ω–µ–Ω–æ');
  }catch(e){ alert('–ù–µ –≤–¥–∞–ª–æ—Å—è —É–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É: '+e); }
});

function drawFromVideo(){
  if(!v.videoWidth) return;
  const W=canvas.width, H=canvas.height;
  ctx.drawImage(v, 0, 0, W, H);
}

setInterval(()=>{ if(stream) drawFromVideo(); }, 80);

// ===== –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Ñ—ñ—á —ñ–∑ canvas =====
function getImageData(){ return ctx.getImageData(0,0,canvas.width,canvas.height); }

function computeFeatures(){
  const {data,width,height}=getImageData();
  const N=width*height;
  let sumL=0,sumR=0,sumG=0,sumB=0;
  for(let i=0;i<data.length;i+=4){
    const r=data[i], g=data[i+1], b=data[i+2];
    const l=0.299*r+0.587*g+0.114*b;
    sumL+=l; sumR+=r; sumG+=g; sumB+=b;
  }
  const avgL=sumL/N, avgR=sumR/N, avgG=sumG/N, avgB=sumB/N;

  // –ö–æ–Ω—Ç—Ä–∞—Å—Ç (std —è—Ä–∫–æ—Å—Ç—ñ)
  let varL=0;
  for(let i=0;i<data.length;i+=4){
    const l=0.299*data[i]+0.587*data[i+1]+0.114*data[i+2];
    varL+=(l-avgL)*(l-avgL);
  }
  const stdL=Math.sqrt(varL/N);

  // –ù–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å (HSV approx: mean(|Cmax-Cmin|))
  let satSum=0;
  for(let i=0;i<data.length;i+=4){
    const r=data[i]/255,g=data[i+1]/255,b=data[i+2]/255;
    const cmax=Math.max(r,g,b), cmin=Math.min(r,g,b);
    satSum += (cmax-cmin);
  }
  const sat = (satSum/N);

  // –†—ñ–∑–∫—ñ—Å—Ç—å (–õ–∞–ø–ª–∞—Å), –ö—Ä–∞—î–≤—ñ—Å—Ç—å (–°–æ–±–µ–ª—å)
  function conv3x3(kernel){
    const out=new Float32Array(N), k=kernel;
    for(let y=1;y<height-1;y++){
      for(let x=1;x<width-1;x++){
        let acc=0;
        for(let dy=-1;dy<=1;dy++){
          for(let dx=-1;dx<=1;dx++){
            const ix=4*((y+dy)*width+(x+dx));
            const l=0.299*data[ix]+0.587*data[ix+1]+0.114*data[ix+2];
            acc += l * k[(dy+1)*3+(dx+1)];
          }
        }
        out[y*width+x]=acc;
      }
    }
    return out;
  }
  const lap=conv3x3([0,1,0,1,-4,1,0,1,0]);
  const sobX=conv3x3([-1,0,1,-2,0,2,-1,0,1]);
  const sobY=conv3x3([-1,-2,-1,0,0,0,1,2,1]);

  let sharp=0, edge=0;
  for(let i=0;i<N;i++){
    sharp += Math.abs(lap[i]);
    edge  += Math.abs(sobX[i]) + Math.abs(sobY[i]);
  }
  sharp/=N; edge/=N;

  // –î–∏—Å–±–∞–ª–∞–Ω—Å –∫–æ–ª—å–æ—Ä—É (R-G, Y-B)
  const rg = (avgR-avgG)/255;
  const yb = ((avgR+avgG)/2 - avgB)/255;

  return {
    avgL, stdL, sat, sharp, edge, rg, yb,
    r:avgR/255, g:avgG/255, b:avgB/255
  };
}

const FEAT_ORDER=['avgL','stdL','sat','sharp','edge','rg','yb','r','g','b'];
function featVector(f){ return FEAT_ORDER.map(k=>f[k]); }

// ===== –î–∞—Ç–∞—Å–µ—Ç =====
let DS=[]; // {feat:[], label, png}
$('#snap').addEventListener('click', ()=>{
  if(!v.videoWidth) return alert('–°–ø–æ—á–∞—Ç–∫—É —É–≤—ñ–º–∫–Ω–∏ –∫–∞–º–µ—Ä—É');
  drawFromVideo();
  const f=computeFeatures();
  const label=$('#label').value;
  const png=canvas.toDataURL('image/png');
  DS.push({feat:featVector(f), label, png});
  updateStats();
  drawScatter();
  log(`–ö–∞–¥—Ä –¥–æ–¥–∞–Ω–æ: ${label} | —Ñ—ñ—á=${FEAT_ORDER.length}`);
});

$('#clear').addEventListener('click', ()=>{ DS=[]; updateStats(); drawScatter(); log('–î–∞—Ç–∞—Å–µ—Ç –æ—á–∏—â–µ–Ω–æ'); });

function updateStats(){
  const n=DS.length;
  const ok=DS.filter(x=>x.label==='OK').length;
  const def=n-ok;
  $('#stat').textContent=`–ö–∞–¥—Ä—ñ–≤: ${n} | OK: ${ok} | DEF: ${def}`;
}

// ===== –°–∫–∞—Ç–µ—Ä–ø–ª–æ—Ç =====
const plot=$('#plot'), gp=plot.getContext('2d');
function fillFeatSelects(){
  const fx=$('#fx'), fy=$('#fy');
  fx.innerHTML=''; fy.innerHTML='';
  FEAT_ORDER.forEach((k,i)=>{
    const o1=document.createElement('option'); o1.value=i; o1.textContent=`${i+1}. ${k}`; fx.appendChild(o1);
    const o2=document.createElement('option'); o2.value=i; o2.textContent=`${i+1}. ${k}`; fy.appendChild(o2);
  });
  fx.value=0; fy.value=1;
}
fillFeatSelects();
$('#redraw').addEventListener('click', drawScatter);

function drawScatter(){
  const W=plot.width,H=plot.height; gp.clearRect(0,0,W,H);
  gp.strokeStyle='#223049'; gp.strokeRect(0.5,0.5,W-1,H-1);
  if(DS.length<1){ gp.fillStyle='#94a3b8'; gp.fillText('–ó–Ω—ñ–º–∏ –∫—ñ–ª—å–∫–∞ –∫–∞–¥—Ä—ñ–≤ —ñ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ù–∞–≤—á–∏—Ç–∏¬ª',14,20); return; }
  const fx=+$('#fx').value, fy=+$('#fy').value;
  const xs=DS.map(d=>d.feat[fx]), ys=DS.map(d=>d.feat[fy]);
  const minX=Math.min(...xs), maxX=Math.max(...xs);
  const minY=Math.min(...ys), maxY=Math.max(...ys);
  const left=50,right=W-10,top=20,bottom=H-30;
  const xOf=v=> left + (v-minX)/(maxX-minX||1)*(right-left);
  const yOf=v=> bottom - (v-minY)/(maxY-minY||1)*(bottom-top);

  for(const d of DS){
    const x=xOf(d.feat[fx]), y=yOf(d.feat[fy]);
    gp.beginPath();
    const col = d.label==='OK' ? '#22c55e' :
                (d.label==='NO_LABEL' ? '#60a5fa' :
                 d.label==='DENT' ? '#f59e0b' :
                 d.label==='STAIN' ? '#f87171' : '#a78bfa');
    gp.strokeStyle=col;
    if(d.label==='OK'){ gp.arc(x,y,4,0,Math.PI*2); gp.stroke(); }
    else { gp.moveTo(x-4,y-4); gp.lineTo(x+4,y+4); gp.moveTo(x-4,y+4); gp.lineTo(x+4,y-4); gp.stroke(); }
  }
  gp.fillStyle='#94a3b8'; gp.font='12px ui-monospace';
  gp.fillText(FEAT_ORDER[fx], left, H-8);
  gp.save(); gp.translate(10,(top+bottom)/2); gp.rotate(-Math.PI/2); gp.fillText(FEAT_ORDER[fy], 0,0); gp.restore();
}

// ===== –†–æ–∑–±–∏—Ç—Ç—è / –ú–µ—Ç—Ä–∏–∫–∏ =====
function rand(seed){ let x=seed%2147483647; if(x<=0) x+=2147483646; return ()=> (x=(x*16807)%2147483647)/2147483647; }
function shuffleInPlace(a,R=Math.random){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(R()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function splitTrainTest(arr, ratio=0.7, seed=42){
  const idx=[...arr.keys()]; const R=rand(seed); shuffleInPlace(idx,R);
  const nTr=Math.floor(ratio*arr.length); const tr=idx.slice(0,nTr), te=idx.slice(nTr);
  return {train:tr.map(i=>arr[i]), test:te.map(i=>arr[i])};
}
function cmatrix(yTrue, yPred, labels){
  const m=labels.length; const M=Array.from({length:m},()=>Array(m).fill(0));
  const idx=Object.fromEntries(labels.map((l,i)=>[l,i]));
  for(let i=0;i<yTrue.length;i++) M[idx[yTrue[i]]][idx[yPred[i]]]++;
  return M;
}
function f1macro(yTrue, yPred, labels){
  const idx=Object.fromEntries(labels.map((l,i)=>[l,i]));
  let sum=0,cnt=0;
  for(const l of labels){
    const i=idx[l];
    let TP=0,FP=0,FN=0;
    for(let r=0;r<labels.length;r++){
      for(let c=0;c<labels.length;c++){
        const v = cm[i?i:0]; // placeholder, we will compute differently
      }
    }
  }
  // –†–µ–∞–ª—ñ–∑—É—î–º–æ –Ω–∞–ø—Ä—è–º—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ M:
  const M=cmatrix(yTrue,yPred,labels);
  for(let i=0;i<labels.length;i++){
    const TP=M[i][i];
    const FP = M.reduce((a,row,ri)=> ri===i ? a : a+row[i], 0);
    const FN = M[i].reduce((a,v,ci)=> ci===i ? a : a+v, 0);
    const prec = TP/(TP+FP||1);
    const rec  = TP/(TP+FN||1);
    const f1 = (prec+rec)? 2*prec*rec/(prec+rec):0;
    sum+=f1; cnt++;
  }
  return {f1: sum/(cnt||1), M};
}
function auc_ok_vs_def(probOK, yTrue){
  // yTrue: true if OK else DEF
  const pairs = probOK.map((p,i)=>({p, y: yTrue[i]})).sort((a,b)=>b.p-a.p);
  let TP=0,FP=0,TN=0,FN=0;
  const P=pairs.filter(o=>o.y).length, N=pairs.length-P;
  let auc=0, prevTPR=0, prevFPR=0;
  let tp=0, fp=0;
  let lastP=null;
  for(const o of pairs){
    if(lastP!==null && o.p!==lastP){
      const TPR=tp/(P||1), FPR=fp/(N||1);
      auc += (FPR-prevFPR)*(TPR+prevTPR)/2;
      prevTPR=TPR; prevFPR=FPR;
    }
    if(o.y) tp++; else fp++;
    lastP=o.p;
  }
  const TPR=tp/(P||1), FPR=fp/(N||1);
  auc += (FPR-prevFPR)*(TPR+prevTPR)/2;
  return Math.abs(auc);
}

// ===== –ú–æ–¥–µ–ª—ñ =====
// k-NN multi-class
function predictKNN(trainX, trainY, X, k=5){
  function d(a,b){let s=0; for(let j=0;j<a.length;j++){ const t=a[j]-b[j]; s+=t*t; } return Math.sqrt(s);}
  const uniq=[...new Set(trainY)];
  const outProb=[];
  for(const x of X){
    const nn=trainX.map((r,i)=>({i,dist:d(r,x)})).sort((a,b)=>a.dist-b.dist).slice(0,k);
    const counts=Object.fromEntries(uniq.map(u=>[u,0]));
    nn.forEach(n=>counts[trainY[n.i]]++);
    const probs=Object.fromEntries(uniq.map(u=>[u,counts[u]/k]));
    outProb.push(probs);
  }
  return {labels:uniq, prob:outProb};
}

// –õ–æ–≥—ñ—Å—Ç–∏—á–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è 1-vs-rest (–≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π —Å–ø—É—Å–∫)
function trainLogRegOVR(X,y,labels,lr=0.1,epochs=400,l2=0.001){
  // —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑—É—î–º–æ
  const mu=new Array(X[0].length).fill(0), sd=new Array(X[0].length).fill(0);
  for(let j=0;j<X[0].length;j++){
    const col=X.map(r=>r[j]); const m=col.reduce((a,b)=>a+b,0)/col.length;
    const s=Math.sqrt(col.reduce((a,b)=>a+(b-m)*(b-m),0)/col.length)||1;
    mu[j]=m; sd[j]=s;
  }
  const Z=X.map(r=>r.map((v,j)=>(v-mu[j])/sd[j]));
  const addBias=A=>A.map(r=>[1,...r]);
  const Zb=addBias(Z);

  const W=labels.map(()=> new Array(Zb[0].length).fill(0));

  function sigm(z){return 1/(1+Math.exp(-z));}

  for(let c=0;c<labels.length;c++){
    const yc = y.map(t=> t===labels[c]?1:0);
    let w=W[c].slice();
    for(let ep=0;ep<epochs;ep++){
      const grad=new Array(w.length).fill(0);
      for(let i=0;i<Zb.length;i++){
        const z=Zb[i].reduce((s,v,j)=>s+v*w[j],0);
        const p=sigm(z); const e=p - yc[i];
        for(let j=0;j<w.length;j++) grad[j]+= e*Zb[i][j];
      }
      for(let j=1;j<w.length;j++) grad[j]+= l2*w[j];
      for(let j=0;j<w.length;j++) w[j]-= lr*grad[j]/Zb.length;
    }
    W[c]=w;
  }

  function predictProba(Xnew){
    const Z=Xnew.map(r=>r.map((v,j)=>(v-mu[j])/sd[j]));
    const Zb=Z.map(r=>[1,...r]);
    return Zb.map(r=>{
      const scores=W.map(w=> r.reduce((s,v,j)=>s+v*w[j],0));
      // —Å—Ç–∞–±—ñ–ª—ñ–∑—É—î–º–æ softmax
      const m=Math.max(...scores); const ex=scores.map(s=>Math.exp(s-m)); const sum=ex.reduce((a,b)=>a+b,0);
      const probs=ex.map(e=>e/sum);
      const obj={}; labels.forEach((lab,i)=> obj[lab]=probs[i]);
      return obj;
    });
  }
  return {labels, W, mu, sd, predictProba};
}

// ===== –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è / –ü—Ä–æ–≥–Ω–æ–∑ / –ú–µ—Ç—Ä–∏–∫–∏ =====
let MODEL=null; // {type, labels, predictProba, (W,mu,sd)}
$('#train').addEventListener('click', ()=>{
  if(DS.length<10) return alert('–î–æ–¥–∞–π —Ö–æ—á–∞ –± 10 –∫–∞–¥—Ä—ñ–≤');
  const split=+$('#split').value/100, seed=+$('#seed').value;
  const {train,test}=splitTrainTest(DS, split, seed);
  const Xtr=train.map(d=>d.feat), ytr=train.map(d=>d.label);
  const Xte=test.map(d=>d.feat), yte=test.map(d=>d.label);
  const labels=[...new Set(DS.map(d=>d.label))];

  let predictProba, coefText='‚Äî';
  if($('#modelType').value==='knn'){
    const k=5;
    predictProba=(X)=> {
      const R=predictKNN(Xtr,ytr,X,k);
      // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ —è–∫ object[label]=p
      return R.prob.map(pr=>{
        const obj={}; labels.forEach(l=>obj[l]=pr[l]||0); return obj;
      });
    };
    coefText='(k-NN –Ω–µ –º–∞—î –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤)';
  }else{
    const M=trainLogRegOVR(Xtr,ytr,labels,0.15,500,0.001);
    predictProba=M.predictProba;
    coefText = '–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –Ω–∞ –∫–ª–∞—Å—ñ–≤: ' + labels.map((lab,i)=>`${lab}[${M.W[i].map((w,j)=> (j===0?'b=':'')+M.W[i][j].toFixed(2)).slice(0,5).join(', ')} ‚Ä¶]`).join(' | ');
  }

  // –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç–µ—Å—Ç—ñ
  const P = predictProba(Xte);
  const yPred = P.map(probs=>{
    let bestL=labels[0], bestP=-1;
    for(const l of labels){ if(probs[l]>bestP){bestP=probs[l]; bestL=l;} }
    return bestL;
  });

  const acc = yPred.filter((p,i)=>p===yte[i]).length/(yte.length||1);
  const f1M = f1macro(yte, yPred, labels);
  // AUC OK vs DEF (–±—ñ–Ω–∞—Ä–∏–∑–∞—Ü—ñ—è)
  const probOK = P.map(probs=> probs['OK']||0);
  const yBin = yte.map(l=> l==='OK');
  const auc = auc_ok_vs_def(probOK, yBin);

  $('#m_split').textContent=`Train ${Math.round(split*100)}% / Test ${Math.round(100-split*100)}%`;
  $('#m_acc').textContent=acc.toFixed(3);
  $('#m_f1').textContent=f1M.f1.toFixed(3);
  $('#m_auc').textContent=auc.toFixed(3);
  $('#m_cm').textContent = renderCM(f1M.M, labels);
  $('#m_w').textContent = coefText;

  MODEL={labels, predictProba};
  log(`–ù–∞–≤—á–µ–Ω–æ ${$('#modelType').value}: acc=${acc.toFixed(3)} F1=${f1M.f1.toFixed(3)} AUC=${auc.toFixed(3)}`);
});

function renderCM(M, labels){
  const head='\\ '+labels.map(l=>l.slice(0,7)).join(' | ');
  const rows=M.map((row,i)=> labels[i].slice(0,7)+': '+row.map(v=>String(v).padStart(3,' ')).join(' '));
  return head+'\n'+rows.join('\n');
}

// –ñ–∏–≤–∏–π –ø—Ä–æ–≥–Ω–æ–∑
$('#predictLive').addEventListener('click', ()=>{
  if(!MODEL) return alert('–°–ø–æ—á–∞—Ç–∫—É –Ω–∞—Ç—Ä–µ–Ω—É–π –º–æ–¥–µ–ª—å');
  drawFromVideo();
  const f=computeFeatures();
  const probs = MODEL.predictProba([featVector(f)])[0];
  let bestL=MODEL.labels[0], bestP=-1;
  for(const l of MODEL.labels){ if((probs[l]||0)>bestP){bestP=probs[l]; bestL=l;} }
  const pOK = probs['OK']||0;
  $('#predStat').textContent = `P(OK)=${pOK.toFixed(3)} | –†—ñ—à–µ–Ω–Ω—è: ${bestL}`;
});

// ===== –ï–∫—Å–ø–æ—Ä—Ç / –ó–≤—ñ—Ç / –ß–µ–∫ / QR =====
$('#saveCsv').addEventListener('click', ()=>{
  if(!DS.length) return alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö');
  let csv='avgL,stdL,sat,sharp,edge,rg,yb,r,g,b,label\n';
  for(const d of DS){ csv += d.feat.join(',')+','+d.label+'\n'; }
  download('tech_para24_cv_dataset_'+stamp()+'.csv', csv, 'text/csv');
});
$('#saveTxt').addEventListener('click', ()=>{
  const lines=[
    '–ü–∞—Ä–∞ 24 ‚Äî –ö–æ–º–ø\'—é—Ç–µ—Ä–Ω–∏–π –∑—ñ—Ä —É QC: –ø—ñ–¥—Å—É–º–æ–∫',
    '–õ–æ—Ç/–ª—ñ–Ω—ñ—è: '+($('#lot').value||'‚Äî'),
    '–ö–∞–¥—Ä—ñ–≤: '+DS.length,
    `Train/Test: ${$('#m_split').textContent}`,
    `Accuracy: ${$('#m_acc').textContent}`,
    `F1 macro: ${$('#m_f1').textContent}`,
    `ROC AUC (OK vs DEF): ${$('#m_auc').textContent}`,
    '–ú–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫:\n'+$('#m_cm').textContent
  ];
  download('tech_para24_summary_'+stamp()+'.txt', lines.join('\n'));
});
$('#print58').addEventListener('click', ()=>{
  const rc=$('#rc'); rc.hidden=false;
  const lines=[
    '=== QC CV (58–º–º) ===',
    '–õ–æ—Ç: '+($('#lot').value||'‚Äî'),
    `Acc=${$('#m_acc').textContent} F1=${$('#m_f1').textContent}`,
    $('#predStat').textContent.replace(/\|/g,'|').trim(),
    '---------------------'
  ];
  rc.textContent=lines.join('\n');
  download('tech_para24_receipt_'+stamp()+'.txt', rc.textContent);
});
$('#qrGen').addEventListener('click', ()=>{
  const data = prompt('–í—Å—Ç–∞–≤ URL/—Ç–µ–∫—Å—Ç (–ø–∞–ø–∫–∞ –∑ –∞–∫—Ç–∞–º–∏/—Ñ–æ—Ç–æ):', $('#lot').value || 'cv-evidence');
  if(data===null) return;
  const url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=2&data='+encodeURIComponent(data);
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.drawImage(img,0,0,220,220); };
  img.onerror=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.fillStyle='#e5e7eb'; q.font='14px ui-monospace'; q.fillText('QR offline', 62,110); q.fillText((data.length>14?data.slice(0,14)+'‚Ä¶':data), 36,132); };
  img.src=url;
});

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
updateStats(); drawScatter();
</script>


</body></html>