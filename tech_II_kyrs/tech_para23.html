<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 23 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –®–Ü –¥–ª—è —Ç–µ—Ä–º–æ–ø—Ä–æ—Ü–µ—Å—ñ–≤: F/PU, –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—é, –≥—Ä–∞—Ñ—ñ–∫–∏, –∂—É—Ä–Ω–∞–ª, —á–µ–∫/CSV/QR</title>
<meta name="description" content="–°–∏–º—É–ª—è—Ç–æ—Ä —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏: –ø—Ä–æ—Ñ—ñ–ª—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏, —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞–Ω–Ω—è F/PU (–ª–µ—Ç–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç), –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥ —Ü—ñ–ª—å –±–µ–∑ –ø–µ—Ä–µ–≤–∞—Ä—é–≤–∞–Ω–Ω—è, –∂–∏–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏, –∂—É—Ä–Ω–∞–ª, –µ–∫—Å–ø–æ—Ä—Ç, —á–µ–∫/QR."/>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1260px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:90px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
small.mono,.mono{font-family:ui-monospace,monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.45fr 1fr}
@media(max-width:1140px){.grid{grid-template-columns:1fr}}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:300px}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace;white-space:pre}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:0 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.small{font-size:.9rem}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üî•</span>
      <div>
        <b>–ü–∞—Ä–∞ 23 ‚Äî –®–Ü –¥–ª—è —Ç–µ—Ä–º–æ–ø—Ä–æ—Ü–µ—Å—ñ–≤</b><br/>
        <span class="badge">–ø—Ä–æ—Ñ—ñ–ª—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ ‚Üí F/PU ‚Üí –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥ —Ü—ñ–ª—å ‚Üí –≥—Ä–∞—Ñ—ñ–∫–∏ ‚Üí –∂—É—Ä–Ω–∞–ª ‚Üí —á–µ–∫/CSV/QR</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <!-- –ú–ï–¢–ê –¢–ê –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –∑–∞–Ω—è—Ç—Ç—è</h2>
    <p>
      –ù–∞–≤—á–∏—Ç–∏ –º–æ–¥–µ–ª—é–≤–∞—Ç–∏ —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫—É <b>–º–æ–ª–æ–∫–∞/–º‚Äô—è—Å–∞/—Å–∏—Ä—É</b> —É –±—Ä–∞—É–∑–µ—Ä—ñ: –±—É–¥—É–≤–∞—Ç–∏ <b>–ø—Ä–æ—Ñ—ñ–ª—å T(t)</b>, —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ <b>–ª–µ—Ç–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç</b> (<span class="mono">F/PU</span>) –∑–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ <span class="mono">T<sub>ref</sub>, z</span>, 
      —Ç–∞ <b>–æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏</b> —á–∞—Å/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ–ª—ñ –±–µ–∑ ¬´–ø–µ—Ä–µ–≤–∞—Ä—é–≤–∞–Ω–Ω—è¬ª (—à—Ç—Ä–∞—Ñ –∑–∞ —è–∫—ñ—Å—Ç—å).
    </p>
    <div class="grid" style="grid-template-columns:repeat(3,minmax(0,1fr))">
      <div class="note"><b>üìê –ú–æ–¥–µ–ª—å</b><br/>–õ–µ—Ç–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å: <span class="mono">L(T)=10^{(T‚àíTref)/z}</span>, —ñ–Ω—Ç–µ–≥—Ä–∞–ª F = ‚à´L¬∑dt.</div>
      <div class="note"><b>üéõÔ∏è –ü—Ä–æ—Ñ—ñ–ª—å</b><br/>–õ—ñ–Ω—ñ–π–Ω–∏–π —Ä–æ–∑–≥—ñ–Ω ‚Üí —ñ–∑–æ—Ç–µ—Ä–º—ñ—á–Ω–∞ –≤–∏—Ç—Ä–∏–º–∫–∞ ‚Üí –ª—ñ–Ω—ñ–π–Ω–µ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è.</div>
      <div class="note"><b>üß† –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è</b><br/>–ü–æ—à—É–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –ø—Ä–æ—Ñ—ñ–ª—é –ø—ñ–¥ <span class="mono">Target F</span> –∑ –º—ñ–Ω—ñ–º—É–º–æ–º —à—Ç—Ä–∞—Ñ—É –∑–∞ —è–∫—ñ—Å—Ç—å/–ø–µ—Ä–µ–≥—Ä—ñ–≤.</div>
    </div>
  </div>

  <div class="grid">
    <!-- –õ–Ü–í–û -->
    <div class="card">
      <h2>üß∞ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—É</h2>
      <div class="row">
        <label>–ü—Ä–æ–¥—É–∫—Ç / —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç
          <select id="prod" class="input">
            <option value="milk" selected>–ú–æ–ª–æ–∫–æ HTST (Tref=72.0¬∞C, z=7.0, —Ü—ñ–ª—å PU=1.0)</option>
            <option value="curd">–°–∏—Ä–Ω–∞ –º–∞—Å–∞ (Tref=63.0¬∞C, z=7.0, —Ü—ñ–ª—å PU=0.5)</option>
            <option value="sausage">–í–∞—Ä–µ–Ω–∞ –∫–æ–≤–±–∞—Å–∞ (Tref=70.0¬∞C, z=6.0, —Ü—ñ–ª—å F=3.0)</option>
            <option value="custom">–ö–∞—Å—Ç–æ–º</option>
          </select>
        </label>
        <label>Tref, ¬∞C<input id="tref" class="input" type="number" step="0.1" value="72.0"/></label>
        <label>z, ¬∞C<input id="z" class="input" type="number" step="0.1" value="7.0"/></label>
        <label>–¶—ñ–ª—å F/PU<input id="ftarget" class="input" type="number" step="0.01" value="1.00"/></label>
      </div>

      <h3 style="margin-top:8px">üìà –ü—Ä–æ—Ñ—ñ–ª—å T(t): —Ä–æ–∑–≥—ñ–Ω ‚Üí –≤–∏—Ç—Ä–∏–º–∫–∞ ‚Üí –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è</h3>
      <div class="row">
        <label>T —Å—Ç–∞—Ä—Ç, ¬∞C<input id="t0" class="input" type="number" step="0.1" value="4.0"/></label>
        <label>T –≤–∏—Ç—Ä–∏–º–∫–∏, ¬∞C<input id="thold" class="input" type="number" step="0.1" value="74.0"/></label>
        <label>–í–∏—Ç—Ä–∏–º–∫–∞, —Å–µ–∫<input id="hold" class="input" type="number" step="1" value="20"/></label>
      </div>
      <div class="row">
        <label>–ß–∞—Å —Ä–æ–∑–≥–æ–Ω—É, —Å–µ–∫<input id="t_up" class="input" type="number" step="1" value="25"/></label>
        <label>–ß–∞—Å –æ—Ö–æ–ª., —Å–µ–∫<input id="t_dn" class="input" type="number" step="1" value="40"/></label>
        <label>–ö—Ä–æ–∫ —Å–∏–º—É–ª—è—Ü—ñ—ó, —Å–µ–∫<input id="dt" class="input" type="number" step="0.1" value="0.5"/></label>
        <button class="btn" id="simulate">‚ñ∂Ô∏è –°–∏–º—É–ª—é–≤–∞—Ç–∏</button>
      </div>

      <h3 style="margin-top:8px">üß† –ê–≤—Ç–æ-–ø—ñ–¥–±—ñ—Ä (AI)</h3>
      <div class="row">
        <label>Max T, ¬∞C<input id="tmax" class="input" type="number" step="0.1" value="78.0"/></label>
        <label>Max —á–∞—Å, —Å–µ–∫<input id="tmaxsec" class="input" type="number" step="1" value="240"/></label>
        <label>–®—Ç—Ä–∞—Ñ —è–∫–æ—Å—Ç—ñ, ¬∞C<sup>2</sup>¬∑—Å–µ–∫<input id="qpen" class="input" type="number" step="0.1" value="0.08"/></label>
        <button class="btn good" id="opt">üöÄ –ü—ñ–¥—ñ–±—Ä–∞—Ç–∏ –ø—ñ–¥ —Ü—ñ–ª—å</button>
      </div>
      <small class="muted">–®—Ç—Ä–∞—Ñ ‚àù ‚àë(max(0, T‚àíT<sub>qual</sub>))¬≤¬∑dt, –¥–µ T<sub>qual</sub>=Tref (–Ω–∞–±–ª–∏–∂–µ–Ω–æ). –ú–µ—Ç–∞ ‚Äî F ‚â• Target –ø—Ä–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–º—É —à—Ç—Ä–∞—Ñ—ñ/—á–∞—Å—ñ.</small>

      <h3 style="margin-top:10px">üìä –ñ–∏–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏</h3>
      <div class="canvasWrap"><canvas id="cT" width="980" height="300"></canvas></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="cF" width="980" height="260"></canvas></div>
      <small class="muted">–í–≥–æ—Ä—ñ ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞; –≤–Ω–∏–∑—É ‚Äî –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∏–π F/PU —ñ –º–∏—Ç—Ç—î–≤–∞ –ª–µ—Ç–∞–ª—å–Ω—ñ—Å—Ç—å L(T).</small>

      <h3 style="margin-top:10px">üõéÔ∏è –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</h3>
      <pre id="alog" class="note" style="max-height:180px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>

      <h3 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç / –¥—Ä—É–∫</h3>
      <div class="row">
        <input id="lot" class="input" placeholder="–õ–æ—Ç/–ø—Ä–æ—Ü–µ—Å (–Ω–∞–ø—Ä. HTST_2025-10-18_–∑–º—ñ–Ω–∞B)"/>
        <button class="btn" id="saveCsv">üìÑ CSV (–ø—Ä–æ—Ñ—ñ–ª—å)</button>
        <button class="btn" id="saveTxt">üíæ TXT (–∑–≤—ñ—Ç)</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="qrGen">üîó QR (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –¥–æ–∫–∞–∑–∏)</button>
      </div>
      <div id="rc" class="receipt" hidden></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="qr" width="220" height="220"></canvas></div>
      <small class="muted">QR –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ <span class="mono">api.qrserver.com</span>; –æ—Ñ–ª–∞–π–Ω ‚Äî –≤–∏–≤–µ–¥–µ—Ç—å—Å—è —Ç–µ–∫—Å—Ç.</small>
    </div>

    <!-- –ü–†–ê–í–û -->
    <div class="card">
      <h2>üìä –ü–æ–∫–∞–∑–Ω–∏–∫–∏</h2>
      <table class="tbl">
        <tbody>
          <tr><th>Target F/PU</th><td id="m_ft">‚Äî</td></tr>
          <tr><th>–î–æ—Å—è–≥–Ω—É—Ç–∏–π F/PU</th><td id="m_f">‚Äî</td></tr>
          <tr><th>–ú–∞–∫—Å T, ¬∞C</th><td id="m_tmax">‚Äî</td></tr>
          <tr><th>–ß–∞—Å –≤–∏—â–µ Tref, —Å–µ–∫</th><td id="m_abv">‚Äî</td></tr>
          <tr><th>–®—Ç—Ä–∞—Ñ —è–∫–æ—Å—Ç—ñ</th><td id="m_pen">‚Äî</td></tr>
          <tr><th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—É, —Å–µ–∫</th><td id="m_dur">‚Äî</td></tr>
          <tr><th>–°—Ç–∞–Ω</th><td id="m_state">‚Äî</td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üîå –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—É (SVG)</h2>
      <svg viewBox="0 0 820 280" role="img" aria-label="–ü—Ä–æ—Ñ—ñ–ª—å T(t) ‚Üí –Ü–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä F ‚Üí –†—ñ—à–µ–Ω–Ω—è">
        <rect x="40" y="40" width="170" height="120" rx="12" fill="#0e2a47" stroke="#3b82f6"/>
        <text x="125" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ü—Ä–æ—Ñ—ñ–ª—å T(t)</text>
        <text x="125" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">—Ä–æ–∑–≥—ñ–Ω/–≤–∏—Ç—Ä–∏–º–∫–∞/–æ—Ö–æ–ª.</text>

        <rect x="230" y="40" width="190" height="120" rx="12" fill="#14532d" stroke="#22c55e"/>
        <text x="325" y="80" fill="#dcfce7" font-size="14" text-anchor="middle">–Ü–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä F/PU</text>
        <text x="325" y="100" fill="#a7f3d0" font-size="12" text-anchor="middle">L(T)=10^{(T‚àíTref)/z}</text>

        <rect x="440" y="40" width="150" height="120" rx="12" fill="#1f2937" stroke="#9ca3af"/>
        <text x="515" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–û—Ü—ñ–Ω–∫–∞ —è–∫–æ—Å—Ç—ñ</text>
        <text x="515" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">—à—Ç—Ä–∞—Ñ –∑–∞ –ø–µ—Ä–µ–≥—Ä—ñ–≤</text>

        <rect x="610" y="40" width="170" height="120" rx="12" fill="#0b1a2f" stroke="#64748b"/>
        <text x="695" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ó–≤—ñ—Ç</text>
        <text x="695" y="100" fill="#93c5fd" font-size="12" text-anchor="middle">—á–µ–∫/CSV/QR</text>

        <line x1="210" y1="100" x2="230" y2="100" stroke="#93c5fd" stroke-width="3"/>
        <line x1="420" y1="100" x2="440" y2="100" stroke="#22c55e" stroke-width="3"/>
        <line x1="590" y1="100" x2="610" y2="100" stroke="#64748b" stroke-width="3"/>
      </svg>

      <h2 style="margin-top:10px">üéØ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
      <ol>
        <li>–î–ª—è <b>–ú–æ–ª–æ–∫–∞ HTST</b> –¥–æ—Å—è–≥–Ω–∏ <b>PU ‚â• 1.0</b> –ø—Ä–∏ <b>Tmax ‚â§ 78¬∞C</b> —ñ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–º—É —à—Ç—Ä–∞—Ñ—ñ. –ó–±–µ—Ä–µ–∂–∏ <b>TXT</b>.</li>
        <li>–ü–æ—Ä—ñ–≤–Ω—è–π —Ä—É—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –∞–≤—Ç–æ-–ø—ñ–¥–±—ñ—Ä: —á–∞—Å –ø—Ä–æ—Ü–µ—Å—É, PU/F, —à—Ç—Ä–∞—Ñ —è–∫–æ—Å—Ç—ñ (—Å–∫—Ä—ñ–Ω –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ + –∂—É—Ä–Ω–∞–ª).</li>
        <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>CSV</b> –ø—Ä–æ—Ñ—ñ–ª—é, <b>—á–µ–∫ 58 –º–º</b> —Ç–∞ <b>QR</b> –Ω–∞ –ø–∞–ø–∫—É –∑ –∞–∫—Ç–∞–º–∏/—Ñ–æ—Ç–æ.</li>
      </ol>

      <h2 style="margin-top:10px">‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="tbl">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–æ –∑—ñ–±—Ä–∞–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å (CSV) + –¥–æ—Å—è–≥–Ω—É—Ç–∏–π Target F/PU</td><td>4</td></tr>
          <tr><td>–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è ¬´—Ä—É—á–Ω–µ vs –∞–≤—Ç–æ¬ª –∑ –≤–∏—Å–Ω–æ–≤–∫–æ–º (—á–∞—Å/—à—Ç—Ä–∞—Ñ/ Tmax)</td><td>3</td></tr>
          <tr><td>–ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π —ñ–∑ –∫–ª—é—á–æ–≤–∏–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏ (–¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ–ª—ñ, –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è)</td><td>2</td></tr>
          <tr><td>–ß–µ–∫ 58 –º–º + QR –¥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ –¥–æ–¥–∞–Ω–æ</td><td>1</td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
      <p class="muted small">–í—ñ–¥ –ø–∞–ø–µ—Ä–æ–≤–∏—Ö —Ç–µ—Ä–º–æ–≥—Ä–∞—Ñ—ñ–≤ –¥–æ —Å—É—á–∞—Å–Ω–∏—Ö —Ü–∏—Ñ—Ä–æ–≤–∏—Ö –ª–æ–≥–µ—Ä—ñ–≤: —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞–Ω–Ω—è <span class="mono">F/PU</span> —Å—Ç–∞–ª–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó –±–µ–∑–ø–µ–∫–∏ –±–µ–∑ –∑–∞–π–≤–æ–≥–æ ¬´–ø–µ—Ä–µ–≤–∞—Ä—é–≤–∞–Ω–Ω—è¬ª –ø—Ä–æ–¥—É–∫—Ç—É.</p>
    </div>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function log(msg){const t=new Date().toLocaleTimeString();const box=$('#alog');if(box.textContent.startsWith('//'))box.textContent='';box.textContent+=`[${t}] ${msg}\n`;box.scrollTop=box.scrollHeight;}

// ===== –ü—Ä–æ—Ñ—ñ–ª—ñ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ =====
const PRODS={
  milk :{tref:72.0, z:7.0, f:1.00},
  curd :{tref:63.0, z:7.0, f:0.50},
  sausage:{tref:70.0, z:6.0, f:3.00},
  custom:{tref:72.0, z:7.0, f:1.00}
};
$('#prod').addEventListener('change',()=>{
  const p=PRODS[$('#prod').value];
  $('#tref').value=p.tref; $('#z').value=p.z; $('#ftarget').value=p.f;
});

// ===== –°–∏–º—É–ª—è—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—é =====
function buildProfile(params){
  const {t0, thold, t_up, hold, t_dn, dt} = params;
  const T0=t0, T1=thold, T2=t0; // –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ –ø–æ—á–∞—Ç–∫—É –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏
  const out=[];
  // —Ä–æ–∑–≥—ñ–Ω
  for(let t=0;t<=t_up;t+=dt){
    const T=T0 + (T1-T0)*(t/Math.max(1e-9,t_up));
    out.push({t:out.length? out[out.length-1].t+dt : 0, T});
  }
  // –≤–∏—Ç—Ä–∏–º–∫–∞
  for(let t=dt;t<=hold+1e-9;t+=dt){
    out.push({t:out[out.length-1].t+dt, T:T1});
  }
  // –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è
  for(let t=dt;t<=t_dn+1e-9;t+=dt){
    const T=T1 + (T2-T1)*(t/Math.max(1e-9,t_dn));
    out.push({t:out[out.length-1].t+dt, T});
  }
  return out;
}

function integrateF(series, tref, z){
  // L(T)=10^((T‚àítref)/z), F = ‚à´ L dt (—Å–µ–∫) ‚Üí —Ö–≤/—Ö–≤: —Ç—É—Ç –∑–∞–ª–∏—à–∏–º–æ ¬´–≤ —Å–µ–∫¬ª —è–∫ ¬´—É–º–æ–≤–Ω—ñ PU¬ª (–º–∞—Å—à—Ç–∞–± –≤—ñ–¥–Ω–æ—Å–Ω–∏–π)
  // –î–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –≤–∏–≤–æ–¥—É ‚Äî –ø–µ—Ä–µ–≤–µ–¥–µ–º–æ –≤ ¬´—Ö–≤–∏–ª–∏–Ω–∏ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç—É¬ª: Fmin = Fsec/60
  let Fsec=0, above=0, Tmax=-1e9;
  for(let i=1;i<series.length;i++){
    const a=series[i-1], b=series[i];
    const dt=b.t-a.t;
    const La=Math.pow(10, (a.T-tref)/z);
    const Lb=Math.pow(10, (b.T-tref)/z);
    const Lavg=0.5*(La+Lb);
    Fsec += Lavg*dt;
    if(a.T>tref) above+=dt;
    Tmax=Math.max(Tmax,b.T);
  }
  return {Fsec, Fmin:Fsec/60, above, Tmax};
}

function qualityPenalty(series, tref, K){
  // —à—Ç—Ä–∞—Ñ –∑–∞ ¬´–ø–µ—Ä–µ–≤–∞—Ä—é–≤–∞–Ω–Ω—è¬ª: —ñ–Ω—Ç–µ–≥—Ä—É—î–º–æ (max(0,T‚àítref))^2 * K * dt
  let pen=0;
  for(let i=1;i<series.length;i++){
    const a=series[i-1], b=series[i], dt=b.t-a.t;
    const qa=Math.max(0,a.T-tref), qb=Math.max(0,b.T-tref);
    pen += K * 0.5*(qa*qa + qb*qb)*dt;
  }
  return pen;
}

function simulate(){
  const parm={
    t0:+$('#t0').value, thold:+$('#thold').value, t_up:+$('#t_up').value, hold:+$('#hold').value, t_dn:+$('#t_dn').value, dt:+$('#dt').value
  };
  const tref=+$('#tref').value, z=+$('#z').value, ft=+$('#ftarget').value;
  const S=buildProfile(parm);
  const F=integrateF(S,tref,z);
  const pen=qualityPenalty(S,tref,+$('#qpen').value);
  updateKPIs(ft,F,pen,S);
  drawAll(S,tref,z,F);
  log(`–°–∏–º—É–ª—è—Ü—ñ—è: F(min)=${F.Fmin.toFixed(3)}, Tmax=${F.Tmax.toFixed(1)}¬∞C, –ø–µ–Ω–∞–ª—å—Ç—ñ=${pen.toFixed(2)}`);
  return {S,F,pen};
}
$('#simulate').addEventListener('click', simulate);

// ===== –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—é –ø—ñ–¥ —Ü—ñ–ª—å =====
function optimize(){
  const tref=+$('#tref').value, z=+$('#z').value, ft=+$('#ftarget').value;
  const t0=+$('#t0').value, dt=+$('#dt').value;
  const TMAX=+$('#tmax').value, TMAXSEC=+$('#tmaxsec').value, K=+$('#qpen').value;

  let best=null, bestScore=+Infinity;

  // –ì—Ä—É–±–∏–π –ø–µ—Ä–µ–±—ñ—Ä + –ª–æ–∫–∞–ª—å–Ω–µ –¥–æ–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è
  for(let Th=tref; Th<=TMAX; Th+=0.5){
    for(let tup=10; tup<=Math.min(90,TMAXSEC); tup+=5){
      for(let hold=5; hold<=TMAXSEC; hold+=5){
        const tdn=Math.max(10, Math.min(TMAXSEC, Math.round((tup+hold)*0.6)));
        const profile=buildProfile({t0, thold:Th, t_up:tup, hold, t_dn:tdn, dt});
        const F=integrateF(profile, tref, z);
        const pen=qualityPenalty(profile, tref, K);
        const miss = Math.max(0, ft - F.Fmin); // –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –Ω–µ –¥–æ—Ç—è–≥–Ω—É–ª–∏
        const over = Math.max(0, F.Fmin - ft); // ¬´–ø–µ—Ä–µ–≤–∞—Ä–∏–ª–∏¬ª
        // —Ü—ñ–ª—å–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è: –≤–∞–≥–∞ –∑–∞ –Ω–µ–¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è >> –ø–µ—Ä–µ–≤–∞—Ä—é–≤–∞–Ω–Ω—è, –∞–ª–µ –æ–±–∏–¥–≤–∞ –ø–æ–≥–∞–Ω—ñ; –ø–ª—é—Å —à—Ç—Ä–∞—Ñ —è–∫–æ—Å—Ç—ñ —Ç–∞ —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ
        const score = 50*miss + 5*over + pen + 0.01*profile[profile.length-1].t;
        if(score<bestScore){
          bestScore=score;
          best={parm:{t0, thold:Th, t_up:tup, hold, t_dn:tdn, dt}, profile, F, pen, score};
        }
      }
    }
  }

  if(!best){ alert('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Ä—ñ—à–µ–Ω—å'); return; }
  // –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –∫—Ä–∞—â–µ
  $('#thold').value=best.parm.thold.toFixed(1);
  $('#t_up').value=best.parm.t_up.toFixed(0);
  $('#hold').value=best.parm.hold.toFixed(0);
  $('#t_dn').value=best.parm.t_dn.toFixed(0);

  updateKPIs(ft,best.F,best.pen,best.profile);
  drawAll(best.profile,tref,z,best.F);
  log(`AI: Thold=${best.parm.thold}¬∞C, up=${best.parm.t_up}s, hold=${best.parm.hold}s, down=${best.parm.t_dn}s -> F=${best.F.Fmin.toFixed(3)}, score=${best.score.toFixed(2)}`);
}
$('#opt').addEventListener('click', optimize);

// ===== –ú–∞–ª—é–≤–∞–Ω–Ω—è =====
const cT=$('#cT'), gT=cT.getContext('2d');
const cF=$('#cF'), gF=cF.getContext('2d');

function drawTemp(series, tref){
  const W=cT.width,H=cT.height; gT.clearRect(0,0,W,H);
  gT.strokeStyle='#223049'; gT.strokeRect(0.5,0.5,W-1,H-1);
  if(series.length<2){ gT.fillStyle='#94a3b8'; gT.fillText('–°–ø–µ—Ä—à—É —Å–∏–º—É–ª—è—Ü—ñ—è –∞–±–æ AI-–ø—ñ–¥–±—ñ—Ä',14,20); return; }

  const t0=0, t1=series[series.length-1].t;
  const Tmin=Math.min(...series.map(p=>p.T), tref-5), Tmax=Math.max(...series.map(p=>p.T), tref+5);
  const left=50, right=W-10, top=20, bottom=H-24;
  const xOf=t=> left + (t-t0)/(t1-t0||1)*(right-left);
  const yOf=T=> bottom - (T-Tmin)/(Tmax-Tmin||1)*(bottom-top);

  // –∑–æ–Ω–∞ –≤–∏—â–µ Tref
  gT.fillStyle='rgba(251,191,36,0.12)';
  gT.fillRect(left, yOf(Math.max(tref,Tmin)), right-left, yOf(Tmin)-yOf(Math.max(tref,Tmin)));

  // –∫—Ä–∏–≤–∞ T(t)
  gT.beginPath(); gT.strokeStyle='#38bdf8'; gT.lineWidth=2;
  series.forEach((p,i)=>{const x=xOf(p.t), y=yOf(p.T); i?gT.lineTo(x,y):gT.moveTo(x,y);}); gT.stroke();

  // –æ—Å—ñ/–ø—ñ–¥–ø–∏—Å–∏
  gT.fillStyle='#94a3b8'; gT.font='12px ui-monospace';
  gT.fillText('t, —Å–µ–∫', right-60, H-6);
  gT.fillText('T, ¬∞C', 8, 14);
  gT.fillText(`Tref=${tref.toFixed(1)}¬∞C`, right-140, 14);
}

function drawF(series, tref, z, F){
  const W=cF.width,H=cF.height; gF.clearRect(0,0,W,H);
  gF.strokeStyle='#223049'; gF.strokeRect(0.5,0.5,W-1,H-1);
  if(series.length<2){ gF.fillStyle='#94a3b8'; gF.fillText('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è F/PU',14,20); return; }

  // –ø–æ–±—É–¥—É—î–º–æ L(T) —ñ –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∏–π Fmin
  const Ls=[0], Fs=[0];
  for(let i=1;i<series.length;i++){
    const a=series[i-1], b=series[i], dt=b.t-a.t;
    const La=Math.pow(10,(a.T-tref)/z), Lb=Math.pow(10,(b.T-tref)/z);
    const Lavg=0.5*(La+Lb);
    Ls.push(Lavg);
    Fs.push(Fs[Fs.length-1]+Lavg*dt/60);
  }

  const t1=series[series.length-1].t, left=50, right=cF.width-10, top=20, bottom=cF.height-24;
  const xOf=t=> left+t/(t1||1)*(right-left);
  const Lmax=Math.max(...Ls);
  const Fmax=Fs[Fs.length-1];
  const yL=v=> bottom - (v/(Lmax||1))*(bottom-top);
  const yF=v=> bottom - (v/(Fmax||1))*(bottom-top);

  // F(t) –∫—É–º—É–ª—è—Ç–∏–≤
  gF.beginPath(); gF.strokeStyle='#22c55e'; gF.lineWidth=2;
  series.forEach((p,i)=>{const x=xOf(p.t), y=yF(Fs[i]); i?gF.lineTo(x,y):gF.moveTo(x,y);}); gF.stroke();

  // L(T) (–Ω–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–æ)
  gF.beginPath(); gF.strokeStyle='rgba(248,113,113,0.75)'; gF.lineWidth=1.5;
  series.forEach((p,i)=>{const x=xOf(p.t), y=yL(Ls[i]); i?gF.lineTo(x,y):gF.moveTo(x,y);}); gF.stroke();

  gF.fillStyle='#94a3b8'; gF.font='12px ui-monospace';
  gF.fillText(`F/PU (–∑–µ–ª–µ–Ω–∞)  ‚Äî  L(T) (—á–µ—Ä–≤–æ–Ω–∞)`, left, 14);
  gF.fillText(`F(final)=${F.Fmin.toFixed(3)}`, right-140, 14);
}

function drawAll(S,tref,z,F){ drawTemp(S,tref); drawF(S,tref,z,F); }

// ===== KPI =====
function updateKPIs(ft,F,pen,S){
  $('#m_ft').textContent=ft.toFixed(3);
  $('#m_f').textContent =F.Fmin.toFixed(3);
  $('#m_tmax').textContent=F.Tmax.toFixed(1);
  $('#m_abv').textContent =F.above.toFixed(0);
  $('#m_pen').textContent =pen.toFixed(2);
  $('#m_dur').textContent =S[S.length-1].t.toFixed(0);
  const state = (F.Fmin+1e-9>=ft) ? 'üéØ –¶—ñ–ª—å –¥–æ—Å—è–≥–Ω—É—Ç–∞' : '‚è≥ –ù–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ';
  $('#m_state').innerHTML = (F.Fmin+1e-9>=ft? `<b class="ok">${state}</b>`:`<b class="warn">${state}</b>`);
  if(F.Fmin+1e-9>=ft) log(`üéØ –î–æ—Å—è–≥–Ω—É—Ç–æ —Ü—ñ–ª—å F/PU: ${F.Fmin.toFixed(3)} ‚â• ${ft.toFixed(3)}`);
  if(F.Tmax>+$('#tmax').value) log(`‚ö†Ô∏è –ü–µ—Ä–µ–≤–∏—â–µ–Ω–æ Tmax –ª—ñ–º—ñ—Ç—É: ${F.Tmax.toFixed(1)}¬∞C > ${(+$('#tmax').value).toFixed(1)}¬∞C`);
}

// ===== –ï–∫—Å–ø–æ—Ä—Ç / —á–µ–∫ / QR =====
$('#saveCsv').addEventListener('click', ()=>{
  const tref=+$('#tref').value, z=+$('#z').value, ft=+$('#ftarget').value;
  const res=simulate(); if(!res) return;
  let csv='t_sec,TempC,L(T),F_cum_min\n';
  // –ø–æ–±—É–¥—É—î–º–æ L, F –ø–æ–≤—Ç–æ—Ä–Ω–æ –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É
  const S=res.S; let Fc=0;
  for(let i=0;i<S.length;i++){
    const t=S[i].t, T=S[i].T;
    const L=Math.pow(10,(T-tref)/z);
    if(i>0){ const dt=S[i].t-S[i-1].t; Fc += 0.5*(L+Math.pow(10,(S[i-1].T-tref)/z))*dt/60; }
    csv+=`${t.toFixed(2)},${T.toFixed(2)},${L.toFixed(6)},${Fc.toFixed(6)}\n`;
  }
  download('tech_para23_profile_'+stamp()+'.csv',csv,'text/csv');
});

$('#saveTxt').addEventListener('click', ()=>{
  const tref=+$('#tref').value, z=+$('#z').value, ft=+$('#ftarget').value;
  const res=simulate(); if(!res) return;
  const lines=[
    '–ü–∞—Ä–∞ 23 ‚Äî –®–Ü –¥–ª—è —Ç–µ—Ä–º–æ–ø—Ä–æ—Ü–µ—Å—ñ–≤: –ø—ñ–¥—Å—É–º–æ–∫',
    '–ü—Ä–æ—Ü–µ—Å: '+($('#lot').value||'‚Äî'),
    `Tref=${tref}¬∞C, z=${z}¬∞C, Target F/PU=${ft}`,
    `–î–æ—Å—è–≥–Ω—É—Ç–∏–π F/PU=${res.F.Fmin.toFixed(3)}, Tmax=${res.F.Tmax.toFixed(1)}¬∞C, –≤–∏—â–µ Tref=${res.F.above.toFixed(0)} —Å–µ–∫`,
    `–®—Ç—Ä–∞—Ñ —è–∫–æ—Å—Ç—ñ=${res.pen.toFixed(2)}, –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å=${res.S[res.S.length-1].t.toFixed(0)} —Å–µ–∫`
  ];
  download('tech_para23_summary_'+stamp()+'.txt', lines.join('\n'));
});

$('#print58').addEventListener('click', ()=>{
  const tref=+$('#tref').value, z=+$('#z').value, ft=+$('#ftarget').value;
  const res=simulate(); if(!res) return;
  const rc=$('#rc'); rc.hidden=false;
  const lines=[
    '=== –¢–ï–†–ú–û–ü–†–û–¶–ï–° (58–º–º) ===',
    '–ü—Ä–æ—Ü–µ—Å: '+($('#lot').value||'‚Äî'),
    `F/PU=${res.F.Fmin.toFixed(3)} (target ${ft})`,
    `Tmax=${res.F.Tmax.toFixed(1)}¬∞C | >Tref=${res.F.above.toFixed(0)}s`,
    `Penalty=${res.pen.toFixed(2)} | Dur=${res.S[res.S.length-1].t.toFixed(0)}s`,
    '--------------------------'
  ];
  rc.textContent=lines.join('\n');
  download('tech_para23_receipt_'+stamp()+'.txt', rc.textContent);
});

$('#qrGen').addEventListener('click', ()=>{
  const data = prompt('–í—Å—Ç–∞–≤ URL/—Ç–µ–∫—Å—Ç (–ø–∞–ø–∫–∞ –∑ –∞–∫—Ç–∞–º–∏/—Ñ–æ—Ç–æ):', $('#lot').value || 'thermal-evidence');
  if(data===null) return;
  const url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=2&data='+encodeURIComponent(data);
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.drawImage(img,0,0,220,220); };
  img.onerror=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.fillStyle='#e5e7eb'; q.font='14px ui-monospace'; q.fillText('QR offline', 62,110); q.fillText((data.length>14?data.slice(0,14)+'‚Ä¶':data), 36,132); };
  img.src=url;
});

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
(function init(){
  // –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Å—Ç–∞—Ä—Ç–æ–≤–∏–π –ø—Ä–æ—Ñ—ñ–ª—å
  $('#m_ft').textContent = (+$('#ftarget').value).toFixed(3);
  simulate();
})();
</script>
</body>
</html>
