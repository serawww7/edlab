<!-- tech_para2.html
     –ü–ê–†–ê 2 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–≤ –∑ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞
     –¢–µ–º–∞: HACCP ‚Äî –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ö–¢–ö (CCP): –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è, –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è, –¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—è.
           –¢—Ä–µ–∫–µ—Ä "—á–∞—Å‚Äì—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º–µ–∂, –∑–≤—ñ—Ç –ø—Ä–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è,
           —á–µ–∫ 58 –º–º, NFC, CSV-–∂—É—Ä–Ω–∞–ª.
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; (–æ–ø—Ü.) —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º; NFC-–º—ñ—Ç–∫–∏.
     –ì–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è –≤ Moodle (iframe).

     –ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 2 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî HACCP: –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è, –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è, –¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—è (CCP), —á–µ–∫ 58 –º–º, NFC, CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e6eef9;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px; position:relative; z-index:999999} /* –ø—ñ–¥–Ω—è–ª–∏ —à–∞—Ä, —è–∫—â–æ —î —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π –æ–≤–µ—Ä–ª–µ–π */
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  textarea{min-height:88px}
  /* –ß–µ–∫ 58 –º–º (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –≤—ñ–∫–Ω—ñ) */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ –≤ Moodle (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
</style>

<!-- Interaction Guard: –≥–∞—Ä–∞–Ω—Ç—É—î –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –Ω–∞–≤—ñ—Ç—å –ø—ñ—Å–ª—è —Å–ø—Ä–æ–± –¥—Ä—É–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ iframe -->
<style>
  /* –ù—ñ—á–æ–≥–æ –∞–≥—Ä–µ—Å–∏–≤–Ω–æ–≥–æ: —Ç—ñ–ª—å–∫–∏ –æ—Å–Ω–æ–≤–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è */
  button, .btn, input, select, textarea, a { pointer-events:auto !important; }
</style>
</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 2 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –ø–µ—Ä–µ—Ä–æ–±–∫–∏</span>
  <h1>üõ°Ô∏è HACCP (CCP): –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è, –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è, –¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—è ‚Äî —Ç—Ä–µ–∫–µ—Ä T‚Äìt, –∑–≤—ñ—Ç, —á–µ–∫ 58 –º–º, NFC</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –ø–∞—Ä–∏</h2>
    <p>
      –ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –≤—ñ–¥—Å–ª—ñ–¥–∫—É—é—Ç—å <b>–ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—é</b> –∑–∞ —á–∞—Å–æ–º —ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ—é,
      (2) –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç—å <b>–ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è</b> –≥–æ—Ç–æ–≤–æ—ó –ø—Ä–æ–¥—É–∫—Ü—ñ—ó/—Å–∏—Ä–æ–≤–∏–Ω–∏,
      (3) —Ä–æ–∑—Ä–∞—Ö—É—é—Ç—å <b>—Ä–æ–±–æ—á—ñ —Ä–æ–∑—á–∏–Ω–∏ –¥–µ–∑—ñ–Ω—Ñ–µ–∫—Ç–∞–Ω—Ç–∞</b>,
      (4) —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>–∑–≤—ñ—Ç –ø—Ä–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</b>, <b>NFC</b> —Ç–∞ <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>, (5) –ø—ñ–¥–≥–æ—Ç—É—é—Ç—å <b>CSV-–∂—É—Ä–Ω–∞–ª</b>.
    </p>
    <p class="small muted">–¢–∏–ø–æ–≤—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –º–µ–∂—ñ: HTST –¥–ª—è –º–æ–ª–æ–∫–∞ ‚Äî ‚â• <span class="mono">72 ¬∞C</span> –ø—Ä–æ—Ç—è–≥–æ–º ‚â• <span class="mono">15 —Å</span>; 
      –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è –≤–∞—Ä–µ–Ω–æ—ó –ø—Ä–æ–¥—É–∫—Ü—ñ—ó ‚Äî –≤—ñ–¥ <span class="mono">60 ¬∞C ‚Üí 21 ¬∞C</span> ‚â§ <span class="mono">2 –≥–æ–¥</span> —ñ –≤—ñ–¥ <span class="mono">21 ¬∞C ‚Üí 5 ¬∞C</span> ‚â§ <span class="mono">4 –≥–æ–¥</span>.</p>
  </div>

  <!-- 1. –í–ò–ë–Ü–† –ö–¢–ö –Ü –ü–ê–†–ê–ú–ï–¢–†–ò -->
  <div class="card">
    <h2>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ö–¢–ö</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏–±—ñ—Ä –ö–¢–ö</h3>
        <div class="row">
          <div style="flex:1">
            <label>–ö—Ä–∏—Ç–∏—á–Ω–∞ —Ç–æ—á–∫–∞</label>
            <select id="ccp">
              <option value="pasteur" selected>–ü–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è (HTST)</option>
              <option value="cooling">–û—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è –≥–æ—Ç–æ–≤–æ—ó –ø—Ä–æ–¥—É–∫—Ü—ñ—ó</option>
              <option value="sanit">–î–µ–∑—ñ–Ω—Ñ–µ–∫—Ü—ñ—è/–º–∏–π–Ω—ñ —Ä–æ–∑—á–∏–Ω–∏</option>
            </select>
          </div>
          <div style="flex:1">
            <label>ID –ª—ñ–Ω—ñ—ó</label><input id="lineId" type="text" value="L1">
          </div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–û–ø–µ—Ä–∞—Ç–æ—Ä</label><input id="operator" type="text" value="–°—Ç—É–¥–µ–Ω—Ç –≥—Ä—É–ø–∏ –¢–ü–¢"></div>
          <div style="flex:1"><label>–ó–º—ñ–Ω–∞</label>
            <select id="shift"><option>A</option><option selected>B</option><option>C</option></select>
          </div>
        </div>
      </div>

      <div class="box" id="boxPasteur">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó</h3>
        <div class="row">
          <div style="flex:1"><label>–ö—Ä–∏—Ç. T, ¬∞C (–Ω–µ –Ω–∏–∂—á–µ)</label><input id="p_Tcrit" type="number" step="0.1" value="72"></div>
          <div style="flex:1"><label>–ß–∞—Å —É—Ç—Ä–∏–º., —Å (–Ω–µ –º–µ–Ω—à–µ)</label><input id="p_tHold" type="number" step="1" value="15"></div>
        </div>
      </div>

      <div class="box" id="boxCooling" style="display:none">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è</h3>
        <div class="row">
          <div style="flex:1"><label>T –ø–æ—á–∞—Ç–∫–æ–≤–∞, ¬∞C</label><input id="c_Tstart" type="number" step="0.1" value="60"></div>
          <div style="flex:1"><label>T –∫—ñ–Ω—Ü–µ–≤–∞, ¬∞C</label><input id="c_Tend" type="number" step="0.1" value="5"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–í—ñ–∫–Ω–æ 60‚Üí21, –≥–æ–¥ (‚â§)</label><input id="c_w1" type="number" step="0.1" value="2"></div>
          <div style="flex:1"><label>–í—ñ–∫–Ω–æ 21‚Üí5, –≥–æ–¥ (‚â§)</label><input id="c_w2" type="number" step="0.1" value="4"></div>
        </div>
      </div>

      <div class="box" id="boxSanit" style="display:none">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–µ–∑—Ä–æ–∑—á–∏–Ω—É</h3>
        <div class="row">
          <div style="flex:1"><label>–¢–∏–ø</label>
            <select id="s_type">
              <option value="NaOCl" selected>–ì—ñ–ø–æ—Ö–ª–æ—Ä–∏—Ç –Ω–∞—Ç—Ä—ñ—é (NaOCl)</option>
              <option value="PAA">–ü–µ—Ä–æ—Ü—Ç–æ–≤–∞ –∫–∏—Å–ª–æ—Ç–∞ (PAA)</option>
              <option value="QUAT">–ß–ê–° (—á–µ—Ç–≤–µ—Ä—Ç–∏–Ω–Ω—ñ –∞–º–æ–Ω—ñ—î–≤—ñ)</option>
            </select>
          </div>
          <div style="flex:1"><label>–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è –ø—Ä–µ–ø–∞—Ä–∞—Ç—É</label><input id="s_stock" type="number" step="0.01" value="5"> <small>% –∞–±–æ –≥/100–º–ª*</small></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ú–µ—Ç–∞, ppm (–º–≥/–ª)</label><input id="s_target" type="number" step="1" value="100"></div>
          <div style="flex:1"><label>–û–±'—î–º, –ª</label><input id="s_volume" type="number" step="0.1" value="10"></div>
        </div>
        <p class="small muted">*–î–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –ø—Ä–∏–π–º–∞—î–º–æ: 1% ‚âà 10 000 ppm –¥—ñ—é—á–æ—ó —Ä–µ—á–æ–≤–∏–Ω–∏.</p>
      </div>
    </div>
  </div>

  <!-- 2. –¢–†–ï–ö–ï–† "–ß–ê–°‚Äì–¢–ï–ú–ü–ï–†–ê–¢–£–†–ê" / –¢–û–ß–ö–ò -->
  <div class="card">
    <h2>‚è±Ô∏èüî• –¢–æ—á–∫–∏ ‚Äú—á–∞—Å‚Äì—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞‚Äù</h2>
    <div class="row">
      <button class="btn" onclick="addPoint()">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ—á–∫—É</button>
      <button class="btn" onclick="nowPoint()">üïí –î–æ–¥–∞—Ç–∏ T –∑–∞—Ä–∞–∑</button>
      <button class="btn" onclick="presetPoints()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="clearPoints()">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      <button class="btn" onclick="copyCSV('csvPoints')">üìã CSV (points)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblPoints">
        <thead>
          <tr>
            <th>#</th>
            <th>–ß–∞—Å (HH:MM:SS)</th>
            <th class="dark">T, ¬∞C</th>
            <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyPoints"></tbody>
      </table>
    </div>
    <div id="csvPoints" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 3. –†–û–ó–†–ê–•–£–ù–û–ö –í–ò–ö–û–ù–ê–ù–ù–Ø –ö–†–ò–¢–ò–ß–ù–ò–• –ú–ï–ñ -->
  <div class="card">
    <h2>üìä –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ö–¢–ö</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫</h3>
        <div class="row">
          <button class="btn" onclick="evaluate()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvEval')">üìã CSV (eval)</button>
        </div>
        <div id="csvEval" class="out" style="margin-top:8px">‚Äî</div>
      </div>
      <div class="box">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p>–°—Ç–∞—Ç—É—Å: <b><span id="status">‚Äî</span></b></p>
        <p>–ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏: <b><span id="metrics">‚Äî</span></b></p>
        <p class="small muted" id="hint">–ü—ñ–¥–∫–∞–∑–∫–∞: –¥–æ–¥–∞–π—Ç–µ –∫—ñ–ª—å–∫–∞ —Ç–æ—á–æ–∫ –∑ —Ä—ñ–∑–Ω–∏—Ü–µ—é —É —á–∞—Å—ñ ‚â• 1‚Äì2 —Ö–≤ –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.</p>
      </div>
      <div class="box">
        <h3>–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è / –¥—ñ—ó</h3>
        <textarea id="actions" placeholder="–û–ø–∏—Å –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, —ñ–∑–æ–ª—è—Ü—ñ—è –ø–∞—Ä—Ç—ñ—ó, –ø–æ–≤—Ç–æ—Ä–Ω–∞ –æ–±—Ä–æ–±–∫–∞/—É—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è, —ñ–Ω—Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è..."></textarea>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildDeviation()">üìù –ó–≤—ñ—Ç –ø—Ä–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</button>
          <button class="btn" onclick="copyEl('devOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="devOut" class="out">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 4. –ñ–£–†–ù–ê–õ -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É</h2>
    <div class="row">
      <button class="btn" onclick="addLog()">‚ûï –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
      <button class="btn" onclick="presetLog()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (journal)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblLog">
        <thead>
          <tr>
            <th>#</th>
            <th>–ö–¢–ö</th>
            <th class="dark">–ö—Ä–∏—Ç. –º–µ–∂—ñ</th>
            <th class="dark">–ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏</th>
            <th class="dark">–°—Ç–∞—Ç—É—Å</th>
            <th>–î—ñ—ó/–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          </tr>
        </thead>
        <tbody id="bodyLog"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 5. –ö–í–ò–¢–û–ö + NFC -->
  <div class="card">
    <h2>üßæ –ö–≤–∏—Ç–æ–∫ 58 –º–º —Ç–∞ NFC</h2>
    <div class="grid g2">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúHACCP CCP CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç/—Ç–µ—Ö–Ω.</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          <div style="flex:1"><label>–ü–∞—Ä—Ç—ñ—è/–ª–æ—Ç</label><input id="lotId" type="text" value="LOT-CCP-0001"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>
      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ –¥–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞ 58 –º–º</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>HACCP ‚Äî CCP TICKET</h4>
          <p><b>–ö–¢–ö:</b> <span id="tCCP">‚Äî</span></p>
          <p><b>–ö—Ä–∏—Ç–∏—á–Ω—ñ –º–µ–∂—ñ:</b> <span id="tCL">‚Äî</span></p>
          <div class="line"></div>
          <p><b>–ú–µ—Ç—Ä–∏–∫–∏:</b> <span id="tMetrics">‚Äî</span></p>
          <p><b>–°—Ç–∞—Ç—É—Å:</b> <span id="tStatus">‚Äî</span></p>
          <div class="line"></div>
          <p>–õ—ñ–Ω—ñ—è: <span id="tLine">‚Äî</span> ¬∑ –ó–º—ñ–Ω–∞: <span id="tShift">‚Äî</span></p>
          <p>–õ–æ—Ç: <span id="tLot">‚Äî</span></p>
          <div class="line"></div>
          <p><small id="tNote">–ó–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è ‚Äî —ñ–∑–æ–ª—è—Ü—ñ—è –ø–∞—Ä—Ç—ñ—ó —Ç–∞ –¥—ñ—ó –∑–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–æ—é HACCP.</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 6. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–û–±–µ—Ä–∏ –ö–¢–ö —Ç–∞ –∑–∞–¥–∞–π <b>–∫—Ä–∏—Ç–∏—á–Ω—ñ –º–µ–∂—ñ</b>.</li>
      <li>–ó–∞–Ω–µ—Å–∏ 6‚Äì10 —Ç–æ—á–æ–∫ <b>—á–∞—Å‚Äì—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</b> –∞–±–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä–æ–∑—á–∏–Ω—É.</li>
      <li>–ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏‚Äù, –æ—Ü—ñ–Ω—é–π <b>—Å—Ç–∞—Ç—É—Å</b>, —Å—Ñ–æ—Ä–º—É–π <b>–∑–≤—ñ—Ç –ø—Ä–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</b> (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏).</li>
      <li>–ó–∞–Ω–µ—Å–∏ –ø—ñ–¥—Å—É–º–æ–∫ —É <b>–∂—É—Ä–Ω–∞–ª</b>, —Å—Ñ–æ—Ä–º—É–π <b>NFC</b> —Ç–∞ <b>–∫–≤–∏—Ç–æ–∫</b>, –∑–±–µ—Ä–µ–∂–∏ <b>CSV</b>.</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–æ –∑–∞–¥–∞–Ω—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –º–µ–∂—ñ —Ç–∞ –¥–∞–Ω—ñ</td><td>3</td></tr>
        <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (HTST/–æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è/–¥–µ–∑—Ä–æ–∑—á–∏–Ω)</td><td>4</td></tr>
        <tr><td>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–π –∂—É—Ä–Ω–∞–ª + CSV</td><td>2</td></tr>
        <tr><td>–ö–≤–∏—Ç–æ–∫/NFC (–∞ –∑–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è ‚Äî –∑–≤—ñ—Ç)</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));

  // ==== –ü–µ—Ä–µ–º–∏–∫–∞—á –±–ª–æ–∫—ñ–≤ –∑–∞ –ö–¢–ö ====
  (function ccpSwitch(){
    const sel = byId('ccp');
    function toggle(){
      const v = sel.value;
      byId('boxPasteur').style.display = (v==='pasteur')?'block':'none';
      byId('boxCooling').style.display = (v==='cooling')?'block':'none';
      byId('boxSanit').style.display   = (v==='sanit')  ?'block':'none';
    }
    sel.addEventListener('change', toggle); toggle();
  })();

  // ==== –¢–æ—á–∫–∏ —á–∞—Å‚Äì—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ====
  const bodyPoints = byId('bodyPoints');
  function reindex(tableBody){ [...tableBody.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function addPoint(sample){
    const tr = document.createElement('tr');
    const now = new Date();
    const hhmmss = (n)=>String(n).padStart(2,'0');
    const ts = sample?.time || `${hhmmss(now.getHours())}:${hhmmss(now.getMinutes())}:${hhmmss(now.getSeconds())}`;
    const t  = (sample?.temp ?? '');
    const note = sample?.note || '';
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${ts}" placeholder="HH:MM:SS"></td>
      <td class="dark"><input type="number" step="0.1" value="${t}"></td>
      <td><input type="text" value="${note}"></td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyPoints); buildCSVpoints();">‚úñ</button></td>
    `;
    bodyPoints.appendChild(tr); reindex(bodyPoints); buildCSVpoints();
  }
  function nowPoint(){
    const val = prompt('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, ¬∞C', '72.0');
    if(val===null) return;
    addPoint({temp: Number(val) || 0});
  }
  function presetPoints(){
    clearPoints();
    const demo = [
      {time:'10:00:00', temp:68.0},
      {time:'10:00:30', temp:71.0},
      {time:'10:00:50', temp:72.3},
      {time:'10:01:10', temp:72.5},
      {time:'10:01:25', temp:72.1},
      {time:'10:01:40', temp:71.8},
      {time:'10:01:55', temp:72.4},
      {time:'10:02:10', temp:72.0},
      {time:'10:02:25', temp:71.5}
    ];
    demo.forEach(addPoint);
  }
  function clearPoints(){ bodyPoints.innerHTML=''; buildCSVpoints(); }
  function parseTime(hms){
    const m = /^(\d{2}):(\d{2}):(\d{2})$/.exec((hms||'').trim());
    if(!m) return null;
    const d = new Date(); d.setHours(+m[1],+m[2],+m[3],0); return d;
  }
  function getPoints(){
    const rows = [...bodyPoints.querySelectorAll('tr')];
    const pts = rows.map(r=>{
      const hms = r.children[1].querySelector('input').value;
      const t = Number(r.children[2].querySelector('input').value);
      return {date: parseTime(hms), T: t};
    }).filter(p=>p.date && !isNaN(p.T));
    pts.sort((a,b)=>a.date-b.date);
    return pts;
  }
  function buildCSVpoints(){
    const rows = [...bodyPoints.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const time=r.children[1].querySelector('input').value.trim();
      const t=r.children[2].querySelector('input').value.trim();
      const note=r.children[3].querySelector('input').value.trim();
      return [idx,time,t,note].join(' | ');
    });
    byId('csvPoints').textContent = rows.join('\n') || '‚Äî';
  }

  // ==== –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º–µ–∂ ====
  function evaluate(){
    const ccp = byId('ccp').value;
    if(ccp==='pasteur') return evalPasteur();
    if(ccp==='cooling') return evalCooling();
    if(ccp==='sanit')   return evalSanit();
  }

  function evalPasteur(){
    const Tcrit = +byId('p_Tcrit').value||72;
    const tHold = +byId('p_tHold').value||15;
    const pts = getPoints();
    if(pts.length<2){ setStatus('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ—á–æ–∫','‚Äî','üü† –î–æ–¥–∞–π—Ç–µ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 2 —Ç–æ—á–∫–∏'); return; }
    let secAbove = 0;
    for(let i=1;i<pts.length;i++){
      const t0=pts[i-1], t1=pts[i];
      const dt = (t1.date - t0.date)/1000; if(dt<=0) continue;
      const T0=t0.T, T1=t1.T;
      if(T0>=Tcrit && T1>=Tcrit){ secAbove += dt; }
      else if((T0>=Tcrit && T1<Tcrit) || (T0<Tcrit && T1>=Tcrit)){
        const m = (T1-T0)/dt;
        if(m!==0){
          const tCross = (Tcrit - T0)/m;
          const above = (T0>=Tcrit) ? Math.max(0, tCross) : Math.max(0, dt - tCross);
          secAbove += above;
        }
      }
    }
    const pass = secAbove >= tHold;
    const status = pass? 'üü¢ –í–ò–ö–û–ù–ê–ù–û' : 'üî¥ –ù–ï –í–ò–ö–û–ù–ê–ù–û';
    const metrics = `T‚â•${Tcrit}¬∞C: ${rnd(secAbove,0)} —Å (–º—ñ–Ω. ${tHold} —Å)`;
    setStatus(status, metrics, pass?'–ü—ñ–¥—Ç—Ä–∏–º—É–π—Ç–µ —Ä–µ–∂–∏–º':'–Ü–∑–æ–ª—é–π—Ç–µ –ø–∞—Ä—Ç—ñ—é, —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω—É –æ–±—Ä–æ–±–∫—É');
    byId('csvEval').textContent = `EVAL|CCP=pasteur|Tcrit=${Tcrit}C|tHold=${tHold}s|tAbove=${rnd(secAbove,0)}s|status=${status}`;
    return {status,metrics};
  }

  function evalCooling(){
    const pts = getPoints();
    if(pts.length<2){ setStatus('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ—á–æ–∫','‚Äî','üü† –î–æ–¥–∞–π—Ç–µ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 2 —Ç–æ—á–∫–∏'); return; }
    const w1 = (+byId('c_w1').value||2)*3600;
    const w2 = (+byId('c_w2').value||4)*3600;
    function timeToTemp(Ttarget){
      for(let i=1;i<pts.length;i++){
        const a=pts[i-1], b=pts[i];
        const T0=a.T, T1=b.T;
        if((T0>=Ttarget && T1<=Ttarget) || (T0<=Ttarget && T1>=Ttarget)){
          const dt=(b.date-a.date)/1000, dT=T1-T0;
          if(dT===0) return (b.date-pts[0].date)/1000;
          const frac=(Ttarget - T0)/dT;
          return ((a.date - pts[0].date)/1000) + frac*dt;
        }
      }
      return null;
    }
    const t21 = timeToTemp(21);
    const t05 = timeToTemp(5);
    const ok1 = (t21!==null) && (t21 <= w1);
    const ok2 = (t21!==null && t05!==null) && ((t05 - t21) <= w2);
    const status = (ok1 && ok2)? 'üü¢ –í–ò–ö–û–ù–ê–ù–û' : 'üî¥ –ù–ï –í–ò–ö–û–ù–ê–ù–û';
    const m = `60‚Üí21: ${t21?fmtHMS(t21):'‚Äî'} (‚â§ ${fmtHMS(w1)}); 21‚Üí5: ${ (t05&&t21)?fmtHMS(t05 - t21):'‚Äî'} (‚â§ ${fmtHMS(w2)})`;
    setStatus(status, m, ok1&&ok2?'–ü–∞—Ä—Ç—ñ—è –±–µ–∑–ø–µ—á–Ω–∞ –∑–∞ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è–º':'–Ü–∑–æ–ª—é–≤–∞—Ç–∏/–ø–µ—Ä–µ—Ö–æ–ª–æ–¥–∏—Ç–∏; –∞–Ω–∞–ª—ñ–∑ –ø—Ä–∏—á–∏–Ω');
    byId('csvEval').textContent = `EVAL|CCP=cooling|t21=${t21?Math.round(t21):'NA'}s|t21max=${w1}s|t05=${t05?Math.round(t05):'NA'}s|win2=${t05&&t21?Math.round(t05-t21):'NA'}s|win2max=${w2}s|status=${status}`;
    return {status,metrics:m};
  }

  function evalSanit(){
    const type = byId('s_type').value;
    const stock = +byId('s_stock').value||0;
    const target = +byId('s_target').value||100;
    const V = +byId('s_volume').value||10;
    const stock_ppm = stock*10000;
    const mL = (target*V)/ (stock_ppm/1000);
    const status = 'üü¢ –†–û–ó–†–ê–•–û–í–ê–ù–û';
    const m = `${rnd(mL,1)} –º–ª –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç—É ${type} –Ω–∞ ${V} –ª –¥–ª—è ${target} ppm (–∑–∞ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è 1%‚âà10 000 ppm –∞–∫—Ç–∏–≤—É)`;
    setStatus(status, m, '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫—É –≤–∏—Ä–æ–±–Ω–∏–∫–∞ —â–æ–¥–æ –∞–∫—Ç–∏–≤—É/–∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ —á–∞—Å—É');
    byId('csvEval').textContent = `EVAL|CCP=sanit|type=${type}|stock=${stock}%|target=${target}ppm|V=${V}L|dose=${rnd(mL,1)}mL|status=${status}`;
    return {status,metrics:m};
  }

  function setStatus(status, metrics, hint){
    byId('status').textContent = status;
    byId('metrics').textContent = metrics;
    byId('hint').textContent = hint || '';
  }
  function fmtHMS(sec){
    const s=Math.max(0,Math.round(sec)); const h=Math.floor(s/3600); const m=Math.floor((s%3600)/60); const ss=s%60;
    const pad=n=>String(n).padStart(2,'0'); return `${pad(h)}:${pad(m)}:${pad(ss)}`;
  }

  // ==== –ó–≤—ñ—Ç –ø—Ä–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è ====
  function buildDeviation(){
    const ccp = byId('ccp').value;
    const st = byId('status').textContent || '‚Äî';
    const met = byId('metrics').textContent || '‚Äî';
    const act = (byId('actions').value||'').trim() || '‚Äî';
    const dev = [
      `HACCP_DEVIATION`,
      `DATE:${new Date().toISOString().slice(0,19).replace('T',' ')}`,
      `LINE:${byId('lineId').value} SHIFT:${byId('shift').value}`,
      `CCP:${ccp} STATUS:${st}`,
      `METRICS:${met}`,
      `ACTIONS:${act}`
    ].join('\n');
    byId('devOut').textContent = dev;
  }

  // ==== –ñ—É—Ä–Ω–∞–ª ====
  const bodyLog = byId('bodyLog');
  function addLog(sample){
    const ccp = byId('ccp').value;
    const limits = (ccp==='pasteur')? `T‚â•${byId('p_Tcrit').value}¬∞C; t‚â•${byId('p_tHold').value}s` :
                    (ccp==='cooling')? `60‚Üí21 ‚â§${byId('c_w1').value}–≥–æ–¥; 21‚Üí5 ‚â§${byId('c_w2').value}–≥–æ–¥` :
                    `–î–æ–∑–∞ ${byId('s_target').value}ppm`;
    const met = byId('metrics').textContent || '‚Äî';
    const st  = byId('status').textContent || '‚Äî';
    const def = {ccp, limits, metrics:met, status:st, note:''};
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td>${s.ccp}</td>
      <td class="dark">${s.limits}</td>
      <td class="dark">${s.metrics}</td>
      <td class="dark">${s.status}</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyLog.appendChild(tr); reindex(bodyLog); buildCSVlog();
  }
  function reindex(tbody){ [...tbody.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function presetLog(){
    bodyLog.innerHTML='';
    addLog({ccp:'pasteur', limits:'T‚â•72¬∞C; t‚â•15s', metrics:'T‚â•72¬∞C: 18 —Å', status:'üü¢ –í–ò–ö–û–ù–ê–ù–û', note:'—Ä–µ–∂–∏–º —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π'});
    addLog({ccp:'cooling', limits:'60‚Üí21 ‚â§2–≥–æ–¥; 21‚Üí5 ‚â§4–≥–æ–¥', metrics:'60‚Üí21: 02:05:00; 21‚Üí5: 03:30:00', status:'üî¥ –ù–ï –í–ò–ö–û–ù–ê–ù–û', note:'–æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è –ø—ñ–¥—Å–∏–ª–∏—Ç–∏'});
    addLog({ccp:'sanit', limits:'–î–æ–∑–∞ 100ppm', metrics:'100ppm @ 10–ª ‚Üí 20.0 –º–ª 5% NaOCl', status:'üü¢ –†–û–ó–†–ê–•–û–í–ê–ù–û', note:'–∫–æ–Ω—Ç–∞–∫—Ç 5 —Ö–≤'});
    buildCSVlog();
  }
  function buildCSVlog(){
    const rows = [...bodyLog.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const ccp=r.children[1].textContent.trim();
      const lim=r.children[2].textContent.trim();
      const met=r.children[3].textContent.trim();
      const st=r.children[4].textContent.trim();
      const note=r.children[5].querySelector('input').value.trim();
      return [idx,ccp,lim,met,st,note].join(' | ');
    });
    byId('csvLog').textContent = rows.join('\n') || '‚Äî';
  }

  // ==== –ö–≤–∏—Ç–æ–∫ —Ç–∞ NFC ====
  function buildTicket(){
    const ccp = byId('ccp').value;
    const limits = (ccp==='pasteur')? `T‚â•${byId('p_Tcrit').value}¬∞C; t‚â•${byId('p_tHold').value}s` :
                    (ccp==='cooling')? `60‚Üí21 ‚â§${byId('c_w1').value}–≥–æ–¥; 21‚Üí5 ‚â§${byId('c_w2').value}–≥–æ–¥` :
                    `–î–æ–∑–∞ ${byId('s_target').value}ppm (${byId('s_type').value})`;
    byId('tCCP').textContent = ccp;
    byId('tCL').textContent = limits;
    byId('tMetrics').textContent = byId('metrics').textContent || '‚Äî';
    byId('tStatus').textContent = byId('status').textContent || '‚Äî';
    byId('tLine').textContent = byId('lineId').value || '‚Äî';
    byId('tShift').textContent = byId('shift').value || '‚Äî';
    byId('tLot').textContent = byId('lotId').value || '‚Äî';
  }
  function buildNFC(){
    const txt = [
      `HACCP_CCP_NFC`,
      `DATE:${new Date().toISOString().slice(0,19).replace('T',' ')}`,
      `LINE:${byId('lineId').value} SHIFT:${byId('shift').value} LOT:${byId('lotId').value}`,
      `CCP:${byId('ccp').value}`,
      `LIMITS:${(byId('tCL').textContent||'').replace(/\n/g,' ')}`,
      `METRICS:${byId('metrics').textContent||'‚Äî'}`,
      `STATUS:${byId('status').textContent||'‚Äî'}`,
      `CONTACT:${byId('nfcPhone').value}`
    ].join('\n');
    byId('nfcOut').textContent = txt;
  }

  // ==== CSV –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è / —É—Ç–∏–ª—ñ—Ç–∏ ====
  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // === Interaction Guard JS: –∑–Ω—ñ–º–∞—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—ñ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤–≤–æ–¥—É, —è–∫—â–æ –≤–æ–Ω–∏ –±—É–ª–∏ —ñ–Ω–∂–µ–∫—Ç–æ–≤–∞–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ–º ===
  (function unlockInteraction(){
    function enable(){
      document.querySelectorAll('button, .btn, input, select, textarea, a').forEach(el=>{
        el.disabled = false;
        el.style.pointerEvents = 'auto';
      });
      // –ø—Ä–∏–±–∏—Ä–∞—î–º–æ —Ç–∏–ø–æ–≤—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ –æ–≤–µ—Ä–ª–µ—ó
      document.querySelectorAll('[data-print-overlay], .print-overlay, .print__overlay, .overlay, [aria-hidden="true"][style*="position: fixed"]').forEach(el=>{
        if(getComputedStyle(el).position === 'fixed'){ el.parentNode && el.parentNode.removeChild(el); }
      });
    }
    enable();
    // –∫—ñ–ª—å–∫–∞ –ø–æ–≤—Ç–æ—Ä—ñ–≤ –Ω–∞ –≤–∏–ø–∞–¥–æ–∫ –ø—ñ–∑–Ω—å–æ–≥–æ —ñ–Ω–∂–µ–∫—Ç—É
    setTimeout(enable, 200);
    setTimeout(enable, 600);
    setTimeout(enable, 1200);
    // –Ω–∞ –≤—Å—è–∫–∏–π ‚Äî –ø—Ä–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—ñ —É —Ñ–æ–∫—É—Å
    window.addEventListener('focus', enable, {passive:true});
    // —ñ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥—Ä—É–∫—É –∑ –Ω–æ–≤–æ–≥–æ –≤—ñ–∫–Ω–∞ (–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥—Ç—É–¥–∞)
    window.addEventListener('message', (ev)=>{
      if(ev && ev.data && ev.data.type==='ticketPrintDone'){ enable(); }
    });
  })();
</script>

<script>
/* –î–†–£–ö –õ–ò–®–ï –ß–ï–ö–ê (58 –º–º) ‚Äî –±–µ–∑ –≤–ø–ª–∏–≤—É –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É */
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }

  try{
    var someTxt = (ticket.querySelector('span, p, h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>
  window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });
  window.addEventListener('afterprint',()=>{ try{ if(window.opener) window.opener.postMessage({type:'ticketPrintDone'},'*'); }catch(_){}})
<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  var w = window.open(url, '_blank');
  if(!w){ alert('–ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫—É—î –Ω–æ–≤—ñ –≤—ñ–∫–Ω–∞. –î–æ–∑–≤–æ–ª—å –ø–æ–ø–∞–ø–∏ –¥–ª—è —Ü—å–æ–≥–æ —Å–∞–π—Ç—É.'); }
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
