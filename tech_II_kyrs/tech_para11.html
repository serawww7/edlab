<!-- tech_para11.html
     –ü–ê–†–ê 11 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–≤ –∑ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞
     –¢–µ–º–∞: –£–ü–ê–ö–û–í–ö–ê, –ú–ê–†–ö–£–í–ê–ù–ù–Ø, –¢–ï–†–ú–Ü–ù –ü–†–ò–î–ê–¢–ù–û–°–¢–Ü ‚Äî MAP/–≤–∞–∫—É—É–º, –µ—Ç–∏–∫–µ—Ç–∫–∞ (GS1/EAN-13),
           –¥–∞—Ç–∞/–ª–æ—Ç, Q10-–æ—Ü—ñ–Ω–∫–∞ —Ç–µ—Ä–º—ñ–Ω—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ö–æ–ª–æ–¥–æ–≤–æ–≥–æ –ª–æ–≥—É, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—ñ,
           –ø–ª–∞–Ω –ø–∞–ª–µ—Ç—É–≤–∞–Ω–Ω—è, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC/QR, CSV.
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏; (–æ–ø—Ü.) —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º 58–º–º; NFC-–º—ñ—Ç–∫–∏.

     –ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
     –£–í–ê–ì–ê: –Ω–∞–≤—á–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å. –†–µ–∞–ª—å–Ω—ñ –≤–∏–º–æ–≥–∏ –µ—Ç–∏–∫–µ—Ç—É–≤–∞–Ω–Ω—è —ñ —Ç–µ—Ä–º—ñ–Ω—ñ–≤ ‚Äî –∑–∞ —á–∏–Ω–Ω–∏–º –∑–∞–∫–æ–Ω–æ–¥–∞–≤—Å—Ç–≤–æ–º —Ç–∞ –°–û–ü –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞.
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 11 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –ü–∞–∫—É–≤–∞–Ω–Ω—è/–ú–∞—Ä–∫—É–≤–∞–Ω–Ω—è: MAP, EAN-13, —Ç–µ—Ä–º—ñ–Ω, —Ö–æ–ª–æ–¥–æ–≤–∏–π –ª–∞–Ω—Ü—é–≥, –∫–≤–∏—Ç–æ–∫/NFC/CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,Monaco,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  textarea{min-height:84px}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ –≤ Moodle (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
  .graph{font:12px/14px ui-monospace,monospace;white-space:pre;background:#fff;color:#000;padding:8px;border-radius:8px;border:1px solid #e5e7eb;overflow:auto}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

<meta name="description" content="–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –ø—ñ–¥–±–µ—Ä—É—Ç—å —Ä–µ–∂–∏–º –ø–∞–∫—É–≤–∞–Ω–Ω—è (MAP/–≤–∞–∫—É—É–º), (2) —Å—Ñ–æ—Ä–º—É—é—Ç—å –µ—Ç–∏–∫–µ—Ç–∫—É –∑ EAN-13, –¥–∞—Ç–æ—é/–ª–æ—Ç–æ–º —Ç–∞ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–º–∏ –ø–æ–ª—è–º–∏, (3) –∑–±–µ—Ä—É—Ç—å —Ö–æ–ª–æ–¥–æ–≤–∏"><link rel="canonical" href="https://edlab.pp.ua/tech_II_kyrs/tech_para11.html"><meta property="og:type" content="article"><meta property="og:title" content="üì¶ –ü–∞–∫—É–≤–∞–Ω–Ω—è/–ú–∞—Ä–∫—É–≤–∞–Ω–Ω—è: MAP/–≤–∞–∫—É—É–º, –µ—Ç–∏–∫–µ—Ç–∫–∞ EAN-13, —Ç–µ—Ä–º—ñ–Ω, —Ö–æ–ª–æ–¥–æ–≤–∏–π –ª–∞–Ω—Ü—é–≥, –∫–≤–∏—Ç–æ–∫/NFC/CSV"><meta property="og:description" content="–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –ø—ñ–¥–±–µ—Ä—É—Ç—å —Ä–µ–∂–∏–º –ø–∞–∫—É–≤–∞–Ω–Ω—è (MAP/–≤–∞–∫—É—É–º), (2) —Å—Ñ–æ—Ä–º—É—é—Ç—å –µ—Ç–∏–∫–µ—Ç–∫—É –∑ EAN-13, –¥–∞—Ç–æ—é/–ª–æ—Ç–æ–º —Ç–∞ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–º–∏ –ø–æ–ª—è–º–∏, (3) –∑–±–µ—Ä—É—Ç—å —Ö–æ–ª–æ–¥–æ–≤–∏"><meta property="og:url" content="https://edlab.pp.ua/tech_II_kyrs/tech_para11.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üì¶ –ü–∞–∫—É–≤–∞–Ω–Ω—è/–ú–∞—Ä–∫—É–≤–∞–Ω–Ω—è: MAP/–≤–∞–∫—É—É–º, –µ—Ç–∏–∫–µ—Ç–∫–∞ EAN-13, —Ç–µ—Ä–º—ñ–Ω, —Ö–æ–ª–æ–¥–æ–≤–∏–π –ª–∞–Ω—Ü—é–≥, –∫–≤–∏—Ç–æ–∫/NFC/CSV","description":"–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –ø—ñ–¥–±–µ—Ä—É—Ç—å —Ä–µ–∂–∏–º –ø–∞–∫—É–≤–∞–Ω–Ω—è (MAP/–≤–∞–∫—É—É–º), (2) —Å—Ñ–æ—Ä–º—É—é—Ç—å –µ—Ç–∏–∫–µ—Ç–∫—É –∑ EAN-13, –¥–∞—Ç–æ—é/–ª–æ—Ç–æ–º —Ç–∞ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–º–∏ –ø–æ–ª—è–º–∏, (3) –∑–±–µ—Ä—É—Ç—å —Ö–æ–ª–æ–¥–æ–≤–∏","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/tech_II_kyrs/tech_para11.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 11 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –ø–µ—Ä–µ—Ä–æ–±–∫–∏</span>
  <h1>üì¶ –ü–∞–∫—É–≤–∞–Ω–Ω—è/–ú–∞—Ä–∫—É–≤–∞–Ω–Ω—è: MAP/–≤–∞–∫—É—É–º, –µ—Ç–∏–∫–µ—Ç–∫–∞ EAN-13, —Ç–µ—Ä–º—ñ–Ω, —Ö–æ–ª–æ–¥–æ–≤–∏–π –ª–∞–Ω—Ü—é–≥, –∫–≤–∏—Ç–æ–∫/NFC/CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –ø–∞—Ä–∏</h2>
    <p>
      –ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –ø—ñ–¥–±–µ—Ä—É—Ç—å <b>—Ä–µ–∂–∏–º –ø–∞–∫—É–≤–∞–Ω–Ω—è</b> (MAP/–≤–∞–∫—É—É–º), (2) —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>–µ—Ç–∏–∫–µ—Ç–∫—É</b> –∑ EAN-13,
      –¥–∞—Ç–æ—é/–ª–æ—Ç–æ–º —Ç–∞ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–º–∏ –ø–æ–ª—è–º–∏, (3) –∑–±–µ—Ä—É—Ç—å <b>—Ö–æ–ª–æ–¥–æ–≤–∏–π –ª–æ–≥</b> —ñ –æ—Ü—ñ–Ω—è—Ç—å <b>—Ç–µ—Ä–º—ñ–Ω –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ</b> –∑–∞ Q10-–º–æ–¥–µ–ª–ª—é,
      (4) –≤–∏–∫–æ–Ω–∞—é—Ç—å <b>–ø–µ—Ä–µ–≤—ñ—Ä–∫—É –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—ñ</b>, (5) –ø–æ–±—É–¥—É—é—Ç—å <b>–ø–ª–∞–Ω –ø–∞–ª–µ—Ç—É–≤–∞–Ω–Ω—è</b>, (6) –æ—Ñ–æ—Ä–º–ª—è—Ç—å <b>CSV</b>, <b>QR/NFC</b> —ñ <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>.
    </p>
    <p class="small muted">–ù–∞–≤—á–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å. –†–µ–∞–ª—å–Ω—ñ –µ—Ç–∏–∫–µ—Ç–∫–∏ –ø–æ–≥–æ–¥–∂—É—é—Ç—å—Å—è –∑ QA/–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–º —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –∑–∞–∫–æ–Ω–æ–¥–∞–≤—Å—Ç–≤—É.</p>
  </div>

  <!-- 1. –ü–ê–†–ê–ú–ï–¢–†–ò –ü–ê–ö–£–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>üõ†Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–∞–∫—É–≤–∞–Ω–Ω—è</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏—Ä—ñ–±/–ª–æ—Ç</h3>
        <div class="row">
          <div style="flex:1"><label>–í–∏—Ä—ñ–±</label><input id="prodName" type="text" value="–®–∏–Ω–∫–∞ –≤–∞—Ä–µ–Ω–∞ ‚Äú–î–æ–º–∞—à–Ω—è‚Äù"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–õ–û–¢</label><input id="lot" type="text" value="H-25101-A1"></div>
          <div style="flex:1"><label>–ú–∞—Å–∞ –Ω–µ—Ç—Ç–æ, –≥</label><input id="netto" type="number" step="1" value="400"></div>
        </div>
      </div>

      <div class="box">
        <h3>–†–µ–∂–∏–º</h3>
        <div class="row">
          <div style="flex:1"><label>–¢–∏–ø</label>
            <select id="pkType">
              <option selected="">–í–∞–∫—É—É–º</option>
              <option>MAP</option>
            </select>
          </div>
          <div style="flex:1"><label>–í–∞–∫—É—É–º, –∫–ü–∞ (–º—ñ–Ω.)</label><input id="vacReq" type="number" step="0.1" value="30.0"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>MAP O‚ÇÇ, %</label><input id="o2" type="number" step="0.1" value="2.0"></div>
          <div style="flex:1"><label>MAP CO‚ÇÇ, %</label><input id="co2" type="number" step="0.1" value="30.0"></div>
        </div>
      </div>

      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="evalPack()">‚úÖ –û—Ü—ñ–Ω–∏—Ç–∏ —Ä–µ–∂–∏–º</button>
          <button class="btn" onclick="copyCSV('csvPack')">üìã CSV (pack)</button>
        </div>
        <div id="packOut" class="out" style="margin-top:8px">‚Äî</div>
        <div id="csvPack" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 2. –ï–¢–ò–ö–ï–¢–ö–ê / EAN-13 -->
  <div class="card">
    <h2>üè∑Ô∏è –ï—Ç–∏–∫–µ—Ç–∫–∞: –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è, EAN-13, –¥–∞—Ç–∞/–ª–æ—Ç</h2>
    <div class="grid g2">
      <div class="box">
        <h3>–ü–æ–ª—è –µ—Ç–∏–∫–µ—Ç–∫–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É</label><input id="lblName" type="text" value="–®–∏–Ω–∫–∞ –≤–∞—Ä–µ–Ω–∞ ‚Äú–î–æ–º–∞—à–Ω—è‚Äù"></div>
          <div style="flex:1"><label>–í–∏—Ä–æ–±–Ω–∏–∫</label><input id="lblMfg" type="text" value="–¢–û–í ¬´–•–∞—Ä—á—ñ-–ï–∫—Å–ø–µ—Ä—Ç¬ª"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–°–∫–ª–∞–¥ (—Å–∫–æ—Ä–æ—á–µ–Ω–æ)</label><input id="lblComp" type="text" value="–°–≤–∏–Ω–∏–Ω–∞, —Å—ñ–ª—å, —Å–ø–µ—Ü—ñ—ó, –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç, —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ç–æ—Ä–∏ (–ï451, –ï407)."></div>
          <div style="flex:1"><label>–ê–ª–µ—Ä–≥–µ–Ω–∏</label><input id="lblAll" type="text" value="‚Äî"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–£–º–æ–≤–∏ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è</label><input id="lblStg" type="text" value="+0‚Ä¶+6¬∞C"></div>
          <div style="flex:1"><label>–ï–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∞ —Ü—ñ–Ω–Ω—ñ—Å—Ç—å (–∫–∫–∞–ª/100–≥)</label><input id="lblKcal" type="number" step="1" value="220"></div>
        </div>
      </div>

      <div class="box">
        <h3>EAN-13 —Ç–∞ –¥–∞—Ç–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–ü—Ä–µ—Ñ—ñ–∫—Å EAN-12</label><input id="ean12" type="text" value="482123456789"></div>
          <div style="flex:1"><label>EAN-13 (–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞)</label><input id="ean13" type="text" value=""></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–î–∞—Ç–∞ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞</label><input id="mfgDate" type="date"></div>
          <div style="flex:1"><label>–í–∂–∏—Ç–∏ –¥–æ (—Ä–æ–∑—Ä–∞—Ö.)</label><input id="expDate" type="date"></div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" onclick="makeEAN()">üìê –û–±—á–∏—Å–ª–∏—Ç–∏ EAN-13</button>
          <button class="btn" onclick="buildLabel()">üß© –ó—ñ–±—Ä–∞—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫—É</button>
          <button class="btn" onclick="copyCSV('csvLabel')">üìã CSV (label)</button>
        </div>
        <div id="labelOut" class="out" style="margin-top:8px">‚Äî</div>
        <div id="csvLabel" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 3. –•–û–õ–û–î–û–í–ò–ô –õ–ê–ù–¶–Æ–ì + Q10-–¢–ï–†–ú–Ü–ù -->
  <div class="card">
    <h2>‚ùÑÔ∏è –•–æ–ª–æ–¥–æ–≤–∏–π –ª–æ–≥ —ñ Q10-–æ—Ü—ñ–Ω–∫–∞ —Ç–µ—Ä–º—ñ–Ω—É</h2>
    <div class="row">
      <button class="btn" onclick="addTemp()">‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å T‚Äìt</button>
      <button class="btn" onclick="presetTemp()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="calcShelf()">üßÆ –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ç–µ—Ä–º—ñ–Ω</button>
      <button class="btn" onclick="copyCSV('csvTemp')">üìã CSV (cold chain)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblTemp">
        <thead>
          <tr>
            <th>#</th>
            <th>–°—Ç–∞–¥—ñ—è</th>
            <th class="dark">T, ¬∞C</th>
            <th class="dark">–ß–∞—Å, –≥–æ–¥</th>
            <th>–ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç –ø—Ä–∏ 4¬∞C, –≥–æ–¥</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyTemp"></tbody>
      </table>
    </div>
    <div id="shelfOut" class="out" style="margin-top:8px">‚Äî</div>
    <div id="csvTemp" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 4. –ì–ï–†–ú–ï–¢–ò–ß–ù–Ü–°–¢–¨ / –í–ê–ö–£–£–ú / –ü–†–û–¢–Ü–ö–ê–ù–ù–Ø -->
  <div class="card">
    <h2>üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—ñ</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–µ—Å—Ç—É</h3>
        <div class="row">
          <div style="flex:1"><label>–í–∞–∫—É—É–º, –∫–ü–∞ (—Ñ–∞–∫—Ç)</label><input id="vacFact" type="number" step="0.1" value="31.0"></div>
          <div style="flex:1"><label>–¢–µ—Å—Ç ‚Äú–≤–∞–Ω–Ω–∞/–±—É–ª—å–±–∞—à–∫–∏‚Äù</label>
            <select id="leak"><option>–ù—ñ</option><option>–¢–∞–∫</option></select>
          </div>
        </div>
        <p class="small muted">–Ø–∫—â–æ MAP ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–∏–π O‚ÇÇ (—Ñ–∞–∫—Ç) ‚â§ —Ü—ñ–ª—ñ.</p>
      </div>

      <div class="box">
        <h3>–û—Ü—ñ–Ω–∫–∞</h3>
        <p>–°—Ç–∞—Ç—É—Å: <b><span id="sealStatus">‚Äî</span></b></p>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="evalSeal()">‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvSeal')">üìã CSV (seal)</button>
        </div>
        <div id="csvSeal" class="out" style="margin-top:8px">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ü–ª–∞–Ω –ø–∞–ª–µ—Ç—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <div style="flex:1"><label>–£–ø–∞–∫./—è—â–∏–∫</label><input id="perCase" type="number" step="1" value="24"></div>
          <div style="flex:1"><label>–Ø—â–∏–∫—ñ–≤/–ø–∞–ª–µ—Ç–∞</label><input id="perPallet" type="number" step="1" value="48"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ü–ª–∞–Ω –ø–∞—Ä—Ç—ñ—ó, —É–ø–∞–∫.</label><input id="planPacks" type="number" step="1" value="1200"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="planPallets()">üì¶ –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvPal')">üìã CSV (pallets)</button>
        </div>
        <div id="palOut" class="out" style="margin-top:8px">‚Äî</div>
        <div id="csvPal" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 5. –ñ–£–†–ù–ê–õ / –ö–í–ò–¢–û–ö / QR / NFC -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª / –ö–≤–∏—Ç–æ–∫ 58 –º–º / QR / NFC</h2>
    <div class="row">
      <button class="btn" onclick="addLog()">‚ûï –î–æ–¥–∞—Ç–∏ —É –∂—É—Ä–Ω–∞–ª</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (journal)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblLog">
        <thead>
          <tr>
            <th>#</th>
            <th>–í–∏—Ä—ñ–±/–ª–æ—Ç</th>
            <th class="dark">–†–µ–∂–∏–º</th>
            <th class="dark">EAN-13</th>
            <th>EXP</th>
            <th>–•–æ–ª–æ–¥. —ñ–Ω–¥–µ–∫—Å</th>
            <th>–ì–µ—Ä–º–µ—Ç.</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyLog"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>

    <div class="grid g2" style="margin-top:12px">
      <div class="box">
        <h3>QR-payload</h3>
        <div class="row">
          <button class="btn" onclick="buildQR()">üß© –ó—ñ–±—Ä–∞—Ç–∏ QR</button>
          <button class="btn" onclick="copyEl('qrOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="qrOut" class="out">‚Äî</div>

        <h3 style="margin-top:12px">NFC ‚Äî ‚ÄúPACK LABEL CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          <div style="flex:1"><label>–û–ø–µ—Ä–∞—Ç–æ—Ä</label><input id="nfcOper" type="text" value="–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ 58 –º–º ‚Äî ‚ÄúPACK &amp; LABEL‚Äù</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>PACK &amp; LABEL</h4>
          <p><b>–í–∏—Ä—ñ–±:</b> <span id="tProd">‚Äî</span></p>
          <p><b>–õ–û–¢:</b> <span id="tLot">‚Äî</span> ¬∑ <b>EAN-13:</b> <span id="tEAN">‚Äî</span></p>
          <div class="line"></div>
          <p><b>–†–µ–∂–∏–º:</b> <span id="tMode">‚Äî</span></p>
          <p><b>–í–∂–∏—Ç–∏ –¥–æ:</b> <span id="tEXP">‚Äî</span></p>
          <p><b>–Ü–Ω–¥–µ–∫—Å —Ö–æ–ª–æ–¥—É:</b> <span id="tCHI">‚Äî</span></p>
          <div class="line"></div>
          <p><small>–ï—Ç–∏–∫–µ—Ç–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞–≤—á–∞–ª—å–Ω–∏–º –≤–∏–º–æ–≥–∞–º. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑—Ä–∞–∑–æ–∫ QA/—é—Ä–∏—Å—Ç–æ–º.</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 6. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–ó–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–∞–∫—É–≤–∞–Ω–Ω—è, –æ—Ü—ñ–Ω—ñ—Ç—å —Ä–µ–∂–∏–º (–≤–∞–∫—É—É–º/MAP).</li>
      <li>–°—Ñ–æ—Ä–º—É–π—Ç–µ –µ—Ç–∏–∫–µ—Ç–∫—É –∑ EAN-13 —Ç–∞ –¥–∞—Ç–∞–º–∏; –∑–±–µ—Ä–µ–∂—ñ—Ç—å CSV.</li>
      <li>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ö–æ–ª–æ–¥–æ–≤–∏–π –ª–æ–≥ (3‚Äì6 –∑–∞–ø–∏—Å—ñ–≤), —Ä–æ–∑—Ä–∞—Ö—É–π—Ç–µ –µ–∫—Å–ø–æ–∑–∏—Ü—ñ—é —Ç–∞ –µ–∫—Å–ø. —Ç–µ—Ä–º—ñ–Ω.</li>
      <li>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å —Ç–∞ —Å–ø–ª–∞–Ω—É–π—Ç–µ –ø–∞–ª–µ—Ç—É–≤–∞–Ω–Ω—è.</li>
      <li>–ó–∞–Ω–µ—Å—ñ—Ç—å —É –∂—É—Ä–Ω–∞–ª, –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ QR/NFC —ñ –∫–≤–∏—Ç–æ–∫, —Å–∫–æ–ø—ñ—é–π—Ç–µ CSV.</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–∏–π —Ä–µ–∂–∏–º –ø–∞–∫—É–≤–∞–Ω–Ω—è (–≤–∞–∫—É—É–º/MAP) —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</td><td>3</td></tr>
        <tr><td>–ï—Ç–∏–∫–µ—Ç–∫–∞ –∑ EAN-13, –¥–∞—Ç–∞–º–∏ —Ç–∞ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–º–∏ –ø–æ–ª—è–º–∏</td><td>3</td></tr>
        <tr><td>–•–æ–ª–æ–¥–æ–≤–∏–π –ª–æ–≥ + Q10-–æ—Ü—ñ–Ω–∫–∞ —Ç–µ—Ä–º—ñ–Ω—É</td><td>3</td></tr>
        <tr><td>–ì–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å/–ø–∞–ª–µ—Ç—É–≤–∞–Ω–Ω—è/–∂—É—Ä–Ω–∞–ª/–∫–≤–∏—Ç–æ–∫/CSV</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  const pad2 = n => String(n).padStart(2,'0');

  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t);
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t);
  }

  // ===== 1) –û—Ü—ñ–Ω–∫–∞ –ø–∞–∫—É–≤–∞–Ω–Ω—è =====
  function evalPack(){
    const type = byId('pkType').value;
    const vacReq = +byId('vacReq').value||0;
    const o2 = +byId('o2').value||0;
    const co2= +byId('co2').value||0;
    let status='‚Äî', note='';
    if(type==='–í–∞–∫—É—É–º'){
      status = (vacReq>=30)? 'üü¢ –í–∞–∫—É—É–º –¥–æ—Å—Ç–∞—Ç–Ω—ñ–π' : 'üü† –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—Å–æ—Å–∏/–ø–ª—ñ–≤–∫—É';
      note = `–ú—ñ–Ω. –≤–∞–∫—É—É–º ${vacReq} –∫–ü–∞; –∫–æ–Ω—Ç—Ä–æ–ª—å –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Ç—ñ–∫–∞–Ω—å.`;
    }else{
      const okMix = (o2<=3 && co2>=20 && co2<=40);
      status = okMix? 'üü¢ MAP —Å—É–º—ñ—à —É –º–µ–∂–∞—Ö' : 'üü† –£—Ç–æ—á–Ω—ñ—Ç—å —Å—É–º—ñ—à (–º º—è—Å–Ω—ñ –≤–∞—Ä–µ–Ω—ñ: O‚ÇÇ‚â§3%, CO‚ÇÇ‚âà20‚Äì40%)';
      note = `–ó–∞–¥–∞–Ω–æ O‚ÇÇ=${o2}%, CO‚ÇÇ=${co2}%.`;
    }
    byId('packOut').textContent = `PACK|type=${type}|status=${status}|note=${note}|netto=${byId('netto').value}g|lot=${byId('lot').value}`;
    byId('csvPack').textContent = byId('packOut').textContent;
    updateTicket();
    return status.includes('üü¢');
  }

  // ===== 2) EAN-13, –µ—Ç–∏–∫–µ—Ç–∫–∞ =====
  function eanChecksum12(e12){
    const d = e12.replace(/\D/g,'').slice(0,12).padStart(12,'0').split('').map(Number);
    const sum = d.reduce((a,x,i)=> a + x*(i%2?3:1), 0);
    const mod = sum%10;
    return (10-mod)%10;
  }
  function makeEAN(){
    const e12 = byId('ean12').value;
    const cs = eanChecksum12(e12);
    const e13 = (e12.replace(/\D/g,'').slice(0,12).padStart(12,'0')) + String(cs);
    byId('ean13').value = e13;
    updateTicket();
    return e13;
  }
  function buildLabel(){
    const name=byId('lblName').value;
    const mfg =byId('lblMfg').value;
    const comp=byId('lblComp').value;
    const all =byId('lblAll').value;
    const stg =byId('lblStg').value;
    const kcal=byId('lblKcal').value;
    const e13 =byId('ean13').value||makeEAN();
    const mfgD=byId('mfgDate').value;
    const expD=byId('expDate').value;
    const txt = [
      `NAME:${name}`,
      `MFG:${mfg}`,
      `COMP:${comp}`,
      `ALLERGENS:${all}`,
      `STORAGE:${stg}`,
      `NETTO:${byId('netto').value}g`,
      `EAN13:${e13}`,
      `MFG_DATE:${mfgD}`,
      `EXP_DATE:${expD}`,
      `LOT:${byId('lot').value}`,
      `NUTR: ${kcal} –∫–∫–∞–ª/100–≥`
    ].join(' | ');
    byId('labelOut').textContent = txt;
    byId('csvLabel').textContent = 'LABEL|' + txt;
    updateTicket();
    return txt;
  }

  // ===== 3) –•–æ–ª–æ–¥–æ–≤–∏–π –ª–æ–≥ + Q10 =====
  const bodyTemp = byId('bodyTemp');
  function reindex(tb){ [...tb.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function addTemp(sample){
    const s = Object.assign({stage:'–°–∫–ª–∞–¥', T:4, h:12}, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.stage}"></td>
      <td class="dark"><input type="number" step="0.1" value="${s.T}"></td>
      <td class="dark"><input type="number" step="0.1" value="${s.h}"></td>
      <td class="chi">‚Äî</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyTemp); calcShelf();">‚úñ</button></td>
    `;
    bodyTemp.appendChild(tr); reindex(bodyTemp); calcShelf();
  }
  function presetTemp(){
    bodyTemp.innerHTML='';
    addTemp({stage:'–û—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è', T:2, h:6});
    addTemp({stage:'–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è',  T:4, h:48});
    addTemp({stage:'–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', T:6, h:8});
    addTemp({stage:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', T:8, h:5});
    calcShelf();
  }
  // Q10 –º–æ–¥–µ–ª—å: —à–≤–∏–¥–∫—ñ—Å—Ç—å –ø—Å—É–≤–∞–Ω–Ω—è –∑—Ä–æ—Å—Ç–∞—î –≤ Q10 —Ä–∞–∑—ñ–≤ –Ω–∞ +10¬∞C; –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω—ñ –≥–æ–¥–∏–Ω–∏ –ø—Ä–∏ 4¬∞C:
  // eq_h = h * Q10^((T - 4)/10). –í—ñ–∑—å–º–µ–º–æ Q10=2.5 (—Ç–∏–ø–æ–≤–æ –¥–ª—è –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–æ—ó –≤–∞—Ä–µ–Ω–æ—ó –º º—è—Å–æ–ø—Ä–æ–¥—É–∫—Ü—ñ—ó)
  function calcShelf(){
    const Q10 = 2.5, Tref=4;
    let eqSum=0, lines=[];
    [...bodyTemp.querySelectorAll('tr')].forEach(r=>{
      const T=Number(r.children[2].querySelector('input').value);
      const h=Number(r.children[3].querySelector('input').value);
      if(!isNaN(T)&&!isNaN(h)){
        const eq = h * Math.pow(Q10, (T - Tref)/10);
        r.querySelector('.chi').textContent = rnd(eq,2);
        eqSum += eq;
        lines.push(`${r.querySelector('.idx').textContent.trim()}:${T}¬∞C√ó${h}h‚Üí${rnd(eq,2)}h@4¬∞C`);
      }
    });
    // –ë–∞–∑–æ–≤–∏–π —Ç–µ—Ä–º—ñ–Ω –ø—Ä–∏ 4¬∞C (–Ω–∞–≤—á–∞–ª—å–Ω–æ): 20 –¥—ñ–± –¥–ª—è –≤–∞—Ä–µ–Ω–æ—ó —à–∏–Ω–∫–∞ —É –≤–∞–∫—É—É–º—ñ
    const baseDays = 20;
    const usedDays = eqSum/24;
    const leftDays = Math.max(0, baseDays - usedDays);
    const today = new Date(byId('mfgDate').value || new Date().toISOString().slice(0,10));
    const expDate = new Date(today.getTime() + leftDays*24*3600*1000);
    const expStr = expDate.toISOString().slice(0,10);
    byId('shelfOut').textContent = `Q10=2.5; –ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç @4¬∞C = ${rnd(eqSum,2)} –≥–æ–¥ (~${rnd(usedDays,2)} –¥—ñ–±); –ó–∞–ª–∏—à–æ–∫ ‚âà ${rnd(leftDays,2)} –¥—ñ–±; EXP‚âà ${expStr}`;
    byId('csvTemp').textContent = lines.join('\n') || '‚Äî';
    if(!byId('expDate').value){ byId('expDate').value = expStr; }
    updateTicket();
    return {eqSum, usedDays, leftDays, expStr};
  }

  // ===== 4) –ì–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å / –ü–∞–ª–µ—Ç–∏ =====
  function evalSeal(){
    const type = byId('pkType').value;
    const vacReq= +byId('vacReq').value||0;
    const vac= +byId('vacFact').value||0;
    const leak = byId('leak').value==='–¢–∞–∫';
    let pass = true; let msg=[];
    if(type==='–í–∞–∫—É—É–º'){ pass = pass && (vac>=vacReq); msg.push(`Vac ${vac}‚â•${vacReq}`); }
    if(leak){ pass = false; msg.push('Leak=yes'); }
    const status = pass? 'üü¢ PASS' : 'üî¥ FAIL';
    byId('sealStatus').textContent = status;
    byId('csvSeal').textContent = `SEAL|type=${type}|vac_req=${vacReq}|vac_fact=${vac}|leak=${leak?'yes':'no'}|status=${status}`;
    updateTicket();
    return pass;
  }

  function planPallets(){
    const perCase=+byId('perCase').value||1;
    const perPal =+byId('perPallet').value||1;
    const plan   =+byId('planPacks').value||0;
    const cases = Math.ceil(plan/perCase);
    const pallets = Math.ceil(cases/perPal);
    const lastCase = plan%perCase || perCase;
    const lastPalCases = cases%perPal || perPal;
    const txt = `–ü–ª–∞–Ω: ${plan} —É–ø–∞–∫. ‚Üí ${cases} —è—â. ‚Üí ${pallets} –ø–∞–ª–µ—Ç(–∏); –æ—Å—Ç–∞–Ω–Ω—ñ–π —è—â–∏–∫: ${lastCase} —É–ø–∞–∫.; –æ—Å—Ç–∞–Ω–Ω—è –ø–∞–ª–µ—Ç–∞: ${lastPalCases} —è—â.`;
    byId('palOut').textContent = txt;
    byId('csvPal').textContent = `PALLET|packs=${plan}|per_case=${perCase}|per_pallet=${perPal}|cases=${cases}|pallets=${pallets}|last_case=${lastCase}|last_pal_cases=${lastPalCases}`;
    return {cases,pallets,lastCase,lastPalCases};
  }

  // ===== 5) –ñ—É—Ä–Ω–∞–ª / –ö–≤–∏—Ç–æ–∫ / QR / NFC =====
  const bodyLog = byId('bodyLog');
  function reindexLog(){ [...bodyLog.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function addLog(){
    const mode = byId('pkType').value==='–í–∞–∫—É—É–º' ? `VAC ${byId('vacReq').value}kPa` : `MAP O‚ÇÇ${byId('o2').value}%/CO‚ÇÇ${byId('co2').value}%`;
    const chi = byId('shelfOut').textContent.split('–ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç')[1]? byId('shelfOut').textContent.split('–ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç')[1].trim() : '‚Äî';
    const seal= byId('sealStatus').textContent || '‚Äî';
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${byId('prodName').value} [${byId('lot').value}]"></td>
      <td class="dark">${mode}</td>
      <td class="dark">${byId('ean13').value}</td>
      <td>${byId('expDate').value||'‚Äî'}</td>
      <td>${chi.replace(/\s+/g,' ')}</td>
      <td>${seal}</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindexLog(); buildLogCSV();">‚úñ</button></td>
    `;
    bodyLog.appendChild(tr); reindexLog(); buildLogCSV();
    updateTicket();
  }
  function buildLogCSV(){
    const rows=[...bodyLog.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const prod=r.children[1].querySelector('input').value.trim();
      const mode=r.children[2].textContent.trim();
      const ean=r.children[3].textContent.trim();
      const exp=r.children[4].textContent.trim();
      const chi=r.children[5].textContent.trim();
      const seal=r.children[6].textContent.trim();
      return [idx,prod,mode,ean,exp,chi,seal].join(' | ');
    });
    byId('csvLog').textContent = rows.join('\n') || '‚Äî';
  }
  function updateTicket(){
    byId('tProd').textContent = byId('prodName').value;
    byId('tLot').textContent  = byId('lot').value;
    byId('tEAN').textContent  = byId('ean13').value || makeEAN();
    byId('tMode').textContent = (byId('pkType').value==='–í–∞–∫—É—É–º' ? `–í–∞–∫—É—É–º ‚â•${byId('vacReq').value} –∫–ü–∞` : `MAP O‚ÇÇ${byId('o2').value}%/CO‚ÇÇ${byId('co2').value}%`);
    byId('tEXP').textContent  = byId('expDate').value || '‚Äî';
    const chiTxt = byId('shelfOut').textContent || '‚Äî';
    const m = chiTxt.match(/~([0-9.]+) –¥—ñ–±/);
    byId('tCHI').textContent = m? (m[1]+' –¥—ñ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ') : '‚Äî';
  }
  function buildQR(){
    const payload = {
      prod: byId('prodName').value,
      lot: byId('lot').value,
      ean13: byId('ean13').value || makeEAN(),
      mode: byId('pkType').value==='–í–∞–∫—É—É–º' ? `VAC ${byId('vacReq').value}kPa` : `MAP O2 ${byId('o2').value}% CO2 ${byId('co2').value}%`,
      mfg: byId('mfgDate').value,
      exp: byId('expDate').value
    };
    byId('qrOut').textContent = JSON.stringify(payload);
  }
  function buildNFC(){
    const txt = [
      `PACK_LABEL_NFC`,
      `PROD:${byId('prodName').value} LOT:${byId('lot').value}`,
      `EAN13:${byId('ean13').value || makeEAN()}`,
      `MODE:${byId('pkType').value==='–í–∞–∫—É—É–º' ? ('VAC '+byId('vacReq').value+'kPa') : ('MAP O2 '+byId('o2').value+'% CO2 '+byId('co2').value+'%')}`,
      `MFG:${byId('mfgDate').value} EXP:${byId('expDate').value}`,
      `OPER:${byId('nfcOper').value} CONTACT:${byId('nfcPhone').value}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = txt;
  }
  function buildTicket(){
    window.scrollTo({top: document.getElementById('ticket').getBoundingClientRect().top + window.scrollY - 60, behavior:'smooth'});
  }

  // ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
  (function init(){
    const today = new Date().toISOString().slice(0,10);
    byId('mfgDate').value = today;
    evalPack(); makeEAN(); buildLabel(); presetTemp(); evalSeal(); planPallets();
    document.addEventListener('change', e=>{
      if(e.target.matches('input,select,textarea')){
        if(e.target.closest('#tblTemp')) calcShelf();
        if(['pkType','vacReq','o2','co2','netto','lot'].includes(e.target.id)) evalPack();
        if(['lblName','lblMfg','lblComp','lblAll','lblStg','lblKcal','mfgDate','expDate','ean12','ean13'].includes(e.target.id)) buildLabel();
        if(['vacFact','leak'].includes(e.target.id)) evalSeal();
        if(['perCase','perPallet','planPacks'].includes(e.target.id)) planPallets();
      }
    });
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>



</body></html>