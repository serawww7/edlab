<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 16 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –ü–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è: —Ç–µ–ø–ª–æ–≥—Ä–∞–º–∞ ‚Üí –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ–π–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ (PU) ‚Üí CCP ‚Üí —á–µ–∫ 58 –º–º/QR/CSV</title>
<meta name="description" content="–ï–º—É–ª—è—Ç–æ—Ä –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó –º–æ–ª–æ–∫–∞/—Å–æ–∫—É/—è—î—á–Ω–æ—ó –º–∞—Å–∏: –Ω–∞–≥—Ä—ñ–≤‚Äì–≤–∏—Ç—Ä–∏–º–∫–∞‚Äì–æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è. –û–±—á–∏—Å–ª–µ–Ω–Ω—è PU = ‚à´10^((T‚àíTref)/z)dt, –∫–æ–Ω—Ç—Ä–æ–ª—å CCP, –≥—Ä–∞—Ñ—ñ–∫, –∂—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥, —á–µ–∫ 58 –º–º, QR, –µ–∫—Å–ø–æ—Ä—Ç CSV/TXT.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1180px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:100px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
small.mono,.mono{font-family:ui-monospace,monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.2fr 1fr}
@media(max-width:1100px){.grid{grid-template-columns:1fr}}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:300px}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
</style>
<link rel="canonical" href="https://edlab.pp.ua/tech_II_kyrs/tech_para16.html"><meta property="og:type" content="article"><meta property="og:title" content="–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞ ‚Äî –ü–∞—Ä–∞ 16"><meta property="og:description" content="–ú–µ—Ç–∞: –∑–º–æ–¥–µ–ª—é–≤–∞—Ç–∏ –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—é –º–æ–ª–æ–∫–∞/—Å–æ–∫—É/—è—î—á–Ω–æ—ó –º–∞—Å–∏, –æ–±—á–∏—Å–ª–∏—Ç–∏ –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ–π–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ (PU) –∑–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ Tref —Ç–∞ z, –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ CCP-–ø–æ—Ä–æ–≥–∏, –±—É–¥—É–≤–∞—Ç–∏ –≥"><meta property="og:url" content="https://edlab.pp.ua/tech_II_kyrs/tech_para16.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞ ‚Äî –ü–∞—Ä–∞ 16","description":"–ú–µ—Ç–∞: –∑–º–æ–¥–µ–ª—é–≤–∞—Ç–∏ –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—é –º–æ–ª–æ–∫–∞/—Å–æ–∫—É/—è—î—á–Ω–æ—ó –º–∞—Å–∏, –æ–±—á–∏—Å–ª–∏—Ç–∏ –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ–π–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ (PU) –∑–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ Tref —Ç–∞ z, –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ CCP-–ø–æ—Ä–æ–≥–∏, –±—É–¥—É–≤–∞—Ç–∏ –≥","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/tech_II_kyrs/tech_para16.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">ü•õ</span>
      <div>
        <b>–ü–∞—Ä–∞ 16 ‚Äî –ü–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è (–µ–º—É–ª—è—Ç–æ—Ä + PU + CCP)</b><br>
        <span class="badge">–Ω–∞–≥—Ä—ñ–≤ ‚Üí –≤–∏—Ç—Ä–∏–º–∫–∞ ‚Üí –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è ‚Ä¢ ‚à´10^((T‚àíTref)/z)dt ‚Ä¢ –≥—Ä–∞—Ñ—ñ–∫ ‚Ä¢ –∂—É—Ä–Ω–∞–ª ‚Ä¢ —á–µ–∫/QR/CSV</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">–ú–µ—Ç–∞: –∑–º–æ–¥–µ–ª—é–≤–∞—Ç–∏ –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—é <b>–º–æ–ª–æ–∫–∞/—Å–æ–∫—É/—è—î—á–Ω–æ—ó –º–∞—Å–∏</b>, –æ–±—á–∏—Å–ª–∏—Ç–∏ <b>–ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ–π–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ (PU)</b> –∑–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ <span class="mono">Tref</span> —Ç–∞ <span class="mono">z</span>, –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ <b>CCP-–ø–æ—Ä–æ–≥–∏</b>, –±—É–¥—É–≤–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ —ñ —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (CSV/TXT/—á–µ–∫ 58 –º–º, QR).</p>

  <div class="grid">
    <!-- –õ–Ü–í–û: –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è + –≥—Ä–∞—Ñ—ñ–∫ + —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
    <div class="card">
      <h2>üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É</h2>
      <div class="row">
        <select id="product" class="input" style="max-width:220px">
          <option value="milk" selected="">–ú–æ–ª–æ–∫–æ HTST (‚âà72¬∞C/15 —Å)</option>
          <option value="batch">–ú–æ–ª–æ–∫–æ batch (‚âà63¬∞C/30 —Ö–≤)</option>
          <option value="egg">–Ø—î—á–Ω–∞ –º–∞—Å–∞ (‚âà60¬∞C/3,5 —Ö–≤)</option>
          <option value="juice">–°—ñ–∫ (–Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è)</option>
        </select>
        <label>–û–±‚Äô—î–º, –ª<input id="vol" class="input" type="number" min="10" step="10" value="500"></label>
        <label>–¢–µ–º–ø. —Å—Ç–∞—Ä—Ç—É ¬∞C<input id="t0" class="input" type="number" step="1" value="6"></label>
      </div>
      <div class="row">
        <label>Tref ¬∞C<input id="tref" class="input" type="number" step="0.1" value="60"></label>
        <label>z ¬∞C<input id="z" class="input" type="number" step="0.1" value="7"></label>
        <label>–¶—ñ–ª—å PU<input id="puTarget" class="input" type="number" step="1" value="15"></label>
        <label>Œît —Å–∏–º—É–ª—è—Ü—ñ—ó, —Å<input id="dt" class="input" type="number" min="1" step="1" value="1"></label>
      </div>
      <div class="row">
        <label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –Ω–∞–≥—Ä—ñ–≤—É %<input id="heat" class="input" type="range" min="0" max="100" value="75"></label>
        <label>–û—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è %<input id="cool" class="input" type="range" min="0" max="100" value="60"></label>
        <label>–£—Ç—Ä–∏–º—É–≤–∞—Ç–∏ ‚â•Thold ¬∞C<input id="thold" class="input" type="number" step="0.5" value="72"></label>
        <label>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å hold, —Å<input id="holdSec" class="input" type="number" step="1" value="15"></label>
      </div>
      <div class="row">
        <button class="btn good" id="start">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç —Å–∏–º—É–ª—è—Ü—ñ—ó</button>
        <button class="btn" id="pause">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
        <button class="btn secondary" id="reset">üßπ –°–∫–∏–Ω—É—Ç–∏</button>
        <span class="badge" id="status">–°—Ç–∞—Ç—É—Å: idle</span>
      </div>

      <h3 style="margin-top:10px">üìà –ñ–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫</h3>
      <div class="canvasWrap"><canvas id="chart" width="960" height="300"></canvas></div>
      <div class="row" style="margin-top:6px">
        <span id="live" class="mono">t=0 c | T=‚Äî ¬∞C | PU=0.00 | hold=0 c</span>
        <span id="ccp" class="badge">CCP: ‚Äî</span>
      </div>

      <h3 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç/–¥—Ä—É–∫</h3>
      <div class="row">
        <input id="lot" class="input" placeholder="–õ–æ—Ç/–ø–∞—Ä—Ç—ñ—è (–Ω–∞–ø—Ä. 2025-10-18-01)">
        <button class="btn" id="saveCsv">üìÑ CSV</button>
        <button class="btn" id="saveTxt">üíæ TXT-–∑–≤—ñ—Ç</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="qrGen">üîó QR</button>
      </div>
      <div class="receipt" id="rc" hidden=""></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="qr" width="220" height="220"></canvas></div>
      <small class="muted">QR –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Å–µ—Ä–≤—ñ—Å <span class="mono">api.qrserver.com</span>. –Ø–∫—â–æ –æ—Ñ–ª–∞–π–Ω ‚Äî –±—É–¥–µ —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–æ–ª–±–µ–∫.</small>
    </div>

    <!-- –ü–†–ê–í–û: —Å—Ö–µ–º–∞ + —Ç–∞–±–ª–∏—Ü—ñ/–∂—É—Ä–Ω–∞–ª -->
    <div class="card">
      <h2>üîå –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—É (SVG)</h2>
      <svg viewBox="0 0 820 280" role="img" aria-label="–ë–∞–∫ –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó: –Ω–∞–≥—Ä—ñ–≤‚Äì–≤–∏—Ç—Ä–∏–º–∫–∞‚Äì–æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è">
        <rect x="40" y="40" width="240" height="160" rx="14" fill="#0e2a47" stroke="#3b82f6"></rect>
        <text x="160" y="70" fill="#e5e7eb" font-size="14" text-anchor="middle">–ë–∞–∫ –∑ —Å–æ—Ä–æ—á–∫–æ—é</text>
        <text x="160" y="90" fill="#93c5fd" font-size="12" text-anchor="middle">–¥–∞—Ç—á–∏–∫ T, –ø–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è</text>

        <rect x="320" y="40" width="200" height="80" rx="12" fill="#14532d" stroke="#22c55e"></rect>
        <text x="420" y="72" fill="#dcfce7" font-size="14" text-anchor="middle">–ù–∞–≥—Ä—ñ–≤–∞—á</text>
        <text x="420" y="90" fill="#a7f3d0" font-size="12" text-anchor="middle">–ø–∞—Ä–∞/–¢–ï–ù</text>

        <rect x="320" y="120" width="200" height="80" rx="12" fill="#1f2937" stroke="#9ca3af"></rect>
        <text x="420" y="152" fill="#e5e7eb" font-size="14" text-anchor="middle">–û—Ö–æ–ª–æ–¥–∂—É–≤–∞—á</text>
        <text x="420" y="170" fill="#93c5fd" font-size="12" text-anchor="middle">–≤–æ–¥–∞/—Ä–æ–∑—Å—ñ–ª</text>

        <rect x="560" y="40" width="220" height="160" rx="12" fill="#0b1a2f" stroke="#64748b"></rect>
        <text x="670" y="72" fill="#e5e7eb" font-size="14" text-anchor="middle">CCP-–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä</text>
        <text x="670" y="90" fill="#93c5fd" font-size="12" text-anchor="middle">PU, Tref, z, hold</text>

        <line x1="280" y1="120" x2="320" y2="80" stroke="#93c5fd" stroke-width="3"></line>
        <line x1="280" y1="120" x2="320" y2="160" stroke="#64748b" stroke-width="3"></line>
        <line x1="520" y1="120" x2="560" y2="120" stroke="#22c55e" stroke-width="3"></line>

        <text x="410" y="230" fill="#fbbf24" font-size="12" text-anchor="middle">–ü—Ä–æ—Ç–æ–∫–æ–ª: CSV/TXT ‚Ä¢ –ß–µ–∫ 58 –º–º ‚Ä¢ QR</text>
      </svg>

      <h2 style="margin-top:10px">üìã –ü–∞—Ä–∞–º–µ—Ç—Ä–∏/—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</h2>
      <table class="tbl">
        <tbody>
          <tr><th>–ü—Ä–æ–¥—É–∫—Ç</th><td id="p_name">‚Äî</td></tr>
          <tr><th>Tref / z</th><td id="p_tz">‚Äî</td></tr>
          <tr><th>–¶—ñ–ª—å PU</th><td id="p_put">‚Äî</td></tr>
          <tr><th>–î–æ—Å—è–≥–Ω—É—Ç–æ</th><td id="p_pu">‚Äî</td></tr>
          <tr><th>Hold —Ñ–∞–∫—Ç–∏—á–Ω–∏–π</th><td id="p_hold">‚Äî</td></tr>
          <tr><th>CCP-–≤–µ—Ä–¥–∏–∫—Ç</th><td id="p_ccp">‚Äî</td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üõéÔ∏è –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</h2>
      <pre id="alog" class="note" style="max-height:220px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>
    </div>
  </div>

  <div class="card">
    <h2>üéØ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
    <ol>
      <li>–ó–º–æ–¥–µ–ª—é–π **HTST –¥–ª—è –º–æ–ª–æ–∫–∞**: —Ü—ñ–ª—å <span class="mono">PU=15</span>, <span class="mono">Tref=60¬∞C</span>, <span class="mono">z=7¬∞C</span>, —É—Ç—Ä–∏–º–∞–Ω–Ω—è <span class="mono">‚â•72¬∞C/15 —Å</span>. –ó–±–µ—Ä–µ–∂–∏ <b>CSV</b> —ñ <b>TXT</b>.</li>
      <li>–ü–æ—Ä—ñ–≤–Ω—è–π —ñ–∑ **batch-–ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—î—é** <span class="mono">63¬∞C/30 —Ö–≤</span> ‚Äî –¥–æ—Å—è–≥–Ω–∏ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ–≥–æ PU. –ó—Ä–æ–±–∏ –≤–∏—Å–Ω–æ–≤–æ–∫ —É <b>TXT</b>.</li>
      <li>–ó–∞–¥–∞–π ¬´—è—î—á–Ω—É –º–∞—Å—É¬ª: <span class="mono">Tref=60¬∞C, z=7¬∞C, hold=60¬∞C/210 —Å</span>, –ø–µ—Ä–µ–≤—ñ—Ä **CCP**. –†–æ–∑–¥—Ä—É–∫—É–π <b>—á–µ–∫ 58 –º–º</b>.</li>
    </ol>
  </div>

  <div class="card">
    <h2>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
    <p class="muted small">–õ—É—ó –ü–∞—Å—Ç–µ—Ä —É XIX —Å—Ç. –ø–æ–∫–∞–∑–∞–≤, —â–æ —Ç–µ–ø–ª–æ –∑–Ω–∏–∂—É—î –º—ñ–∫—Ä–æ–±–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –°—å–æ–≥–æ–¥–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ —Ä–∞—Ö—É—é—Ç—å ¬´–µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç –ø–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó¬ª —è–∫ —ñ–Ω—Ç–µ–≥—Ä–∞–ª –≤—ñ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ ‚Äî —ñ –º–∏ —Ü–µ –ø–æ–≤—Ç–æ—Ä—é—î–º–æ –ø—Ä–æ—Å—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ.</p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s);
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function clamp(x,a,b){return Math.max(a,Math.min(b,x));}
function fmt(x,n=2){return (Math.round(x*Math.pow(10,n))/Math.pow(10,n)).toFixed(n).replace('.',',');}
function log(msg){const t=new Date().toLocaleTimeString();const box=$('#alog');if(box.textContent.startsWith('//'))box.textContent='';box.textContent+=`[${t}] ${msg}\n`;box.scrollTop=box.scrollHeight;}

// ===== –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–∏–º—É–ª—è—Ü—ñ—ó =====
const cvs=$('#chart'), ctx=cvs.getContext('2d');
let t=0, T=null, PU=0, hold=0, running=false, timer=null;
const series=[]; // {t, T, PU}

// –ü—Ä–æ—Ñ—ñ–ª—ñ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
const PRESETS={
  milk:{ name:'–ú–æ–ª–æ–∫–æ HTST', tref:60, z:7, pu:15, thold:72, holdSec:15 },
  batch:{ name:'–ú–æ–ª–æ–∫–æ batch', tref:60, z:7, pu:300, thold:63, holdSec:1800 },
  egg:{ name:'–Ø—î—á–Ω–∞ –º–∞—Å–∞', tref:60, z:7, pu:210, thold:60, holdSec:210 },
  juice:{ name:'–°—ñ–∫ (–∫–∞—Å—Ç–æ–º)', tref:60, z:10, pu:50, thold:72, holdSec:20 }
};

// ===== UI presets =====
const product=$('#product');
function applyPreset(){
  const p=product.value;
  const s=PRESETS[p];
  $('#tref').value=s.tref; $('#z').value=s.z; $('#puTarget').value=s.pu;
  $('#thold').value=s.thold; $('#holdSec').value=s.holdSec;
  $('#p_name').textContent=s.name;
  $('#p_tz').textContent=`Tref=${s.tref}¬∞C, z=${s.z}¬∞C`;
  $('#p_put').textContent=s.pu+' PU';
}
product.addEventListener('change',applyPreset);
applyPreset();

// ===== –ì—Ä–∞—Ñ—ñ–∫ =====
function draw(){
  const W=cvs.width,H=cvs.height;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#223049';ctx.strokeRect(0.5,0.5,W-1,H-1);
  if(series.length<2) return;
  const maxN=500;
  const s=series.slice(-maxN);
  const tmin=s[0].t, tmax=s[s.length-1].t||1;
  const xs=s.map(v=> (v.t-tmin)/(tmax-tmin||1)*(W-20)+10);
  // –æ—Å—ñ
  ctx.fillStyle='#94a3b8';ctx.font='12px ui-monospace';
  ctx.fillText('T ¬∞C', 8, 14); ctx.fillText('PU', W-36, 14);

  // —à–∫–∞–ª–∏
  const Tmax=Math.max(...s.map(v=>v.T), 80), Tmin=Math.min(...s.map(v=>v.T), 0);
  // T
  ctx.beginPath(); ctx.strokeStyle='#38bdf8'; ctx.lineWidth=2;
  xs.forEach((x,i)=>{const y=H-12-( (s[i].T - Tmin) / (Tmax - Tmin || 1) )*(H-24); i?ctx.lineTo(x,y):ctx.moveTo(x,y);}); ctx.stroke();
  // PU (–Ω–æ—Ä–º–æ–≤–∞–Ω–æ)
  const PUmax=Math.max(...s.map(v=>v.PU), 1);
  ctx.beginPath(); ctx.strokeStyle='#22c55e'; ctx.lineWidth=2;
  xs.forEach((x,i)=>{const y=H-12-( (s[i].PU) / (PUmax || 1) )*(H-24); i?ctx.lineTo(x,y):ctx.moveTo(x,y);}); ctx.stroke();

  // –ª—ñ–Ω—ñ—è hold
  const th=parseFloat($('#thold').value);
  const yH=H-12-( (th - Tmin) / (Tmax - Tmin || 1) )*(H-24);
  ctx.strokeStyle='#fbbf24'; ctx.setLineDash([6,4]); ctx.beginPath(); ctx.moveTo(10,yH); ctx.lineTo(W-10,yH); ctx.stroke(); ctx.setLineDash([]);
}

function step(){
  const dt=parseFloat($('#dt').value)||1;
  const heat=parseInt($('#heat').value,10)/100;
  const cool=parseInt($('#cool').value,10)/100;
  const thold=parseFloat($('#thold').value)||72;
  const holdSec=parseFloat($('#holdSec').value)||15;

  // –î—É–∂–µ –ø—Ä–æ—Å—Ç–∞ –º–æ–¥–µ–ª—å: T —Ä—É—Ö–∞—î—Ç—å—Å—è –¥–æ Tin –ø—Ä–∏ –Ω–∞–≥—Ä—ñ–≤—ñ —Ç–∞ –¥–æ Tout –ø—Ä–∏ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—ñ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏
  const Tin = 78 + 10*heat;   // –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ ¬´–≥–∞—Ä—è—á–∞¬ª —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å–æ—Ä–æ—á–∫–∏
  const Tout= 4 + (1-cool)*8; // –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ ¬´—Ö–æ–ª–æ–¥–Ω–∞¬ª —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
  const kHeat = 0.015 + 0.015*heat;   // —à–≤–∏–¥–∫—ñ—Å—Ç—å –Ω–∞–≥—Ä—ñ–≤—É
  const kCool = 0.02  + 0.02 *cool;   // —à–≤–∏–¥–∫—ñ—Å—Ç—å –æ—Ö–æ–ª.

  // –§–∞–∑–∞: –ø–æ–∫–∏ T<thold ‚Äî –Ω–∞–≥—Ä—ñ–≤; –∫–æ–ª–∏ –¥–æ—Å—è–≥–Ω—É—Ç–æ ‚Äî —É—Ç—Ä–∏–º–∞–Ω–Ω—è; –ø—ñ—Å–ª—è —Ü—ñ–ª—ñ PU ‚Äî –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è
  const targetPU=parseFloat($('#puTarget').value)||15;
  let dT=0;
  if(PU>=targetPU){
    dT = (Tout - T)*kCool*dt;
  }else if(T>=thold){
    dT = (thold - T)*0.03*dt; // —Ç—Ä–∏–º–∞–π –±—ñ–ª—è hold
  }else{
    dT = (Tin - T)*kHeat*dt;
  }
  T += dT;

  // PU —ñ–Ω—Ç–µ–≥—Ä–∞–ª
  const tref=parseFloat($('#tref').value), z=parseFloat($('#z').value);
  const rate = Math.pow(10, (T - tref)/z); // 1/—Å–µ–∫
  PU += rate * dt;

  // hold —á–∞—Å
  if(T>=thold) hold += dt; else if(hold>0 && T<thold-0.5) hold = Math.max(0, hold - dt*0.2); // –Ω–µ–≤–µ–ª–∏–∫–µ —Å–ø–∞–¥–∞–Ω–Ω—è –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ

  t += dt;
  series.push({t, T, PU});

  // —Å—Ç–∞—Ç—É—Å/CCP
  const ccp = (PU>=targetPU && hold>=holdSec) ? 'OK' : (T>=thold ? 'HOLD' : 'HEAT');
  $('#live').textContent=`t=${t.toFixed(0)} c | T=${T.toFixed(2)} ¬∞C | PU=${PU.toFixed(2)} | hold=${hold.toFixed(0)} c`;
  $('#ccp').textContent='CCP: '+ccp;
  if(ccp==='OK'){ $('#ccp').classList.remove('warn','bad'); $('#ccp').classList.add('ok'); }
  else if(ccp==='HOLD'){ $('#ccp').classList.remove('ok','bad'); $('#ccp').classList.add('warn'); }
  else { $('#ccp').classList.remove('ok','warn'); $('#ccp').classList.add('bad'); }

  draw();

  // –∞–≤—Ç–æ–ª–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π
  if(Math.abs(T - thold) < 0.05 && hold<1){ log('–î–æ—Å—è–≥–Ω—É—Ç–æ –ø–æ—Ä–æ–≥—É hold'); }
  if(PU>=targetPU && Math.abs(PU-targetPU)<rate*dt){ log('–î–æ—Å—è–≥–Ω—É—Ç–æ —Ü—ñ–ª—å–æ–≤–∏—Ö PU'); }

  // –æ–Ω–æ–≤–∏—Ç–∏ –ø—ñ–¥—Å—É–º–∫–æ–≤—É —Ç–∞–±–ª–∏—á–∫—É
  $('#p_pu').textContent=PU.toFixed(2)+' PU';
  $('#p_hold').textContent=hold.toFixed(0)+' c';
  $('#p_ccp').innerHTML = (PU>=targetPU && hold>=holdSec) ? '<b class="ok">PASS</b>' : '<b class="warn">IN PROGRESS</b>';
}

function loop(){
  if(!running) return;
  step();
  timer = setTimeout(loop, 50); // —à–≤–∏–¥–∫–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è
}

function reset(){
  running=false; if(timer) clearTimeout(timer);
  t=0; PU=0; hold=0; T=parseFloat($('#t0').value)||6; series.length=0;
  series.push({t, T, PU});
  draw();
  $('#status').textContent='–°—Ç–∞—Ç—É—Å: idle';
  $('#rc').hidden=true; const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220);
  log('–°–∫–∏–¥–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–æ');
}

$('#start').addEventListener('click', ()=>{
  if(!running){ running=true; $('#status').textContent='–°—Ç–∞—Ç—É—Å: running'; if(series.length===0) reset(); loop(); }
});
$('#pause').addEventListener('click', ()=>{ running=false; $('#status').textContent='–°—Ç–∞—Ç—É—Å: paused'; });
$('#reset').addEventListener('click', reset);

// —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
reset();
$('#p_name').textContent=PRESETS[product.value].name;

// ===== –ï–∫—Å–ø–æ—Ä—Ç CSV/TXT/–ß–µ–∫ =====
$('#saveCsv').addEventListener('click', ()=>{
  if(series.length<2) return alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö');
  const lot=($('#lot').value||'').replace(/"/g,'""');
  const head='t_sec,Temp_C,PU_cum,Lot\n';
  const rows=series.map(v=>`${v.t.toFixed(0)},${v.T.toFixed(3)},${v.PU.toFixed(3)},"${lot}"`).join('\n');
  download('tech_para16_pasteur_'+stamp()+'.csv', head+rows+'\n', 'text/csv');
});
$('#saveTxt').addEventListener('click', ()=>{
  const s=PRESETS[product.value];
  const txt=[
    '–ü–∞—Ä–∞ 16 ‚Äî –ü–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è (–µ–º—É–ª—è—Ç–æ—Ä)',
    `–ü—Ä–æ–¥—É–∫—Ç: ${s.name}`,
    `–ü–∞—Ä–∞–º–µ—Ç—Ä–∏: Tref=${$('#tref').value}¬∞C, z=${$('#z').value}¬∞C, –¶—ñ–ª—å PU=${$('#puTarget').value}, Hold: ‚â•${$('#thold').value}¬∞C/${$('#holdSec').value} c`,
    `–†–µ–∑—É–ª—å—Ç–∞—Ç: PU=${PU.toFixed(2)}, Hold=${hold.toFixed(0)} c, –°—Ç–∞—Ç—É—Å=${(PU>=s.pu && hold>=(+$('#holdSec').value))?'PASS':'IN PROGRESS'}`,
    `–õ–æ—Ç: ${$('#lot').value||'‚Äî'}`,
    '--- –ñ—É—Ä–Ω–∞–ª ---',
    ...($('#alog').textContent.startsWith('//')?[]:$('#alog').textContent.trim().split('\n'))
  ];
  download('tech_para16_report_'+stamp()+'.txt', txt.join('\n'));
});
$('#print58').addEventListener('click', ()=>{
  const s=PRESETS[product.value];
  const lines=[
    '=== –ß–ï–ö –ü–ê–°–¢–ï–†–ò–ó–ê–¶–Ü–á (58–º–º) ===',
    '–ü—Ä–æ–¥—É–∫—Ç: '+s.name,
    `Tref=${$('#tref').value}¬∞C, z=${$('#z').value}¬∞C`,
    `–¶—ñ–ª—å PU=${$('#puTarget').value}`,
    `Hold ‚â•${$('#thold').value}¬∞C/${$('#holdSec').value} c`,
    `PU=${PU.toFixed(2)} | Hold=${hold.toFixed(0)} c`,
    '–í–µ—Ä–¥–∏–∫—Ç: '+((PU>=(+$('#puTarget').value) && hold>= (+$('#holdSec').value))?'PASS':'IN PROGRESS'),
    '–õ–æ—Ç: '+($('#lot').value||'‚Äî'),
    '-----------------------------'
  ];
  const rc=$('#rc'); rc.hidden=false; rc.textContent=lines.join('\n');
  download('tech_para16_receipt_'+stamp()+'.txt', lines.join('\n'));
});

// ===== QR =====
$('#qrGen').addEventListener('click', ()=>{
  const data = prompt('–í—Å—Ç–∞–≤ —Ç–µ–∫—Å—Ç/URL –¥–ª—è QR (–Ω–∞–ø—Ä., –ø–∞–ø–∫–∞ –∑ –ª–æ–≥–∞–º–∏/—Ñ–æ—Ç–æ):', $('#lot').value || 'pasteurization-log');
  if(data===null) return;
  const url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=2&data='+encodeURIComponent(data);
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.drawImage(img,0,0,220,220); };
  img.onerror=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.fillStyle='#e5e7eb'; q.font='14px ui-monospace'; q.fillText('QR offline', 62,110); q.fillText((data.length>14?data.slice(0,14)+'‚Ä¶':data), 36,132); };
  img.src=url;
});
</script>


</body></html>