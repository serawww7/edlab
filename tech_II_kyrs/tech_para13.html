<!-- tech_para13.html
     –ü–ê–†–ê 13 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–≤ –∑ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞
     –¢–µ–º–∞: SPC + CAPA ‚Äî –∫–∞—Ä—Ç–∏ XÃÑ‚ÄìR, –º–µ–∂—ñ –∫–µ—Ä—É–≤–∞–Ω–Ω—è, Cp/Cpk, –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ (NCR) —Ç–∞ –ø–ª–∞–Ω CAPA,
           –∫–≤–∏—Ç–æ–∫ 58 –º–º, QR/NFC, CSV.
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏; (–æ–ø—Ü.) —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º; NFC-–º—ñ—Ç–∫–∏.

     –ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
     –£–í–ê–ì–ê: –Ω–∞–≤—á–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å. –§–∞–∫—Ç–∏—á–Ω—ñ –∫–∞—Ä—Ç–∏/–º–µ–∂—ñ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—é—Ç—å QA –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –≤–∏–±—ñ—Ä–∫–∞—Ö.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 13 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî SPC XÃÑ‚ÄìR, Cp/Cpk, NCR & CAPA, –∫–≤–∏—Ç–æ–∫/QR/NFC/CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  textarea{min-height:84px}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ –≤ Moodle (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
  /* ASCII –≥—Ä–∞—Ñ—ñ–∫–∏ */
  .graph{font:12px/14px ui-monospace,monospace;white-space:pre;background:#fff;color:#000;padding:8px;border-radius:8px;border:1px solid #e5e7eb;overflow:auto}
</style>
</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 13 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –ø–µ—Ä–µ—Ä–æ–±–∫–∏</span>
  <h1>üìà SPC XÃÑ‚ÄìR, Cp/Cpk, NCR & CAPA, –∫–≤–∏—Ç–æ–∫/QR/NFC/CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –ø–∞—Ä–∏</h2>
    <p>
      –ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –∑–±–µ—Ä—É—Ç—å <b>–≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è</b> –ø–æ –ø—ñ–¥–≥—Ä—É–ø–∞—Ö, (2) –ø–æ–±—É–¥—É—é—Ç—å <b>–∫–∞—Ä—Ç–∏ XÃÑ‚ÄìR</b> –∑ –º–µ–∂–∞–º–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è,
      (3) —Ä–æ–∑—Ä–∞—Ö—É—é—Ç—å <b>Cp/Cpk</b>, (4) –∑–∞—Ñ—ñ–∫—Å—É—é—Ç—å <b>–Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ (NCR)</b> —Ç–∞ —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>–ø–ª–∞–Ω CAPA</b>,
      (5) –æ—Ñ–æ—Ä–º–ª—è—Ç—å <b>CSV</b>, <b>QR/NFC</b> —Ç–∞ <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>.
    </p>
    <p class="small muted">–ú–æ–¥–µ–ª—å –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è. –ù–∞ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤—ñ ‚Äî —É–∑–≥–æ–¥–∂—É–π—Ç–µ –∑ QA –º–µ—Ç–æ–¥–∏–∫–∏, —Ä–æ–∑–º—ñ—Ä –ø—ñ–¥–≥—Ä—É–ø, –ø—Ä–∞–≤–∏–ª–∞ —Å–∏–≥–Ω–∞–ª—ñ–≤ (WECO), –ø–ª–∞–Ω–∏ –≤—ñ–¥–±–æ—Ä—É.</p>
  </div>

  <!-- 1. –°–ü–ï–¶–ò–§–Ü–ö–ê–¶–Ü–Ø/–ü–ê–†–ê–ú–ï–¢–†–ò SPC -->
  <div class="card">
    <h2>‚öôÔ∏è –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ SPC</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–æ–∫–∞–∑–Ω–∏–∫</h3>
        <div class="row">
          <div style="flex:1"><label>–ù–∞–∑–≤–∞</label><input id="charName" type="text" value="–ú–∞—Å–∞ –Ω–µ—Ç—Ç–æ, –≥"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>LSL</label><input id="lsl" type="number" step="0.1" value="390"></div>
          <div style="flex:1"><label>TARGET</label><input id="tgt" type="number" step="0.1" value="400"></div>
          <div style="flex:1"><label>USL</label><input id="usl" type="number" step="0.1" value="410"></div>
        </div>
      </div>

      <div class="box">
        <h3>–ü—ñ–¥–≥—Ä—É–ø–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–†–æ–∑–º—ñ—Ä –ø—ñ–¥–≥—Ä—É–ø–∏ (n, 2‚Äì10)</label><input id="n" type="number" step="1" value="5"></div>
          <div style="flex:1"><label>–ü—ñ–¥–≥—Ä—É–ø –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ</label><input id="k" type="number" step="1" value="8"></div>
        </div>
        <p class="small muted">–ö–∞—Ä—Ç–∏: XÃÑ (—Å–µ—Ä–µ–¥–Ω—ñ) —Ç–∞ R (—Ä–æ–∑–º–∞—Ö). –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ A2/D3/D4/d2 ‚Äî –∑–∞ –≤–∏–±—Ä–∞–Ω–∏–º n.</p>
      </div>

      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="presetData()">üß™ –ü—Ä–∏–∫–ª–∞–¥ –¥–∞–Ω–∏—Ö</button>
          <button class="btn" onclick="recalc()">‚úÖ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvData')">üìã CSV (raw)</button>
        </div>
        <div id="csvData" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 2. –î–ê–ù–Ü –í–ò–ú–Ü–†–Æ–í–ê–ù–¨ -->
  <div class="card">
    <h2>üß™ –í–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è</h2>
    <div class="row">
      <button class="btn" onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ –≤–∏–º—ñ—Ä</button>
      <button class="btn" onclick="autoSubgroup()">üîÅ –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –ø—ñ–¥–≥—Ä—É–ø–∏</button>
      <button class="btn" onclick="copyCSV('csvSub')">üìã CSV (subgroups)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tbl">
        <thead>
          <tr>
            <th>#</th>
            <th>–ü—ñ–¥–≥—Ä—É–ø–∞</th>
            <th class="dark">–ó–Ω–∞—á–µ–Ω–Ω—è</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="body"></tbody>
      </table>
    </div>
    <div id="csvSub" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 3. –†–ï–ó–£–õ–¨–¢–ê–¢–ò SPC -->
  <div class="card">
    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ SPC</h2>
    <div class="grid g2">
      <div class="box">
        <h3>–ü—ñ–¥—Å—É–º–∫–∏</h3>
        <div id="sumOut" class="out">‚Äî</div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="copyCSV('csvSPC')">üìã CSV (spc)</button>
        </div>
        <div id="csvSPC" class="out" style="margin-top:8px">‚Äî</div>
      </div>
      <div class="box">
        <h3>–°–∏–≥–Ω–∞–ª–∏/–ø–æ—Ä—É—à–µ–Ω–Ω—è</h3>
        <div id="sigOut" class="out">‚Äî</div>
      </div>
    </div>

    <h3 style="margin-top:12px">–ö–∞—Ä—Ç–∏ XÃÑ —Ç–∞ R (ASCII)</h3>
    <div class="grid g2">
      <div>
        <div class="graph" id="chartX">‚Äî</div>
      </div>
      <div>
        <div class="graph" id="chartR">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 4. NCR + CAPA -->
  <div class="card">
    <h2>üö® –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ (NCR) —Ç–∞ CAPA</h2>
    <div class="row">
      <button class="btn" onclick="addNCR()">‚ûï –î–æ–¥–∞—Ç–∏ NCR</button>
      <button class="btn" onclick="presetNCR()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="copyCSV('csvNCR')">üìã CSV (NCR)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblNCR">
        <thead>
          <tr>
            <th>#</th>
            <th>–û–ø–∏—Å</th>
            <th class="dark">Root cause</th>
            <th class="dark">Corrective</th>
            <th class="dark">Preventive</th>
            <th>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π</th>
            <th>–¢–µ—Ä–º—ñ–Ω</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyNCR"></tbody>
      </table>
    </div>
    <div id="csvNCR" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 5. –ñ–£–†–ù–ê–õ / –ö–í–ò–¢–û–ö 58 –º–º / QR / NFC -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª SPC / –ö–≤–∏—Ç–æ–∫ 58 –º–º / QR / NFC</h2>
    <div class="row">
      <button class="btn" onclick="addLog()">‚ûï –î–æ–¥–∞—Ç–∏ —É –∂—É—Ä–Ω–∞–ª</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (journal)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblLog">
        <thead>
          <tr>
            <th>#</th>
            <th>–ü–æ–∫–∞–∑–Ω–∏–∫</th>
            <th class="dark">XÃÑ¬±A2¬∑RÃÑ</th>
            <th class="dark">RÃÑ (LCL/UCL)</th>
            <th>Cp/Cpk</th>
            <th>–°–∏–≥–Ω–∞–ª–∏</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyLog"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>

    <div class="grid g2" style="margin-top:12px">
      <div class="box">
        <h3>QR-payload</h3>
        <div class="row">
          <button class="btn" onclick="buildQR()">üß© –ó—ñ–±—Ä–∞—Ç–∏ QR</button>
          <button class="btn" onclick="copyEl('qrOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="qrOut" class="out">‚Äî</div>

        <h3 style="margin-top:12px">NFC ‚Äî ‚ÄúSPC CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          <div style="flex:1"><label>–ê–Ω–∞–ª—ñ—Ç–∏–∫</label><input id="nfcOper" type="text" value="–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ 58 –º–º ‚Äî ‚ÄúSPC SUMMARY‚Äù</h3>
        <div class="row">
          <button class="btn" onclick="scrollTicket()">üßæ –ü–æ–∫–∞–∑–∞—Ç–∏</button>
          <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>SPC SUMMARY</h4>
          <p><b>–ü–æ–∫–∞–∑–Ω–∏–∫:</b> <span id="tChar">‚Äî</span></p>
          <p><b>XÃÑ:</b> <span id="tXbar">‚Äî</span> ¬∑ <b>RÃÑ:</b> <span id="tRbar">‚Äî</span></p>
          <p><b>–ú–µ–∂—ñ XÃÑ:</b> <span id="tXlim">‚Äî</span></p>
          <p><b>–ú–µ–∂—ñ R:</b> <span id="tRlim">‚Äî</span></p>
          <div class="line"></div>
          <p><b>Cp/Cpk:</b> <span id="tCap">‚Äî</span></p>
          <p><b>–°–∏–≥–Ω–∞–ª–∏:</b> <span id="tSig">‚Äî</span></p>
          <div class="line"></div>
          <p><small>–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å –æ—Ü—ñ–Ω–∫–∏ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–∏–±—ñ—Ä–∫–∏; –¥–ª—è —Ä—ñ—à–µ–Ω—å ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç—É–π—Ç–µ—Å—è –∑ QA.</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 6. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–ó–∞–¥–∞–π—Ç–µ LSL/TARGET/USL —Ç–∞ n,k; –≤–Ω–µ—Å—ñ—Ç—å 30‚Äì50 –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å –∞–±–æ —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—å –ø—Ä–∏–∫–ª–∞–¥–æ–º.</li>
      <li>–ü–µ—Ä–µ—Ä–∞—Ö—É–π—Ç–µ –∫–∞—Ä—Ç–∏ XÃÑ‚ÄìR; –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ ASCII-–≥—Ä–∞—Ñ—ñ–∫–∏ —Ç–∞ —Å–∏–≥–Ω–∞–ª–∏.</li>
      <li>–†–æ–∑—Ä–∞—Ö—É–π—Ç–µ Cp/Cpk; –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ —Å—Ç–≤–æ—Ä—ñ—Ç—å NCR —Ç–∞ CAPA.</li>
      <li>–ó–∞–Ω–µ—Å—ñ—Ç—å –ø—ñ–¥—Å—É–º–æ–∫ —É –∂—É—Ä–Ω–∞–ª; —Å—Ñ–æ—Ä–º—É–π—Ç–µ QR/NFC —ñ –∫–≤–∏—Ç–æ–∫; —Å–∫–æ–ø—ñ—é–π—Ç–µ CSV.</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö —Ç–∞ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è</td><td>3</td></tr>
        <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω—ñ –º–µ–∂—ñ, –∫–∞—Ä—Ç–∏ XÃÑ‚ÄìR, —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è —Å–∏–≥–Ω–∞–ª—ñ–≤</td><td>4</td></tr>
        <tr><td>Cp/Cpk + –≤–∏—Å–Ω–æ–≤–æ–∫</td><td>2</td></tr>
        <tr><td>–ñ—É—Ä–Ω–∞–ª/QR/NFC/–∫–≤–∏—Ç–æ–∫/CSV</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();
  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  function copyCSV(id){ const t=byId(id).textContent.trim(); if(!t||t==='‚Äî'){alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö');return;} navigator.clipboard.writeText(t); }
  function copyEl(id){ const t=byId(id).textContent.trim(); if(!t||t==='‚Äî'){alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö');return;} navigator.clipboard.writeText(t); }
  function reindex(tb){ [...tb.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  // ===== –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è n=2..10 =====
  const CONST = {
    2:{A2:1.880,D3:0.000,D4:3.267,d2:1.128},
    3:{A2:1.023,D3:0.000,D4:2.574,d2:1.693},
    4:{A2:0.729,D3:0.000,D4:2.282,d2:2.059},
    5:{A2:0.577,D3:0.000,D4:2.114,d2:2.326},
    6:{A2:0.483,D3:0.000,D4:2.004,d2:2.534},
    7:{A2:0.419,D3:0.076,D4:1.924,d2:2.704},
    8:{A2:0.373,D3:0.136,D4:1.864,d2:2.847},
    9:{A2:0.337,D3:0.184,D4:1.816,d2:2.970},
    10:{A2:0.308,D3:0.223,D4:1.777,d2:3.078}
  };

  // ===== –î–∞–Ω—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å =====
  const body = byId('body');
  function addRow(sample){
    const s = Object.assign({sg:1, val:400}, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="number" step="1" value="${s.sg}"></td>
      <td class="dark"><input type="number" step="0.1" value="${s.val}"></td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(body); buildCSV_Raw(); recalc();">‚úñ</button></td>
    `;
    body.appendChild(tr); reindex(body); buildCSV_Raw();
  }
  function autoSubgroup(){
    const n = +byId('n').value||5;
    const k = +byId('k').value||8;
    // –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ—ó—Ç–∏ –ø—ñ–¥–≥—Ä—É–ø–∏ –ø–æ n
    const rows=[...body.querySelectorAll('tr')];
    rows.forEach((r,i)=> r.children[1].querySelector('input').value = Math.floor(i/n)+1 );
    reindex(body); buildCSV_Raw(); recalc();
  }
  function buildCSV_Raw(){
    const lines=[...body.querySelectorAll('tr')].map(r=>{
      return [r.querySelector('.idx').textContent.trim(),
              r.children[1].querySelector('input').value.trim(),
              r.children[2].querySelector('input').value.trim()].join(' | ');
    });
    byId('csvData').textContent = lines.join('\n') || '‚Äî';
  }
  function presetData(){
    body.innerHTML='';
    // –∑–≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –Ω–∞–±—ñ—Ä –Ω–∞–≤–∫–æ–ª–æ TARGET –∑ –Ω–µ–≤–µ–ª–∏–∫–∏–º —Ç—Ä–µ–Ω–¥–æ–º
    const target = +byId('tgt').value||400, n = +byId('n').value||5, k=+byId('k').value||8;
    let sg=1, count=0;
    for(let i=0;i<n*k;i++){
      if(i>0 && i%n===0) sg++;
      const drift = (sg-1)*0.5; // —Ç—Ä–µ–Ω–¥ +0.5 –≥ –Ω–∞ –ø—ñ–¥–≥—Ä—É–ø—É
      const noise = (Math.random()*2-1)*2.0; // –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å ~¬±2 –≥
      addRow({sg:sg, val: rnd(target + drift + noise,1)});
      count++;
    }
    autoSubgroup(); recalc();
  }

  // ===== –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–∞—Ä—Ç XÃÑ‚ÄìR, Cp/Cpk, —Å–∏–≥–Ω–∞–ª–∏ =====
  function groupData(){
    const n = +byId('n').value||5;
    const rows = [...body.querySelectorAll('tr')].map(r=>({
      sg:+r.children[1].querySelector('input').value||1,
      val:+r.children[2].querySelector('input').value||NaN
    })).filter(x=>!isNaN(x.val));
    const map = new Map();
    rows.forEach(r=>{ if(!map.has(r.sg)) map.set(r.sg, []); map.get(r.sg).push(r.val); });
    // –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ª–∏—à–µ –ø–æ–≤–Ω—ñ –ø—ñ–¥–≥—Ä—É–ø–∏ —Ä–æ–∑–º—ñ—Ä—É n
    const sgs = [...map.keys()].sort((a,b)=>a-b).filter(k=>map.get(k).length===n);
    const data = sgs.map(k=>{
      const arr = map.get(k);
      const mean = arr.reduce((a,x)=>a+x,0)/arr.length;
      const range = Math.max(...arr)-Math.min(...arr);
      return {sg:k, arr, mean, range};
    });
    return data;
  }

  function recalc(){
    const n = Math.min(10, Math.max(2, (+byId('n').value||5)));
    byId('n').value = n;
    const C = CONST[n];
    const data = groupData();
    if(!data.length){ byId('sumOut').textContent='‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø–æ–≤–Ω–∏—Ö –ø—ñ–¥–≥—Ä—É–ø ‚Äî'; byId('csvSPC').textContent='‚Äî'; byId('sigOut').textContent='‚Äî'; byId('chartX').textContent='‚Äî'; byId('chartR').textContent='‚Äî'; return; }

    const means = data.map(d=>d.mean);
    const ranges= data.map(d=>d.range);
    const xbarbar = means.reduce((a,x)=>a+x,0)/means.length;
    const rbar    = ranges.reduce((a,x)=>a+x,0)/ranges.length;

    const UCLx = xbarbar + C.A2 * rbar;
    const LCLx = xbarbar - C.A2 * rbar;
    const UCLr = C.D4 * rbar;
    const LCLr = C.D3 * rbar;

    // –ü–æ—Ä—É—à–µ–Ω–Ω—è: –∑–∞ –º–µ–∂–∞–º–∏ UCL/LCL —Ç–∞ 7 —Ç–æ—á–æ–∫ –∑ —Ç—Ä–µ–Ω–¥–æ–º (–º–æ–Ω–æ—Ç–æ–Ω–Ω–æ)
    const sig = [];
    data.forEach(d=>{
      if(d.mean>UCLx || d.mean<LCLx) sig.push(`XÃÑ: –ø—ñ–¥–≥—Ä—É–ø–∞ ${d.sg} –ø–æ–∑–∞ –º–µ–∂–∞–º–∏`);
      if(d.range>UCLr || d.range<LCLr) sig.push(`R: –ø—ñ–¥–≥—Ä—É–ø–∞ ${d.sg} –ø–æ–∑–∞ –º–µ–∂–∞–º–∏`);
    });
    // –ø—Ä–æ—Å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–µ–Ω–¥—É: 7 –ø–æ—Å–ø—ñ–ª—å –∑—Ä–æ—Å—Ç./—Å–ø–∞–¥.
    if(data.length>=7){
      let up=1, down=1;
      for(let i=1;i<data.length;i++){
        if(data[i].mean>data[i-1].mean){ up++; down=1; } else
        if(data[i].mean<data[i-1].mean){ down++; up=1; } else { up=1; down=1; }
        if(up>=7){ sig.push('XÃÑ: 7 –ø—ñ–¥—Ä—è–¥ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è (—Ç—Ä–µ–Ω–¥)'); break; }
        if(down>=7){ sig.push('XÃÑ: 7 –ø—ñ–¥—Ä—è–¥ —Å–ø–∞–¥–∞–Ω–Ω—è (—Ç—Ä–µ–Ω–¥)'); break; }
      }
    }

    // –û—Ü—ñ–Ω–∫–∞ sigma –ø—Ä–æ—Ü–µ—Å—É —á–µ—Ä–µ–∑ RÃÑ/d2
    const sigma = rbar / C.d2;
    const LSL = +byId('lsl').value||NaN, USL = +byId('usl').value||NaN, tgt=+byId('tgt').value||NaN;
    let Cp='–Ω/–¥', Cpk='–Ω/–¥';
    if(!isNaN(LSL)&&!isNaN(USL)&&sigma>0){
      Cp = rnd((USL-LSL)/(6*sigma),2);
      const Cpu = (USL - xbarbar)/(3*sigma);
      const Cpl = (xbarbar - LSL)/(3*sigma);
      Cpk = rnd(Math.min(Cpu, Cpl),2);
    }

    // –í–∏–≤—ñ–¥ —Å—É–º–∞—Ä–Ω–∏–π + CSV
    byId('sumOut').textContent =
      `n=${n}; –ø—ñ–¥–≥—Ä—É–ø=${data.length}; XÃÑÃÑ=${rnd(xbarbar,3)}; RÃÑ=${rnd(rbar,3)}; `+
      `–ú–µ–∂—ñ XÃÑ: [${rnd(LCLx,2)}; ${rnd(UCLx,2)}]; –ú–µ–∂—ñ R: [${rnd(LCLr,2)}; ${rnd(UCLr,2)}]; `+
      `œÉ‚âà${rnd(sigma,3)}; Cp=${Cp}; Cpk=${Cpk}`;
    const lines = [
      `SPC|n=${n}|k=${data.length}|Xbarbar=${rnd(xbarbar,3)}|Rbar=${rnd(rbar,3)}|LCLx=${rnd(LCLx,2)}|UCLx=${rnd(UCLx,2)}|LCLr=${rnd(LCLr,2)}|UCLr=${rnd(UCLr,2)}|sigma=${rnd(sigma,3)}|Cp=${Cp}|Cpk=${Cpk}`
    ];
    data.forEach(d=> lines.push(`SUB|${d.sg}|mean=${rnd(d.mean,3)}|R=${rnd(d.range,3)}`));
    byId('csvSPC').textContent = lines.join('\n');

    // –°–∏–≥–Ω–∞–ª–∏
    byId('sigOut').textContent = sig.length? ('‚ö†Ô∏è '+sig.join('\n')) : 'üü¢ –°–∏–≥–Ω–∞–ª—ñ–≤ –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ';

    // ASCII –≥—Ä–∞—Ñ—ñ–∫–∏
    drawAsciiChart('chartX', data.map(d=>d.mean), xbarbar, LCLx, UCLx, 'XÃÑ');
    drawAsciiChart('chartR', data.map(d=>d.range), rbar, LCLr, UCLr, 'R');

    // –û–Ω–æ–≤–∏—Ç–∏ –∫–≤–∏—Ç–æ–∫/–∂—É—Ä–Ω–∞–ª –ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏
    byId('tChar').textContent = byId('charName').value;
    byId('tXbar').textContent = rnd(xbarbar,3);
    byId('tRbar').textContent = rnd(rbar,3);
    byId('tXlim').textContent = `[${rnd(LCLx,2)}; ${rnd(UCLx,2)}]`;
    byId('tRlim').textContent = `[${rnd(LCLr,2)}; ${rnd(UCLr,2)}]`;
    byId('tCap').textContent  = `Cp=${Cp}; Cpk=${Cpk}`;
    byId('tSig').textContent  = sig.length? sig[0] : '‚Äî';
  }

  function drawAsciiChart(elId, arr, center, LCL, UCL, label){
    // –ù–æ—Ä–º—É—î–º–æ –Ω–∞ —Ä—è–¥–æ–∫ 60 —Å–∏–º–≤–æ–ª—ñ–≤
    const width=60;
    const min = Math.min(...arr, LCL);
    const max = Math.max(...arr, UCL);
    const scale = (x)=> Math.round((x-min)/(max-min||1)*(width-1));
    const lines = [];
    lines.push(`${label} chart: min=${rnd(min,2)} center=${rnd(center,2)} max=${rnd(max,2)}`);
    const posL=scale(LCL), posC=scale(center), posU=scale(UCL);
    lines.push('|'+' '.repeat(posL)+'L'+' '.repeat(Math.max(0,posC-posL-1))+'C'+' '.repeat(Math.max(0,posU-posC-1))+'U'+ ' '.repeat(Math.max(0,width-posU-1))+'|');
    arr.forEach((v,i)=>{
      const p=scale(v);
      let row = new Array(width).fill(' ');
      row[posL]='|'; row[posU]='|'; row[posC]='|';
      row[p] = (v<UCL && v>LCL)? '*' : '‚úñ';
      lines.push(String(i+1).padStart(2,'0')+' '+row.join(''));
    });
    byId(elId).textContent = lines.join('\n');
  }

  // ===== NCR/CAPA =====
  const bodyNCR = byId('bodyNCR');
  function addNCR(sample){
    const s = Object.assign({desc:'–í–∏—Ö—ñ–¥ —Ç–æ—á–∫–∏ –∑–∞ UCL XÃÑ', root:'–¢—Ä–µ–Ω–¥ —É –¥–æ–∑–∞—Ç–æ—Ä—ñ', corr:'–ü–µ—Ä–µ–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤–∞–≥—É', prev:'–ü–ª–∞–Ω –∫–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è —â–æ—Ç–∏–∂–Ω—è', resp:'–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢', due:(new Date().toISOString().slice(0,10))}, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.desc}"></td>
      <td class="dark"><input type="text" value="${s.root}"></td>
      <td class="dark"><input type="text" value="${s.corr}"></td>
      <td class="dark"><input type="text" value="${s.prev}"></td>
      <td><input type="text" value="${s.resp}"></td>
      <td><input type="date" value="${s.due}"></td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyNCR); buildCSV_NCR();">‚úñ</button></td>
    `;
    bodyNCR.appendChild(tr); reindex(bodyNCR); buildCSV_NCR();
  }
  function presetNCR(){
    bodyNCR.innerHTML='';
    addNCR({desc:'7 –ø—ñ–¥—Ä—è–¥ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è XÃÑ', root:'–ü–æ–≤—ñ–ª—å–Ω–∏–π –¥—Ä–µ–π—Ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ —Ä–æ–∑—Å–æ–ª—É', corr:'–û—Ö–æ–ª–æ–¥–∏—Ç–∏ —Ä–æ–∑—Å—ñ–ª –¥–æ 2‚Äì3¬∞C', prev:'–ö–æ–Ω—Ç—Ä–æ–ª—å T –∫–æ–∂–Ω—ñ 30 —Ö–≤', resp:'–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢', due:new Date().toISOString().slice(0,10)});
  }
  function buildCSV_NCR(){
    const rows=[...bodyNCR.querySelectorAll('tr')].map(r=>{
      return [
        r.querySelector('.idx').textContent.trim(),
        r.children[1].querySelector('input').value.trim(),
        r.children[2].querySelector('input').value.trim(),
        r.children[3].querySelector('input').value.trim(),
        r.children[4].querySelector('input').value.trim(),
        r.children[5].querySelector('input').value.trim(),
        r.children[6].querySelector('input').value.trim()
      ].join(' | ');
    });
    byId('csvNCR').textContent = rows.join('\n') || '‚Äî';
  }

  // ===== –ñ–£–†–ù–ê–õ / QR / NFC / –¢–ò–ö–ï–¢ =====
  const bodyLog = byId('bodyLog');
  function addLog(){
    const summary = byId('sumOut').textContent || '';
    const sigs = byId('sigOut').textContent || '‚Äî';
    // –≤–∏—Ç—è–≥–Ω–µ–º–æ –º–µ–∂—ñ
    const mX = summary.match(/–ú–µ–∂—ñ XÃÑ: \[([0-9.\-]+); ([0-9.\-]+)\]/);
    const mR = summary.match(/–ú–µ–∂—ñ R: \[([0-9.\-]+); ([0-9.\-]+)\]/);
    const cap = (summary.match(/Cp=([0-9.]+); Cpk=([0-9.]+)/) || []).slice(1).join('/');
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${byId('charName').value}"></td>
      <td class="dark">${mX?`[${mX[1]}; ${mX[2]}]`:'‚Äî'}</td>
      <td class="dark">${mR?`[${mR[1]}; ${mR[2]}]`:'‚Äî'}</td>
      <td>${cap||'‚Äî'}</td>
      <td>${sigs.length>2? '–Ñ —Å–∏–≥–Ω–∞–ª–∏' : '–ù–µ–º–∞—î'}</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyLog); buildCSV_Log();">‚úñ</button></td>
    `;
    bodyLog.appendChild(tr); reindex(bodyLog); buildCSV_Log();
  }
  function buildCSV_Log(){
    const rows=[...bodyLog.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const ch=r.children[1].querySelector('input').value.trim();
      const x=r.children[2].textContent.trim();
      const R=r.children[3].textContent.trim();
      const cap=r.children[4].textContent.trim();
      const sig=r.children[5].textContent.trim();
      return [idx,ch,x,R,cap,sig].join(' | ');
    });
    byId('csvLog').textContent = rows.join('\n') || '‚Äî';
  }
  function buildQR(){
    const payload = {
      char: byId('charName').value,
      summary: byId('sumOut').textContent,
      signals: byId('sigOut').textContent.slice(0,120)+'‚Ä¶'
    };
    byId('qrOut').textContent = JSON.stringify(payload);
  }
  function buildNFC(){
    const txt = [
      `SPC_CARD`,
      `CHAR:${byId('charName').value}`,
      `SUM:${byId('sumOut').textContent}`,
      `SIG:${byId('sigOut').textContent.slice(0,100)}`,
      `OPER:${byId('nfcOper').value} CONTACT:${byId('nfcPhone').value}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = txt;
  }
  function scrollTicket(){ byId('ticket').scrollIntoView({behavior:'smooth',block:'center'}); }

  // ===== INIT =====
  (function init(){
    // —Å—Ç–∞—Ä—Ç–æ–≤–∏–π –Ω–µ–≤–µ–ª–∏–∫–∏–π –Ω–∞–±—ñ—Ä
    presetData();
    document.addEventListener('change', e=>{
      if(e.target.matches('input,select,textarea')){
        if(e.target.closest('#tbl')){ buildCSV_Raw(); recalc(); }
        if(['lsl','tgt','usl','n','k'].includes(e.target.id)){ recalc(); }
      }
    });
  })();
</script>
</body>
</html>
