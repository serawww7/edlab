<!-- tech_para7.html
     –ü–ê–†–ê 7 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–≤ –∑ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞
     –¢–µ–º–∞: –ö–û–ù–¢–†–û–õ–¨ –Ø–ö–û–°–¢–Ü –ì–û–¢–û–í–û–á –ü–†–û–î–£–ö–¶–Ü–á ‚Äî –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, –∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏, pH/aw,
           –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å, –µ—Ç–∏–∫–µ—Ç–∫–∞/—à—Ç—Ä–∏—Ö–∫–æ–¥, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC, CSV-–∂—É—Ä–Ω–∞–ª.
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏; (–æ–ø—Ü.) —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º; NFC-–º—ñ—Ç–∫–∏; (–∑–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ) —Ç–µ—Å—Ç-–∫—É–ª—è –¥–ª—è –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ç–æ—Ä–∞.
     –ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 7 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî QC: –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, –º–∞—Å–∞, pH/aw, –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å, –µ—Ç–∏–∫–µ—Ç–∫–∞, –∫–≤–∏—Ç–æ–∫/NFC/CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,Monaco,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  textarea{min-height:84px}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ –≤ Moodle (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

<meta name="description" content="–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏ –≤–∏–∫–æ–Ω–∞—é—Ç—å –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä—Ç—ñ—ó –≥–æ—Ç–æ–≤–æ—ó –ø—Ä–æ–¥—É–∫—Ü—ñ—ó: (1) –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, (2) –∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏, (3) pH —Ç–∞ aw (–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–æ–¥–∏) ‚Äî –≤–Ω–æ—Å–∏–º–æ –¥–∞–Ω"><link rel="canonical" href="https://edlab.pp.ua/tech_II_kyrs/tech_para7.html"><meta property="og:type" content="article"><meta property="og:title" content="üß™ QC: –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, –º–∞—Å–∞, pH/aw, –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å, –µ—Ç–∏–∫–µ—Ç–∫–∞, –∫–≤–∏—Ç–æ–∫/NFC/CSV"><meta property="og:description" content="–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏ –≤–∏–∫–æ–Ω–∞—é—Ç—å –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä—Ç—ñ—ó –≥–æ—Ç–æ–≤–æ—ó –ø—Ä–æ–¥—É–∫—Ü—ñ—ó: (1) –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, (2) –∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏, (3) pH —Ç–∞ aw (–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–æ–¥–∏) ‚Äî –≤–Ω–æ—Å–∏–º–æ –¥–∞–Ω"><meta property="og:url" content="https://edlab.pp.ua/tech_II_kyrs/tech_para7.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üß™ QC: –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, –º–∞—Å–∞, pH/aw, –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å, –µ—Ç–∏–∫–µ—Ç–∫–∞, –∫–≤–∏—Ç–æ–∫/NFC/CSV","description":"–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏ –≤–∏–∫–æ–Ω–∞—é—Ç—å –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä—Ç—ñ—ó –≥–æ—Ç–æ–≤–æ—ó –ø—Ä–æ–¥—É–∫—Ü—ñ—ó: (1) –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, (2) –∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏, (3) pH —Ç–∞ aw (–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–æ–¥–∏) ‚Äî –≤–Ω–æ—Å–∏–º–æ –¥–∞–Ω","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/tech_II_kyrs/tech_para7.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 7 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –ø–µ—Ä–µ—Ä–æ–±–∫–∏</span>
  <h1>üß™ QC: –º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è, –º–∞—Å–∞, pH/aw, –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å, –µ—Ç–∏–∫–µ—Ç–∫–∞, –∫–≤–∏—Ç–æ–∫/NFC/CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –ø–∞—Ä–∏</h2>
    <p>
      –ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏ –≤–∏–∫–æ–Ω–∞—é—Ç—å –ø–æ–≤–Ω–∏–π <b>–∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä—Ç—ñ—ó –≥–æ—Ç–æ–≤–æ—ó –ø—Ä–æ–¥—É–∫—Ü—ñ—ó</b>:
      (1) <b>–º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è</b>, (2) <b>–∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏</b>, (3) <b>pH</b> —Ç–∞ <b>aw</b> (–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–æ–¥–∏) ‚Äî –≤–Ω–æ—Å–∏–º–æ –¥–∞–Ω—ñ –≤—Ä—É—á–Ω—É,
      (4) <b>–≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å/–≤–∞–∫—É—É–º</b>, (5) <b>–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –µ—Ç–∏–∫–µ—Ç–∫–∏/—à—Ç—Ä–∏—Ö–∫–æ–¥—É</b>, (6) <b>–∂—É—Ä–Ω–∞–ª</b>, <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>, <b>NFC</b> —ñ <b>CSV</b>.
    </p>
    <p class="small muted">–¶–µ –Ω–∞–≤—á–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å –ö–ö–¢. –§–∞–∫—Ç–∏—á–Ω—ñ –º–µ–∂—ñ/–ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –∑–∞—Ç–≤–µ—Ä–¥–∂—É—é—Ç—å—Å—è —É –≤–∞—à–æ–º—É HACCP-–ø–ª–∞–Ω—ñ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è—Ö –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞.</p>
  </div>

  <!-- 1. –î–ê–ù–Ü –ü–ê–†–¢–Ü–á -->
  <div class="card">
    <h2>üì¶ –î–∞–Ω—ñ –ø–∞—Ä—Ç—ñ—ó</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è</h3>
        <div class="row">
          <div style="flex:1"><label>–í–∏—Ä—ñ–±</label><input id="prodName" type="text" value="–°–æ—Å–∏—Å–∫–∏ –º–æ–ª–æ—á–Ω—ñ"></div>
          <div style="flex:1"><label>–õ–û–¢</label><input id="lot" type="text" value="S-25047-M1"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>EAN-13</label><input id="ean13" type="text" value="4820001234567"></div>
          <div style="flex:1"><label>–ö-—Ç—å —É–ø–∞–∫–æ–≤–æ–∫</label><input id="packs" type="number" step="1" value="50"></div>
        </div>
      </div>

      <div class="box">
        <h3>–ú–∞—Å–∞ –Ω–µ—Ç—Ç–æ</h3>
        <div class="row">
          <div style="flex:1"><label>–ù–æ–º—ñ–Ω–∞–ª, –≥</label><input id="netNom" type="number" step="1" value="400"></div>
          <div style="flex:1"><label>–î–æ–ø—É—Å–∫, % (¬±)</label><input id="tolPct" type="number" step="0.1" value="2.5"></div>
        </div>
        <p class="small muted">–ö–æ–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤ –º–µ–∂–∞—Ö –Ω–æ–º—ñ–Ω–∞–ª—É ¬± –¥–æ–ø—É—Å–∫; —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å–µ—Ä–µ–¥–Ω—î.</p>
      </div>

      <div class="box">
        <h3>pH / aw / –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å</h3>
        <div class="row">
          <div style="flex:1"><label>–¶—ñ–ª—å pH (–¥—ñ–∞–ø–∞–∑–æ–Ω)</label><input id="phMin" type="number" step="0.01" value="5.8"></div>
          <div style="flex:1"><label>¬∑¬∑</label><input id="phMax" type="number" step="0.01" value="6.4"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ú–∞–∫—Å. aw</label><input id="awMax" type="number" step="0.001" value="0.970"></div>
          <div style="flex:1"><label>–ú—ñ–Ω. –≤–∞–∫—É—É–º, –∫–ü–∞</label><input id="vacMin" type="number" step="0.1" value="30.0"></div>
        </div>
      </div>
    </div>
    <div class="row" style="margin-top:6px">
      <button class="btn" onclick="calcLimits()">üìè –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –º–µ–∂—ñ</button>
      <button class="btn" onclick="copyCSV('csvBatch')">üìã CSV (batch)</button>
    </div>
    <div id="csvBatch" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 2. –ú–ï–¢–ê–õ–û–î–ï–¢–ï–ö–¶–Ü–Ø -->
  <div class="card">
    <h2>üß≤ –ú–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <div style="flex:1"><label>–û—Ç–≤—ñ—Ä (–∞–ø–µ—Ä—Ç—É—Ä–∞), –º–º</label><input id="aperture" type="number" step="1" value="120"></div>
          <div style="flex:1"><label>–ß—É—Ç–ª–∏–≤—ñ—Å—Ç—å (—Ä–µ—Ñ.)</label>
            <select id="sens">
              <option>–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
              <option>–ü—ñ–¥–≤–∏—â–µ–Ω–∞</option>
              <option>–í–∏—Å–æ–∫–∞</option>
            </select>
          </div>
        </div>
        <p class="small muted">–†–µ—Ñ–µ—Ä–µ–Ω—Å-—Ç—ñ–ª–∞: Fe, Non-Fe, SS (–Ω–µ—Ä–∂.). –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∫—É–ª—å–∫–∏ –∑–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—î—é –≤–∏—Ä–æ–±–Ω–∏–∫–∞.</p>
      </div>

      <div class="box">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É</h3>
        <div class="row">
          <div style="flex:1"><label>Fe, –º–º (–≤–∏—è–≤–ª–µ–Ω–æ ‚â§)</label><input id="fe_mm" type="number" step="0.1" value="2.0"></div>
          <div style="flex:1"><label>Non-Fe, –º–º (–≤–∏—è–≤–ª–µ–Ω–æ ‚â§)</label><input id="nfe_mm" type="number" step="0.1" value="2.5"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>SS, –º–º (–≤–∏—è–≤–ª–µ–Ω–æ ‚â§)</label><input id="ss_mm" type="number" step="0.1" value="3.0"></div>
          <div style="flex:1"><label>–§–∞–ª—å—à-—Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–Ω–Ω—è</label>
            <select id="falseTrig"><option>–ù—ñ</option><option>–¢–∞–∫</option></select>
          </div>
        </div>
      </div>

      <div class="box">
        <h3>–ü—ñ–¥—Å—É–º–æ–∫</h3>
        <p>–°—Ç–∞—Ç—É—Å: <b><span id="mdStatus">‚Äî</span></b></p>
        <p>–ü–æ—Ä–æ–≥–æ–≤—ñ –∫—É–ª—å–∫–∏ (—Ä–µ—Ñ.): <b><span id="mdRef">‚Äî</span></b></p>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="evalMetal()">‚úÖ –û—Ü—ñ–Ω–∏—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvMD')">üìã CSV (MD)</button>
        </div>
        <div id="csvMD" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 3. –ö–û–ù–¢–†–û–õ–¨ –ú–ê–°–ò -->
  <div class="card">
    <h2>‚öñÔ∏è –ö–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏</h2>
    <div class="row">
      <button class="btn" onclick="addWeight()">‚ûï –î–æ–¥–∞—Ç–∏ –∑–≤–∞–∂—É–≤–∞–Ω–Ω—è</button>
      <button class="btn" onclick="presetWeights()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="evaluateWeights()">‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
      <button class="btn" onclick="copyCSV('csvWeights')">üìã CSV (weights)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblW">
        <thead>
          <tr>
            <th>#</th>
            <th>–ß–∞—Å</th>
            <th class="dark">–ü–æ–∫–∞–∑, –≥</th>
            <th>–í –º–µ–∂–∞—Ö?</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyW"></tbody>
      </table>
    </div>
    <div id="wSummary" class="out" style="margin-top:8px">‚Äî</div>
    <div id="csvWeights" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 4. pH / aw / –ì–ï–†–ú–ï–¢–ò–ß–ù–Ü–°–¢–¨ / –ï–¢–ò–ö–ï–¢–ö–ê -->
  <div class="card">
    <h2>üß´ pH / aw / –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å / –µ—Ç–∏–∫–µ—Ç–∫–∞</h2>
    <div class="grid g2">
      <div class="box">
        <h3>–í–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <div style="flex:1"><label>pH</label><input id="phVal" type="number" step="0.01" value="6.10"></div>
          <div style="flex:1"><label>aw</label><input id="awVal" type="number" step="0.001" value="0.965"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–í–∞–∫—É—É–º, –∫–ü–∞</label><input id="vacVal" type="number" step="0.1" value="32.0"></div>
          <div style="flex:1"><label>–¢–µ—Å—Ç –≥–µ—Ä–º–µ—Ç–∏—á–Ω.</label>
            <select id="sealOk"><option>–û–∫</option><option>–ü—Ä–æ–±–ª–µ–º–∞</option></select>
          </div>
        </div>
      </div>

      <div class="box">
        <h3>–ï—Ç–∏–∫–µ—Ç–∫–∞/—à—Ç—Ä–∏—Ö–∫–æ–¥</h3>
        <div class="row">
          <div style="flex:1"><label>–î–∞—Ç–∞ ‚Äú–≤–∂–∏—Ç–∏ –¥–æ‚Äù</label><input id="expDate" type="date"></div>
          <div style="flex:1"><label>–†–æ–∑–±—ñ—Ä–ª–∏–≤—ñ—Å—Ç—å –¥—Ä—É–∫—É</label>
            <select id="printQual"><option>–î–æ–±—Ä–∞</option><option>–ü–æ—Å–µ—Ä–µ–¥–Ω—è</option><option>–ü–æ–≥–∞–Ω–∞</option></select>
          </div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="evalLab()">‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvLab')">üìã CSV (lab)</button>
        </div>
        <div id="labOut" class="out" style="margin-top:8px">‚Äî</div>
        <div id="csvLab" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 5. –ñ–£–†–ù–ê–õ + –ö–í–ò–¢–û–ö 58 –º–º + NFC -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª / –ö–≤–∏—Ç–æ–∫ / NFC</h2>
    <div class="row">
      <button class="btn" onclick="addLog()">‚ûï –î–æ–¥–∞—Ç–∏ —É –∂—É—Ä–Ω–∞–ª</button>
      <button class="btn" onclick="presetLog()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (journal)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblLog">
        <thead>
          <tr>
            <th>#</th>
            <th>–í–∏—Ä—ñ–±</th>
            <th class="dark">–õ–û–¢</th>
            <th class="dark">EAN-13</th>
            <th>MD</th>
            <th>–ú–∞—Å–∞</th>
            <th>pH/aw</th>
            <th>–ì–µ—Ä–º–µ—Ç.</th>
            <th>–ï—Ç–∏–∫–µ—Ç–∫–∞</th>
            <th>–í–∏—Å–Ω–æ–≤–æ–∫</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyLog"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>

    <div class="grid g2" style="margin-top:12px">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúQC BATCH CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          <div style="flex:1"><label>–û–ø–µ—Ä–∞—Ç–æ—Ä</label><input id="operator" type="text" value="–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ 58 –º–º</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>QC CHECK TICKET</h4>
          <p><b>–í–∏—Ä—ñ–±:</b> <span id="tProd">‚Äî</span></p>
          <p><b>–õ–û–¢:</b> <span id="tLot">‚Äî</span></p>
          <p><b>EAN-13:</b> <span id="tEAN">‚Äî</span></p>
          <div class="line"></div>
          <p><b>MD:</b> <span id="tMD">‚Äî</span></p>
          <p><b>–ú–∞—Å–∞:</b> <span id="tW">‚Äî</span></p>
          <p><b>pH/aw:</b> <span id="tPA">‚Äî</span></p>
          <p><b>–ì–µ—Ä–º–µ—Ç.:</b> <span id="tSeal">‚Äî</span></p>
          <p><b>–ï—Ç–∏–∫–µ—Ç–∫–∞:</b> <span id="tLab">‚Äî</span></p>
          <div class="line"></div>
          <p><b>–í–∏—Å–Ω–æ–≤–æ–∫:</b> <span id="tVerdict">‚Äî</span></p>
          <div class="line"></div>
          <p><small>–ö–ö–¢: –ú–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ç–æ—Ä/–ú–∞—Å–∞/–ú–∞—Ä–∫—É–≤–∞–Ω–Ω—è ‚Äî –∑–≥—ñ–¥–Ω–æ –∑ HACCP-–ø–ª–∞–Ω–æ–º.</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 6. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞–Ω—ñ –ø–∞—Ä—Ç—ñ—ó; –∑–∞–¥–∞–π—Ç–µ –º–µ–∂—ñ pH/aw/–≤–∞–∫—É—É–º.</li>
      <li>–í–Ω–µ—Å—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ <b>–º–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—ó</b> —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ‚Äú–û—Ü—ñ–Ω–∏—Ç–∏‚Äù.</li>
      <li>–ó—Ä–æ–±—ñ—Ç—å 8‚Äì12 –∑–≤–∞–∂—É–≤–∞–Ω—å, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å.</li>
      <li>–í–Ω–µ—Å—ñ—Ç—å pH, aw, –≤–∞–∫—É—É–º —ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—ñ; –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –µ—Ç–∏–∫–µ—Ç–∫—É.</li>
      <li>–î–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫ —É –∂—É—Ä–Ω–∞–ª, —Å—Ñ–æ—Ä–º—É–π—Ç–µ NFC —ñ –∫–≤–∏—Ç–æ–∫, —Å–∫–æ–ø—ñ—é–π—Ç–µ CSV.</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ú–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è: –∫–æ—Ä–µ–∫—Ç–Ω—ñ –ø–æ—Ä–æ–≥–∏ —ñ –≤–∏—Å–Ω–æ–≤–æ–∫</td><td>3</td></tr>
        <tr><td>–ö–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏: –≤–∏–±—ñ—Ä–∫–∞, —Å–µ—Ä–µ–¥–Ω—î, –≤—ñ–¥—Å–æ—Ç–æ–∫ –±—Ä–∞–∫—É</td><td>3</td></tr>
        <tr><td>pH/aw/–≤–∞–∫—É—É–º/–≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å/–µ—Ç–∏–∫–µ—Ç–∫–∞</td><td>3</td></tr>
        <tr><td>–ñ—É—Ä–Ω–∞–ª + –∫–≤–∏—Ç–æ–∫/NFC + CSV</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  const pad2 = n => String(n).padStart(2,'0');

  // ===== CSV/–∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è =====
  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // ===== 1) –ú–µ–∂—ñ –º–∞—Å–∏ —Ç–∞ CSV –ø–∞—Ä—Ç—ñ—ó =====
  function calcLimits(){
    const nom = +byId('netNom').value||0;
    const tol = (+byId('tolPct').value||0)/100;
    const low = nom*(1 - tol), high = nom*(1 + tol);
    byId('csvBatch').textContent =
      `BATCH|prod=${byId('prodName').value}|lot=${byId('lot').value}|ean13=${byId('ean13').value}|packs=${byId('packs').value}\n`+
      `WEIGHT_LIMITS|nom=${nom}g|tol=¬±${rnd(tol*100,1)}%|low=${rnd(low,1)}g|high=${rnd(high,1)}g\n`+
      `PH=${byId('phMin').value}..${byId('phMax').value}|aw_max=${byId('awMax').value}|vac_min=${byId('vacMin').value}kPa`;
    return {low, high};
  }

  // ===== 2) –ú–µ—Ç–∞–ª–æ–¥–µ—Ç–µ–∫—Ü—ñ—è =====
  function mdRefs(){
    // –°–ø—Ä–æ—â–µ–Ω—ñ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å-–º–µ–∂—ñ, –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —á—É—Ç–ª–∏–≤–æ—Å—Ç—ñ (–¥–µ–º–æ)
    const sens = byId('sens').value;
    if(sens==='–í–∏—Å–æ–∫–∞')   return {Fe:2.0, NFe:2.5, SS:3.0};
    if(sens==='–ü—ñ–¥–≤–∏—â–µ–Ω–∞')return {Fe:2.5, NFe:3.0, SS:3.5};
    return {Fe:3.0, NFe:3.5, SS:4.0};
  }
  function evalMetal(){
    const ref = mdRefs();
    const fe = +byId('fe_mm').value||999;
    const nfe= +byId('nfe_mm').value||999;
    const ss = +byId('ss_mm').value||999;
    const ft = byId('falseTrig').value==='–¢–∞–∫';
    const pass = (fe<=ref.Fe && nfe<=ref.NFe && ss<=ref.SS && !ft);
    byId('mdStatus').textContent = pass? 'üü¢ PASS' : 'üî¥ FAIL';
    byId('mdStatus').style.color = pass? '#10b981' : '#ef4444';
    byId('mdRef').textContent = `Fe ‚â§ ${ref.Fe} –º–º; Non-Fe ‚â§ ${ref.NFe} –º–º; SS ‚â§ ${ref.SS} –º–º; false-trigger: –Ω—ñ`;
    byId('csvMD').textContent =
      `MD|aperture=${byId('aperture').value}mm|sens=${byId('sens').value}|fe=${fe}mm|nonfe=${nfe}mm|ss=${ss}mm|falseTrig=${ft?'yes':'no'}|status=${pass?'PASS':'FAIL'}`;
    return pass;
  }

  // ===== 3) –ö–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å–∏ =====
  const bodyW = byId('bodyW');
  function reindex(tb){ [...tb.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function nowHHMM(){ const d=new Date(); return pad2(d.getHours())+':'+pad2(d.getMinutes()); }
  function limits(){ const nom=+byId('netNom').value||0; const tol=(+byId('tolPct').value||0)/100; return {low:nom*(1-tol), high:nom*(1+tol)}; }
  function addWeight(sample){
    const s = Object.assign({time: nowHHMM(), g:''}, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="time" value="${s.time}"></td>
      <td class="dark"><input type="number" step="0.1" value="${s.g}"></td>
      <td class="wok">‚Äî</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyW); buildWCSV();">‚úñ</button></td>
    `;
    bodyW.appendChild(tr); reindex(bodyW); buildWCSV();
  }
  function presetWeights(){
    bodyW.innerHTML='';
    addWeight({g:402.3}); addWeight({g:398.9}); addWeight({g:401.2}); addWeight({g:396.8});
    addWeight({g:405.0}); addWeight({g:399.6}); addWeight({g:403.4}); addWeight({g:397.5});
    evaluateWeights();
  }
  function evaluateWeights(){
    const {low,high} = limits();
    const rows=[...bodyW.querySelectorAll('tr')];
    let ok=0, sum=0, n=0;
    rows.forEach(r=>{
      const g = Number(r.children[2].querySelector('input').value);
      if(!isNaN(g)){ n++; sum+=g; const pass=(g>=low && g<=high);
        r.children[3].textContent = pass?'–≤ –º–µ–∂–∞—Ö':'–ø–æ–∑–∞ –º–µ–∂–∞–º–∏';
        r.children[3].style.color = pass? '#10b981' : '#ef4444';
        if(pass) ok++;
      } else { r.children[3].textContent='–Ω/–¥'; r.children[3].style.color='#f59e0b'; }
    });
    const avg = n? sum/n : 0;
    const passAll = (ok===n && avg>=low && avg<=high);
    const msg = `–í–∏–±—ñ—Ä–∫–∞: ${n} —à—Ç; –≤ –º–µ–∂–∞—Ö: ${ok}; —Å–µ—Ä–µ–¥–Ω—î: ${rnd(avg,1)} –≥ (–º–µ–∂—ñ ${rnd(low,1)}‚Ä¶${rnd(high,1)} –≥) ‚Äî ${passAll?'üü¢ PASS':'üü† MIXED'}`;
    byId('wSummary').textContent = msg;
    buildWCSV();
    return {n, ok, avg, low, high, passAll};
  }
  function buildWCSV(){
    const lines=[...bodyW.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const tm=r.children[1].querySelector('input').value.trim();
      const g=r.children[2].querySelector('input').value.trim();
      const st=r.children[3].textContent.trim();
      return [idx,tm,g,st].join(' | ');
    });
    byId('csvWeights').textContent = lines.join('\n') || '‚Äî';
  }

  // ===== 4) pH/aw/–≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å/–µ—Ç–∏–∫–µ—Ç–∫–∞ =====
  function evalLab(){
    const ph = +byId('phVal').value, pmin=+byId('phMin').value, pmax=+byId('phMax').value;
    const aw = +byId('awVal').value, awMax=+byId('awMax').value;
    const vac= +byId('vacVal').value, vacMin=+byId('vacMin').value;
    const seal = byId('sealOk').value==='–û–∫';
    const ean = byId('ean13').value.replace(/\D/g,'');
    const eanOk = ean.length===13;
    const expOk = !!byId('expDate').value;
    const print = byId('printQual').value;
    const phOk = (!isNaN(ph) && ph>=pmin && ph<=pmax);
    const awOk = (!isNaN(aw) && aw<=awMax);
    const vacOk= (!isNaN(vac) && vac>=vacMin);

    const status = (phOk&&awOk&&vacOk&&seal&&eanOk&&expOk&&print!=='–ü–æ–≥–∞–Ω–∞')?'üü¢ PASS':'üü† REVIEW';
    const text = [
      `pH=${ph} (–Ω–æ—Ä–º–∞ ${pmin}‚Ä¶${pmax}) ‚Äî ${phOk?'–æ–∫':'–Ω—ñ'}`,
      `aw=${aw} (‚â§${awMax}) ‚Äî ${awOk?'–æ–∫':'–Ω—ñ'}`,
      `Vac=${vac}–∫–ü–∞ (‚â•${vacMin}) ‚Äî ${vacOk?'–æ–∫':'–Ω—ñ'}`,
      `–ì–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å ‚Äî ${seal?'–æ–∫':'–ø—Ä–æ–±–ª–µ–º–∞'}`,
      `EAN13(${ean.length}) ‚Äî ${eanOk?'–æ–∫':'–Ω—ñ'}`,
      `–î–∞—Ç–∞ EXP ‚Äî ${expOk?'–∑–∞–¥–∞–Ω–æ':'–≤—ñ–¥—Å—É—Ç–Ω—è'}`,
      `–î—Ä—É–∫ ‚Äî ${print}`
    ].join(' | ');
    byId('labOut').textContent = `STATUS ${status} | ${text}`;
    byId('csvLab').textContent = `LAB|${text}|STATUS=${status.includes('PASS')?'PASS':'REVIEW'}`;
    return {status, phOk, awOk, vacOk, seal, eanOk, expOk, print};
  }

  // ===== 5) –ñ—É—Ä–Ω–∞–ª / –∫–≤–∏—Ç–æ–∫ / NFC =====
  const bodyL = byId('bodyLog');
  function addLog(sample){
    const md = evalMetal();
    const w  = evaluateWeights();
    const lab= evalLab();

    const def = {
      prod: byId('prodName').value,
      lot: byId('lot').value,
      ean: byId('ean13').value,
      mdS: md?'PASS':'FAIL',
      wS:  w.passAll?`PASS (avg ${rnd(w.avg,1)}–≥)`:`MIX`,
      paS: `pH ${byId('phVal').value}/aw ${byId('awVal').value}`,
      seal: (byId('sealOk').value==='–û–∫' && (+byId('vacVal').value)>= (+byId('vacMin').value))?'PASS':'REVIEW',
      labS: lab.status.includes('PASS')?'PASS':'REVIEW',
      verdict: (md && w.passAll && lab.status.includes('PASS'))?'üü¢ –î–û–ü–£–°–¢–ò–¢–ò':'üü† –£–ú–û–í–ù–û/–ü–ï–†–ï–í–Ü–†–ò–¢–ò'
    };
    const s = Object.assign({}, def, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${s.prod}"></td>
      <td class="dark">${s.lot}</td>
      <td class="dark">${s.ean}</td>
      <td>${s.mdS}</td>
      <td>${s.wS}</td>
      <td>${s.paS}</td>
      <td>${s.seal}</td>
      <td>${s.labS}</td>
      <td>${s.verdict}</td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyL); buildLogCSV();">‚úñ</button></td>
    `;
    bodyL.appendChild(tr); reindex(bodyL); buildLogCSV();
    // –û–Ω–æ–≤–∏—Ç–∏ –∫–≤–∏—Ç–æ–∫
    byId('tProd').textContent = s.prod;
    byId('tLot').textContent  = s.lot;
    byId('tEAN').textContent  = s.ean;
    byId('tMD').textContent   = s.mdS;
    byId('tW').textContent    = s.wS;
    byId('tPA').textContent   = s.paS;
    byId('tSeal').textContent = s.seal;
    byId('tLab').textContent  = s.labS;
    byId('tVerdict').textContent = s.verdict;
  }
  function presetLog(){
    presetWeights(); evalMetal(); evalLab(); addLog();
  }
  function buildLogCSV(){
    const rows=[...bodyL.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const prod=r.children[1].querySelector('input').value.trim();
      const lot=r.children[2].textContent.trim();
      const ean=r.children[3].textContent.trim();
      const md=r.children[4].textContent.trim();
      const w =r.children[5].textContent.trim();
      const pa=r.children[6].textContent.trim();
      const se=r.children[7].textContent.trim();
      const lb=r.children[8].textContent.trim();
      const vd=r.children[9].textContent.trim();
      return [idx,prod,lot,ean,md,w,pa,se,lb,vd].join(' | ');
    });
    byId('csvLog').textContent = rows.join('\n') || '‚Äî';
  }
  function buildTicket(){
    window.scrollTo({top: document.getElementById('ticket').getBoundingClientRect().top + window.scrollY - 60, behavior:'smooth'});
  }
  function buildNFC(){
    const txt = [
      `QC_BATCH_NFC`,
      `PROD:${byId('prodName').value} LOT:${byId('lot').value} EAN13:${byId('ean13').value}`,
      `MD:${byId('tMD').textContent} | MASS:${byId('tW').textContent}`,
      `PH_AW:${byId('tPA').textContent} | SEAL:${byId('tSeal').textContent} | LABEL:${byId('tLab').textContent}`,
      `VERDICT:${byId('tVerdict').textContent}`,
      `OPER:${byId('operator').value} CONTACT:${byId('nfcPhone').value}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = txt;
  }

  // ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è / —Å–ª—É—Ö–∞—á—ñ =====
  (function init(){
    const now=new Date(); byId('expDate').value = byId('expDate').value || now.toISOString().slice(0,10);
    calcLimits(); evalMetal(); evaluateWeights(); evalLab();
    document.addEventListener('change', e=>{
      if(e.target.matches('input,select,textarea')) {
        if(e.target.closest('#tblW')) evaluateWeights();
        calcLimits(); buildWCSV(); buildLogCSV();
      }
    });
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>



</body></html>