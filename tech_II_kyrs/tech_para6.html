<!-- tech_para6.html
     –ü–ê–†–ê 6 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–≤ –∑ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ç–≤–∞—Ä–∏–Ω–Ω–∏—Ü—Ç–≤–∞
     –¢–µ–º–∞: –ü–õ–ê–ù–£–í–ê–ù–ù–Ø –¢–ï–†–ú–û–û–ë–†–û–ë–ö–ò ‚Äî –≥—Ä–∞—Ñ—ñ–∫ (Gantt), —Ü–∏–∫–ª –ø–µ—á—ñ/–∫–æ–ø—Ç–∏–ª—å–Ω—ñ, –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å,
           –µ–Ω–µ—Ä–≥–æ—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è, –∫–æ–Ω—Ç—Ä–æ–ª—å T—è–¥—Ä–∞/–≤–∏—Ç—Ä–∏–º–∫–∏, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC, CSV.
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏; (–æ–ø—Ü.) —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º; NFC-–º—ñ—Ç–∫–∏.

     –ü—Ä–∏–º—ñ—Ç–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
     –£–í–ê–ì–ê: —Ü–µ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫. –§–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –≤–∞—Ä–∫–∏/–∫–æ–ø—á–µ–Ω–Ω—è –∑–≤—ñ—Ä—è–π—Ç–µ –∑ –∫–∞—Ä—Ç–∞–º–∏ –ø—Ä–æ—Ü–µ—Å—É –π —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ –∑–∞–≤–æ–¥—É.
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 6 (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏) ‚Äî –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏: –≥—Ä–∞—Ñ—ñ–∫, –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å, –µ–Ω–µ—Ä–≥–æ—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è, –∫–≤–∏—Ç–æ–∫/NFC/CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  textarea{min-height:84px}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ –≤ Moodle (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
  /* "–ì–∞–Ω—Ç" ASCII */
  .bars{font:12px/12px ui-monospace,monospace;white-space:pre;background:#fff;color:#000;padding:8px;border-radius:8px;border:1px solid #e5e7eb;overflow:auto}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

<meta name="description" content="–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –Ω–∞–ª–∞—à—Ç—É—é—Ç—å –ª—ñ–Ω—ñ—é —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏ (–ø—ñ—á/–∫–æ–ø—Ç–∏–ª—å–Ω—è), (2) —Å—Ç–≤–æ—Ä—è—Ç—å –ø–∞—Ä—Ç—ñ—ó, (3) –∑–≥–µ–Ω–µ—Ä—É—é—Ç—å –≥—Ä–∞—Ñ—ñ–∫ (Gantt) —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç—å –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å"><link rel="canonical" href="https://edlab.pp.ua/tech_II_kyrs/tech_para6.html"><meta property="og:type" content="article"><meta property="og:title" content="üî• –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏: –≥—Ä–∞—Ñ—ñ–∫ (Gantt), –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å, –µ–Ω–µ—Ä–≥–æ—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è, –∫–≤–∏—Ç–æ–∫/NFC/CSV"><meta property="og:description" content="–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –Ω–∞–ª–∞—à—Ç—É—é—Ç—å –ª—ñ–Ω—ñ—é —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏ (–ø—ñ—á/–∫–æ–ø—Ç–∏–ª—å–Ω—è), (2) —Å—Ç–≤–æ—Ä—è—Ç—å –ø–∞—Ä—Ç—ñ—ó, (3) –∑–≥–µ–Ω–µ—Ä—É—é—Ç—å –≥—Ä–∞—Ñ—ñ–∫ (Gantt) —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç—å –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å"><meta property="og:url" content="https://edlab.pp.ua/tech_II_kyrs/tech_para6.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üî• –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏: –≥—Ä–∞—Ñ—ñ–∫ (Gantt), –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å, –µ–Ω–µ—Ä–≥–æ—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è, –∫–≤–∏—Ç–æ–∫/NFC/CSV","description":"–ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –Ω–∞–ª–∞—à—Ç—É—é—Ç—å –ª—ñ–Ω—ñ—é —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏ (–ø—ñ—á/–∫–æ–ø—Ç–∏–ª—å–Ω—è), (2) —Å—Ç–≤–æ—Ä—è—Ç—å –ø–∞—Ä—Ç—ñ—ó, (3) –∑–≥–µ–Ω–µ—Ä—É—é—Ç—å –≥—Ä–∞—Ñ—ñ–∫ (Gantt) —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç—å –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/tech_II_kyrs/tech_para6.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 6 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –ø–µ—Ä–µ—Ä–æ–±–∫–∏</span>
  <h1>üî• –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏: –≥—Ä–∞—Ñ—ñ–∫ (Gantt), –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å, –µ–Ω–µ—Ä–≥–æ—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è, –∫–≤–∏—Ç–æ–∫/NFC/CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞ –ø–∞—Ä–∏</h2>
    <p>
      –ó–∞ –∑–∞–Ω—è—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç–∏: (1) –Ω–∞–ª–∞—à—Ç—É—é—Ç—å <b>–ª—ñ–Ω—ñ—é —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏</b> (–ø—ñ—á/–∫–æ–ø—Ç–∏–ª—å–Ω—è), (2) —Å—Ç–≤–æ—Ä—è—Ç—å <b>–ø–∞—Ä—Ç—ñ—ó</b>,
      (3) –∑–≥–µ–Ω–µ—Ä—É—é—Ç—å <b>–≥—Ä–∞—Ñ—ñ–∫ (Gantt)</b> —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç—å <b>–ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å</b>,
      (4) –æ—Ü—ñ–Ω—è—Ç—å <b>–µ–Ω–µ—Ä–≥–æ—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è</b>, (5) –∑–∞—Ñ—ñ–∫—Å—É—é—Ç—å <b>T —è–¥—Ä–∞/–≤–∏—Ç—Ä–∏–º–∫—É</b> —Ç–∞ –æ—Ñ–æ—Ä–º–ª—è—Ç—å <b>CSV, NFC —ñ –∫–≤–∏—Ç–æ–∫ 58 –º–º</b>.
    </p>
    <p class="small muted">–°–ø—Ä–æ—â–µ–Ω–∞ –º–æ–¥–µ–ª—å: —á–∞—Å —Ü–∏–∫–ª—É = <span class="mono">–ø—Ä–æ–≥—Ä—ñ–≤ + (a¬∑–¥—ñ–∞–º–µ—Ç—Ä + b¬∑–Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è/—î–º–Ω—ñ—Å—Ç—å) + –≤–∏—Ç—Ä–∏–º–∫–∞</span>. –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω—é–≤–∞—Ç–∏.</p>
  </div>

  <!-- 1. –ü–ê–†–ê–ú–ï–¢–†–ò –û–ë–õ–ê–î–ù–ê–ù–ù–Ø -->
  <div class="card">
    <h2>üõ†Ô∏è –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü—ñ—á / –∫–æ–ø—Ç–∏–ª—å–Ω—è</h3>
        <div class="row">
          <div style="flex:1"><label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å, –∫–í—Ç</label><input id="powerKW" type="number" step="0.1" value="18.0"></div>
          <div style="flex:1"><label>–Ñ–º–Ω—ñ—Å—Ç—å, –∫–≥/—Ü–∏–∫–ª</label><input id="capacityKg" type="number" step="1" value="300"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ü—Ä–æ–≥—Ä—ñ–≤, —Ö–≤</label><input id="preheatMin" type="number" step="1" value="20"></div>
          <div style="flex:1"><label>–í–∏—Ç—Ä–∏–º–∫–∞ (T—è–¥—Ä–∞), —Ö–≤</label><input id="holdMin" type="number" step="1" value="15"></div>
        </div>
      </div>

      <div class="box">
        <h3>–ú–æ–¥–µ–ª—å —á–∞—Å—É (–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏)</h3>
        <div class="row">
          <div style="flex:1"><label>a ¬∑ –¥—ñ–∞–º–µ—Ç—Ä (—Ö–≤/—Å–º)</label><input id="coefA" type="number" step="0.1" value="2.0"></div>
          <div style="flex:1"><label>b ¬∑ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (—Ö–≤ ¬∑ —î–º–Ω.)</label><input id="coefB" type="number" step="0.1" value="30.0"></div>
        </div>
        <p class="small muted">–¢–µ—Ä–º—ñ–Ω ‚Äúb‚Äù ‚Äî –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —á–∞—Å –ø—Ä–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—ñ —î–º–Ω–æ—Å—Ç—ñ –Ω–∞ 100%. –Ø–∫—â–æ 50% ‚Äî –¥–æ–¥–∞—î—Ç—å—Å—è 0.5¬∑b.</p>
      </div>

      <div class="box">
        <h3>–ö–æ–Ω—Ç—Ä–æ–ª—å T—è–¥—Ä–∞</h3>
        <div class="row">
          <div style="flex:1"><label>–¶—ñ–ª—å T—è–¥—Ä–∞, ¬∞C</label><input id="targetCore" type="number" step="0.1" value="72.0"></div>
          <div style="flex:1"><label>–ú–µ–∂–∞ —á–∞—Å—É –¥–æ—Å—è–≥–Ω., —Ö–≤ (‚â§)</label><input id="timeLimit" type="number" step="1" value="120"></div>
        </div>
        <p class="small muted">–î–æ–ø—É—Å–∫ –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é: –¥–æ—Å—è–≥—Ç–∏ T—è–¥—Ä–∞ ‚â§ –∑–∞–¥–∞–Ω–æ–≥–æ –ª—ñ–º—ñ—Ç—É —á–∞—Å—É.</p>
      </div>
    </div>
    <div class="row" style="margin-top:6px">
      <button class="btn" onclick="buildSchedule()">üßÆ –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫</button>
      <button class="btn" onclick="presetBatches()">üß™ –ü—Ä–∏–∫–ª–∞–¥ –ø–∞—Ä—Ç—ñ–π</button>
      <button class="btn" onclick="copyCSV('csvEquip')">üìã CSV (equip)</button>
    </div>
    <div id="csvEquip" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 2. –ü–ê–†–¢–Ü–á -->
  <div class="card">
    <h2>üì¶ –ü–∞—Ä—Ç—ñ—ó –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</h2>
    <div class="row">
      <button class="btn" onclick="addBatch()">‚ûï –î–æ–¥–∞—Ç–∏ –ø–∞—Ä—Ç—ñ—é</button>
      <button class="btn" onclick="copyCSV('csvBatches')">üìã CSV (batches)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblBatches">
        <thead>
          <tr>
            <th>#</th>
            <th>–í–∏—Ä—ñ–±</th>
            <th class="dark">–ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –∫–≥</th>
            <th class="dark">√ò –±–∞—Ç–æ–Ω–∞, –º–º</th>
            <th class="dark">–ó–∞–ø–ª–∞–Ω. —Å—Ç–∞—Ä—Ç</th>
            <th>–õ–û–¢</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyBatches"></tbody>
      </table>
    </div>
    <div id="csvBatches" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 3. –ì–†–ê–§–Ü–ö (GANTT) + –ü–†–û–ü–£–°–ö–ù–ê –ó–î–ê–¢–ù–Ü–°–¢–¨ + –ï–ù–ï–†–ì–Ü–Ø -->
  <div class="card">
    <h2>üìä –ì—Ä–∞—Ñ—ñ–∫ —Ü–∏–∫–ª—ñ–≤, –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å —ñ –µ–Ω–µ—Ä–≥—ñ—è</h2>
    <div class="grid g2">
      <div class="box">
        <h3>–ü–ª–∞–Ω-–≥—Ä–∞—Ñ—ñ–∫</h3>
        <div id="gantt" class="bars">‚Äî</div>
      </div>
      <div class="box">
        <h3>–ü—ñ–¥—Å—É–º–∫–∏</h3>
        <p>–¶–∏–∫–ª—ñ–≤: <b><span id="sumCycles">‚Äî</span></b></p>
        <p>–ó–∞–π–Ω—è—Ç—ñ—Å—Ç—å –ø–µ—á—ñ: <b><span id="sumHours">‚Äî</span></b> –≥–æ–¥</p>
        <p>–ü–ª–∞–Ω–æ–≤–∞ –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å: <b><span id="sumKg">‚Äî</span></b> –∫–≥/–¥–µ–Ω—å</p>
        <p>–ï–Ω–µ—Ä–≥–æ—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è (–æ—Ü—ñ–Ω–∫–∞): <b><span id="sumKWh">‚Äî</span></b> –∫–í—Ç¬∑–≥–æ–¥</p>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="copyCSV('csvSchedule')">üìã CSV (schedule)</button>
        </div>
        <div id="csvSchedule" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 4. –ö–û–ù–¢–†–û–õ–¨ T—è–¥—Ä–∞ / –í–ò–¢–†–ò–ú–ö–ò (–º—ñ–Ω—ñ-—Ç—Ä–µ–∫–µ—Ä) -->
  <div class="card">
    <h2>üå°Ô∏è –ö–æ–Ω—Ç—Ä–æ–ª—å T—è–¥—Ä–∞ / –≤–∏—Ç—Ä–∏–º–∫–∏</h2>
    <div class="row">
      <button class="btn" onclick="addPoint()">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ—á–∫—É</button>
      <button class="btn" onclick="presetPoints()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="evaluateCore()">‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
      <button class="btn" onclick="copyCSV('csvCoreTrack')">üìã CSV (T-track)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblCore">
        <thead>
          <tr>
            <th>#</th>
            <th>–ß–∞—Å (HH:MM)</th>
            <th class="dark">T—è–¥—Ä–∞, ¬∞C</th>
            <th>√ó</th>
          </tr>
        </thead>
        <tbody id="bodyCore"></tbody>
      </table>
    </div>
    <div id="coreStatus" class="out" style="margin-top:8px">‚Äî</div>
    <div id="csvCoreTrack" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 5. –ñ–£–†–ù–ê–õ + –ö–í–ò–¢–û–ö 58 –º–º + NFC -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª / –ö–≤–∏—Ç–æ–∫ / NFC</h2>
    <div class="row">
      <button class="btn" onclick="addLog()">‚ûï –î–æ–¥–∞—Ç–∏ —É –∂—É—Ä–Ω–∞–ª</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (journal)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblLog">
        <thead>
          <tr>
            <th>#</th>
            <th>–í–∏—Ä—ñ–±</th>
            <th class="dark">–õ–û–¢</th>
            <th class="dark">–°—Ç–∞—Ä—Ç</th>
            <th class="dark">–ö—ñ–Ω–µ—Ü—å</th>
            <th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å, —Ö–≤</th>
            <th>–ï–Ω–µ—Ä–≥—ñ—è, –∫–í—Ç¬∑–≥–æ–¥</th>
            <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          </tr>
        </thead>
        <tbody id="bodyLog"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>

    <div class="grid g2" style="margin-top:12px">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúTHERMAL BATCH CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          <div style="flex:1"><label>–û–ø–µ—Ä–∞—Ç–æ—Ä</label><input id="operator" type="text" value="–°—Ç—É–¥–µ–Ω—Ç –¢–ü–¢"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ 58 –º–º</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>THERMAL CYCLE TICKET</h4>
          <p><b>–í–∏—Ä—ñ–±:</b> <span id="tProd">‚Äî</span></p>
          <p><b>–õ–û–¢:</b> <span id="tLot">‚Äî</span></p>
          <div class="line"></div>
          <p><b>–°—Ç–∞—Ä—Ç:</b> <span id="tStart">‚Äî</span></p>
          <p><b>–ö—ñ–Ω–µ—Ü—å (–ø–ª–∞–Ω):</b> <span id="tEnd">‚Äî</span></p>
          <p><b>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:</b> <span id="tDur">‚Äî</span> —Ö–≤</p>
          <div class="line"></div>
          <p><b>T—è–¥—Ä–∞ —Ü—ñ–ª—å:</b> <span id="tCore">‚Äî</span> ¬∞C ¬∑ <b>–í–∏—Ç—Ä–∏–º–∫–∞:</b> <span id="tHold">‚Äî</span> —Ö–≤</p>
          <p><b>–ï–Ω–µ—Ä–≥—ñ—è:</b> <span id="tKWh">‚Äî</span> –∫–í—Ç¬∑–≥–æ–¥</p>
          <div class="line"></div>
          <p><small>–î–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å –ø—Ä–æ–≥—Ä–∞–º–∏ —Ç–µ—Ä–º–æ–æ–±—Ä–æ–±–∫–∏ —Ç–∞ HACCP.</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 6. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–ó–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–µ—á—ñ —Ç–∞ –º–æ–¥–µ–ª—ñ —á–∞—Å—É.</li>
      <li>–î–æ–¥–∞–π—Ç–µ 3‚Äì5 –ø–∞—Ä—Ç—ñ–π —ñ–∑ –º–∞—Å–æ—é, √ò –±–∞—Ç–æ–Ω–∞ —Ç–∞ —Å—Ç–∞—Ä—Ç-—á–∞—Å–æ–º.</li>
      <li>–ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ –≥—Ä–∞—Ñ—ñ–∫, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –µ–Ω–µ—Ä–≥—ñ—é –π –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å.</li>
      <li>–î–ª—è –æ–¥–Ω—ñ—î—ó –ø–∞—Ä—Ç—ñ—ó –∑–∞—Ñ—ñ–∫—Å—É–π—Ç–µ T—è–¥—Ä–∞/–≤–∏—Ç—Ä–∏–º–∫—É, –¥–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫ —É –∂—É—Ä–Ω–∞–ª, —Å—Ñ–æ—Ä–º—É–π—Ç–µ NFC —ñ –∫–≤–∏—Ç–æ–∫.</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω—ñ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ –º–æ–¥–µ–ª—å —á–∞—Å—É</td><td>3</td></tr>
        <tr><td>–ì—Ä–∞—Ñ—ñ–∫ + –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å + –µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞</td><td>4</td></tr>
        <tr><td>–ö–æ–Ω—Ç—Ä–æ–ª—å T—è–¥—Ä–∞/–≤–∏—Ç—Ä–∏–º–∫–∏ (—Ç—Ä–µ–∫–∏–Ω–≥)</td><td>2</td></tr>
        <tr><td>–ñ—É—Ä–Ω–∞–ª + –∫–≤–∏—Ç–æ–∫/NFC</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  const pad2 = n => String(n).padStart(2,'0');

  // ===== CSV/–∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è =====
  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // ===== –ü–ê–†–¢–Ü–á =====
  const bodyB = byId('bodyBatches');
  function reindex(tb){ [...tb.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function addBatch(sample){
    const s = Object.assign({name:'–ö–æ–≤–±–∞—Å–∞ –≤–∞—Ä–µ–Ω–∞', kg:150, dia:60, start:'08:00', lot:'LOT-0001'}, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.name}"></td>
      <td class="dark"><input type="number" step="1" value="${s.kg}"></td>
      <td class="dark"><input type="number" step="1" value="${s.dia}"></td>
      <td class="dark"><input type="time" value="${s.start}"></td>
      <td><input type="text" value="${s.lot}"></td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyB); buildSchedule();">‚úñ</button></td>
    `;
    bodyB.appendChild(tr); reindex(bodyB); buildBatchesCSV();
  }
  function presetBatches(){
    bodyB.innerHTML='';
    addBatch({name:'–ö–æ–≤–±–∞—Å–∞ –≤–∞—Ä–µ–Ω–∞ ‚Äú–ö–ª–∞—Å–∏—á–Ω–∞‚Äù', kg:180, dia:60, start:'08:00', lot:'K-25041-A'});
    addBatch({name:'–°–æ—Å–∏—Å–∫–∏ –º–æ–ª–æ—á–Ω—ñ', kg:120, dia:25, start:'10:30', lot:'S-25041-B'});
    addBatch({name:'–®–∏–Ω–∫–∞ —Ñ–æ—Ä–º–æ–≤–∞–Ω–∞', kg:200, dia:100, start:'13:30', lot:'H-25041-C'});
    buildSchedule();
  }
  function buildBatchesCSV(){
    const rows = [...bodyB.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const name=r.children[1].querySelector('input').value.trim();
      const kg=r.children[2].querySelector('input').value.trim();
      const dia=r.children[3].querySelector('input').value.trim();
      const start=r.children[4].querySelector('input').value.trim();
      const lot=r.children[5].querySelector('input').value.trim();
      return [idx,name,kg,dia,start,lot].join(' | ');
    });
    byId('csvBatches').textContent = rows.join('\n') || '‚Äî';
  }

  // ===== –†–û–ó–ö–õ–ê–î / –ì–ê–ù–¢–¢ / –ï–ù–ï–†–ì–Ü–Ø =====
  function parseTimeHHMM(t){
    const m=/^(\d{2}):(\d{2})$/.exec(t||'');
    if(!m) return null;
    const d=new Date(); d.setHours(+m[1],+m[2],0,0); return d;
  }
  function minutesBetween(a,b){ return Math.round((b-a)/60000); }
  function addMinutes(date, m){ const d=new Date(date); d.setMinutes(d.getMinutes()+m); return d; }
  function fmtHHMM(d){ return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`; }

  function scheduleOne(batch, ctx){
    // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–æ–¥–µ–ª—ñ
    const cap = +byId('capacityKg').value||300;
    const pre = +byId('preheatMin').value||20;
    const hold= +byId('holdMin').value||15;
    const a = +byId('coefA').value||2.0; // —Ö–≤/—Å–º
    const b = +byId('coefB').value||30.0; // —Ö–≤ –ø—Ä–∏ 100%
    // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —á–∞—Å—É –Ω–∞–≥—Ä—ñ–≤—É
    const dia_cm = (+batch.dia||60)/10; // —Å–º
    const loadFrac = Math.min(1, Math.max(0, (+batch.kg||0)/cap));
    const heatMin = a*dia_cm + b*loadFrac;
    const cycleMin = pre + heatMin + hold;
    // –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è: —Å—Ç–∞—Ä—Ç ‚Äî max(–∑–∞–ø–ª–∞–Ω., –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫—ñ–Ω–µ—Ü—å)
    const startPlan = new Date(Math.max(batch.startTime, ctx.lastEnd));
    const endPlan   = addMinutes(startPlan, Math.ceil(cycleMin));
    // –ï–Ω–µ—Ä–≥—ñ—è
    const kW = +byId('powerKW').value||18;
    const kWh = kW * (minutesBetween(startPlan,endPlan)/60);
    return {
      start: startPlan, end: endPlan,
      duration: Math.ceil(cycleMin),
      pre, heatMin: Math.ceil(heatMin), hold,
      kWh: rnd(kWh,2)
    };
  }

  function buildSchedule(){
    buildBatchesCSV();
    const rows=[...bodyB.querySelectorAll('tr')].map(r=>{
      return {
        name:r.children[1].querySelector('input').value.trim(),
        kg:+r.children[2].querySelector('input').value||0,
        dia:+r.children[3].querySelector('input').value||0,
        start:r.children[4].querySelector('input').value.trim(),
        lot:r.children[5].querySelector('input').value.trim(),
        startTime: parseTimeHHMM(r.children[4].querySelector('input').value.trim())?.getTime() || new Date().setHours(8,0,0,0)
      };
    });
    if(!rows.length){ byId('gantt').textContent='‚Äî'; byId('csvSchedule').textContent='‚Äî'; return; }

    // –ü–æ—Å–æ—Ä—Ç—É—î–º–æ –∑–∞ —Å—Ç–∞—Ä—Ç–æ–º
    rows.sort((a,b)=>a.startTime-b.startTime);

    const lines=[];
    let sumKg=0, sumMin=0, sumKWh=0;
    let ctx={lastEnd: rows[0].startTime};
    lines.push('–ß–ê–°  | –ì–†–ê–§–Ü–ö –¶–ò–ö–õ–Ü–í (‚Äî –ø—Ä–æ–≥—Ä—ñ–≤ ‚ñí –Ω–∞–≥—Ä—ñ–≤ ‚ñà –≤–∏—Ç—Ä–∏–º–∫–∞)\n------------------------------------------------------');

    const segmentsCSV=[];
    rows.forEach((b,i)=>{
      const res = scheduleOne(b, ctx);
      ctx.lastEnd = res.end.getTime();
      sumKg += b.kg;
      sumMin += res.duration;
      sumKWh += +res.kWh;

      // ASCII-–±–∞—Ä: 1 —Å–∏–º–≤–æ–ª ~ 5 —Ö–≤
      const units = Math.max(1, Math.round(res.duration/5));
      const preU = Math.max(0, Math.round(res.pre/5));
      const heatU= Math.max(0, Math.round(res.heatMin/5));
      const holdU= Math.max(0, Math.round(res.hold/5));
      const bar = '‚Äî'.repeat(preU) + '‚ñí'.repeat(heatU) + '‚ñà'.repeat(holdU) + '¬∑'.repeat(Math.max(0, units - preU - heatU - holdU));
      lines.push(`${fmtHHMM(res.start)}‚Äì${fmtHHMM(res.end)} | ${bar}  ${b.name} (${b.kg} –∫–≥, √ò${b.dia} –º–º, –ª–æ—Ç ${b.lot})`);

      segmentsCSV.push(
        `CYCLE|${i+1}|prod=${b.name}|lot=${b.lot}|kg=${b.kg}|dia=${b.dia}mm|start=${fmtHHMM(res.start)}|end=${fmtHHMM(res.end)}|dur_min=${res.duration}|kWh=${res.kWh}`
      );

      // –û–Ω–æ–≤–∏—Ç–∏ –∫–≤–∏—Ç–æ–∫ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –æ—Å—Ç–∞–Ω–Ω—ñ–º —Ü–∏–∫–ª–æ–º –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥—Ä—É–∫—É
      if(i===rows.length-1){
        byId('tProd').textContent = b.name;
        byId('tLot').textContent  = b.lot;
        byId('tStart').textContent= fmtHHMM(res.start);
        byId('tEnd').textContent  = fmtHHMM(res.end);
        byId('tDur').textContent  = res.duration;
        byId('tCore').textContent = byId('targetCore').value || '‚Äî';
        byId('tHold').textContent = byId('holdMin').value || '‚Äî';
        byId('tKWh').textContent  = res.kWh;
      }
    });

    // –í–∏–≤—ñ–¥
    byId('gantt').textContent = lines.join('\n');

    const hours = rnd(sumMin/60,2);
    byId('sumCycles').textContent = rows.length;
    byId('sumHours').textContent  = hours;
    byId('sumKg').textContent     = sumKg;
    byId('sumKWh').textContent    = rnd(sumKWh,2);

    byId('csvSchedule').textContent = segmentsCSV.join('\n');
    byId('csvEquip').textContent = `EQUIP|power=${byId('powerKW').value}kW|capacity=${byId('capacityKg').value}kg|preheat=${byId('preheatMin').value}min|hold=${byId('holdMin').value}min|a=${byId('coefA').value}|b=${byId('coefB').value}|targetCore=${byId('targetCore').value}C|timeLimit=${byId('timeLimit').value}min`;
  }

  // ===== –ö–û–ù–¢–†–û–õ–¨ T—è–¥—Ä–∞ / –í–ò–¢–†–ò–ú–ö–ò =====
  const bodyCore = byId('bodyCore');
  function addPoint(sample){
    const now = new Date();
    const hh = pad2(now.getHours()), mm = pad2(now.getMinutes());
    const s = Object.assign({hms:`${hh}:${mm}`, temp:''}, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="time" value="${s.hms}"></td>
      <td class="dark"><input type="number" step="0.1" value="${s.temp}"></td>
      <td><button class="btn" onclick="this.closest('tr').remove(); reindex(bodyCore); buildCoreCSV();">‚úñ</button></td>
    `;
    bodyCore.appendChild(tr); reindex(bodyCore); buildCoreCSV();
  }
  function presetPoints(){
    bodyCore.innerHTML='';
    addPoint({hms:'10:00', temp:55.0});
    addPoint({hms:'10:20', temp:64.0});
    addPoint({hms:'10:35', temp:70.5});
    addPoint({hms:'10:45', temp:72.3});
    addPoint({hms:'10:55', temp:72.1});
    buildCoreCSV();
  }
  function parseHM(s){
    const m=/^(\d{2}):(\d{2})$/.exec(s||''); if(!m) return null;
    const d=new Date(); d.setHours(+m[1],+m[2],0,0); return d;
  }
  function buildCoreCSV(){
    const rows=[...bodyCore.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const time=r.children[1].querySelector('input').value.trim();
      const t=r.children[2].querySelector('input').value.trim();
      return [idx,time,t].join(' | ');
    });
    byId('csvCoreTrack').textContent = rows.join('\n') || '‚Äî';
  }
  function evaluateCore(){
    const Tt = +byId('targetCore').value||72;
    const limitMin = +byId('timeLimit').value||120;
    const pts = [...bodyCore.querySelectorAll('tr')].map(r=>{
      const time=r.children[1].querySelector('input').value.trim();
      const t=Number(r.children[2].querySelector('input').value);
      const d=parseHM(time); return (d && !isNaN(t))? {d,t}:null;
    }).filter(Boolean).sort((a,b)=>a.d-b.d);
    if(pts.length<2){ byId('coreStatus').textContent='–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ—á–æ–∫'; return; }
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–µ—Ä—à–∏–π –º–æ–º–µ–Ω—Ç T—è–¥—Ä–∞ ‚â• —Ü—ñ–ª—ñ
    let tAch=null;
    for(let i=1;i<pts.length;i++){
      const a=pts[i-1], b=pts[i];
      if( (a.t<Tt && b.t>=Tt) || (a.t>=Tt && b.t<Tt) ){
        // —ñ–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è
        const dt=(b.d-a.d)/60000, dT=b.t-a.t;
        const frac=(Tt - a.t)/dT;
        tAch = new Date(a.d.getTime()+frac*dt*60000);
        break;
      }
      if(a.t>=Tt && !tAch) tAch=a.d;
    }
    // –í–∏—Ç—Ä–∏–º–∫–∞: —á–∞—Å, –ø—Ä–æ—Ç—è–≥–æ–º —è–∫–æ–≥–æ T ‚â• Tt
    let hold=0;
    for(let i=1;i<pts.length;i++){
      const a=pts[i-1], b=pts[i];
      const dt=(b.d-a.d)/60000, T0=a.t, T1=b.t;
      if(T0>=Tt && T1>=Tt) hold+=dt;
      else if((T0>=Tt && T1<Tt) || (T0<Tt && T1>=Tt)){
        const dT=T1-T0; if(dT!==0){
          const frac=(Tt - T0)/dT;
          if(T0>=Tt) hold += Math.max(0, dt*frac);
          else hold += Math.max(0, dt*(1-frac));
        }
      }
    }
    const status = (tAch && hold>= (+byId('holdMin').value||15) && minutesBetween(pts[0].d,tAch) <= limitMin)
      ? 'üü¢ –í–ò–ö–û–ù–ê–ù–û'
      : 'üî¥ –ù–ï –í–ò–ö–û–ù–ê–ù–û';

    const msg = [
      `STATUS: ${status}`,
      `T—è–¥—Ä–∞‚â•${Tt}¬∞C –¥–æ—Å—è–≥–Ω—É—Ç–æ –æ ${tAch?fmtHHMM(tAch):'‚Äî'}`,
      `–í–∏—Ç—Ä–∏–º–∫–∞ ‚â•${byId('holdMin').value} —Ö–≤: —Ñ–∞–∫—Ç–∏—á–Ω–æ ${rnd(hold,0)} —Ö–≤`,
      `–ß–∞—Å –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É —Ç—Ä–µ–∫—É: ${tAch? minutesBetween(pts[0].d,tAch):'‚Äî'} —Ö–≤ (–ª—ñ–º—ñ—Ç ‚â§ ${limitMin})`
    ].join('\n');
    byId('coreStatus').textContent = msg;
  }

  // ===== –ñ–£–†–ù–ê–õ / –ö–í–ò–¢–û–ö / NFC =====
  const bodyL = byId('bodyLog');
  function addLog(sample){
    // –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ü–∏–∫–ª –∑ –≥—Ä–∞—Ñ—ñ–∫–∞ (–∑ –∫–≤–∏—Ç–∫–∞)
    const def = {
      prod: byId('tProd').textContent || '–í–∏—Ä—ñ–±',
      lot: byId('tLot').textContent  || '‚Äî',
      start: byId('tStart').textContent|| '‚Äî',
      end: byId('tEnd').textContent    || '‚Äî',
      dur: byId('tDur').textContent    || '‚Äî',
      kwh: byId('tKWh').textContent    || '‚Äî',
      note:''
    };
    const s = Object.assign({}, def, sample||{});
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="idx">1</td>
      <td><input type="text" value="${s.prod}"></td>
      <td class="dark">${s.lot}</td>
      <td class="dark">${s.start}</td>
      <td class="dark">${s.end}</td>
      <td>${s.dur}</td>
      <td>${s.kwh}</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyL.appendChild(tr); reindex(bodyL); buildLogCSV();
  }
  function buildLogCSV(){
    const rows=[...bodyL.querySelectorAll('tr')].map(r=>{
      const idx=r.querySelector('.idx').textContent.trim();
      const prod=r.children[1].querySelector('input').value.trim();
      const lot=r.children[2].textContent.trim();
      const start=r.children[3].textContent.trim();
      const end=r.children[4].textContent.trim();
      const dur=r.children[5].textContent.trim();
      const kwh=r.children[6].textContent.trim();
      const note=r.children[7].querySelector('input').value.trim();
      return [idx,prod,lot,start,end,dur,kwh,note].join(' | ');
    });
    byId('csvLog').textContent = rows.join('\n') || '‚Äî';
  }
  function buildTicket(){
    // –≤–∂–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π —É buildSchedule() –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –ø–∞—Ä—Ç—ñ—ó
    window.scrollTo({top: document.getElementById('ticket').getBoundingClientRect().top + window.scrollY - 60, behavior:'smooth'});
  }
  function buildNFC(){
    const txt = [
      `THERMAL_BATCH_NFC`,
      `PROD:${byId('tProd').textContent} LOT:${byId('tLot').textContent}`,
      `START:${byId('tStart').textContent} END:${byId('tEnd').textContent} DUR:${byId('tDur').textContent}min`,
      `CORE_TGT:${byId('tCore').textContent}C HOLD:${byId('tHold').textContent}min`,
      `ENERGY:${byId('tKWh').textContent}kWh`,
      `OPER:${byId('operator').value} CONTACT:${byId('nfcPhone').value}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = txt;
  }

  // ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è / —Å–ª—É—Ö–∞—á—ñ =====
  (function init(){
    presetBatches();
    document.addEventListener('change', e=>{
      if(e.target.matches('input,select,textarea')) {
        buildBatchesCSV();
        if(e.target.closest('#tblBatches') || e.target.closest('.box')) buildSchedule();
        buildLogCSV(); buildCoreCSV();
      }
    });
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>



</body></html>