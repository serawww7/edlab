<!-- mechanic_para1.html
     –ü–ê–†–ê 1 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤
     –¢–µ–º–∞: –¶–ò–§–†–û–í–ò–ô –ñ–£–†–ù–ê–õ –¢–û –¢–ê –û–ë–õ–Ü–ö –†–û–ë–Ü–¢ ‚Äî —Ç–µ—Ö–Ω—ñ–∫–∞, –Ω–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ ¬´–∫–æ–ª–∏ –Ω–∞ —Å–µ—Ä–≤—ñ—Å¬ª, —á–µ–∫ 58 –º–º, NFC-—Ç–µ–≥, CSV
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫. –ü—Ä–∞—Ü—é—î –Ω–∞ GitHub Pages / —É Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏, 58 –º–º —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä (USB/BT), NFC-–º—ñ—Ç–∫–∏ (–æ–ø—Ü—ñ–π–Ω–æ), Arduino (–æ–ø—Ü—ñ–π–Ω–æ –¥–ª—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –º–æ—Ç–æ–≥–æ–¥–∏–Ω).

     –©–æ –≤–º—ñ—î:
     ‚Ä¢ –î–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω (ID, –º–æ–¥–µ–ª—å, –º–æ—Ç–æ–≥–æ–¥–∏–Ω–∏, –¥–∞—Ç–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –¢–û, —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¢–û –∑–∞ –º–æ—Ç–æ–≥–æ–¥–∏–Ω–∞–º–∏/–¥–Ω—è–º–∏).
     ‚Ä¢ –ñ—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç: —Ç–∏–ø —Ä–æ–±—ñ—Ç, —Ç—Ä—É–¥–æ–º—ñ—Å—Ç–∫—ñ—Å—Ç—å, –∑–∞–ø—á–∞—Å—Ç–∏–Ω–∏/–º–∞—Ç–µ—Ä—ñ–∞–ª–∏ (–≤–∞—Ä—Ç—ñ—Å—Ç—å).
     ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ ¬´–ö–æ–ª–∏ –Ω–∞ —Å–µ—Ä–≤—ñ—Å¬ª: –∑–∞ –º–æ—Ç–æ–≥–æ–¥–∏–Ω–∞–º–∏ –∞–±–æ –∑–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º.
     ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç—É –¥–ª—è NFC-–º—ñ—Ç–∫–∏ –º–∞—à–∏–Ω–∏ —Ç–∞ —á–µ–∫ 58 –º–º (–Ω–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è).
     ‚Ä¢ –ï–∫—Å–ø–æ—Ä—Ç CSV (–º–∞—à–∏–Ω–∏ / —Ä–æ–±–æ—Ç–∏). –ö–æ–Ω—Ç—Ä–∞—Å—Ç –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–æ –¥–ª—è —Ç–µ–º–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ü–∞—Ä–∞ 1 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –¶–∏—Ñ—Ä–æ–≤–∏–π –∂—É—Ä–Ω–∞–ª –¢–û, —á–µ–∫ 58 –º–º, NFC, CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted); letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  .small{font-size:12px; color:#9fb0c8}
  .muted{color:#93a3b5}
  .pill{display:inline-block; padding:4px 10px; border:1px solid #223049; border-radius:999px; font-size:12px; color:#a5b4fc; background:#0d1a2e; margin-right:6px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:var(--darkcell); color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:8px 10px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left; position:sticky; top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell); color:var(--darkink2)}
  .table td.dark, .table th.dark{background:var(--darkcell) !important; color:var(--darkink2) !important}
  .out{background:var(--darkcell); color:var(--darkink2); border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}

  input[type="text"], input[type="number"], input[type="date"], select, textarea{
    width:100%; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e6eef9
  }

  /* –ß–µ–∫ 58 –º–º */
  .ticket{ width:58mm; background:#fff; color:#000; padding:6mm 4mm; border-radius:6px; box-shadow:0 0 0 1px #e5e7eb inset; font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px; font-size:13px; text-align:center}
  .ticket p{margin:2px 0; font-size:12px}
  .ticket .line{border-top:1px dashed #111; margin:6px 0}
  .ticket small{font-size:10px}

  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}
  html.embedded .box{background:#f8fafc; color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6; color:#111}

  @media print{
    @page{ margin:4mm }
    .no-print{ display:none !important }
  }
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 1 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
    <h1>üîß –¶–∏—Ñ—Ä–æ–≤–∏–π –∂—É—Ä–Ω–∞–ª –¢–û: —Ç–µ—Ö–Ω—ñ–∫–∞, –Ω–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —á–µ–∫ 58 –º–º, NFC, CSV</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>
        –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å <b>–¥–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω</b>, –∑–∞–ø–æ–≤–Ω—é—é—Ç—å <b>–∂—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç</b>, —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—é—Ç—å <b>–∫–æ–ª–∏ –Ω–∞—Å—Ç—É–ø–Ω–µ –¢–û</b>
        (–∑–∞ –º–æ—Ç–æ–≥–æ–¥–∏–Ω–∞–º–∏/–¥–∞—Ç–æ—é), —Ñ–æ—Ä–º—É—é—Ç—å <b>—á–µ–∫ 58 –º–º</b> (–Ω–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è) –¥–ª—è –¥—Ä—É–∫—É —Ç–∞ <b>NFC-—Ç–µ–∫—Å—Ç</b> –¥–ª—è –º—ñ—Ç–∫–∏.
        –í –∫—ñ–Ω—Ü—ñ ‚Äî <b>CSV</b> —É Google Sheets —ñ –∫–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏.
      </p>
      <p class="small">–ü—Ä–∞–≤–∏–ª–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É: –¢–û –Ω–∞—Å—Ç–∞—î —Ä–∞–Ω—ñ—à–µ –∑ –¥–≤–æ—Ö ‚Äî –∑–∞ <span class="mono">–º–æ—Ç–æ–≥–æ–¥–∏–Ω–∞–º–∏</span> –∞–±–æ –∑–∞ <span class="mono">–∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º</span>.</p>
    </div>

    <!-- –î–û–í–Ü–î–ù–ò–ö –ú–ê–®–ò–ù -->
    <div class="card">
      <h2>üöú –î–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω</h2>
      <div class="row">
        <button class="btn" onclick="addMachine()">‚ûï –î–æ–¥–∞—Ç–∏ –º–∞—à–∏–Ω—É</button>
        <button class="btn" onclick="demoMachines()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="copyCSV('csvM')">üìã CSV (–º–∞—à–∏–Ω–∏)</button>
      </div>
      <div style="overflow:auto; margin-top:8px">
        <table class="table" id="tblM">
          <thead>
            <tr>
              <th>#</th>
              <th>–ú–∞—à–∏–Ω–∞ ID</th>
              <th>–ú–æ–¥–µ–ª—å</th>
              <th>–ú–æ—Ç–æ–≥–æ–¥., h (–ø–æ—Ç–æ—á–Ω—ñ)</th>
              <th>–¢–û –æ—Å—Ç–∞–Ω–Ω—î: –¥–∞—Ç–∞</th>
              <th>–¢–û –æ—Å—Ç–∞–Ω–Ω—î: h</th>
              <th>–Ü–Ω—Ç–µ—Ä–≤–∞–ª –¢–û: h</th>
              <th>–Ü–Ω—Ç–µ—Ä–≤–∞–ª –¢–û: –¥–Ω—ñ–≤</th>
              <th class="dark">–ó–∞–ª–∏—à–æ–∫ –¥–æ –¢–û, h</th>
              <th class="dark">–ó–∞–ª–∏—à–æ–∫ –¥–æ –¢–û, –¥–Ω—ñ–≤</th>
              <th class="dark">–°—Ç–∞—Ç—É—Å</th>
              <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
            </tr>
          </thead>
          <tbody id="bodyM"></tbody>
        </table>
      </div>
      <div id="csvM" class="out" style="margin-top:8px">‚Äî</div>
      <p class="small muted">–¢–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ (<span class="mono">.dark</span>) ‚Äî –∑—ñ —Å–≤—ñ—Ç–ª–∏–º —Ç–µ–∫—Å—Ç–æ–º –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ.</p>
    </div>

    <!-- –ñ–£–†–ù–ê–õ –†–û–ë–Ü–¢ -->
    <div class="card">
      <h2>üß± –ñ—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç</h2>
      <div class="row">
        <button class="btn" onclick="addJob()">‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å</button>
        <button class="btn" onclick="demoJobs()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="copyCSV('csvJ')">üìã CSV (—Ä–æ–±–æ—Ç–∏)</button>
      </div>
      <div style="overflow:auto; margin-top:8px">
        <table class="table" id="tblJ">
          <thead>
            <tr>
              <th>#</th>
              <th>–î–∞—Ç–∞</th>
              <th>–ú–∞—à–∏–Ω–∞ ID</th>
              <th>–¢–∏–ø —Ä–æ–±—ñ—Ç</th>
              <th>–ì–æ–¥–∏–Ω–∏ –ø—Ä–∞—Ü—ñ, –ª—é–¥.-–≥–æ–¥</th>
              <th>–ó–∞–ø—á–∞—Å—Ç–∏–Ω–∏/–º–∞—Ç–µ—Ä—ñ–∞–ª–∏, –≥—Ä–Ω</th>
              <th class="dark">–í–∞—Ä—Ç—ñ—Å—Ç—å —Ä–æ–±—ñ—Ç, –≥—Ä–Ω (–¥–æ–≤—ñ–¥–∫–æ–≤–∞)</th>
              <th class="dark">–†–∞–∑–æ–º, –≥—Ä–Ω</th>
              <th>–ù–æ—Ç–∞—Ç–∫–∞</th>
            </tr>
          </thead>
          <tbody id="bodyJ"></tbody>
        </table>
      </div>
      <div id="csvJ" class="out" style="margin-top:8px">‚Äî</div>
      <p class="small">–û—Ü—ñ–Ω–∫–∞ –≤–∞—Ä—Ç–æ—Å—Ç—ñ —Ä–æ–±—ñ—Ç: <span class="mono">–ª—é–¥.-–≥–æ–¥ √ó —Ç–∞—Ä–∏—Ñ</span> (–¥–∏–≤. ¬´–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è¬ª).</p>
    </div>

    <!-- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø + NFC + –ß–ï–ö -->
    <div class="card">
      <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è / NFC / –ß–µ–∫ 58 –º–º</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
          <div class="row">
            <div style="flex:1"><label>–¢–∞—Ä–∏—Ñ, –≥—Ä–Ω/–≥–æ–¥</label><input id="rate" type="number" step="1" value="220"></div>
            <div style="flex:1"><label>–î–∞—Ç–∞ ¬´—Å—å–æ–≥–æ–¥–Ω—ñ¬ª</label><input id="today" type="date"></div>
          </div>
          <p class="small">–î–∞—Ç–∞ ¬´—Å—å–æ–≥–æ–¥–Ω—ñ¬ª –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑–∞–ª–∏—à–∫—É –¥–Ω—ñ–≤ –¥–æ –¢–û.</p>
        </div>

        <div class="box">
          <h3>NFC ‚Äî —Ç–µ–∫—Å—Ç –¥–ª—è –º—ñ—Ç–∫–∏ –º–∞—à–∏–Ω–∏</h3>
          <div class="row">
            <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞ ID</label><input id="nfcId" type="text" value="TR-001"></div>
            <div style="flex:1"><label>–°–µ—Ä–≤—ñ—Å-–∫–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcContact" type="text" value="+380XXXXXXXXX"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
            <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
          <div id="nfcOut" class="out">‚Äî</div>
        </div>

        <div class="box">
          <h3>–ù–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (—á–µ–∫ 58 –º–º)</h3>
          <div class="row">
            <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
            <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
          </div>
          <div class="ticket" id="ticket" style="margin-top:8px">
            <h4>–ù–ê–†–Ø–î-–ó–ê–ú–û–í–õ–ï–ù–ù–Ø</h4>
            <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
            <div class="line"></div>
            <p><b>–ú–∞—à–∏–Ω–∞:</b> <span id="tId">‚Äî</span> ¬∑ <b>–ú–æ–¥–µ–ª—å:</b> <span id="tModel">‚Äî</span></p>
            <p><b>–ü–æ—Ç–æ—á–Ω—ñ h:</b> <span id="tH">‚Äî</span> ¬∑ <b>–ù–∞—Å—Ç. –¢–û —á–µ—Ä–µ–∑:</b> <span id="tDue">‚Äî</span></p>
            <div class="line"></div>
            <p><b>–†–æ–±–æ—Ç–∞:</b> <span id="tJob">‚Äî</span></p>
            <p><b>–¢—Ä—É–¥–æ–º—ñ—Å—Ç–∫—ñ—Å—Ç—å:</b> <span id="tHours">‚Äî</span> –≥–æ–¥ √ó <span id="tRate">‚Äî</span> = <span id="tWorkCost">‚Äî</span> –≥—Ä–Ω</p>
            <p><b>–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏:</b> <span id="tParts">‚Äî</span> –≥—Ä–Ω</p>
            <p><b>–†–∞–∑–æ–º:</b> <span id="tTotal">‚Äî</span> –≥—Ä–Ω</p>
            <div class="line"></div>
            <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
          </div>
        </div>
      </div>
    </div>

    <!-- –•–Ü–î –†–û–ë–û–¢–ò -->
    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
      <ol>
        <li>–ó–∞–ø–æ–≤–Ω–∏ <b>–î–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω</b> (–º—ñ–Ω—ñ–º—É–º 3 –∑–∞–ø–∏—Å–∏), –∑–∞–¥–∞–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –¢–û.</li>
        <li>–î–æ–¥–∞–π 3‚Äì5 –∑–∞–ø–∏—Å—ñ–≤ —É <b>–ñ—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç</b> (—Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ —Ä–æ–±—ñ—Ç).</li>
        <li>–ü–µ—Ä–µ–≤—ñ—Ä <b>–∑–∞–ª–∏—à–æ–∫ –¥–æ –¢–û</b> (–≥–æ–¥/–¥–Ω—ñ) —ñ —Å—Ç–∞—Ç—É—Å (¬´OK / —Å–∫–æ—Ä–æ / —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ¬ª).</li>
        <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>NFC</b>-—Ç–µ–∫—Å—Ç –¥–ª—è –æ–¥–Ω—ñ—î—ó –º–∞—à–∏–Ω–∏ —Ç–∞ <b>—á–µ–∫ 58 –º–º</b> –ø–æ –æ–¥–Ω—ñ–π —Ä–æ–±–æ—Ç—ñ.</li>
        <li>–°–∫–æ–ø—ñ—é–π <b>CSV</b> —É Google Sheets (–∞—Ä–∫—É—à—ñ <span class="mono">Machines</span> —Ç–∞ <span class="mono">Jobs</span>).</li>
      </ol>
    </div>

    <div class="card">
      <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="table">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–ó–∞–ø–æ–≤–Ω–µ–Ω–∏–π –¥–æ–≤—ñ–¥–Ω–∏–∫ —ñ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¢–û (–≥–æ–¥/–¥–Ω—ñ)</td><td>4</td></tr>
          <tr><td>–ñ—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π (3‚Äì5 –∑–∞–ø–∏—Å—ñ–≤), –ø—ñ–¥—Å—É–º–∫–∏ –ª–æ–≥—ñ—á–Ω—ñ</td><td>3</td></tr>
          <tr><td>–ß–µ–∫ 58 –º–º —Ç–∞ NFC-—Ç–µ–∫—Å—Ç —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω—ñ</td><td>2</td></tr>
          <tr><td>CSV —É Sheets + –∫–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏</td><td>1</td></tr>
        </tbody>
      </table>
      <p class="pill">üß∞ –¢–û</p><p class="pill">üßæ –ù–∞—Ä—è–¥</p><p class="pill">üîñ NFC</p><p class="pill">üìä CSV</p>
    </div>
  </div>

<script>
  // –†–µ–∂–∏–º –≤–±—É–¥—É–≤–∞–Ω–Ω—è (–¥–ª—è Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // –ï–ª–µ–º–µ–Ω—Ç–∏
  const bodyM = document.getElementById('bodyM');
  const bodyJ = document.getElementById('bodyJ');
  const byId = id => document.getElementById(id);
  const rnd = (n,d=2) => Number((+n).toFixed(d));

  // –ü–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
  (function setToday(){
    const d = new Date().toISOString().slice(0,10);
    byId('today').value = d;
  })();

  // ====== –î–û–í–Ü–î–ù–ò–ö –ú–ê–®–ò–ù ======
  function addMachine(sample){
    const d = new Date().toISOString().slice(0,10);
    const def = {
      id:'TR-001', model:'–ú–¢–ó-82', h: 4200, lastDate: d, lastH: 4000, intH: 250, intD: 180, note:''
    };
    const s = Object.assign(def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.id}"></td>
      <td><input type="text" value="${s.model}"></td>
      <td><input type="number" step="1" value="${s.h}"></td>
      <td><input type="date" value="${s.lastDate}"></td>
      <td><input type="number" step="1" value="${s.lastH}"></td>
      <td><input type="number" step="1" value="${s.intH}"></td>
      <td><input type="number" step="1" value="${s.intD}"></td>
      <td class="dark dueH">‚Äî</td>
      <td class="dark dueD">‚Äî</td>
      <td class="dark status">‚Äî</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyM.appendChild(tr);
    reindex(bodyM);
  }
  function reindex(tbody){ [...tbody.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  function demoMachines(){
    bodyM.innerHTML='';
    addMachine({id:'TR-001', model:'–ú–¢–ó-82',   h:4200, lastDate:'2025-06-15', lastH:4000, intH:250, intD:180});
    addMachine({id:'COM-12', model:'John Deere S', h:1350, lastDate:'2025-08-20', lastH:1200, intH:200, intD:150});
    addMachine({id:'SPR-07', model:'TeeJet 18–º', h:800,  lastDate:'2025-07-10', lastH:700,  intH:150, intD:120});
    recalc();
  }

  // ====== –ñ–£–†–ù–ê–õ –†–û–ë–Ü–¢ ======
  function addJob(sample){
    const d = new Date().toISOString().slice(0,10);
    const def = { date:d, id:'TR-001', job:'–ó–∞–º—ñ–Ω–∞ –º–∞—Å–ª–∞', hours:2.5, parts:1800, note:'' };
    const s = Object.assign(def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="date" value="${s.date}"></td>
      <td><input type="text" value="${s.id}"></td>
      <td><input type="text" value="${s.job}"></td>
      <td><input type="number" step="0.1" value="${s.hours}"></td>
      <td><input type="number" step="1" value="${s.parts}"></td>
      <td class="dark workCost">‚Äî</td>
      <td class="dark total">‚Äî</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyJ.appendChild(tr);
    reindex(bodyJ);
  }

  function demoJobs(){
    bodyJ.innerHTML='';
    addJob({id:'TR-001', job:'–ó–∞–º—ñ–Ω–∞ –º–∞—Å–ª–∞', hours:2.5, parts:1800});
    addJob({id:'COM-12', job:'–†–µ–≥—É–ª—é–≤–∞–Ω–Ω—è –ª–∞–Ω—Ü—é–≥—ñ–≤', hours:1.2, parts:450});
    addJob({id:'SPR-07', job:'–ü—Ä–æ–º–∏–≤–∫–∞ —Ñ–æ—Ä—Å—É–Ω–æ–∫', hours:1.0, parts:220});
    recalc();
  }

  // ====== –†–û–ó–†–ê–•–£–ù–ö–ò ======
  function recalc(){
    // –ú–∞—à–∏–Ω–∏: –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω—ñ–≤ –¢–û
    const today = new Date(byId('today').value||new Date().toISOString().slice(0,10));
    [...bodyM.querySelectorAll('tr')].forEach(tr=>{
      const h = +tr.children[3].querySelector('input').value || 0;
      const lastDate = tr.children[4].querySelector('input').value;
      const lastH = +tr.children[5].querySelector('input').value || 0;
      const intH = +tr.children[6].querySelector('input').value || 0;
      const intD = +tr.children[7].querySelector('input').value || 0;

      const dueH = (lastH + intH) - h; // –≥–æ–¥–∏–Ω –¥–æ –¢–û
      tr.querySelector('.dueH').textContent = (isFinite(dueH)? rnd(dueH,0) : '‚Äî');

      // –î–Ω—ñ –¥–æ –¢–û
      let dueDays = '‚Äî';
      if(lastDate){
        const next = new Date(lastDate); next.setDate(next.getDate() + intD);
        dueDays = Math.ceil((next - today)/(1000*60*60*24));
      }
      tr.querySelector('.dueD').textContent = isFinite(+dueDays)? dueDays : '‚Äî';

      // –°—Ç–∞—Ç—É—Å
      let status='OK';
      const riskH = (isFinite(dueH) && dueH<=20);   // –º–µ–Ω—à–µ —Ä—ñ–≤–Ω—è
      const riskD = (isFinite(+dueDays) && +dueDays<=7);
      if((isFinite(dueH) && dueH<=0) || (isFinite(+dueDays) && +dueDays<=0)) status='–¢–ï–†–ú–Ü–ù–û–í–û';
      else if(riskH || riskD) status='–°–ö–û–†–û';
      tr.querySelector('.status').textContent = status;
      tr.querySelector('.status').style.color = status==='–¢–ï–†–ú–Ü–ù–û–í–û'? '#ef4444' : (status==='–°–ö–û–†–û'? '#f59e0b' : '#10b981');
    });

    // –†–æ–±–æ—Ç–∏: —Å—É–º–∏
    const rate = +byId('rate').value || 0;
    [...bodyJ.querySelectorAll('tr')].forEach(tr=>{
      const hours = +tr.children[4].querySelector('input').value || 0;
      const parts = +tr.children[5].querySelector('input').value || 0;
      const work = hours * rate;
      const total = work + parts;
      tr.querySelector('.workCost').textContent = Math.round(work).toLocaleString('uk-UA');
      tr.querySelector('.total').textContent = Math.round(total).toLocaleString('uk-UA');
    });

    // –û–Ω–æ–≤–∏—Ç–∏ CSV
    buildCSV();
  }

  function buildCSV(){
    // –ú–∞—à–∏–Ω–∏
    const linesM = [...bodyM.querySelectorAll('tr')].map(tr=>{
      const idx = tr.querySelector('.idx').textContent.trim();
      const id  = tr.children[1].querySelector('input').value.trim();
      const model = tr.children[2].querySelector('input').value.trim();
      const h = tr.children[3].querySelector('input').value.trim();
      const lastDate = tr.children[4].querySelector('input').value.trim();
      const lastH = tr.children[5].querySelector('input').value.trim();
      const intH = tr.children[6].querySelector('input').value.trim();
      const intD = tr.children[7].querySelector('input').value.trim();
      const dueH = tr.querySelector('.dueH').textContent.trim();
      const dueD = tr.querySelector('.dueD').textContent.trim();
      const status = tr.querySelector('.status').textContent.trim();
      const note = tr.children[11].querySelector('input').value.trim();
      return [idx,id,model,h,lastDate,lastH,intH,intD,dueH,dueD,status,note].join(' | ');
    });
    byId('csvM').textContent = linesM.join('\n') || '‚Äî';

    // –†–æ–±–æ—Ç–∏
    const linesJ = [...bodyJ.querySelectorAll('tr')].map(tr=>{
      const idx = tr.querySelector('.idx').textContent.trim();
      const d   = tr.children[1].querySelector('input').value.trim();
      const id  = tr.children[2].querySelector('input').value.trim();
      const job = tr.children[3].querySelector('input').value.trim();
      const hours = tr.children[4].querySelector('input').value.trim();
      const parts = tr.children[5].querySelector('input').value.trim();
      const work  = tr.querySelector('.workCost').textContent.trim();
      const total = tr.querySelector('.total').textContent.trim();
      const note  = tr.children[8].querySelector('input').value.trim();
      return [idx,d,id,job,hours,parts,work,total,note].join(' | ');
    });
    byId('csvJ').textContent = linesJ.join('\n') || '‚Äî';
  }

  function copyCSV(id){
    const t = byId(id).textContent.trim();
    if(!t || t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }

  // ====== NFC —ñ –ß–ï–ö ======
  function buildNFC(){
    // –í—ñ–∑—å–º–µ–º–æ –ø–µ—Ä—à—É –º–∞—à–∏–Ω—É (–∞–±–æ ID –∑ –ø–æ–ª—è)
    const id = byId('nfcId').value.trim();
    const contact = byId('nfcContact').value.trim();
    // –ü–æ—à—É–∫ –¥–∞–Ω–∏—Ö –º–∞—à–∏–Ω–∏
    let model='‚Äî', h='‚Äî', due='‚Äî';
    const tr = bodyM.querySelector('tr');
    if(tr){
      model = tr.children[2].querySelector('input').value.trim();
      h     = tr.children[3].querySelector('input').value.trim();
      const dueH = tr.querySelector('.dueH').textContent.trim();
      const dueD = tr.querySelector('.dueD').textContent.trim();
      due = `h:${dueH}; d:${dueD}`;
    }
    const text = [
      `ID:${id}`,
      `MODEL:${model}`,
      `HOURS:${h}`,
      `NEXT:${due}`,
      `CONTACT:${contact}`,
      `DATE:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = text;
  }

  function buildTicket(){
    // –í—ñ–∑—å–º–µ–º–æ –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Å –∑ —Ä–æ–±—ñ—Ç
    const trJ = bodyJ.querySelector('tr');
    const trM = bodyM.querySelector('tr');
    if(!trJ || !trM){ alert('–î–æ–¥–∞–π —Ö–æ—á–∞ –± –æ–¥–Ω—É –º–∞—à–∏–Ω—É —ñ –æ–¥–∏–Ω –∑–∞–ø–∏—Å —Ä–æ–±–æ—Ç–∏.'); return; }

    const date = trJ.children[1].querySelector('input').value.trim();
    const id = trJ.children[2].querySelector('input').value.trim();
    const job = trJ.children[3].querySelector('input').value.trim();
    const hours = parseFloat(trJ.children[4].querySelector('input').value||'0');
    const parts = parseFloat(trJ.children[5].querySelector('input').value||'0');

    const model = trM.children[2].querySelector('input').value.trim();
    const hNow = trM.children[3].querySelector('input').value.trim();
    const dueH = trM.querySelector('.dueH').textContent.trim();
    const dueD = trM.querySelector('.dueD').textContent.trim();

    const rate = +byId('rate').value || 0;
    const workCost = Math.round(hours*rate);
    const total = Math.round(workCost + parts);

    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${date}</small>`;
    byId('tId').textContent = id;
    byId('tModel').textContent = model;
    byId('tH').textContent = hNow;
    byId('tDue').textContent = `h:${dueH} / –¥:${dueD}`;
    byId('tJob').textContent = job;
    byId('tHours').textContent = hours.toFixed(1);
    byId('tRate').textContent = rate;
    byId('tWorkCost').textContent = workCost.toLocaleString('uk-UA');
    byId('tParts').textContent = parts.toLocaleString('uk-UA');
    byId('tTotal').textContent = total.toLocaleString('uk-UA');
    byId('tNote').textContent = `–ü—Ä–∏–º.: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è ¬∑ Ref:${Math.random().toString(36).slice(2,8).toUpperCase()}`;
  }

  // ====== –£–¢–ò–õ–Ü–¢–ò ======
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){ addMachine(); addJob(); recalc(); })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
