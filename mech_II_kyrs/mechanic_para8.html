<!-- mechanic_para8.html
     –ü–ê–†–ê 8 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤
     –¢–µ–º–∞: –í–Ü–ë–†–û–î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê ‚Äî –≤–∏–º—ñ—Ä –∑ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É, RMS g, –ø—ñ–∫–∏ 1X/2X/3X, –æ—Ü—ñ–Ω–∫–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å—É/—Ä–æ–∑—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è/–ø–æ—Å–ª–∞–±–ª–µ–Ω–Ω—è,
           –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –æ—á—ñ–∫—É–≤–∞–Ω–æ—é —á–∞—Å—Ç–æ—Ç–æ—é (rpm), –∂—É—Ä–Ω–∞–ª, —á–µ–∫ 58 –º–º, NFC, CSV
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –ø—Ä–∞—Ü—é—î –Ω–∞ GitHub Pages —Ç–∞ –≤ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏ –∑ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–æ–º (—É –±—Ä–∞—É–∑–µ—Ä—ñ), —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º (–æ–ø—Ü.), NFC-–º—ñ—Ç–∫–∏ (–æ–ø—Ü.).

     –©–æ –≤–º—ñ—î:
     ‚Ä¢ –î–æ—Å—Ç—É–ø –¥–æ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ (–∑–∞ –∑–≥–æ–¥–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞); –∑–±—ñ—Ä —Å–∏–≥–Ω–∞–ª—É 3-–æ—Å–µ–π, –º–æ–¥—É–ª—å a=‚àö(ax¬≤+ay¬≤+az¬≤), –≤–∏–¥–∞–ª–µ–Ω–Ω—è g —Å—Ç–∞—Ç–∏—á–Ω–æ—ó.
     ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫: RMS/Peak (g), –¥–æ–º—ñ–Ω–∞–Ω—Ç–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞, –∞–º–ø–ª—ñ—Ç—É–¥–∏ –Ω–∞ 1X/2X/3X (Goertzel), –∫–æ–µ—Ñ. –¥–∏—Å–±–∞–ª–∞–Ω—Å—É/—Ä–æ–∑—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è (–Ω–∞ –ø—ñ–¥—Å—Ç–∞–≤—ñ –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö –ø—ñ–∫—ñ–≤).
     ‚Ä¢ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è ‚Äú–æ—á—ñ–∫—É–≤–∞–Ω–∞ 1X‚Äù —ñ–∑ –≤–≤–µ–¥–µ–Ω–∏—Ö rpm —Ç–∞ ‚Äú–≤–∏–º—ñ—Ä—è–Ω–∞ 1X‚Äù ‚Üí –≤–∏—Å–Ω–æ–≤–æ–∫ (–∫–æ–≤–∑–∞–Ω–Ω—è —Ä–µ–º–µ–Ω—è/–Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —à–≤–∏–¥–∫–æ—Å—Ç—ñ).
     ‚Ä¢ –ñ—É—Ä–Ω–∞–ª –≤–∏–º—ñ—Ä—ñ–≤; –∫–≤–∏—Ç–æ–∫ 58 –º–º ‚ÄúVIBRO CHECK‚Äù; NFC-—Ç–µ–∫—Å—Ç; –µ–∫—Å–ø–æ—Ä—Ç CSV.
     –ü—Ä–∏–º—ñ—Ç–∫–∞: —Ü–µ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç; –≥—Ä–∞–Ω–∏—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Å–ø—Ä–æ—â–µ–Ω—ñ.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 8 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –í—ñ–±—Ä–∞—Ü—ñ–π–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: RMS g, 1X/2X/3X, –∂—É—Ä–Ω–∞–ª, —á–µ–∫ 58 –º–º, NFC, CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  .ok{color:#10b981}.warn{color:#f59e0b}.bad{color:#ef4444}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 8 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
  <h1>üì≥ –í—ñ–±—Ä–∞—Ü—ñ–π–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: RMS g, 1X/2X/3X, –∂—É—Ä–Ω–∞–ª –≤–∏–º—ñ—Ä—ñ–≤, —á–µ–∫ 58 –º–º, NFC</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞</h2>
    <p>
      –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –≤–∏–∫–æ–Ω–∞—é—Ç—å <b>–≤–∏–º—ñ—Ä –≤—ñ–±—Ä–∞—Ü—ñ–π —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º</b>, –ø—Ä–æ—Ä–∞—Ö—É—é—Ç—å <b>RMS/Peak</b>, –∞–º–ø–ª—ñ—Ç—É–¥–∏ –Ω–∞ <b>1X/2X/3X</b>,
      –ø–æ—Ä—ñ–≤–Ω—è—é—Ç—å –∑ <b>–æ—á—ñ–∫—É–≤–∞–Ω–æ—é —á–∞—Å—Ç–æ—Ç–æ—é –æ–±–µ—Ä—Ç–∞–Ω–Ω—è</b>, –∑—Ä–æ–±–ª—è—Ç—å <b>–≤–∏—Å–Ω–æ–≤–æ–∫</b> (–¥–∏—Å–±–∞–ª–∞–Ω—Å/—Ä–æ–∑—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è/–ø–æ—Å–ª–∞–±–ª–µ–Ω–Ω—è),
      —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>–∂—É—Ä–Ω–∞–ª</b>, <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>, <b>NFC</b>-—Ç–µ–∫—Å—Ç —ñ <b>CSV</b>.
    </p>
    <p class="small">1X ‚Äî –æ—Å–Ω–æ–≤–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ (–æ–±/—Å); 2X ‚Äî —Ç–∏–ø–æ–≤–æ —Ä–æ–∑—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è; 3X —Ç–∞ —à–∏—Ä–æ–∫–æ—Å–º—É–≥–æ–≤–∞ ‚Äî –ø–æ—Å–ª–∞–±–ª–µ–Ω–Ω—è/–ª—é—Ñ—Ç. –ü–æ—Ä–æ–≥–∏ —É–º–æ–≤–Ω—ñ –π –Ω–∞–≤—á–∞–ª—å–Ω—ñ.</p>
  </div>

  <!-- –í–•–Ü–î–ù–Ü –î–ê–ù–Ü –ú–ê–®–ò–ù–ò -->
  <div class="card">
    <h2>‚öôÔ∏è –û–± º—î–∫—Ç –∫–æ–Ω—Ç—Ä–æ–ª—é —Ç–∞ —Ä–µ–∂–∏–º</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–∞—Å–ø–æ—Ä—Ç–Ω—ñ/—Ä–æ–±–æ—á—ñ</h3>
        <div class="row">
          <div style="flex:1"><label>–ù–∞–∑–≤–∞ –≤—É–∑–ª–∞</label><input id="nodeName" type="text" value="–í–∞–ª –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–û–±–µ—Ä—Ç–∏, rpm</label><input id="rpm" type="number" step="1" value="1800"></div>
          <div style="flex:1"><label>–û—á—ñ–∫—É–≤–∞–Ω–∞ 1X, –ì—Ü</label><input id="f1exp" type="number" step="0.01" value="30.0"></div>
        </div>
        <p class="small">–ü—ñ–¥–∫–∞–∑–∫–∞: 1X = rpm/60. –ö–Ω–æ–ø–∫–∞ ‚Äú‚ü≥ –û–±—á–∏—Å–ª–∏—Ç–∏ 1X‚Äù –Ω–∏–∂—á–µ.</p>
      </div>

      <div class="box">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤–∏–º—ñ—Ä—É</h3>
        <div class="row">
          <div style="flex:1"><label>–í—ñ–∫–Ω–æ, —Å</label><input id="winSec" type="number" step="0.5" value="6"></div>
          <div style="flex:1"><label>–ó–Ω–æ—Ä–º—É–≤–∞—Ç–∏ g (–≤–∏–¥–∞–ª–∏—Ç–∏ DC)</label>
            <select id="detrend"><option value="on" selected>—Ç–∞–∫</option><option value="off">–Ω—ñ</option></select>
          </div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–†–µ–∂–∏–º Goertzel</label>
            <select id="gMode"><option value="multi" selected>1X/2X/3X</option><option value="fine">—Ç–æ–Ω–∫–∏–π ¬±5%</option></select>
          </div>
          <div style="flex:1"><label>–ü–æ—Ä—ñ–≥ —Ç—Ä–∏–≤–æ–≥–∏, g RMS</label><input id="thrRMS" type="number" step="0.01" value="0.4"></div>
        </div>
      </div>

      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" id="permBtn">üîì –î–æ–∑–≤—ñ–ª –Ω–∞ —Å–µ–Ω—Å–æ—Ä–∏</button>
          <button class="btn" id="startBtn">‚ñ∂Ô∏è –ü—É—Å–∫</button>
          <button class="btn" id="stopBtn" disabled>‚èπÔ∏è –°—Ç–æ–ø</button>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="calcF1()">‚ü≥ –û–±—á–∏—Å–ª–∏—Ç–∏ 1X</button>
          <button class="btn" onclick="addLog()">üß© –í –∂—É—Ä–Ω–∞–ª</button>
          <button class="btn" onclick="copyCSV('csvSys')">üìã CSV (—Å–µ—Å—ñ—è)</button>
        </div>
        <div id="csvSys" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>

    <div class="grid g3" style="margin-top:8px">
      <div class="box">
        <h3>–ü–æ—Ç–æ—á–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏</h3>
        <p>RMS: <b><span id="rms">‚Äî</span></b> g ¬∑ Peak: <b><span id="peak">‚Äî</span></b> g</p>
        <p>f –¥–æ–º—ñ–Ω–∞–Ω—Ç–Ω–∞: <b><span id="fdom">‚Äî</span></b> –ì—Ü</p>
        <p>–°—Ç–∞—Ç—É—Å: <b><span id="status">‚Äî</span></b></p>
      </div>
      <div class="box">
        <h3>–°–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ñ –ø—ñ–∫–∏</h3>
        <p>1X: <b><span id="a1">‚Äî</span></b> g ¬∑ 2X: <b><span id="a2">‚Äî</span></b> g ¬∑ 3X: <b><span id="a3">‚Äî</span></b> g</p>
        <p>–í–∏—Å–Ω–æ–≤–æ–∫: <b><span id="diag">‚Äî</span></b></p>
      </div>
      <div class="box">
        <h3>–ö–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è/–ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è</h3>
        <p>–û—á—ñ–∫. 1X: <b><span id="f1lbl">‚Äî</span></b> –ì—Ü ¬∑ –í–∏–º—ñ—Ä. 1X: <b><span id="f1meas">‚Äî</span></b> –ì—Ü</p>
        <p>–†—ñ–∑–Ω–∏—Ü—è: <b><span id="f1diff">‚Äî</span></b> %</p>
      </div>
    </div>
  </div>

  <!-- –ñ–£–†–ù–ê–õ -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª –≤–∏–º—ñ—Ä—ñ–≤</h2>
    <div class="row">
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (–∂—É—Ä–Ω–∞–ª)</button>
      <button class="btn" onclick="presetLog()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tbl">
        <thead>
          <tr>
            <th>#</th>
            <th>–í—É–∑–æ–ª</th>
            <th>rpm</th>
            <th>1X –æ—á—ñ–∫., –ì—Ü</th>
            <th>RMS g</th>
            <th>Peak g</th>
            <th class="dark">1X g</th>
            <th class="dark">2X g</th>
            <th class="dark">3X g</th>
            <th class="dark">Œî1X, %</th>
            <th class="dark">–î—ñ–∞–≥–Ω–æ–∑</th>
            <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          </tr>
        </thead>
        <tbody id="body"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- –ö–í–ò–¢–û–ö + NFC -->
  <div class="card">
    <h2>üßæ –ö–≤–∏—Ç–æ–∫ 58 –º–º —Ç–∞ NFC</h2>
    <div class="grid g2">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúVIBRO CHECK‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞ ID</label><input id="nfcId" type="text" value="TR-001"></div>
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ ‚ÄúVIBRO CHECK‚Äù</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>VIBRO CHECK</h4>
          <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
          <div class="line"></div>
          <p><b>–í—É–∑–æ–ª:</b> <span id="tNode">‚Äî</span></p>
          <p><b>rpm/1X:</b> <span id="tRpm">‚Äî</span> / <span id="tF1">‚Äî</span> –ì—Ü</p>
          <p><b>RMS/Peak:</b> <span id="tRMS">‚Äî</span> / <span id="tPeak">‚Äî</span> g</p>
          <p><b>1X/2X/3X:</b> <span id="tH1">‚Äî</span>/<span id="tH2">‚Äî</span>/<span id="tH3">‚Äî</span> g</p>
          <p><b>Œî1X:</b> <span id="tD1">‚Äî</span> % ¬∑ <b>–í–∏—Å–Ω–æ–≤–æ–∫:</b> <span id="tDiag">‚Äî</span></p>
          <div class="line"></div>
          <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–ó–∞–¥–∞–π <b>rpm</b> –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ ‚Äú‚ü≥ –û–±—á–∏—Å–ª–∏—Ç–∏ 1X‚Äù. –ü–æ–ø—Ä–æ—Å–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ —Å–µ–Ω—Å–æ—Ä–∏ —ñ –Ω–∞—Ç–∏—Å–Ω–∏ <b>–ü—É—Å–∫</b> ‚Äî —Ç—Ä–∏–º–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω –±—ñ–ª—è –≤—É–∑–ª–∞.</li>
      <li>–ü—ñ—Å–ª—è <b>–≤—ñ–∫–Ω–∞</b> –∑–±–æ—Ä—É –ø–µ—Ä–µ–≥–ª—è–Ω—å <b>RMS/Peak</b>, <b>1X/2X/3X</b>, <b>Œî1X</b> —ñ <b>–≤–∏—Å–Ω–æ–≤–æ–∫</b>.</li>
      <li>–î–æ–¥–∞–π –∑–∞–ø–∏—Å —É <b>–∂—É—Ä–Ω–∞–ª</b> (–º—ñ–Ω. 3 —Ä—è–¥–∫–∏: —Ä—ñ–∑–Ω—ñ RPM –∞–±–æ —Ä—ñ–∑–Ω—ñ –≤—É–∑–ª–∏).</li>
      <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>, <b>NFC</b> —ñ <b>CSV</b> –¥–ª—è –∑–≤—ñ—Ç—É (<span class="mono">Vibration</span>).</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–í–∏–º—ñ—Ä –∑ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ (–¥–æ–∑–≤—ñ–ª, –∫–æ—Ä–µ–∫—Ç–Ω–µ –≤—ñ–∫–Ω–æ)</td><td>3</td></tr>
        <tr><td>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ RMS/Peak, 1X/2X/3X —Ç–∞ Œî1X</td><td>3</td></tr>
        <tr><td>–ñ—É—Ä–Ω–∞–ª (‚â•3 —Ä—è–¥–∫–∏) —ñ –≤—ñ—Ä–Ω–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫</td><td>3</td></tr>
        <tr><td>–ö–≤–∏—Ç–æ–∫/NFC + CSV</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  const bodyEl = document.getElementById('body');

  // ---------- –î–æ–ø–æ–º—ñ–∂–Ω—ñ ----------
  function calcF1(){
    const rpm = +byId('rpm').value||0;
    const f1 = rpm/60;
    byId('f1exp').value = f1.toFixed(2);
    updateLabels();
  }
  function updateLabels(){
    byId('f1lbl').textContent = (+byId('f1exp').value||0).toFixed(2);
  }

  // ---------- –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö –∑ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ ----------
  let collecting=false, samples=[], times=[];
  let lastStamp=null;

  async function requestPermission(){
    try{
      if (typeof(DeviceMotionEvent)!=='undefined' && typeof DeviceMotionEvent.requestPermission==='function'){
        const st = await DeviceMotionEvent.requestPermission();
        if(st!=='granted'){ alert('–î–æ—Å—Ç—É–ø –¥–æ —Å–µ–Ω—Å–æ—Ä—ñ–≤ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ'); return; }
      }
      flash('‚úÖ –î–æ—Å—Ç—É–ø –¥–æ —Å–µ–Ω—Å–æ—Ä—ñ–≤ –¥–æ–∑–≤–æ–ª–µ–Ω–æ');
    }catch(e){ alert('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∑–∞–ø–∏—Ç –¥–æ–∑–≤–æ–ª—É –¥–ª—è —Å–µ–Ω—Å–æ—Ä—ñ–≤'); }
  }

  function onMotion(e){
    if(!collecting) return;
    const a = e.accelerationIncludingGravity || e.acceleration || {x:0,y:0,z:0};
    const ax=a.x||0, ay=a.y||0, az=a.z||0;
    // –º–æ–¥—É–ª—å –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –≤ g; –ø—Ä–∏–±–ª–∏–∑–Ω–æ –¥—ñ–ª–∏–º–æ –Ω–∞ 9.81
    let g = Math.sqrt(ax*ax+ay*ay+az*az)/9.81;
    // –≤–∏–¥–∞–ª–µ–Ω–Ω—è DC (–≤–∏–¥–∞–ª–∏—Ç–∏ —Å–µ—Ä–µ–¥–Ω—î –ø–æ —Ö–æ–¥—É –∑–±–æ—Ä—É)
    if(byId('detrend').value==='on'){
      // –±—É–¥–µ–º–æ –≤—ñ–¥–Ω—ñ–º–∞—Ç–∏ –∫–æ–≤–∑–Ω–µ —Å–µ—Ä–µ–¥–Ω—î ~ –ø—Ä–æ—Å—Ç–µ: –∑–±–µ—Ä–µ–∂–µ–º–æ —ñ –≤—ñ–¥–Ω—ñ–º–µ–º–æ –ø—ñ–∑–Ω—ñ—à–µ –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ
    }
    const t = e.timeStamp || performance.now();
    samples.push(g); times.push(t);
  }

  function startCollect(){
    samples=[]; times=[]; lastStamp=null;
    collecting=true;
    window.addEventListener('devicemotion', onMotion, {passive:true});
    byId('startBtn').disabled=true; byId('stopBtn').disabled=false;
    const dur = (+byId('winSec').value||6)*1000;
    setTimeout(stopCollect, dur);
  }

  function stopCollect(){
    if(!collecting) return;
    collecting=false;
    window.removeEventListener('devicemotion', onMotion);
    byId('startBtn').disabled=false; byId('stopBtn').disabled=true;
    processData();
  }

  // ---------- –û–±—Ä–æ–±–∫–∞ ----------
  function detrend(arr){
    const mean = arr.reduce((a,b)=>a+b,0)/(arr.length||1);
    return arr.map(x=>x-mean);
  }

  function rms(arr){
    if(!arr.length) return 0;
    let s=0; for(const x of arr) s+=x*x;
    return Math.sqrt(s/arr.length);
  }
  function peak(arr){
    let p=0; for(const x of arr) p=Math.max(p,Math.abs(x));
    return p;
  }

  function estimateFs(ts){
    if(ts.length<2) return 50; // –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è
    let ms = 0, n=0;
    for(let i=1;i<ts.length;i++){ const dt = ts[i]-ts[i-1]; if(dt>0 && dt<200){ ms += dt; n++; } }
    const avg = n? ms/n : 20;
    return 1000/avg;
  }

  // Goertzel –¥–ª—è —á–∞—Å—Ç–æ—Ç–∏ f0
  function goertzel(arr, fs, f0){
    const n = arr.length;
    if(n===0 || fs<=0 || f0<=0) return 0;
    const k = Math.round(0.5 + (n * f0)/fs);
    const w = (2*Math.PI*k)/n;
    const cw = Math.cos(w), sw = Math.sin(w);
    const coeff = 2*cw;
    let s0=0, s1=0, s2=0;
    for(let i=0;i<n;i++){
      s0 = arr[i] + coeff*s1 - s2;
      s2 = s1; s1 = s0;
    }
    const real = s1 - s2*cw;
    const imag = s2*sw;
    const mag = Math.sqrt(real*real + imag*imag)/n*2; // –Ω–æ—Ä–º–æ–≤–∞–Ω–∞ –∞–º–ø–ª—ñ—Ç—É–¥–∞
    return mag;
  }

  function dominantFreq(arr, fs){
    // –ì—Ä—É–±–∞ –æ—Ü—ñ–Ω–∫–∞: –∞–≤—Ç–æ–∫–æ—Ä–µ–ª—è—Ü—ñ—è –¥–ª—è –ø–µ—Ä—ñ–æ–¥—É 0.5‚Ä¶50 –ì—Ü
    const fmin=0.5, fmax=Math.min(50, fs/2-1);
    let bestF=0, bestR=0;
    for(let f=fmin; f<=fmax; f+=0.5){
      const T = Math.round(fs/f);
      if(T<=1) continue;
      let r=0, m=0;
      for(let i=0;i+T<arr.length;i++){ r += arr[i]*arr[i+T]; m++; }
      if(m>0){ r/=m; if(r>bestR){bestR=r; bestF=f;} }
    }
    return bestF;
  }

  function diagHeuristic(a1,a2,a3,rmsVal,thrRMS){
    let notes=[];
    if(rmsVal>thrRMS) notes.push('—Ä—ñ–≤–µ–Ω—å –≤–∏—Å–æ–∫–∏–π');
    if(a1>Math.max(a2,a3)*1.5 && a1>0.15) notes.push('–¥–∏—Å–±–∞–ª–∞–Ω—Å (1X)');
    if(a2>Math.max(a1,a3)*1.3 && a2>0.1) notes.push('—Ä–æ–∑—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è (2X)');
    if(a3>0.1 && a3>0.7*a2) notes.push('–ø–æ—Å–ª–∞–±–ª–µ–Ω–Ω—è/–ª—é—Ñ—Ç (3X)');
    if(notes.length===0) return '–Ω–æ—Ä–º–∞/–±–µ–∑ –∑–∞—É–≤–∞–∂–µ–Ω—å';
    return notes.join('; ');
  }

  function processData(){
    if(samples.length<20){ flash('–ú–∞–ª–æ –¥–∞–Ω–∏—Ö'); return; }
    const fs = estimateFs(times);
    let x = samples.slice();
    if(byId('detrend').value==='on') x = detrend(x);

    const r = rms(x), p = peak(x);
    const f1exp = +byId('f1exp').value || 0;
    const f1 = f1exp>0? f1exp : dominantFreq(x, fs);

    // Goertzel –Ω–∞ 1X/2X/3X; –≤ —Ä–µ–∂–∏–º—ñ "fine" –±–µ—Ä–µ–º–æ ¬±5% —ñ –æ–±–∏—Ä–∞—î–º–æ –ø—ñ–∫
    function pickAround(f){
      const mode = byId('gMode').value;
      if(mode==='multi') return goertzel(x,fs,f);
      let best=0;
      for(let ff=f*0.95; ff<=f*1.05; ff+=f*0.005){ best = Math.max(best, goertzel(x,fs,ff)); }
      return best;
    }
    const a1 = f1>0? pickAround(f1) : 0;
    const a2 = f1>0? pickAround(2*f1) : 0;
    const a3 = f1>0? pickAround(3*f1) : 0;

    const fdom = dominantFreq(x,fs);
    const diff = f1exp>0? ((fdom - f1exp)/f1exp*100) : 0;

    // –í–∏—Å–Ω–æ–≤–∫–∏/—Å—Ç–∞—Ç—É—Å–∏
    const thr = +byId('thrRMS').value||0.4;
    const status = (r<=thr? 'üü¢ –æ–∫' : (r<=thr*1.5? 'üü† –ø—ñ–¥–≤–∏—â–µ–Ω–æ' : 'üî¥ –≤–∏—Å–æ–∫–æ'));
    const diag = diagHeuristic(a1,a2,a3,r,thr);

    byId('rms').textContent = rnd(r,3);
    byId('peak').textContent= rnd(p,3);
    byId('fdom').textContent= rnd(fdom,2);
    byId('a1').textContent  = rnd(a1,3);
    byId('a2').textContent  = rnd(a2,3);
    byId('a3').textContent  = rnd(a3,3);
    byId('status').textContent = status;
    byId('diag').textContent   = diag;
    byId('f1lbl').textContent  = f1exp? rnd(f1exp,2) : '‚Äî';
    byId('f1meas').textContent = rnd(fdom,2);
    byId('f1diff').textContent = f1exp? rnd(diff,1) : '‚Äî';

    // CSV —Å–µ—Å—ñ—ó
    const csv = [
      `NODE|${byId('nodeName').value}`,
      `RPM|${byId('rpm').value}|F1exp|${byId('f1exp').value}|Fs|${rnd(fs,1)}`,
      `RMS|${rnd(r,3)}|Peak|${rnd(p,3)}`,
      `HARM|1X:${rnd(a1,3)}|2X:${rnd(a2,3)}|3X:${rnd(a3,3)}`,
      `FREQ|fdom:${rnd(fdom,2)}|diff%:${f1exp?rnd(diff,1):'‚Äî'}`,
      `STATUS|${status}|DIAG|${diag}`
    ].join('\n');
    byId('csvSys').textContent = csv;
  }

  // ---------- –ñ—É—Ä–Ω–∞–ª ----------
  function addLog(){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${byId('nodeName').value}"></td>
      <td><input type="number" step="1" value="${byId('rpm').value}"></td>
      <td><input type="number" step="0.01" value="${byId('f1exp').value}"></td>
      <td class="rms">`+byId('rms').textContent+`</td>
      <td class="peak">`+byId('peak').textContent+`</td>
      <td class="dark h1">`+byId('a1').textContent+`</td>
      <td class="dark h2">`+byId('a2').textContent+`</td>
      <td class="dark h3">`+byId('a3').textContent+`</td>
      <td class="dark d1">`+byId('f1diff').textContent+`</td>
      <td class="dark dg">`+byId('diag').textContent+`</td>
      <td><input type="text" value=""></td>
    `;
    bodyEl.appendChild(tr);
    reindex();
    buildCSVlog();
  }
  function reindex(){ [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function buildCSVlog(){
    const lines = [...bodyEl.querySelectorAll('tr')].map(tr=>{
      const idx=tr.querySelector('.idx').textContent.trim();
      const node=tr.children[1].querySelector('input').value.trim();
      const rpm =tr.children[2].querySelector('input').value.trim();
      const f1e =tr.children[3].querySelector('input').value.trim();
      const rms =tr.querySelector('.rms').textContent.trim();
      const pk  =tr.querySelector('.peak').textContent.trim();
      const h1  =tr.querySelector('.h1').textContent.trim();
      const h2  =tr.querySelector('.h2').textContent.trim();
      const h3  =tr.querySelector('.h3').textContent.trim();
      const d1  =tr.querySelector('.d1').textContent.trim();
      const dg  =tr.querySelector('.dg').textContent.trim();
      const note=tr.children[11].querySelector('input').value.trim();
      return [idx,node,rpm,f1e,rms,pk,h1,h2,h3,d1,dg,note].join(' | ');
    });
    byId('csvLog').textContent = lines.join('\n') || '‚Äî';
  }
  function presetLog(){
    bodyEl.innerHTML='';
    // –ü—Ä–∏–∫–ª–∞–¥–∏ —Ç—Ä—å–æ—Ö –≤—É–∑–ª—ñ–≤/—Ä–µ–∂–∏–º—ñ–≤
    const add=(n,r,f1,rms,pk,h1,h2,h3,d1,dg,note)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td class="idx">1</td>
        <td><input type="text" value="${n}"></td>
        <td><input type="number" step="1" value="${r}"></td>
        <td><input type="number" step="0.01" value="${f1}"></td>
        <td class="rms">${rms}</td>
        <td class="peak">${pk}</td>
        <td class="dark h1">${h1}</td>
        <td class="dark h2">${h2}</td>
        <td class="dark h3">${h3}</td>
        <td class="dark d1">${d1}</td>
        <td class="dark dg">${dg}</td>
        <td><input type="text" value="${note}"></td>
      `;
      bodyEl.appendChild(tr);
    };
    add('–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä', 1800, 30.00, '0.28','0.85','0.22','0.08','0.05','-1.2','–Ω–æ—Ä–º–∞/–±–µ–∑ –∑–∞—É–≤–∞–∂–µ–Ω—å','–±–∞–∑–æ–≤–∞ —Ç–æ—á–∫–∞');
    add('–®–∫—ñ–≤ —Ä–µ–º–µ–Ω—è', 1500, 25.00, '0.52','1.30','0.80','0.25','0.18','+3.5','—Ä—ñ–≤–µ–Ω—å –≤–∏—Å–æ–∫–∏–π; –¥–∏—Å–±–∞–ª–∞–Ω—Å (1X)','–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –±—Ä—É–¥/–±–∞–ª–∞–Ω—Å');
    add('–ù–∞—Å–æ—Å', 1200, 20.00, '0.45','1.10','0.30','0.40','0.28','-4.0','—Ä—ñ–≤–µ–Ω—å –≤–∏—Å–æ–∫–∏–π; —Ä–æ–∑—Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è (2X)','—Å–ø—ñ–≤–≤—ñ—Å–Ω—ñ—Å—Ç—å –º—É—Ñ—Ç–∏');
    reindex(); buildCSVlog();
  }

  // ---------- –ö–≤–∏—Ç–æ–∫ / NFC / CSV ----------
  function buildTicket(){
    const d = new Date().toISOString().slice(0,10);
    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${d}</small>`;
    byId('tNode').textContent = byId('nodeName').value;
    byId('tRpm').textContent  = byId('rpm').value;
    byId('tF1').textContent   = (+byId('f1exp').value||0).toFixed(2);
    byId('tRMS').textContent  = byId('rms').textContent;
    byId('tPeak').textContent = byId('peak').textContent;
    byId('tH1').textContent   = byId('a1').textContent;
    byId('tH2').textContent   = byId('a2').textContent;
    byId('tH3').textContent   = byId('a3').textContent;
    byId('tD1').textContent   = byId('f1diff').textContent;
    byId('tDiag').textContent = byId('diag').textContent;
    byId('tNote').textContent = `Win:${byId('winSec').value}s; Mode:${byId('gMode').value}; Norm:${byId('thrRMS').value}g RMS`;
  }

  function buildNFC(){
    const text = [
      `VIBRO_NFC`,
      `MACHINE:${byId('nfcId').value}`,
      `CONTACT:${byId('nfcPhone').value}`,
      `NODE:${byId('nodeName').value}`,
      `RPM:${byId('rpm').value}; F1exp:${byId('f1exp').value}`,
      `RMS:${byId('rms').textContent}g; Peak:${byId('peak').textContent}g`,
      `HARM:1X=${byId('a1').textContent}g;2X=${byId('a2').textContent}g;3X=${byId('a3').textContent}g`,
      `DIAG:${byId('diag').textContent}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = text;
  }

  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t || t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // ---------- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ —Å–ª—É—Ö–∞—á—ñ ----------
  (function init(){
    updateLabels();
    // –ö–Ω–æ–ø–∫–∏
    byId('permBtn').addEventListener('click', requestPermission);
    byId('startBtn').addEventListener('click', startCollect);
    byId('stopBtn').addEventListener('click', stopCollect);
    // –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –º—ñ—Ç–æ–∫
    ['rpm','f1exp'].forEach(id=>byId(id).addEventListener('change', updateLabels));
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
