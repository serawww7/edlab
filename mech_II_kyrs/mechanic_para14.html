<!-- mechanic_para14.html
     –ü–ê–†–ê 14 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤
     –¢–µ–º–∞: –î–í–ò–ì–£–ù –Ü –¢–ï–ü–õ–û–í–Ü –†–ï–ñ–ò–ú–ò ‚Äî –≤–∏—Ç—Ä–∞—Ç–∞ –ø–∞–ª–∏–≤–∞, –ø–∏—Ç–æ–º–∞ –≤–∏—Ç—Ä–∞—Ç–∞ (BSFC),
           —Ç–µ–ø–ª–æ–≤–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –¥–æ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è –∞–Ω—Ç–∏—Ñ—Ä–∏–∑—É (–∑–∞–º–µ—Ä–∑–∞–Ω–Ω—è/–∑–∞–∫–∏–ø–∞–Ω–Ω—è),
           —Ç–∏—Å–∫ –∫—Ä–∏—à–∫–∏ —Ä–∞–¥—ñ–∞—Ç–æ—Ä–∞, —Ç–µ—Å—Ç —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç–∞, –∂—É—Ä–Ω–∞–ª, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC, CSV.
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages —Ç–∞ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏; (–æ–ø—Ü.) –≤–∏—Ç—Ä–∞—Ç–æ–º—ñ—Ä/–º—ñ—Ä–Ω–∞ –∫–æ–ª–±–∞, —Ç–µ—Ä–º–æ–º–µ—Ç—Ä OBD/—Å–∫–∞–Ω–µ—Ä, –ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º, NFC.

     –ü—Ä–∏–º—ñ—Ç–∫–∞ —â–æ–¥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (.dark).
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 14 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –î–≤–∏–≥—É–Ω —ñ —Ç–µ–ø–ª–æ–≤—ñ —Ä–µ–∂–∏–º–∏: –≤–∏—Ç—Ä–∞—Ç–∞, BSFC, –∞–Ω—Ç–∏—Ñ—Ä–∏–∑, —Ç–∏—Å–∫, —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 14 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
  <h1>üî• –î–≤–∏–≥—É–Ω —ñ —Ç–µ–ø–ª–æ–≤—ñ —Ä–µ–∂–∏–º–∏: –≤–∏—Ç—Ä–∞—Ç–∞, BSFC, –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è, –∞–Ω—Ç–∏—Ñ—Ä–∏–∑, —Ç–∏—Å–∫, —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞</h2>
    <p>
      –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –Ω–∞–≤—á–∞—Ç—å—Å—è –≤–∏–∑–Ω–∞—á–∞—Ç–∏ <b>–≥–æ–¥–∏–Ω–Ω—É –≤–∏—Ç—Ä–∞—Ç—É –ø–∞–ª–∏–≤–∞</b> —Ç–∞ <b>–ø–∏—Ç–æ–º—É –≤–∏—Ç—Ä–∞—Ç—É (BSFC)</b>,
      –æ—Ü—ñ–Ω—é–≤–∞—Ç–∏ <b>—Ç–µ–ø–ª–æ–≤–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å–∏—Å—Ç–µ–º—É –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è</b>, –ø—ñ–¥–±–∏—Ä–∞—Ç–∏ <b>–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—é –∞–Ω—Ç–∏—Ñ—Ä–∏–∑—É</b> –ø—ñ–¥ –∫–ª—ñ–º–∞—Ç,
      –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ <b>—Ç–∏—Å–∫ –∫—Ä–∏—à–∫–∏ —Ä–∞–¥—ñ–∞—Ç–æ—Ä–∞</b> —ñ <b>—Å—Ç–∞–Ω —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç–∞</b>, —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ <b>–∂—É—Ä–Ω–∞–ª</b>, <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>,
      <b>NFC</b> —ñ <b>CSV</b>.
    </p>
    <p class="small">–î–∏–∑–ø–∞–ª–∏–≤–æ: <span class="mono">œÅ‚âà0.84 –∫–≥/–ª</span>, <span class="mono">LHV‚âà42.6 –ú–î–∂/–∫–≥</span>.
      –¢–∏–ø–æ–≤—ñ –ö–ö–î –¥–∏–∑–µ–ª—è –Ω–∞ –ø–æ–≤–Ω–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ ~ <span class="mono">35‚Äì42%</span>. –ê–Ω—Ç–∏—Ñ—Ä–∏–∑ (–µ—Ç–∏–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—å): –º–∞–∫—Å–∏–º—É–º –∑–∞—Ö–∏—Å—Ç—É ~ <span class="mono">50‚Äì60%</span>.</p>
  </div>

  <!-- 1. –í–ò–¢–†–ê–¢–ê –ü–ê–õ–ò–í–ê / BSFC -->
  <div class="card">
    <h2>‚õΩ –í–∏—Ç—Ä–∞—Ç–∞ –ø–∞–ª–∏–≤–∞ —Ç–∞ –ø–∏—Ç–æ–º–∞ –≤–∏—Ç—Ä–∞—Ç–∞ (BSFC)</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏–º—ñ—Ä / —É–º–æ–≤–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–ú–µ—Ç–æ–¥</label>
            <select id="fuelMode">
              <option value="mass" selected>–º–∞—Å–∞/—á–∞—Å (–∫–≥/–≥–æ–¥)</option>
              <option value="vol">–æ–±'—î–º/—á–∞—Å (–ª/–≥–æ–¥)</option>
              <option value="volTime">–æ–±'—î–º —ñ —á–∞—Å (–ª –∑–∞ t)</option>
            </select>
          </div>
          <div style="flex:1"><label>–ú–∞—Å–∞, –∫–≥/–≥–æ–¥ ¬∑ –æ–±'—î–º, –ª/–≥–æ–¥ ¬∑ –ª</label><input id="fuelA" type="number" step="0.01" value="20"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ß–∞—Å t, —Ö–≤ (–¥–ª—è –º–µ—Ç–æ–¥—É ‚Äú–ª –∑–∞ t‚Äù)</label><input id="fuelT" type="number" step="0.1" value="10"></div>
          <div style="flex:1"><label>–ì—É—Å—Ç–∏–Ω–∞ œÅ, –∫–≥/–ª</label><input id="rho" type="number" step="0.01" value="0.84"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ï—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å, –∫–í—Ç</label><input id="Pout" type="number" step="0.1" value="120"></div>
          <div style="flex:1"><label>–ù–∏–∂—á–∞ —Ç–µ–ø–ª–æ—Ç–∞ LHV, –ú–î–∂/–∫–≥</label><input id="LHV" type="number" step="0.1" value="42.6"></div>
        </div>
      </div>
      <div class="box">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p>–í–∏—Ç—Ä–∞—Ç–∞ <b>·πÅ</b>: <b><span id="mDot">‚Äî</span></b> –∫–≥/–≥–æ–¥ ( <span id="lph">‚Äî</span> –ª/–≥–æ–¥ )</p>
        <p>BSFC: <b><span id="bsfc">‚Äî</span></b> –≥/–∫–í—Ç¬∑–≥–æ–¥</p>
        <p>–ö–ö–î –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π: <b><span id="eta">‚Äî</span></b> %</p>
      </div>
      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="calcFuel()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="presetFuel()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
          <button class="btn" onclick="copyCSV('csvFuel')">üìã CSV (fuel)</button>
        </div>
        <div id="csvFuel" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
    <p class="small muted">BSFC = <span class="mono">·πÅ –ø–∞–ª (–≥/–≥–æ–¥) / P–≤–∏—Ö (–∫–í—Ç)</span>. –ö–ö–î ‚âà <span class="mono">P–≤–∏—Ö / (·πÅ¬∑LHV)</span>.</p>
  </div>

  <!-- 2. –¢–ï–ü–õ–û–í–ê –ü–û–¢–£–ñ–ù–Ü–°–¢–¨ –î–û –û–•–û–õ–û–î–ñ–ï–ù–ù–Ø -->
  <div class="card">
    <h2>üå°Ô∏è –¢–µ–ø–ª–æ–≤–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –¥–æ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏—Ö—ñ–¥–Ω—ñ</h3>
        <div class="row">
          <div style="flex:1"><label>–ß–∞—Å—Ç–∫–∞ –≤—Ç—Ä–∞—Ç –Ω–∞ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è, %</label><input id="coolFrac" type="number" step="1" value="25"></div>
          <div style="flex:1"><label>–î–µ–±—ñ—Ç –û–ñ, –ª/—Ö–≤</label><input id="coolFlow" type="number" step="1" value="120"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–í—Ö—ñ–¥ –û–ñ, ¬∞C</label><input id="Tin" type="number" step="0.1" value="85"></div>
          <div style="flex:1"><label>–í–∏—Ö—ñ–¥ –û–ñ, ¬∞C</label><input id="Tout" type="number" step="0.1" value="95"></div>
        </div>
      </div>
      <div class="box">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p>QÃá –æ—Ö–æ–ª. (–æ—Ü—ñ–Ω–∫–∞): <b><span id="Qcool">‚Äî</span></b> –∫–í—Ç</p>
        <p>–ó–∞ –≤–∏—Ç—Ä–∞—Ç–æ—é –û–ñ: <b><span id="Qmeas">‚Äî</span></b> –∫–í—Ç</p>
        <p>–°—Ç–∞—Ç—É—Å: <b><span id="coolFlag">‚Äî</span></b></p>
      </div>
      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="calcCool()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvCool')">üìã CSV (cooling)</button>
        </div>
        <div id="csvCool" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
    <p class="small muted">–û—Ü—ñ–Ω–∫–∞: <span class="mono">QÃá–æ—Ö–æ–ª ‚âà —á–∞—Å—Ç–∫–∞% ¬∑ P–ø–∞–ª–∏–≤–∞</span>, –¥–µ <span class="mono">P–ø–∞–ª–∏–≤–∞ = ·πÅ¬∑LHV</span>.
      –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ –≤–∏—Ç—Ä–∞—Ç—ñ: <span class="mono">QÃá=·πÅ–û–ñ¬∑c¬∑ŒîT</span>, –∑ <span class="mono">c‚âà3.6 –∫–î–∂/(–∫–≥¬∑¬∞C)</span>, <span class="mono">œÅ–û–ñ‚âà1.05 –∫–≥/–ª</span>.</p>
  </div>

  <!-- 3. –ê–ù–¢–ò–§–†–ò–ó: –ö–û–ù–¶–ï–ù–¢–†–ê–¶–Ü–Ø / –¢–û–ß–ö–ò -->
  <div class="card">
    <h2>üß™ –ê–Ω—Ç–∏—Ñ—Ä–∏–∑: –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è, –∑–∞–º–µ—Ä–∑–∞–Ω–Ω—è —Ç–∞ –∑–∞–∫–∏–ø–∞–Ω–Ω—è</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏</h3>
        <div class="row">
          <div style="flex:1"><label>% –µ—Ç–∏–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—é</label><input id="eg" type="number" step="1" value="50"></div>
          <div style="flex:1"><label>–¢–∏—Å–∫ –∫—Ä–∏—à–∫–∏, –±–∞—Ä</label><input id="cap" type="number" step="0.05" value="1.2"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ê—Ç–º–æ—Å—Ñ. —Ç–∏—Å–∫, –±–∞—Ä</label><input id="atm" type="number" step="0.01" value="1.0"></div>
          <div style="flex:1"><label>–ú–µ—Ç–∞ –º—ñ–Ω. T, ¬∞C</label><input id="TminTarget" type="number" step="1" value="-30"></div>
        </div>
      </div>
      <div class="box">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p>–ó–∞–º–µ—Ä–∑–∞–Ω–Ω—è: <b><span id="Tf">‚Äî</span></b> ¬∞C</p>
        <p>–ó–∞–∫–∏–ø–∞–Ω–Ω—è (–ø—ñ–¥ —Ç–∏—Å–∫–æ–º): <b><span id="Tb">‚Äî</span></b> ¬∞C</p>
        <p>–°—Ç–∞—Ç—É—Å —Å—É–º—ñ—à—ñ: <b><span id="mixFlag">‚Äî</span></b></p>
      </div>
      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="calcAF()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvAF')">üìã CSV (antifreeze)</button>
        </div>
        <div id="csvAF" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
    <p class="small muted">–ù–∞–±–ª–∏–∂–µ–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –µ—Ç–∏–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—é: 40% ‚âà ‚àí25¬∞C / +105¬∞C@1.1 –±–∞—Ä; 50% ‚âà ‚àí37¬∞C / +108‚Äì110¬∞C@1.1‚Äì1.2; 60% ‚âà ‚àí55¬∞C / +112¬∞C, –∞–ª–µ —Ç–µ–ø–ª–æ—î–º–Ω—ñ—Å—Ç—å –≥—ñ—Ä—à–∞.</p>
  </div>

  <!-- 4. –¢–ï–†–ú–û–°–¢–ê–¢: –¢–ï–°–¢ -->
  <div class="card">
    <h2>üß© –¢–µ—Ä–º–æ—Å—Ç–∞—Ç: –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ç–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏–º—ñ—Ä–∏</h3>
        <div class="row">
          <div style="flex:1"><label>T –ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è (–ø–∞—Å–ø–æ—Ä—Ç), ¬∞C</label><input id="TopenSpec" type="number" step="0.1" value="82"></div>
          <div style="flex:1"><label>T —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂., ¬∞C</label><input id="Tstab" type="number" step="0.1" value="92"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–¢–µ–º–ø. –Ω–∞–≤–∫–æ–ª., ¬∞C</label><input id="Tamb" type="number" step="0.1" value="15"></div>
          <div style="flex:1"><label>–ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, %</label><input id="loadPct" type="number" step="1" value="70"></div>
        </div>
      </div>
      <div class="box">
        <h3>–û—Ü—ñ–Ω–∫–∞</h3>
        <p>–û—Ñ—Å–µ—Ç –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è: <b><span id="Tofs">‚Äî</span></b> ¬∞C</p>
        <p>–°—Ç–∞—Ç—É—Å —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç–∞: <b><span id="thermFlag">‚Äî</span></b></p>
        <p>–ü–æ—Ä–∞–¥–∞: <b><span id="thermTip">‚Äî</span></b></p>
      </div>
      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="calcTherm()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csvTherm')">üìã CSV (thermostat)</button>
        </div>
        <div id="csvTherm" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- 5. –ñ–£–†–ù–ê–õ -->
  <div class="card">
    <h2>üìí –ñ—É—Ä–Ω–∞–ª –≤–∏–º—ñ—Ä—ñ–≤</h2>
    <div class="row">
      <button class="btn" onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å</button>
      <button class="btn" onclick="presetRows()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="copyCSV('csvLog')">üìã CSV (–∂—É—Ä–Ω–∞–ª)</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tbl">
        <thead>
          <tr>
            <th>#</th>
            <th>–†–µ–∂–∏–º/–≤—É–∑–æ–ª</th>
            <th>·πÅ, –∫–≥/–≥–æ–¥</th>
            <th class="dark">BSFC, –≥/–∫–í—Ç¬∑–≥–æ–¥</th>
            <th class="dark">Q–æ—Ö–æ–ª, –∫–í—Ç</th>
            <th class="dark">AF ¬∞C (F/B)</th>
            <th>–¢–µ—Ä–º–æ—Å—Ç–∞—Ç</th>
            <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          </tr>
        </thead>
        <tbody id="body"></tbody>
      </table>
    </div>
    <div id="csvLog" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- 6. –ö–í–ò–¢–û–ö + NFC -->
  <div class="card">
    <h2>üßæ –ö–≤–∏—Ç–æ–∫ 58 –º–º —Ç–∞ NFC</h2>
    <div class="grid g2">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúENGINE HEAT CARD‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞/–¥–≤–∏–≥—É–Ω</label><input id="nfcId" type="text" value="TR-001/Engine-A"></div>
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>
      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ ‚ÄúENGINE HEAT CHECK‚Äù</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>ENGINE HEAT CHECK</h4>
          <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
          <div class="line"></div>
          <p><b>·πÅ:</b> <span id="tMDot">‚Äî</span> –∫–≥/–≥–æ–¥ ( <span id="tLPH">‚Äî</span> –ª/–≥–æ–¥ )</p>
          <p><b>BSFC:</b> <span id="tBSFC">‚Äî</span> –≥/–∫–í—Ç¬∑–≥–æ–¥ ¬∑ <b>Œ∑:</b> <span id="tEta">‚Äî</span> %</p>
          <p><b>Q–æ—Ö–æ–ª:</b> <span id="tQcool">‚Äî</span> –∫–í—Ç</p>
          <p><b>AF F/B:</b> <span id="tAF">‚Äî</span> ¬∞C</p>
          <p><b>Thermostat:</b> <span id="tTherm">‚Äî</span></p>
          <div class="line"></div>
          <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 7. –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
    <ol>
      <li>–í–∏–∑–Ω–∞—á <b>–≤–∏—Ç—Ä–∞—Ç—É</b> (–±—É–¥—å-—è–∫–∏–º —ñ–∑ 3 –º–µ—Ç–æ–¥—ñ–≤) —ñ <b>BSFC</b> –ø—Ä–∏ –∑–∞–¥–∞–Ω—ñ–π –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ.</li>
      <li>–û—Ü—ñ–Ω–∏ <b>QÃá –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è</b> –¥–≤–æ–º–∞ —Å–ø–æ—Å–æ–±–∞–º–∏ (—á–∞—Å—Ç–∫–∞ –≤—ñ–¥ –ø–∞–ª–∏–≤–∞ —Ç–∞ –∑–∞ –≤–∏—Ç—Ä–∞—Ç–æ—é –û–ñ).</li>
      <li>–ü—ñ–¥—ñ–±—Ä–∞–π <b>–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—é –∞–Ω—Ç–∏—Ñ—Ä–∏–∑—É</b> –ø—ñ–¥ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Ä–µ–≥—ñ–æ–Ω—É; –ø–µ—Ä–µ–≤—ñ—Ä <b>—Ç–æ—á–∫—É –∑–∞–∫–∏–ø–∞–Ω–Ω—è</b> –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ç–∏—Å–∫—É.</li>
      <li>–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π <b>—Ç–µ—Ä–º–æ—Å—Ç–∞—Ç</b> –∑–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—î—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏.</li>
      <li>–ó–∞–ø–æ–≤–Ω–∏ <b>–∂—É—Ä–Ω–∞–ª</b> (‚â•3 —Ä—è–¥–∫–∏), —Å—Ñ–æ—Ä–º—É–π <b>NFC</b>, <b>–∫–≤–∏—Ç–æ–∫</b> —Ç–∞ <b>CSV</b> (<span class="mono">EngineHeat</span>).</li>
    </ol>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–í–∏—Ç—Ä–∞—Ç–∞/BSFC —Ç–∞ –ö–ö–î —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –∫–æ—Ä–µ–∫—Ç–Ω–æ</td><td>4</td></tr>
        <tr><td>–û—Ü—ñ–Ω–∫–∞ QÃá –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è (2 –º–µ—Ç–æ–¥–∏) –∑–±—ñ–≥–∞—î—Ç—å—Å—è –≤ –º–µ–∂–∞—Ö —Ä–æ–∑—É–º–Ω–æ–≥–æ</td><td>3</td></tr>
        <tr><td>–ê–Ω—Ç–∏—Ñ—Ä–∏–∑/—Ç–∏—Å–∫/—Ç–µ—Ä–º–æ—Å—Ç–∞—Ç ‚Äî –∞–¥–µ–∫–≤–∞—Ç–Ω—ñ –≤–∏—Å–Ω–æ–≤–∫–∏</td><td>2</td></tr>
        <tr><td>–ö–≤–∏—Ç–æ–∫/NFC + CSV</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));
  const bodyEl = document.getElementById('body');

  // ===== 1) –ü–∞–ª–∏–≤–æ / BSFC =====
  function calcFuel(){
    const mode = byId('fuelMode').value;
    const A = +byId('fuelA').value||0; // –∫–≥/–≥–æ–¥ –∞–±–æ –ª/–≥–æ–¥ –∞–±–æ –ª
    const Tm = +byId('fuelT').value||0; // —Ö–≤
    const rho = +byId('rho').value||0.84; // –∫–≥/–ª
    const P = +byId('Pout').value||0; // –∫–í—Ç
    const LHV = (+byId('LHV').value||42.6) * 1e6; // –î–∂/–∫–≥

    let mDot = 0, lph = 0;
    if(mode==='mass'){ mDot = A; lph = (rho>0)? mDot/rho : 0; }
    else if(mode==='vol'){ lph = A; mDot = lph * rho; }
    else { // volTime
      const l = A, h = (Tm>0)? (l * 60 / Tm) : 0; // –ª/–≥–æ–¥
      lph = h; mDot = h * rho;
    }

    const bsfc = (P>0)? (mDot*1000)/P : 0; // –≥/–∫–í—Ç¬∑–≥–æ–¥
    const Pin = mDot * LHV / 3600; // –í—Ç (–±–æ mDot —É –∫–≥/–≥–æ–¥ ‚Üí /3600)
    const eta = (Pin>0)? (P*1000)/Pin : 0;

    byId('mDot').textContent = rnd(mDot,2);
    byId('lph').textContent = rnd(lph,2);
    byId('bsfc').textContent = rnd(bsfc,0);
    byId('eta').textContent = rnd(eta*100,1);

    const csv = `FUEL|mode=${mode}|mDot=${rnd(mDot,2)}kgph|lph=${rnd(lph,2)}lph|Pout=${P}kW|BSFC=${rnd(bsfc,0)}g/kWh|eta=${rnd(eta*100,1)}%`;
    byId('csvFuel').textContent = csv;

    return {mDot,lph,bsfc,eta,P,LHV};
  }
  function presetFuel(){
    byId('fuelMode').value='volTime'; byId('fuelA').value=3.5; byId('fuelT').value=10; byId('rho').value=0.84; byId('Pout').value=110; byId('LHV').value=42.6;
    calcFuel();
  }

  // ===== 2) –û—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è =====
  function calcCool(){
    const f = calcFuel();
    const frac = (+byId('coolFrac').value||25)/100;
    const coolFlow = +byId('coolFlow').value||0; // –ª/—Ö–≤
    const Tin = +byId('Tin').value||0;
    const Tout = +byId('Tout').value||0;
    const dT = Math.max(0, Tout - Tin);

    // –û—Ü—ñ–Ω–∫–∞ –≤—ñ–¥ –ø–∞–ª–∏–≤–∞
    const Pin = f.mDot * (f.LHV) / 3600; // –í—Ç
    const Qcool = frac * Pin / 1000; // –∫–í—Ç

    // –ó–∞ –≤–∏—Ç—Ä–∞—Ç–æ—é –û–ñ
    const rho = 1.05; // –∫–≥/–ª
    const c = 3600;   // –î–∂/(–∫–≥¬∑¬∞C) ~ 3.6 –∫–î–∂/–∫–≥¬∞C
    const mDotCool = coolFlow * rho / 60; // –∫–≥/—Å
    const Qmeas = mDotCool * c * dT / 1000; // –∫–í—Ç

    let flag='üü¢ —É–∑–≥–æ–¥–∂–µ–Ω–æ', color='#10b981';
    if(Qmeas>0 && Math.abs(Qmeas - Qcool) > Math.max(10, 0.2*Qcool)){
      flag='üü† —Ä–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–∞–Ω—ñ/–¥–∞—Ç—á–∏–∫–∏'; color='#f59e0b';
    }

    byId('Qcool').textContent = rnd(Qcool,1);
    byId('Qmeas').textContent = rnd(Qmeas,1);
    byId('coolFlag').textContent = flag; byId('coolFlag').style.color = color;

    const csv = `COOL|frac=${(frac*100).toFixed(0)}%|Qcool‚âà${rnd(Qcool,1)}kW|Qmeas‚âà${rnd(Qmeas,1)}kW|Tin=${Tin}C|Tout=${Tout}C|Flow=${coolFlow}lpm|flag=${flag}`;
    byId('csvCool').textContent = csv;

    return {Qcool,Qmeas,flag};
  }

  // ===== 3) –ê–Ω—Ç–∏—Ñ—Ä–∏–∑ =====
  function mapEGtoFreeze(eg){
    // –ì—Ä—É–±–∞ –∞–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è –∫—Ä–∏–≤–æ—ó –∑–∞–º–µ—Ä–∑–∞–Ω–Ω—è (–µ—Ç–∏–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—å, % –º–∞—Å.)
    // 0%: 0¬∞C; 30%: -15; 40%: -25; 50%: -37; 60%: -55
    if(eg<=0) return 0;
    if(eg<=30) return 0 + (eg/30)*(-15);
    if(eg<=40) return -15 + ((eg-30)/10)*(-10);
    if(eg<=50) return -25 + ((eg-40)/10)*(-12);
    if(eg<=60) return -37 + ((eg-50)/10)*(-18);
    return -55 + (eg-60)*(-0.5); // –¥–∞–ª—ñ –ø–æ–≥—ñ—Ä—à–µ–Ω–Ω—è
  }
  function mapEGtoBoilBase(eg){
    // –¢–µ–º–ø. –∫–∏–ø—ñ–Ω–Ω—è –ø—Ä–∏ 1 –±–∞—Ä (–∞—Ç–º): –≤–æ–¥–∞ 100¬∞C; 50% EG ‚âà 108¬∞C
    if(eg<=0) return 100;
    if(eg<=50) return 100 + (eg/50)*8;
    if(eg<=60) return 108 + ((eg-50)/10)*4; // –¥–æ ~112
    return 112 + (eg-60)*0.2;
  }
  function calcAF(){
    const eg = +byId('eg').value||0;
    const cap = +byId('cap').value||1.2; // –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ç–∏—Å–∫ –Ω–∞–¥ –∞—Ç–º
    const atm = +byId('atm').value||1.0;
    const target = +byId('TminTarget').value||-30;

    const Tf = mapEGtoFreeze(eg);
    const Tb0 = mapEGtoBoilBase(eg);
    // –ü—ñ–¥–Ω—è—Ç—Ç—è —Ç–æ—á–∫–∏ –∫–∏–ø—ñ–Ω–Ω—è –∑ —Ç–∏—Å–∫–æ–º (–Ω–∞–±–ª.): ~+10¬∞C –Ω–∞ –∫–æ–∂–µ–Ω +1 –±–∞—Ä –≤—ñ–¥–Ω–æ—Å–Ω–æ–≥–æ
    const Tb = Tb0 + cap*10;

    let flag='üü¢ –æ–∫', color='#10b981';
    if(Tf>target){ flag='üî¥ —Å—É–º—ñ—à —Å–ª–∞–±–∫–∞ –¥–ª—è —Ä–µ–≥—ñ–æ–Ω—É'; color='#ef4444'; }
    else if(eg>60){ flag='üü† –∑–∞–Ω–∞–¥—Ç–æ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω–∞ (–Ω–∏–∑—å–∫–∞ —Ç–µ–ø–ª–æ—î–º–Ω—ñ—Å—Ç—å)'; color='#f59e0b'; }

    byId('Tf').textContent = rnd(Tf,0);
    byId('Tb').textContent = rnd(Tb,0);
    byId('mixFlag').textContent = flag; byId('mixFlag').style.color = color;

    const csv = `AF|EG=${eg}%|Freeze=${rnd(Tf,0)}C|Boil@${cap+atm}bar=${rnd(Tb,0)}C|TargetMin=${target}C|flag=${flag}`;
    byId('csvAF').textContent = csv;

    return {Tf,Tb,flag,eg,cap};
  }

  // ===== 4) –¢–µ—Ä–º–æ—Å—Ç–∞—Ç =====
  function calcTherm(){
    const Tspec = +byId('TopenSpec').value||0;
    const Tstab = +byId('Tstab').value||0;
    const Tamb = +byId('Tamb').value||0;
    const load = +byId('loadPct').value||0;

    const ofs = Tstab - Tspec;
    let flag='üü¢ –æ–∫', tip='—Å—Ç–∞–±—ñ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞';
    if(Tstab< Tspec-2){ flag='üî¥ –∑–∞—Å—Ç—Ä—è–≥–∞—î –≤—ñ–¥–∫—Ä–∏—Ç–∏–º / —Ä–∞–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è'; tip='–¥–æ–≤–≥–µ –ø—Ä–æ–≥—Ä—ñ–≤–∞–Ω–Ω—è, –Ω–∏–∑—å–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –æ–ø–∞–ª–µ–Ω–Ω—è'; }
    else if(Tstab> Tspec+12){ flag='üî¥ –ø—ñ–∑–Ω—î –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è / –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π –ø–æ—Ç—ñ–∫'; tip='–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç, –Ω–∞—Å–æ—Å, —Ä–∞–¥—ñ–∞—Ç–æ—Ä'; }
    else if(ofs>8 && load<50){ flag='üü† –≤–∏—Å–æ–∫–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è –±–µ–∑ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è'; tip='–∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è —Å–æ—Ç / –Ω–∏–∑—å–∫–∏–π –æ–±–¥—É–≤'; }

    byId('Tofs').textContent = rnd(ofs,1);
    byId('thermFlag').textContent = flag; byId('thermFlag').style.color = (flag.includes('üî¥')?'#ef4444':flag.includes('üü†')?'#f59e0b':'#10b981');
    byId('thermTip').textContent = tip;

    const csv = `THERM|Spec=${Tspec}C|Stab=${Tstab}C|Offset=${rnd(ofs,1)}C|Load=${load}%|Tamb=${Tamb}C|Flag=${flag}|Tip=${tip}`;
    byId('csvTherm').textContent = csv;

    return {ofs,flag,tip};
  }

  // ===== 5) –ñ—É—Ä–Ω–∞–ª =====
  function addRow(sample){
    const f = calcFuel(); const c = calcCool(); const af = calcAF(); const t = calcTherm();
    const def = {
      node:'–ü–æ–ª—å–æ–≤–∏–π —Ä–µ–∂–∏–º 75%',
      md:rnd(f.mDot,2),
      bsfc:rnd(f.bsfc,0),
      q:rnd(c.Qcool,1),
      af:`${rnd(af.Tf,0)}/${rnd(af.Tb,0)}`,
      th:`${rnd(t.ofs,1)}¬∞C ${t.flag}`,
      note:'–æ–∫'
    };
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.node}"></td>
      <td>${s.md}</td>
      <td class="dark">${s.bsfc}</td>
      <td class="dark">${s.q}</td>
      <td class="dark">${s.af}</td>
      <td>${s.th}</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyEl.appendChild(tr); reindex(); buildCSVlog();
  }
  function reindex(){ [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }
  function presetRows(){
    bodyEl.innerHTML='';
    addRow({node:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç 50%', md:'12.6', bsfc:'235', q:'35.2', af:'-37/120', th:'7.0¬∞C üü¢ –æ–∫', note:'–Ω–æ—Ä–º–∞'});
    addRow({node:'–û—Ä–∞–Ω–∫–∞ 90%', md:'24.3', bsfc:'218', q:'62.5', af:'-37/120', th:'14.0¬∞C üî¥', note:'–ø—Ä–æ—á–∏—Å—Ç–∏—Ç–∏ —Ä–∞–¥—ñ–∞—Ç–æ—Ä'});
    addRow({node:'–•–æ–ª–æ—Å—Ç–∏–π 0%', md:'3.1',  bsfc:'‚Äî',  q:'5.2',  af:'-25/112', th:'-4.0¬∞C üî¥', note:'—Ç–µ—Ä–º–æ—Å—Ç–∞—Ç –≤—ñ–¥–∫—Ä–∏—Ç–∏–π'});
    buildCSVlog();
  }
  function buildCSVlog(){
    const lines = [...bodyEl.querySelectorAll('tr')].map(tr=>{
      const idx=tr.querySelector('.idx').textContent.trim();
      const node=tr.children[1].querySelector('input').value.trim();
      const md  =tr.children[2].textContent.trim();
      const bsfc=tr.children[3].textContent.trim();
      const q   =tr.children[4].textContent.trim();
      const af  =tr.children[5].textContent.trim();
      const th  =tr.children[6].textContent.trim();
      const note=tr.children[7].querySelector('input').value.trim();
      return [idx,node,md,bsfc,q,af,th,note].join(' | ');
    });
    byId('csvLog').textContent = lines.join('\n') || '‚Äî';
  }

  // ===== 6) –ö–≤–∏—Ç–æ–∫ / NFC =====
  function buildTicket(){
    const f = calcFuel(); const c = calcCool(); const af = calcAF(); const t = calcTherm();
    const d = new Date().toISOString().slice(0,10);
    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${d}</small>`;
    byId('tMDot').textContent = rnd(f.mDot,2);
    byId('tLPH').textContent = rnd(f.lph,2);
    byId('tBSFC').textContent = rnd(f.bsfc,0);
    byId('tEta').textContent = rnd(f.eta*100,1);
    byId('tQcool').textContent = rnd(c.Qcool,1);
    byId('tAF').textContent = `${rnd(af.Tf,0)}/${rnd(af.Tb,0)}`;
    byId('tTherm').textContent = byId('thermFlag').textContent || '‚Äî';
    byId('tNote').textContent = `EG=${byId('eg').value}%; cap=${byId('cap').value} –±–∞—Ä; Tin/Tout=${byId('Tin').value}/${byId('Tout').value}¬∞C`;
  }
  function buildNFC(){
    const f = calcFuel(); const c = calcCool(); const af = calcAF(); const t = calcTherm();
    const text = [
      `ENGINE_HEAT_NFC`,
      `ID:${byId('nfcId').value}`,
      `FUEL:mDot=${rnd(f.mDot,2)}kgph (${rnd(f.lph,2)}lph); BSFC=${rnd(f.bsfc,0)}g/kWh; eta=${rnd(f.eta*100,1)}%`,
      `COOL:Q‚âà${rnd(c.Qcool,1)}kW (Tin=${byId('Tin').value}C, Tout=${byId('Tout').value}C, Flow=${byId('coolFlow').value}lpm)`,
      `AF:Freeze=${byId('Tf').textContent}C; Boil=${byId('Tb').textContent}C; EG=${byId('eg').value}%`,
      `THERM:${byId('thermFlag').textContent}`,
      `CONTACT:${byId('nfcPhone').value}`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = text;
  }

  // ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
  (function init(){
    calcFuel(); calcCool(); calcAF(); calcTherm();
    document.addEventListener('change', e=>{
      if(e.target.matches('input,select')) { calcFuel(); calcCool(); calcAF(); calcTherm(); }
    });
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
