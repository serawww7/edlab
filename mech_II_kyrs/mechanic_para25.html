<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 25 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –®–Ü#5: –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –¢–û (LLM-–∞–≥–µ–Ω—Ç, Gantt, CSV/ICS, —á–µ–∫ 58 –º–º)</title>
<meta name="description" content="–ß–µ—Ä–≥–∞ —Ä–æ–±—ñ—Ç –¢–û: —Ä–∏–∑–∏–∫, –±–µ–∑–ø–µ–∫–∞, –¥–µ–¥–ª–∞–π–Ω, –∑–∞–ø—á–∞—Å—Ç–∏–Ω–∏, –º–µ—Ö–∞–Ω—ñ–∫–∏. –ü—Ä—ñ–æ—Ä–∏—Ç–µ–∑–∞—Ü—ñ—è, —Ä–æ–∑–∫–ª–∞–¥ –ø–æ –¥–Ω—è—Ö, Gantt-–¥—ñ–∞–≥—Ä–∞–º–∞, –µ–∫—Å–ø–æ—Ä—Ç CSV/ICS, —á–µ–∫ 58 –º–º, –∂—É—Ä–Ω–∞–ª, –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1240px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:100px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
small.mono,.mono{font-family:ui-monospace,monospace}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.3fr 1fr}
@media(max-width:1120px){.grid{grid-template-columns:1fr}}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;max-width:100%}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
</style>
<link rel="canonical" href="https://edlab.pp.ua/mech_II_kyrs/mechanic_para25.html"><meta property="og:type" content="article"><meta property="og:title" content="–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 25"><meta property="og:description" content="–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ **—Ä–æ–∑–∫–ª–∞–¥ –¢–û/—Ä–µ–º–æ–Ω—Ç—É** –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ä–∏–∑–∏–∫—É, –±–µ–∑–ø–µ–∫–∏, –¥–µ–¥–ª–∞–π–Ω—ñ–≤, –∑–∞–ø—á–∞—Å—Ç–∏–Ω, —à—Ç–∞—Ç—É —Ç–∞ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –ø—Ä–æ—Å—Ç–æ—é. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ—Ü—ñ–Ω—é—î **–ø—Ä—ñ–æ—Ä–∏"><meta property="og:url" content="https://edlab.pp.ua/mech_II_kyrs/mechanic_para25.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 25","description":"–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ **—Ä–æ–∑–∫–ª–∞–¥ –¢–û/—Ä–µ–º–æ–Ω—Ç—É** –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ä–∏–∑–∏–∫—É, –±–µ–∑–ø–µ–∫–∏, –¥–µ–¥–ª–∞–π–Ω—ñ–≤, –∑–∞–ø—á–∞—Å—Ç–∏–Ω, —à—Ç–∞—Ç—É —Ç–∞ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –ø—Ä–æ—Å—Ç–æ—é. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ—Ü—ñ–Ω—é—î **–ø—Ä—ñ–æ—Ä–∏","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/mech_II_kyrs/mechanic_para25.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üóÇÔ∏è</span>
      <div>
        <b>–ü–∞—Ä–∞ 25 ‚Äî –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –¢–û (–®–Ü-–∞–≥–µ–Ω—Ç, Gantt, CSV/ICS)</b><br>
        <span class="badge">—á–µ—Ä–≥–∞ —Ä–æ–±—ñ—Ç ‚Üí –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç ‚Üí —Ä–µ—Å—É—Ä—Å–∏ ‚Üí —Ä–æ–∑–∫–ª–∞–¥ ‚Üí Gantt ‚Üí –µ–∫—Å–ø–æ—Ä—Ç ‚Üí —á–µ–∫ 58 –º–º</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ **—Ä–æ–∑–∫–ª–∞–¥ –¢–û/—Ä–µ–º–æ–Ω—Ç—É** –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º <b>—Ä–∏–∑–∏–∫—É</b>, <b>–±–µ–∑–ø–µ–∫–∏</b>, <b>–¥–µ–¥–ª–∞–π–Ω—ñ–≤</b>, <b>–∑–∞–ø—á–∞—Å—Ç–∏–Ω</b>, <b>—à—Ç–∞—Ç—É</b> —Ç–∞ <b>–≤–∞—Ä—Ç–æ—Å—Ç—ñ –ø—Ä–æ—Å—Ç–æ—é</b>. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ—Ü—ñ–Ω—é—î **–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç** —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–ª–∞–Ω—É—î –¥–Ω—ñ, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ **LOTO/–±–µ–∑–ø–µ–∫—É** —Ç–∞ **–≤–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É –∫–∞–ª–µ–Ω–¥–∞—Ä (.ics)**.</p>

  <div class="grid">
    <!-- –õ–Ü–í–û: —á–µ—Ä–≥–∞ —Ä–æ–±—ñ—Ç + —Ä–µ—Å—É—Ä—Å–∏ + –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
    <div class="card">
      <h2>üßæ –ß–µ—Ä–≥–∞ —Ä–æ–±—ñ—Ç</h2>
      <table class="tbl" id="jobsTbl">
        <thead>
          <tr>
            <th>–ú–∞—à–∏–Ω–∞</th><th>–†–æ–±–æ—Ç–∞</th><th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å, –≥–æ–¥</th><th>–ü–æ—Ç—Ä. –º–µ—Ö.</th>
            <th>–î–µ–¥–ª–∞–π–Ω</th><th>–†–∏—Å–∫ p(0..1)</th><th>–í–ø–ª–∏–≤ 1..5</th><th>–ë–µ–∑–ø–µ–∫–∞</th>
            <th>Downtime, $/–¥–µ–Ω—å</th><th>–ó–∞–ø—á–∞—Å—Ç–∏–Ω–∏ (item:—à—Ç)</th><th>–î—ñ—è</th>
          </tr>
        </thead>
        <tbody id="jobsBody"></tbody>
      </table>
      <div class="row" style="margin-top:6px">
        <input class="input" id="jMach" placeholder="–¢—Ä–∞–∫—Ç–æ—Ä –ú–¢–ó-82">
        <input class="input" id="jTask" placeholder="–ó–∞–º—ñ–Ω–∞ –ø—ñ–¥—à–∏–ø–Ω–∏–∫–∞ –Ω–∞ –ø—Ä–æ–º–≤–∞–ª—ñ">
        <input class="input" id="jDur" type="number" min="1" step="1" value="6">
        <input class="input" id="jTech" type="number" min="1" step="1" value="2">
        <input class="input" id="jDue" type="date">
        <input class="input" id="jRisk" type="number" min="0" max="1" step="0.05" value="0.6">
        <input class="input" id="jImp" type="number" min="1" max="5" step="1" value="4">
        <select class="input" id="jSafe"><option value="ok">ok</option><option value="warn">warn</option><option value="critical">critical</option></select>
        <input class="input" id="jDown" type="number" min="0" step="10" value="400">
        <input class="input" id="jParts" placeholder="6204:2, A42:1">
        <button class="btn good" id="addJob">‚ûï –î–æ–¥–∞—Ç–∏</button>
        <button class="btn secondary" id="demoJobs">üìå –î–µ–º–æ–¥–∞–Ω—ñ</button>
      </div>
    </div>

    <div class="card">
      <h2>üë∑ –†–µ—Å—É—Ä—Å–∏ —Ç–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è</h2>
      <div class="row">
        <label style="flex:1">–ú–µ—Ö–∞–Ω—ñ–∫—ñ–≤ —É –∑–º—ñ–Ω—ñ<input class="input" id="capTech" type="number" min="1" value="4"></label>
        <label style="flex:1">–ì–æ–¥–∏–Ω —É –∑–º—ñ–Ω—ñ<input class="input" id="capHours" type="number" min="1" value="8"></label>
        <label style="flex:1">–ü–æ—á–∞—Ç–∫–æ–≤–∞ –¥–∞—Ç–∞ –ø–ª–∞–Ω—É<input class="input" id="startDate" type="date"></label>
      </div>
      <div class="row">
        <label style="flex:1">–ó–∞–ø–∞—Å–∏ (—á–µ—Ä–µ–∑ –∫–æ–º—É)<textarea id="stock" class="input" placeholder="6204:10, A42:3, HLP-46:20–ª, M10:50"></textarea></label>
        <label style="flex:1">–í–∞–≥–∞ –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤<input class="input" id="weights" value="{&quot;risk&quot;:0.35,&quot;impact&quot;:0.2,&quot;safety&quot;:0.2,&quot;urgency&quot;:0.15,&quot;downtime&quot;:0.1}"></label>
      </div>
      <div class="row">
        <button class="btn" id="plan">üß† –°–ø–ª–∞–Ω—É–≤–∞—Ç–∏ (–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç‚Üí—Ä–æ–∑–∫–ª–∞–¥)</button>
        <button class="btn secondary" id="clearAll">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
        <span id="stat" class="badge">–°—Ç–∞—Ç—É—Å: –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è</span>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>üìä –ü—Ä—ñ–æ—Ä–∏—Ç–µ–∑–∞—Ü—ñ—è —Ç–∞ —Ä–æ–∑–∫–ª–∞–¥</h2>
    <div class="row">
      <div style="flex:1">
        <table class="tbl" id="prioTbl">
          <thead><tr><th>#</th><th>–ú–∞—à–∏–Ω–∞</th><th>–†–æ–±–æ—Ç–∞</th><th>Score</th><th>–ü—Ä–∏—á–∏–Ω–∞</th></tr></thead>
          <tbody id="prioBody"><tr><td colspan="5" class="muted">–ù–∞—Ç–∏—Å–Ω–∏ ¬´–°–ø–ª–∞–Ω—É–≤–∞—Ç–∏¬ª</td></tr></tbody>
        </table>
      </div>
      <div style="flex:1">
        <table class="tbl" id="planTbl">
          <thead><tr><th>–î–∞—Ç–∞</th><th>–ó–∞–≤–¥–∞–Ω–Ω—è</th><th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</th><th>–ú–µ—Ö.</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
          <tbody id="planBody"><tr><td colspan="5" class="muted">–ü–æ—Ä–æ–∂–Ω—å–æ</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>üìà Gantt-–¥—ñ–∞–≥—Ä–∞–º–∞</h2>
    <div class="canvasWrap"><canvas id="gantt" width="1100" height="360"></canvas></div>
    <small class="muted">–ö–ª—ñ–∫ –ø–æ –±–∞—Ä—É ‚Äî –≤–∏–¥—ñ–ª–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è; –ø–æ–¥–≤—ñ–π–Ω–∏–π –∫–ª—ñ–∫ ‚Äî –≤—ñ–¥–º—ñ—Ç–∏—Ç–∏ —è–∫ <b>–≤–∏–∫–æ–Ω–∞–Ω–æ</b>.</small>
  </div>

  <div class="grid">
    <div class="card">
      <h2>üß† –ü—Ä–æ–º–ø—Ç –¥–æ LLM-–∞–≥–µ–Ω—Ç–∞ (–æ–ø—Ü—ñ–π–Ω–æ)</h2>
      <div class="row">
        <button class="btn" id="mkPromptUA">üá∫üá¶ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ (—É–∫—Ä)</button>
        <button class="btn" id="mkPromptEN">üá¨üáß Generate (eng)</button>
        <button class="btn secondary" id="copyPrompt">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      </div>
      <pre class="code" id="promptBox">// –°–ø–æ—á–∞—Ç–∫—É –ø–æ–±—É–¥—É–π —Ä–æ–∑–∫–ª–∞–¥</pre>
    </div>

    <div class="card">
      <h2>üìú –ñ—É—Ä–Ω–∞–ª —ñ –µ–∫—Å–ø–æ—Ä—Ç</h2>
      <div class="row">
        <button class="btn" id="expCSV">üìÑ CSV (—Ä–æ–∑–∫–ª–∞–¥)</button>
        <button class="btn" id="expICS">üìÜ ICS (–∫–∞–ª–µ–Ω–¥–∞—Ä)</button>
        <button class="btn" id="makeReceipt">üñ®Ô∏è 58 –º–º —á–µ–∫</button>
      </div>
      <pre class="code" id="alog" style="max-height:180px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –∑–∞–ø–∏—Å—ñ–≤</pre>
      <div class="receipt" id="rc" hidden=""></div>
    </div>
  </div>

  <div class="card">
    <h2>üéØ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
    <ol>
      <li>–ó–∞–≤–∞–Ω—Ç–∞–∂ 6‚Äì10 —Ä–æ–±—ñ—Ç (—Ä—ñ–∑–Ω—ñ —Ä–∏–∑–∏–∫–∏/–¥–µ–¥–ª–∞–π–Ω–∏), –≤—Å—Ç–∞–Ω–æ–≤–∏ <b>–∑–∞–ø–∞—Å–∏</b> —Ç–∞ <b>–≤–∞–≥–∏</b>. –ù–∞—Ç–∏—Å–Ω–∏ ¬´–°–ø–ª–∞–Ω—É–≤–∞—Ç–∏¬ª. –ó–±–µ—Ä–µ–∂–∏ <b>CSV</b> —Ç–∞ <b>ICS</b>.</li>
      <li>–ó–º—ñ–Ω–∏ –≤–∞–≥–∏ —Ç–∞–∫, —â–æ–± –±–µ–∑–ø–µ–∫–∞ –º–∞–ª–∞ –Ω–∞–π–±—ñ–ª—å—à–∏–π –≤–ø–ª–∏–≤, —ñ –ø–æ–≤—Ç–æ—Ä–∏ –ø–ª–∞–Ω. –ü–æ—Ä—ñ–≤–Ω—è–π <b>Score</b> —Ç–∞ –ø–æ—Ä—è–¥–æ–∫ —É <b>TXT</b>-–Ω–æ—Ç–∞—Ç—Ü—ñ.</li>
      <li>–í—ñ–¥–º—ñ—Ç—å 1‚Äì2 –∑–∞–¥–∞—á—ñ —è–∫ ¬´–≤–∏–∫–æ–Ω–∞–Ω–æ¬ª –Ω–∞ Gantt, –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–≥–µ–Ω–µ—Ä—É–π —á–µ–∫ 58 –º–º –¥–ª—è –±—Ä–∏–≥–∞–¥–∏.</li>
    </ol>
  </div>

  <div class="card">
    <h2>üîå –°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫—É (SVG)</h2>
    <svg viewBox="0 0 980 260" role="img" aria-label="–ß–µ—Ä–≥–∞ ‚Üí –ü—Ä—ñ–æ—Ä–∏—Ç–µ–∑–∞—Ü—ñ—è ‚Üí –†–æ–∑–∫–ª–∞–¥ ‚Üí Gantt ‚Üí –ï–∫—Å–ø–æ—Ä—Ç">
      <rect x="40" y="60" width="180" height="100" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
      <text x="130" y="92" fill="#e5e7eb" font-size="14" text-anchor="middle">–ß–µ—Ä–≥–∞ —Ä–æ–±—ñ—Ç</text>
      <text x="130" y="112" fill="#93c5fd" font-size="12" text-anchor="middle">—Ä–∏–∑–∏–∫/–∑–∞–ø—á–∞—Å—Ç–∏–Ω–∏</text>

      <rect x="250" y="50" width="200" height="120" rx="12" fill="#14532d" stroke="#22c55e"></rect>
      <text x="350" y="90" fill="#dcfce7" font-size="14" text-anchor="middle">–ü—Ä—ñ–æ—Ä–∏—Ç–µ–∑–∞—Ü—ñ—è</text>
      <text x="350" y="108" fill="#a7f3d0" font-size="12" text-anchor="middle">risk¬∑impact¬∑safety¬∑urgency¬∑downtime</text>

      <rect x="480" y="50" width="200" height="120" rx="12" fill="#1f2937" stroke="#9ca3af"></rect>
      <text x="580" y="90" fill="#e5e7eb" font-size="14" text-anchor="middle">–†–æ–∑–∫–ª–∞–¥</text>
      <text x="580" y="108" fill="#93c5fd" font-size="12" text-anchor="middle">–ª—é–¥–∏¬∑–≥–æ–¥–∏–Ω–∏¬∑—Å–∫–ª–∞–¥</text>

      <rect x="700" y="50" width="240" height="120" rx="12" fill="#0b1a2f" stroke="#64748b"></rect>
      <text x="820" y="90" fill="#e5e7eb" font-size="14" text-anchor="middle">Gantt + –ï–∫—Å–ø–æ—Ä—Ç</text>
      <text x="820" y="108" fill="#93c5fd" font-size="12" text-anchor="middle">CSV / ICS / —á–µ–∫ 58 –º–º</text>

      <line x1="220" y1="110" x2="250" y2="110" stroke="#93c5fd" stroke-width="3"></line>
      <line x1="450" y1="110" x2="480" y2="110" stroke="#22c55e" stroke-width="3"></line>
      <line x1="680" y1="110" x2="700" y2="110" stroke="#64748b" stroke-width="3"></line>
    </svg>
  </div>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>CSV —Ä–æ–∑–∫–ª–∞–¥—É: <span class="mono">date,start,end,machine,task,hours,tech,score,status</span>.</li>
      <li>ICS –∫–∞–ª–µ–Ω–¥–∞—Ä —ñ–∑ –ø–æ–¥—ñ—è–º–∏ –ø–æ —Ä–æ–±–æ—Ç–∞—Ö.</li>
      <li>–°–∫—Ä–∏–Ω Gantt + —á–µ–∫ 58 –º–º –¥–ª—è –±—Ä–∏–≥–∞–¥–∏.</li>
    </ul>
  </div>

  <div class="card">
    <h2>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
    <p class="muted small">–ü—ñ–æ–Ω–µ—Ä–∏ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è —É 1950-—Ö (PERT/CPM) –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞–ª–∏ –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ –∫–æ—Ä–∞–±–ª—ñ–≤. –°—å–æ–≥–æ–¥–Ω—ñ —Ç–æ–π —Å–∞–º–∏–π –¥—É—Ö ‚Äî —É —à–∫—ñ–ª—å–Ω–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ: —Ä–∏–∑–∏–∫, —Ä–µ—Å—É—Ä—Å–∏, –∫—Ä–∏—Ç–∏—á–Ω—ñ –≤—ñ–∫–Ω–∞ ‚Äî —ñ –Ω–∞ –≤–∏—Ö–æ–¥—ñ –∫–∞–ª–µ–Ω–¥–∞—Ä –¥–ª—è —Ä–µ–º–æ–Ω—Ç–Ω–æ—ó –±—Ä–∏–≥–∞–¥–∏.</p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function parseDate(d){const t=new Date(d); if(isNaN(+t)) return null; return new Date(t.getFullYear(),t.getMonth(),t.getDate());}
function addDays(d,n){const x=new Date(d); x.setDate(x.getDate()+n); return x;}
function ymd(d){return d.toISOString().slice(0,10);}
function pad(n){return (n<10?'0':'')+n;}
function log(msg){const t=new Date().toLocaleTimeString(); const box=$('#alog'); if(box.textContent.startsWith('//')) box.textContent=''; box.textContent+=`[${t}] ${msg}\n`; box.scrollTop=box.scrollHeight;}

// ===== –î–∞–Ω—ñ =====
let JOBS=[]; // {id,mach,task,dur,tech,due,risk,imp,safe,down,parts:{name:qty}}
let PLAN=[]; // {date,start,end,jobId,hours,tech,status}
let STOCK=new Map(); // part -> qty
let SELECTED=null;

// ===== –ß–µ—Ä–≥–∞ —Ä–æ–±—ñ—Ç =====
function renderJobs(){
  const body=$('#jobsBody'); body.innerHTML='';
  if(!JOBS.length){ body.innerHTML='<tr><td colspan="11" class="muted">–î–æ–¥–∞–π —Ä–æ–±–æ—Ç–∏</td></tr>'; return; }
  JOBS.forEach((j,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${j.mach}</td><td>${j.task}</td><td>${j.dur}</td><td>${j.tech}</td>
      <td>${j.due?ymd(j.due):'‚Äî'}</td><td>${j.risk.toFixed(2)}</td><td>${j.imp}</td>
      <td>${j.safe}</td><td>${j.down}</td>
      <td>${Object.entries(j.parts).map(([k,v])=>`${k}:${v}`).join(', ')||'‚Äî'}</td>
      <td><button class="btn secondary" data-del="${j.id}">üóëÔ∏è</button></td>`;
    body.appendChild(tr);
  });
  body.querySelectorAll('button[data-del]').forEach(b=>{
    b.addEventListener('click',()=>{ JOBS=JOBS.filter(x=>x.id!==b.getAttribute('data-del')); renderJobs(); });
  });
}

function parseParts(s){
  const out={}; (s||'').split(',').map(x=>x.trim()).filter(Boolean).forEach(p=>{
    const m=p.match(/^(.+?):\s*([0-9]+)\s*$/);
    if(m){ out[m[1].trim()]=parseInt(m[2],10); }
  });
  return out;
}
function parseStock(s){
  STOCK.clear();
  (s||'').split(',').map(x=>x.trim()).filter(Boolean).forEach(p=>{
    // –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ "HLP-46:20–ª" ‚Üí –∑–∞–ø–∏—Å—É—î–º–æ —è–∫ 20 (–æ–¥.)
    const m=p.match(/^(.+?):\s*([0-9]+(?:[.,][0-9]+)?)\s*/i);
    if(m){ STOCK.set(m[1].trim(), parseFloat(m[2].replace(',','.'))); }
  });
}

$('#addJob').addEventListener('click', ()=>{
  const mach=($('#jMach').value||'').trim();
  const task=($('#jTask').value||'').trim();
  const dur=parseInt($('#jDur').value,10)||1;
  const tech=parseInt($('#jTech').value,10)||1;
  const due=parseDate($('#jDue').value);
  const risk=parseFloat($('#jRisk').value)||0;
  const imp=parseInt($('#jImp').value,10)||1;
  const safe=$('#jSafe').value;
  const down=parseFloat($('#jDown').value)||0;
  const parts=parseParts($('#jParts').value);
  if(!mach||!task){ alert('–ó–∞–ø–æ–≤–Ω–∏ –ú–∞—à–∏–Ω–∞ —ñ –†–æ–±–æ—Ç–∞'); return; }
  const id='J'+Math.random().toString(36).slice(2,8);
  JOBS.push({id,mach,task,dur,tech,due,risk,imp,safe,down,parts});
  renderJobs();
});
$('#demoJobs').addEventListener('click', ()=>{
  const today=new Date(); const d=dt=>ymd(addDays(today,dt));
  $('#jDue').value=d(2);
  JOBS=[
    {id:'J1',mach:'–ö–æ–º–±–∞–π–Ω John Deere',task:'–ü—ñ–¥—à–∏–ø–Ω–∏–∫ —Ä–æ—Ç–æ—Ä–∞ 6307',dur:8,tech:2,due:addDays(today,2),risk:0.7,imp:5,safe:'critical',down:1500,parts:{'6307':1,'–õ—ñ—Ç–æ–ª-24':1}},
    {id:'J2',mach:'–¢—Ä–∞–∫—Ç–æ—Ä –ú–¢–ó-82',task:'–†–µ–º—ñ–Ω—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ A42',dur:3,tech:1,due:addDays(today,4),risk:0.4,imp:2,safe:'ok',down:300,parts:{'A42':1}},
    {id:'J3',mach:'–û–±–ø—Ä–∏—Å–∫—É–≤–∞—á Amazone',task:'–¢—Ä—ñ—â–∏–Ω–∞ —Ö–æ–º—É—Ç–∞ √ò25, –∑–∞–º—ñ–Ω–∞',dur:2,tech:1,due:addDays(today,1),risk:0.6,imp:3,safe:'warn',down:500,parts:{'–•–æ–º—É—Ç 25-40':2}},
    {id:'J4',mach:'–ö–æ—Å–∞—Ä–∫–∞',task:'–í—ñ–±—Ä–∞—Ü—ñ—è —Ä–µ–¥—É–∫—Ç–æ—Ä–∞, –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞',dur:5,tech:2,due:addDays(today,3),risk:0.8,imp:4,safe:'warn',down:700,parts:{}},
    {id:'J5',mach:'–ü–æ—Å—ñ–≤–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Å',task:'–ì—ñ–¥—Ä–æ—Ä–æ–∑–ø–æ–¥—ñ–ª—å–Ω–∏–∫ ‚Äî —Ç–µ—á–∞',dur:6,tech:2,due:addDays(today,2),risk:0.9,imp:5,safe:'critical',down:1200,parts:{'HLP-46':5}}
  ];
  $('#stock').value='6307:2, –õ—ñ—Ç–æ–ª-24:3, A42:3, –•–æ–º—É—Ç 25-40:10, HLP-46:20';
  $('#weights').value='{"risk":0.35,"impact":0.2,"safety":0.2,"urgency":0.15,"downtime":0.1}';
  const sd=ymd(today); $('#startDate').value=sd;
  renderJobs();
  log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ');
});

$('#clearAll').addEventListener('click', ()=>{
  JOBS=[]; PLAN=[]; STOCK.clear();
  $('#stock').value=''; $('#prioBody').innerHTML='<tr><td colspan="5" class="muted">‚Äî</td></tr>';
  $('#planBody').innerHTML='<tr><td colspan="5" class="muted">‚Äî</td></tr>';
  const g=$('#gantt').getContext('2d'); g.clearRect(0,0,$('#gantt').width,$('#gantt').height);
  log('–û—á–∏—â–µ–Ω–æ –≤—Å—ñ –¥–∞–Ω—ñ');
});

// ===== –ü—Ä—ñ–æ—Ä–∏—Ç–µ–∑–∞—Ü—ñ—è =====
function safetyWeight(s){ return s==='critical'?1 : (s==='warn'?0.5:0); }
function urgencyScore(due, start){
  if(!due) return 0.2; // –Ω–µ–≤—ñ–¥–æ–º–∏–π –¥–µ–¥–ª–∞–π–Ω ‚Äî –Ω–µ–≤–µ–ª–∏–∫–∏–π —Ç–∏—Å–∫
  const days = Math.max(0,(due - start)/(24*3600*1000));
  if(days<=0) return 1;
  if(days<1) return 0.9;
  if(days<3) return 0.7;
  if(days<5) return 0.5;
  if(days<7) return 0.3;
  return 0.1;
}
function normDowntime(v, arr){
  const max=Math.max(10, ...arr);
  return Math.min(1, v/max);
}
function computePriority(jobs, weights, startDate){
  const downs=jobs.map(j=>j.down);
  return jobs.map(j=>{
    const risk=j.risk; // 0..1
    const imp=j.imp/5; // 0..1
    const saf=safetyWeight(j.safe); // 0..1
    const urg=urgencyScore(j.due, startDate); // 0..1
    const dtn=normDowntime(j.down, downs); // 0..1
    const score = weights.risk*risk + weights.impact*imp + weights.safety*saf + weights.urgency*urg + weights.downtime*dtn;
    const why = `risk ${risk.toFixed(2)} ¬∑ imp ${(imp*5).toFixed(0)}/5 ¬∑ safety ${j.safe} ¬∑ urg ${(urg*100).toFixed(0)}% ¬∑ dt ${(dtn*100).toFixed(0)}%`;
    return {id:j.id,score,why};
  }).sort((a,b)=>b.score-a.score);
}

function renderPrio(list){
  const body=$('#prioBody'); body.innerHTML='';
  list.forEach((p,i)=>{
    const j=JOBS.find(x=>x.id===p.id);
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${j.mach}</td><td>${j.task}</td><td>${p.score.toFixed(3)}</td><td class="small muted">${p.why}</td>`;
    body.appendChild(tr);
  });
  if(!list.length){ body.innerHTML='<tr><td colspan="5" class="muted">–ü–æ—Ä–æ–∂–Ω—å–æ</td></tr>'; }
}

// ===== –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ =====
function cloneStock(){ const m=new Map(); STOCK.forEach((v,k)=>m.set(k,v)); return m; }
function partsAvailable(job, stock){ return Object.entries(job.parts).every(([k,v]) => (stock.get(k)||0) >= v); }
function consumeParts(job, stock){ Object.entries(job.parts).forEach(([k,v])=> stock.set(k, (stock.get(k)||0)-v)); }
function planSchedule(jobs, prio, startDate, capTech, capHours){
  const dayCap = capTech * capHours; // –ª—é–¥–∏–Ω–æ-–≥–æ–¥–∏–Ω–∏ –Ω–∞ –¥–µ–Ω—å
  let cur = new Date(startDate);
  const plan=[]; const used= new Set(); const stock=cloneStock();
  // –Ü–¥–µ–º–æ –ø–æ –¥–Ω—è—Ö, –ø–æ–∫–∏ —î –Ω–µ–∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ
  let safetyLoop=0;
  while(used.size<jobs.length && safetyLoop<365){
    safetyLoop++;
    let remaining=dayCap; let techLeft=capTech;
    // –∫–æ–∂–Ω–æ–≥–æ –¥–Ω—è —Å—Ç–∞–≤–∏–º–æ –∑–∞–¥–∞—á—ñ –≤ –ø–æ—Ä—è–¥–∫—É –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É
    for(const p of prio){
      if(used.has(p.id)) continue;
      const j=jobs.find(x=>x.id===p.id);
      if(!partsAvailable(j,stock)) continue;
      if(j.tech>techLeft) continue; // –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤ —Å—å–æ–≥–æ–¥–Ω—ñ
      const hours = Math.min(j.dur, remaining/j.tech); // –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –º–æ–∂–µ–º–æ –≤–∏–¥—ñ–ª–∏—Ç–∏ —Å—Ç—ñ–ª—å–∫–∏ –≥–æ–¥–∏–Ω
      if(hours<=0) continue;
      // —Ñ—ñ–∫—Å—É—î–º–æ —Å–ª–æ—Ç
      const startH = capHours - Math.floor(remaining/j.tech); // –≥—Ä—É–±–∞ –ø—Ä–∏–≤'—è–∑–∫–∞
      const endH = startH + hours;
      plan.push({date:new Date(cur), start:startH, end:endH, jobId:j.id, hours, tech:j.tech, status:'planned'});
      remaining -= hours*j.tech;
      techLeft -= 0; // –º–µ—Ö–∞–Ω—ñ–∫–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–ª–æ—Ç—É; –º–æ–¥–µ–ª—å —Å–ø—Ä–æ—â–µ–Ω–∞
      j.dur -= hours;
      if(j.dur<=0){ used.add(j.id); consumeParts(j,stock); }
    }
    // –Ω–∞—Å—Ç—É–ø–Ω–∏–π –¥–µ–Ω—å
    cur = addDays(cur,1);
  }
  return plan;
}

function renderPlan(plan){
  const body=$('#planBody'); body.innerHTML='';
  if(!plan.length){ body.innerHTML='<tr><td colspan="5" class="muted">–ü–æ—Ä–æ–∂–Ω—å–æ</td></tr>'; return; }
  plan.forEach(s=>{
    const j=JOBS.find(x=>x.id===s.jobId);
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${ymd(s.date)}</td><td>${j.mach} ‚Äî ${j.task}</td><td>${s.hours.toFixed(1)} –≥–æ–¥</td><td>${s.tech}</td><td>${s.status}</td>`;
    body.appendChild(tr);
  });
}

// ===== Gantt =====
const gantt=$('#gantt'), gctx=gantt.getContext('2d');
function drawGantt(plan){
  const W=gantt.width, H=gantt.height;
  gctx.clearRect(0,0,W,H);
  if(!plan.length){ gctx.fillStyle='#94a3b8'; gctx.fillText('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è Gantt', 20, 20); return; }
  const dates=[...new Set(plan.map(s=>ymd(s.date)))];
  const dayWidth=Math.max(80, Math.floor((W-160)/dates.length));
  const rowHeight=36;
  // –æ—Å—ñ
  gctx.strokeStyle='#223049'; gctx.strokeRect(0.5,0.5,W-1,H-1);
  // –¥–Ω—ñ
  dates.forEach((d,i)=>{
    const x=100+i*dayWidth;
    gctx.fillStyle='#94a3b8'; gctx.fillText(d, x+8, 16);
    gctx.strokeStyle='#223049'; gctx.beginPath(); gctx.moveTo(x,20); gctx.lineTo(x,H-10); gctx.stroke();
  });
  // –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –∑–∞–¥–∞—á–∞—Ö
  const jobsOrder=[...new Set(plan.map(s=>s.jobId))];
  jobsOrder.forEach((jid,ri)=>{
    const y=30+ri*rowHeight;
    const j=JOBS.find(x=>x.id===jid);
    gctx.fillStyle='#e6eef9'; gctx.fillText((ri+1)+'. '+j.mach+' ‚Äî '+j.task, 8, y+14);
    // —Å–ª–æ—Ç–∏
    const slots=plan.filter(s=>s.jobId===jid);
    slots.forEach(s=>{
      const i=dates.indexOf(ymd(s.date));
      const x=100+i*dayWidth;
      const span=Math.max(8, Math.floor((s.end-s.start)/($('#capHours').value||8)* (dayWidth-12)));
      gctx.fillStyle = s.status==='done' ? '#22c55e' : '#38bdf8';
      gctx.fillRect(x+6, y+6, span, rowHeight-12);
      gctx.strokeStyle='#0b1220'; gctx.strokeRect(x+6.5, y+6.5, span-1, rowHeight-13);
    });
  });

  // —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤: —Ö—ñ—Ç-—Ç–µ—Å—Ç
  gantt.onclick=(e)=>{
    const r=gantt.getBoundingClientRect(); const mx=e.clientX-r.left, my=e.clientY-r.top;
    SELECTED = hitSlot(mx,my,plan,dates,dayWidth,rowHeight);
    if(SELECTED){ const j=JOBS.find(x=>x.id===SELECTED.jobId); log(`–í–∏–±—Ä–∞–Ω–æ: ${ymd(SELECTED.date)} | ${j.mach} ‚Äî ${j.task} (${SELECTED.hours.toFixed(1)} –≥–æ–¥)`); }
  };
  gantt.ondblclick=(e)=>{
    const r=gantt.getBoundingClientRect(); const mx=e.clientX-r.left, my=e.clientY-r.top;
    const sl=hitSlot(mx,my,plan,dates,dayWidth,rowHeight);
    if(sl){ sl.status = (sl.status==='done'?'planned':'done'); renderPlan(plan); drawGantt(plan); log(`–°—Ç–∞—Ç—É—Å –∑–º—ñ–Ω–µ–Ω–æ: ${ymd(sl.date)} ‚Üí ${sl.status}`); }
  };
}
function hitSlot(mx,my,plan,dates,dayWidth,rowHeight){
  const jobsOrder=[...new Set(plan.map(s=>s.jobId))];
  for(let ri=0;ri<jobsOrder.length;ri++){
    const y=30+ri*rowHeight;
    if(my<y||my>y+rowHeight) continue;
    const jid=jobsOrder[ri];
    for(const s of plan.filter(x=>x.jobId===jid)){
      const i=dates.indexOf(ymd(s.date)); const x=100+i*dayWidth;
      const span=Math.max(8, Math.floor((s.end-s.start)/($('#capHours').value||8)* (dayWidth-12)));
      if(mx>=x+6 && mx<=x+6+span && my>=y+6 && my<=y+6+rowHeight-12) return s;
    }
  }
  return null;
}

// ===== –ü—Ä–æ–º–ø—Ç–∏ –¥–æ LLM =====
function makePrompt(lang='ua'){
  if(!PLAN.length){ alert('–°–ø–µ—Ä—à—É –ø–æ–±—É–¥—É–π —Ä–æ–∑–∫–ª–∞–¥'); return; }
  const w=JSON.parse($('#weights').value||'{"risk":0.35}');
  const header = (lang==='ua')
   ? `SYSTEM:\n–¢–∏ ‚Äî –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –¢–û —Å/–≥ —Ç–µ—Ö–Ω—ñ–∫–∏. –ù–∞–¥–∞–π –∫–æ—Ä–æ—Ç–∫—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó, –∑–≤–µ—Ä–Ω–∏ —É–≤–∞–≥—É –Ω–∞ –±–µ–∑–ø–µ–∫—É (LOTO, –ó–Ü–ó), –∫—Ä–∏—Ç–∏—á–Ω—ñ –≤—É–∑–ª–∏ —Ç–∞ —Ä–∏–∑–∏–∫–∏.\nUSER:\n`
   : `SYSTEM:\nYou are a maintenance planner for agricultural machinery. Provide brief recommendations stressing safety (LOTO, PPE), critical items and risks.\nUSER:\n`;
  const jobs = JOBS.map(j=>`- ${j.mach} | ${j.task} | dur ${j.dur<=0?0:j.dur}h left | tech ${j.tech} | due ${j.due?ymd(j.due):'‚Äî'} | risk ${j.risk} | impact ${j.imp}/5 | safety ${j.safe} | downtime $${j.down}/day | parts ${Object.entries(j.parts).map(([k,v])=>k+':'+v).join(';')||'‚Äî'}`).join('\n');
  const plan = PLAN.map(s=>{ const j=JOBS.find(x=>x.id===s.jobId); return `${ymd(s.date)} ${pad(Math.floor(s.start))}:00-${pad(Math.floor(s.end))}:00 | ${j.mach} ‚Äî ${j.task} | ${s.hours.toFixed(1)}h x${s.tech} | ${s.status}`; }).join('\n');
  const ask = (lang==='ua')
    ? `–í–∞–≥–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤: ${JSON.stringify(w)}.\n1) –ü–æ—Ä–∞–¥–∏ —â–æ–¥–æ —Ä–∏–∑–∏–∫—ñ–≤ —ñ –±–µ–∑–ø–µ–∫–∏.\n2) –©–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —É —Ä–∞–∑—ñ –¥–µ—Ñ—ñ—Ü–∏—Ç—É –∑–∞–ø—á–∞—Å—Ç–∏–Ω.\n3) –Ø–∫ –∑–º—ñ–Ω–∏—Ç–∏ –≤–∞–≥–∏ –¥–ª—è –º—ñ–Ω—ñ–º—É–º—É –ø—Ä–æ—Å—Ç–æ—é.\n4) –ö–æ—Ä–æ—Ç–∫–∞ –Ω–æ—Ç–∞—Ç–∫–∞ –¥–ª—è –±—Ä–∏–≥–∞–¥–∏.`
    : `Weights: ${JSON.stringify(w)}.\n1) Risk & safety notes.\n2) What to reschedule if parts are short.\n3) How to adjust weights to minimize downtime.\n4) Short note for crew.`;
  const txt = `${header}Queue:\n${jobs}\n\nSchedule:\n${plan}\n\n${ask}`;
  $('#promptBox').textContent=txt;
  return txt;
}
$('#mkPromptUA').addEventListener('click', ()=>makePrompt('ua'));
$('#mkPromptEN').addEventListener('click', ()=>makePrompt('en'));
$('#copyPrompt').addEventListener('click', ()=>{
  const ta=document.createElement('textarea'); ta.value=$('#promptBox').textContent; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); log('–ü—Ä–æ–º–ø—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
});

// ===== –ï–∫—Å–ø–æ—Ä—Ç–∏ =====
$('#expCSV').addEventListener('click', ()=>{
  if(!PLAN.length) return alert('–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É');
  const head='date,start,end,machine,task,hours,tech,score,status\n';
  const pr=computePriority(JOBS, JSON.parse($('#weights').value||'{}'), parseDate($('#startDate').value)||new Date());
  const scoreMap=new Map(pr.map(p=>[p.id,p.score]));
  const rows=PLAN.map(s=>{
    const j=JOBS.find(x=>x.id===s.jobId);
    return [ymd(s.date), pad(Math.floor(s.start))+':00', pad(Math.floor(s.end))+':00', csv(j.mach), csv(j.task), s.hours.toFixed(1), s.tech, (scoreMap.get(j.id)||0).toFixed(3), s.status].join(',');
  }).join('\n');
  download('mechanic_para25_plan_'+stamp()+'.csv', head+rows+'\n','text/csv');
});

$('#expICS').addEventListener('click', ()=>{
  if(!PLAN.length) return alert('–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É');
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Europe/Kyiv';
  const toDT = (d,h)=> `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}T${pad(Math.floor(h))}0000`;
  let ics = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//EDLab Mechanic Planner//UA\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n';
  PLAN.forEach(s=>{
    const j=JOBS.find(x=>x.id===s.jobId);
    const dtstart=toDT(s.date,s.start);
    const dtend  =toDT(s.date,s.end);
    const uid = `${s.jobId}-${ymd(s.date)}-${Math.floor(s.start)}@edlab`;
    ics+=`BEGIN:VEVENT\nUID:${uid}\nDTSTAMP:${toDT(new Date(),0)}Z\nSUMMARY:${escapeICS(j.mach+' ‚Äî '+j.task)}\nDTSTART;TZID=${tz}:${dtstart}\nDTEND;TZID=${tz}:${dtend}\nDESCRIPTION:${escapeICS('–ú–µ—Ö: '+s.tech+'; –ì–æ–¥: '+s.hours.toFixed(1)+'; –°—Ç–∞—Ç—É—Å: '+s.status)}\nEND:VEVENT\n`;
  });
  ics+='END:VCALENDAR\n';
  download('mechanic_para25_plan_'+stamp()+'.ics', ics, 'text/calendar');
});

function escapeICS(s){ return s.replace(/([,;\\])/g,'\\$1').replace(/\n/g,'\\n'); }
function csv(s){ return `"${(s??'').toString().replace(/"/g,'""')}"`; }

// –ß–µ–∫ 58 –º–º
$('#makeReceipt').addEventListener('click', ()=>{
  if(!PLAN.length) return alert('–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É');
  const today=new Date().toISOString().slice(0,10);
  const lines=['=== –ß–ï–ö –ü–õ–ê–ù–£ (58–º–º) ===','–î–∞—Ç–∞: '+today,'--- –¢–æ–ø –∑–∞–¥–∞—á—ñ ---'];
  const pr=computePriority(JOBS, JSON.parse($('#weights').value||'{}'), parseDate($('#startDate').value)||new Date());
  pr.slice(0,5).forEach((p,i)=>{ const j=JOBS.find(x=>x.id===p.id); lines.push(`${i+1}. ${j.mach}: ${j.task} | score ${p.score.toFixed(2)}`);});
  lines.push('--- –ë–ª–∏–∂—á—ñ —Å–ª–æ—Ç–∏ ---');
  PLAN.slice(0,6).forEach(s=>{ const j=JOBS.find(x=>x.id===s.jobId); lines.push(`${ymd(s.date)} ${pad(Math.floor(s.start))}-${pad(Math.floor(s.end))} ${j.mach}`); });
  const rc=$('#rc'); rc.hidden=false; rc.textContent=lines.join('\n');
  download('para25_receipt_'+stamp()+'.txt', lines.join('\n'));
});

// ===== –ì–æ–ª–æ–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞ ¬´–°–ø–ª–∞–Ω—É–≤–∞—Ç–∏¬ª =====
$('#plan').addEventListener('click', ()=>{
  if(!JOBS.length) return alert('–î–æ–¥–∞–π —Ö–æ—á–∞ –± –æ–¥–Ω—É —Ä–æ–±–æ—Ç—É');
  const start=parseDate($('#startDate').value)||new Date();
  parseStock($('#stock').value);
  let weights={risk:0.35,impact:0.2,safety:0.2,urgency:0.15,downtime:0.1};
  try{ weights=Object.assign(weights, JSON.parse($('#weights').value||'{}')); }catch{}
  const pr=computePriority(JOBS.map(j=>({...j})), weights, start);
  renderPrio(pr);
  // —Ä–æ–±–∏–º–æ –∫–æ–ø—ñ—ó —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç–µ–π –¥–ª—è –ø–ª–∞–Ω—É
  const jobsCopy=JOBS.map(j=>({ ...j, dur: j.dur }));
  PLAN = planSchedule(jobsCopy, pr, start, parseInt($('#capTech').value,10)||4, parseInt($('#capHours').value,10)||8);
  renderPlan(PLAN);
  drawGantt(PLAN);
  $('#stat').textContent='–°—Ç–∞—Ç—É—Å: –ø–ª–∞–Ω –≥–æ—Ç–æ–≤–∏–π';
  log('–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ: —Å–ª–æ—Ç—ñ–≤ '+PLAN.length);
});

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
(function init(){
  const now=new Date(); $('#startDate').value = ymd(now);
})();
</script>


</body></html>