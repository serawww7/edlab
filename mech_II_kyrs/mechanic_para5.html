<!-- mechanic_para5.html
     –ü–ê–†–ê 5 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤
     –¢–µ–º–∞: –ì–Ü–î–†–ê–í–õ–Ü–ö–ê ‚Äî —Ç–∏—Å–∫, –≤–∏—Ç—Ä–∞—Ç–∞, –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å; —Ü–∏–ª—ñ–Ω–¥—Ä–∏ –π –≥—ñ–¥—Ä–æ–º–æ—Ç–æ—Ä–∏; –ø—ñ–¥–±—ñ—Ä —à–ª–∞–Ω–≥—ñ–≤; –Ω–∞–≥—Ä—ñ–≤ –º–∞—Å—Ç–∏–ª–∞; —á–µ–∫ 58 –º–º; NFC; CSV
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages / Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏, 58 –º–º —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä (–æ–ø—Ü.), NFC-–º—ñ—Ç–∫–∏ (–æ–ø—Ü.).

     –©–æ –≤–º—ñ—î:
     ‚Ä¢ –ù–∞—Å–æ—Å: Q –∑ —Ä–æ–±.–æ–±‚Äô—î–º—É —Ç–∞ –æ–±/—Ö–≤; P–≥—ñ–¥—Ä = p¬∑Q/600 (–∫–í—Ç); –ö–ö–î: –æ–±‚Äô—î–º–Ω–∏–π/–º–µ—Ö–∞–Ω—ñ—á–Ω–∏–π ‚Üí —Ñ–∞–∫—Ç–∏—á–Ω–∏–π Q, –∫–í—Ç.
     ‚Ä¢ –°–ø–æ–∂–∏–≤–∞—á—ñ: —Ü–∏–ª—ñ–Ω–¥—Ä/–º–æ—Ç–æ—Ä ‚Üí —Å–∏–ª–∞/—à–≤–∏–¥–∫—ñ—Å—Ç—å/—á–∞—Å —Ö–æ–¥—É, –∫—Ä—É—Ç–Ω–∏–π –º–æ–º–µ–Ω—Ç/–æ–±–µ—Ä—Ç–∏/–ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å.
     ‚Ä¢ –®–ª–∞–Ω–≥–∏: —à–≤–∏–¥–∫—ñ—Å—Ç—å –ø–æ—Ç–æ–∫—É, –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π Œîp, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è –¥—ñ–∞–º–µ—Ç—Ä–∞ –∑–∞ —Ü—ñ–ª—è–º–∏ —à–≤–∏–¥–∫–æ—Å—Ç—ñ.
     ‚Ä¢ –¢–µ–ø–ª–æ: –æ—Ü—ñ–Ω–∫–∞ –≤—Ç—Ä–∞—Ç –∫–í—Ç —Ç–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ –æ–±‚Äô—î–º—É –±–∞–∫–∞, –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è T –∑–∞ –∑–º—ñ–Ω—É.
     ‚Ä¢ –ö–≤–∏—Ç–æ–∫ 58 –º–º ‚Äú–ì—ñ–¥—Ä–æ–∑–∞–≤–¥–∞–Ω–Ω—è‚Äù, NFC-—Ç–µ–∫—Å—Ç; CSV-–µ–∫—Å–ø–æ—Ä—Ç.
     –§–æ—Ä–º—É–ª–∏ (–Ω–∞–≤—á–∞–ª—å–Ω–æ):
       Q[L/min] = (Vg[—Å–º¬≥/–æ–±] ¬∑ n[–æ–±/—Ö–≤]) / 1000
       P–≥—ñ–¥—Ä[kW] = p[bar] ¬∑ Q[L/min] / 600
       F[N] = p[Pa] ¬∑ A[–º¬≤],  A = œÄ¬∑D¬≤/4;  p[Pa] = p[bar]¬∑1e5
       v—Ü–∏–ª[–º/—Å] = (Q—á–∞—Å—Ç–∫–∏[L/—Ö–≤]/60) / A
       t—Ö—ñ–¥[—Å] = —Ö—ñ–¥[–º] / v—Ü–∏–ª
       T–º–æ—Ç[–ù¬∑–º] ‚âà (p[bar] ¬∑ Vd[—Å–º¬≥/–æ–±]) / (2œÄ) ¬∑ 0.1
       n–º–æ—Ç[–æ–±/—Ö–≤] = (Q—á–∞—Å—Ç–∫–∏[L/—Ö–≤] ¬∑ 1000) / Vd[—Å–º¬≥/–æ–±]
       v—à–ª–∞–Ω–≥–∞[–º/—Å] = (Q[L/—Ö–≤]/60) / (œÄ¬∑(D–≤–Ω[–º])¬≤/4)
       Œîp[bar] ‚âà K ¬∑ L[–º] ¬∑ (Q[L/—Ö–≤])¬≤ / (D–≤–Ω[–º–º])‚Åµ   (K‚âà1.2e-6 –Ω–∞–≤—á.)
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 5 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –ì—ñ–¥—Ä–∞–≤–ª—ñ–∫–∞: –Ω–∞—Å–æ—Å, —Å–ø–æ–∂–∏–≤–∞—á—ñ, —à–ª–∞–Ω–≥–∏, —Ç–µ–ø–ª–æ, —á–µ–∫ 58 –º–º, NFC, CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px}
  h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  .ok{color:#10b981}.warn{color:#f59e0b}.bad{color:#ef4444}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 5 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
  <h1>üíß –ì—ñ–¥—Ä–∞–≤–ª—ñ–∫–∞: –Ω–∞—Å–æ—Å ‚Üí —Å–ø–æ–∂–∏–≤–∞—á—ñ ‚Üí —à–ª–∞–Ω–≥–∏ ‚Üí —Ç–µ–ø–ª–æ ‚Üí —á–µ–∫ 58 –º–º, NFC, CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞</h2>
    <p>
      –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –ø—Ä–æ—Ä–∞—Ö—É—é—Ç—å <b>–Ω–∞—Å–æ—Å/—Ç–∏—Å–∫/–≤–∏—Ç—Ä–∞—Ç—É/–ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å</b>, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ <b>—Ü–∏–ª—ñ–Ω–¥—Ä—ñ–≤/–º–æ—Ç–æ—Ä—ñ–≤</b>, –ø—ñ–¥–±–µ—Ä—É—Ç—å <b>—à–ª–∞–Ω–≥–∏</b>,
      –æ—Ü—ñ–Ω—è—Ç—å <b>–≤—Ç—Ä–∞—Ç–∏ —Ç–∞ –Ω–∞–≥—Ä—ñ–≤</b>, —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b> —ñ <b>NFC</b>-—Ç–µ–∫—Å—Ç, –≤–∏–≤–∞–Ω—Ç–∞–∂–∞—Ç—å <b>CSV</b>.
    </p>
    <p class="small">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —à–≤–∏–¥–∫–æ—Å—Ç—ñ: –≤—Å–º–æ–∫—Ç—É–≤–∞–ª—å–Ω–∞ –ª—ñ–Ω—ñ—è <span class="mono">0.5‚Äì1.5 –º/—Å</span>, –Ω–∞–ø—ñ—Ä–Ω–∞ <span class="mono">2‚Äì4 –º/—Å</span>, –∑–ª–∏–≤ <span class="mono">1‚Äì2 –º/—Å</span>.</p>
  </div>

  <!-- –ù–ê–°–û–° + –¢–ò–°–ö + –ö–ö–î -->
  <div class="card">
    <h2>‚öôÔ∏è –ù–∞—Å–æ—Å —ñ —Ç–∏—Å–∫</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞—Å–æ—Å–∞</h3>
        <div class="row">
          <div style="flex:1"><label>Vg, —Å–º¬≥/–æ–±</label><input id="Vg" type="number" step="0.1" value="45"></div>
          <div style="flex:1"><label>n, –æ–±/—Ö–≤</label><input id="n" type="number" step="10" value="1800"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>Œ∑·µ• (–æ–± º—î–º–Ω–∏–π)</label><input id="etaV" type="number" step="0.01" value="0.92"></div>
          <div style="flex:1"><label>Œ∑‚Çò (–º–µ—Ö.)</label><input id="etaM" type="number" step="0.01" value="0.88"></div>
        </div>
      </div>
      <div class="box">
        <h3>–†–æ–±–æ—á—ñ —É–º–æ–≤–∏</h3>
        <div class="row">
          <div style="flex:1"><label>–¢–∏—Å–∫ —Å–∏—Å—Ç–µ–º–∏, bar</label><input id="pBar" type="number" step="1" value="180"></div>
          <div style="flex:1"><label>–ß–∞—Å—Ç–∫–∞ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, % —á–∞—Å—É</label><input id="duty" type="number" step="5" value="60"></div>
        </div>
        <p class="small">–î–ª—è –æ—Ü—ñ–Ω–∫–∏ —Ç–µ–ø–ª–∞ –±–µ—Ä–µ—Ç—å—Å—è —Å–µ—Ä–µ–¥–Ω—è –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑–∞ —Ü–∏–∫–ª.</p>
      </div>
      <div class="box">
        <h3>–ü—ñ–¥—Å—É–º–∫–∏ –Ω–∞—Å–æ—Å–∞</h3>
        <p>Q—Ç–µ–æ—Ä: <b><span id="Qth">‚Äî</span></b> –ª/—Ö–≤ ¬∑ Q—Ñ–∞–∫—Ç (Œ∑·µ•): <b><span id="Qact">‚Äî</span></b> –ª/—Ö–≤</p>
        <p>P–≥—ñ–¥—Ä: <b><span id="Phyd">‚Äî</span></b> –∫–í—Ç ¬∑ P–≤–∞–ª—É (Œ∑‚Çò): <b><span id="Pshaft">‚Äî</span></b> –∫–í—Ç</p>
        <p>–°–µ—Ä–µ–¥–Ω—è P–≤—Ç—Ä–∞—Ç ‚âà <b><span id="Ploss">‚Äî</span></b> –∫–í—Ç</p>
      </div>
    </div>
  </div>

  <!-- –°–ü–û–ñ–ò–í–ê–ß–Ü -->
  <div class="card">
    <h2>üß± –°–ø–æ–∂–∏–≤–∞—á—ñ (—Ü–∏–ª—ñ–Ω–¥—Ä–∏ / –º–æ—Ç–æ—Ä–∏)</h2>
    <div class="row">
      <button class="btn" onclick="addCons()">‚ûï –î–æ–¥–∞—Ç–∏</button>
      <button class="btn" onclick="presetCons()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
      <button class="btn" onclick="copyCSV('csvC')">üìã CSV</button>
    </div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblC">
        <thead>
          <tr>
            <th>#</th>
            <th>–¢–∏–ø</th>
            <th>–ù–∞–∑–≤–∞</th>
            <th>Q—á–∞—Å—Ç–∫–∏, –ª/—Ö–≤</th>
            <th>p, bar</th>
            <th>D —Ü–∏–ª., –º–º / Vd –º–æ—Ç–æ—Ä, —Å–º¬≥/–æ–±</th>
            <th>–®—Ç–æ–∫, –º–º</th>
            <th>–•—ñ–¥, –º–º</th>
            <th class="dark">F, –∫–ù / T, –ù¬∑–º</th>
            <th class="dark">v—Ü–∏–ª, –º–º/—Å / n, –æ–±/—Ö–≤</th>
            <th class="dark">t—Ö—ñ–¥, —Å / P, –∫–í—Ç</th>
            <th>–ü—Ä–∏–º.</th>
          </tr>
        </thead>
        <tbody id="bodyC"></tbody>
      </table>
    </div>
    <div id="csvC" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- –®–õ–ê–ù–ì–ò -->
  <div class="card">
    <h2>üî© –®–ª–∞–Ω–≥–∏ (–¥—ñ–∞–º–µ—Ç—Ä, —à–≤–∏–¥–∫—ñ—Å—Ç—å, Œîp)</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ª—ñ–Ω—ñ—ó</h3>
        <div class="row">
          <div style="flex:1"><label>Q, –ª/—Ö–≤</label><input id="hoseQ" type="number" step="0.1" value="60"></div>
          <div style="flex:1"><label>–î–æ–≤–∂–∏–Ω–∞ L, –º</label><input id="hoseL" type="number" step="0.1" value="8"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>D–≤–Ω—É—Ç—Ä, –º–º</label><input id="hoseD" type="number" step="1" value="12"></div>
          <div style="flex:1"><label>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label>
            <select id="hoseRole">
              <option value="suction">–≤—Å–º–æ–∫—Ç—É–≤–∞–ª—å–Ω–∞</option>
              <option value="pressure" selected>–Ω–∞–ø—ñ—Ä–Ω–∞</option>
              <option value="return">–∑–ª–∏–≤/–ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è</option>
            </select>
          </div>
        </div>
      </div>
      <div class="box">
        <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥—ñ–∞–º–µ—Ç—Ä–∞</h3>
        <p>–°–ø–∏—Å–æ–∫ –¥—ñ–∞–º–µ—Ç—Ä—ñ–≤ (–º–º):</p>
        <input id="diamList" type="text" value="8,10,12,16,19,25">
        <p class="small">–ü–æ—à—É–∫ –º—ñ–Ω. –¥—ñ–∞–º–µ—Ç—Ä–∞, —â–æ –¥–∞—î v —É –º–µ–∂–∞—Ö –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É.</p>
      </div>
      <div class="box">
        <h3>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫</h3>
        <p>–®–≤–∏–¥–∫—ñ—Å—Ç—å v: <b><span id="hoseV">‚Äî</span></b> –º/—Å ¬∑ Œîp: <b><span id="hoseDp">‚Äî</span></b> bar</p>
        <p>–†–µ–∫–æ–º–µ–Ω–¥. D: <b><span id="hoseRec">‚Äî</span></b> –º–º</p>
      </div>
    </div>
  </div>

  <!-- –¢–ï–ü–õ–û -->
  <div class="card">
    <h2>üå°Ô∏è –¢–µ–ø–ª–æ —Ç–∞ –±–∞–∫</h2>
    <div class="grid g2">
      <div class="box">
        <h3>–û—Ü—ñ–Ω–∫–∞ –Ω–∞–≥—Ä—ñ–≤—É –∑–∞ –∑–º—ñ–Ω—É (–Ω–∞–≤—á–∞–ª—å–Ω–æ)</h3>
        <div class="row">
          <div style="flex:1"><label>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å, –≥–æ–¥</label><input id="shiftH" type="number" step="0.5" value="6"></div>
          <div style="flex:1"><label>–û–± º—î–º –±–∞–∫–∞, –ª</label><input id="tankL" type="number" step="1" value="120"></div>
        </div>
        <p>ŒîT‚âà <b><span id="dT">‚Äî</span></b> ¬∞C ¬∑ –ú—ñ–Ω. –±–∞–∫ ‚âà <b><span id="tankMin">‚Äî</span></b> –ª</p>
        <p class="small">–û—Ü—ñ–Ω–∫–∞ –≥—Ä—É–±–∞ (—Ç–µ–ø–ª–æ–≤—ñ–¥–≤—ñ–¥ –Ω–µ –≤—Ä–∞—Ö–æ–≤–∞–Ω–æ): ŒîT ‚âà (P–≤—Ç—Ä–∞—Ç[kW] ¬∑ 860 ¬∑ –≥–æ–¥) / (–º–∞—Å—É –º–∞—Å–ª–∞[–∫–≥]). œÅ‚âà0.87 –∫–≥/–ª.</p>
      </div>
      <div class="box">
        <h3>–ü—ñ–¥—Å—É–º–∫–∏ —Å–∏—Å—Ç–µ–º–∏</h3>
        <p>Œ£P—Å–ø–æ–∂–∏–≤–∞—á—ñ–≤: <b><span id="sumPcons">‚Äî</span></b> –∫–í—Ç ¬∑ P–≤—Ç—Ä–∞—Ç (–Ω–∞—Å–æ—Å‚Äì—Å–ø–æ–∂.): <b><span id="lossSys">‚Äî</span></b> –∫–í—Ç</p>
        <p class="small">–Ø–∫—â–æ P–≤—Ç—Ä–∞—Ç –≤–∏—Å–æ–∫–∞ ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä —à–ª–∞–Ω–≥–∏ (v/Œîp), —Ç–∏—Å–∫ —É –ª—ñ–Ω—ñ—è—Ö, —Ä–µ–¥—É–∫—Ü—ñ–π–Ω—ñ –∫–ª–∞–ø–∞–Ω–∏, —Ç–µ–ø–ª–æ–æ–±–º—ñ–Ω–Ω–∏–∫.</p>
      </div>
    </div>
  </div>

  <!-- –ö–í–ò–¢–û–ö + NFC -->
  <div class="card">
    <h2>üßæ –ö–≤–∏—Ç–æ–∫ 58 –º–º —Ç–∞ NFC</h2>
    <div class="grid g2">
      <div class="box">
        <h3>NFC ‚Äî –≥—ñ–¥—Ä–æ–∑–∞–≤–¥–∞–Ω–Ω—è</h3>
        <div class="row">
          <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞ ID</label><input id="nfcId" type="text" value="TR-001"></div>
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ ‚Äú–ì—ñ–¥—Ä–æ–∑–∞–≤–¥–∞–Ω–Ω—è‚Äù</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>–ì–Ü–î–†–û–ó–ê–í–î–ê–ù–ù–Ø</h4>
          <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
          <div class="line"></div>
          <p><b>–ù–∞—Å–æ—Å:</b> Q=<span id="tQ">‚Äî</span> –ª/—Ö–≤; p=<span id="tP">‚Äî</span> bar</p>
          <p><b>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å:</b> –≥—ñ–¥—Ä <span id="tPh">‚Äî</span> –∫–í—Ç; –≤–∞–ª <span id="tPs">‚Äî</span> –∫–í—Ç</p>
          <p><b>–®–ª–∞–Ω–≥:</b> Q=<span id="tHQ">‚Äî</span> –ª/—Ö–≤; D=<span id="tHD">‚Äî</span> –º–º; v=<span id="tHV">‚Äî</span> –º/—Å</p>
          <div class="line"></div>
          <p><b>–°–ø–æ–∂–∏–≤–∞—á:</b> <span id="tCons">‚Äî</span></p>
          <p><b>–†–µ–∂–∏–º:</b> <span id="tConsMode">‚Äî</span></p>
          <p><b>–û—Ä—ñ—î–Ω—Ç. Œîp:</b> <span id="tHdp">‚Äî</span> bar; <b>P–≤—Ç—Ä–∞—Ç:</b> <span id="tLoss">‚Äî</span> –∫–í—Ç</p>
          <div class="line"></div>
          <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- –ö–ï–†–£–í–ê–ù–ù–Ø + CSV -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ —Ç–∞ CSV</h2>
    <ol>
      <li>–ó–∞–¥–∞–π <b>–Ω–∞—Å–æ—Å</b> (Vg, n, Œ∑), —Ç–∏—Å–∫ —Ç–∞ —á–∞—Å—Ç–∫—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.</li>
      <li>–î–æ–¥–∞–π 2‚Äì4 <b>—Å–ø–æ–∂–∏–≤–∞—á—ñ</b> (—Ü–∏–ª—ñ–Ω–¥—Ä/–º–æ—Ç–æ—Ä) –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ ‚Äî –ø–µ—Ä–µ—Ä–∞—Ö—É–π.</li>
      <li>–ü—ñ–¥—ñ–±–µ—Ä–∏ <b>—à–ª–∞–Ω–≥</b> –∑–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—é –ø–æ—Ç–æ–∫—É —Ç–∞ Œîp, –ø–µ—Ä–µ–≤—ñ—Ä <b>—Ç–µ–ø–ª–æ</b>.</li>
      <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>NFC</b> —ñ <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>. –°–∫–æ–ø—ñ—é–π <b>CSV</b> —É Sheets (<span class="mono">Hydraulics</span>).</li>
    </ol>
    <div class="row">
      <button class="btn" onclick="copyCSV('csvFull')">üìã CSV (—Å–∏—Å—Ç–µ–º–∞+—à–ª–∞–Ω–≥)</button>
    </div>
    <div id="csvFull" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–ù–∞—Å–æ—Å: –∫–æ—Ä–µ–∫—Ç–Ω—ñ Q, P–≥—ñ–¥—Ä, P–≤–∞–ª—É</td><td>3</td></tr>
        <tr><td>–°–ø–æ–∂–∏–≤–∞—á—ñ: –≤—ñ—Ä–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ (—Å–∏–ª–∞/—à–≤–∏–¥–∫—ñ—Å—Ç—å/—á–∞—Å –∞–±–æ –º–æ–º–µ–Ω—Ç/–æ–±–µ—Ä—Ç–∏/–ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å)</td><td>3</td></tr>
        <tr><td>–®–ª–∞–Ω–≥: –ø—ñ–¥–±—ñ—Ä –¥—ñ–∞–º–µ—Ç—Ä–∞ –∑–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—é, –∞–¥–µ–∫–≤–∞—Ç–Ω–∏–π Œîp; —Ç–µ–ø–ª–æ–≤–∞ –æ—Ü—ñ–Ω–∫–∞</td><td>3</td></tr>
        <tr><td>–ö–≤–∏—Ç–æ–∫/NFC + CSV</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2) => Number((+n).toFixed(d));

  // ==== –ù–∞—Å–æ—Å ====
  function pumpCalc(){
    const Vg = +byId('Vg').value||0;   // —Å–º3/–æ–±
    const n  = +byId('n').value||0;    // –æ–±/—Ö–≤
    const etaV = +byId('etaV').value||0;
    const etaM = +byId('etaM').value||0;
    const pBar = +byId('pBar').value||0;

    const Qth = (Vg*n)/1000;          // –ª/—Ö–≤
    const Qact = Qth * etaV;          // –ª/—Ö–≤
    const Phyd = (pBar * Qact)/600;   // –∫–í—Ç
    const Pshaft = Phyd / (etaM>0?etaM:1); // –∫–í—Ç

    byId('Qth').textContent = rnd(Qth,1);
    byId('Qact').textContent = rnd(Qact,1);
    byId('Phyd').textContent = rnd(Phyd,2);
    byId('Pshaft').textContent = rnd(Pshaft,2);

    const duty = (+byId('duty').value||0)/100;
    const Ploss = Math.max(0, (Pshaft-Phyd) * duty);
    byId('Ploss').textContent = rnd(Ploss,2);

    return {Qth,Qact,Phyd,Pshaft,Ploss};
  }

  // ==== –°–ø–æ–∂–∏–≤–∞—á—ñ ====
  const bodyC = document.getElementById('bodyC');

  function addCons(sample){
    const def = { type:'cyl', name:'–ü—ñ–¥—ñ–π–º–∞—á', Q:20, p:160, D:60, rod:30, stroke:400, note:'' };
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td>
        <select>
          <option value="cyl" ${s.type==='cyl'?'selected':''}>—Ü–∏–ª—ñ–Ω–¥—Ä</option>
          <option value="mot" ${s.type==='mot'?'selected':''}>–º–æ—Ç–æ—Ä</option>
        </select>
      </td>
      <td><input type="text" value="${s.name}"></td>
      <td><input type="number" step="0.1" value="${s.Q}"></td>
      <td><input type="number" step="1" value="${s.p}"></td>
      <td><input type="number" step="0.1" value="${s.D}"></td>
      <td><input type="number" step="0.1" value="${s.rod}"></td>
      <td><input type="number" step="1" value="${s.stroke}"></td>
      <td class="dark ft">‚Äî</td>
      <td class="dark v">‚Äî</td>
      <td class="dark tP">‚Äî</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyC.appendChild(tr);
    reindex(bodyC);
  }
  function reindex(tbody){[...tbody.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1);}

  function presetCons(){
    bodyC.innerHTML='';
    addCons({type:'cyl',name:'–ü—ñ–¥—ñ–π–º–∞—á –Ω–∞–≤—ñ—Å–∫–∏',Q:18,p:170,D:70,rod:35,stroke:350});
    addCons({type:'mot',name:'–ì—ñ–¥—Ä–æ–º–æ—Ç–æ—Ä —à–Ω–µ–∫—É',Q:25,p:150,D:160,rod:0,stroke:0}); // D –ø–æ–ª–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ —è–∫ Vd –¥–ª—è –º–æ—Ç–æ—Ä–∞
    recalc();
  }

  function calcConsumers(){
    let sumP=0, anyName='‚Äî', anyMode='‚Äî';
    [...bodyC.querySelectorAll('tr')].forEach((tr,idx)=>{
      const type = tr.children[1].querySelector('select').value;
      const name = tr.children[2].querySelector('input').value.trim();
      const Q = +tr.children[3].querySelector('input').value||0; // –ª/—Ö–≤
      const p = +tr.children[4].querySelector('input').value||0; // bar
      const D = +tr.children[5].querySelector('input').value||0; // –¥–ª—è —Ü–∏–ª —ñ–Ω–Ω–µ—Ä –¥—ñ–∞–º; –¥–ª—è –º–æ—Ç–æ—Ä—ñ–≤ ‚Äî —Ç—É—Ç –±—É–¥–µ–º–æ –±—Ä–∞—Ç–∏ —è–∫ Vd (—Å–º3/–æ–±)
      const rod = +tr.children[6].querySelector('input').value||0;
      const stroke = +tr.children[7].querySelector('input').value||0; // –º–º

      if(idx===0){ anyName = name || (type==='cyl'?'—Ü–∏–ª—ñ–Ω–¥—Ä':'–º–æ—Ç–æ—Ä'); anyMode = (type==='cyl'?'—Ö—ñ–¥':'–æ–±–µ—Ä—Ç'); }

      if(type==='cyl'){
        const A = Math.PI * Math.pow(D/1000,2) / 4; // D –º–º ‚Üí –º
        const Qm3s = (Q/1000)/60;                   // –ª/—Ö–≤ ‚Üí –º¬≥/—Å
        const v = A>0 ? Qm3s / A : 0;               // –º/—Å
        const F = (p*1e5) * A;                      // N
        const t = (stroke/1000) / (v||1);           // —Å
        const PkW = (p*Q)/600;                      // –∫–í—Ç (–≥—ñ–¥—Ä –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –Ω–∞ —Ü—å–æ–º—É —Å–ø–æ–∂–∏–≤–∞—á—ñ)

        tr.querySelector('.ft').textContent = `${rnd(F/1000,1)} –∫–ù`;
        tr.querySelector('.v').textContent  = `${rnd(v*1000,1)} –º–º/—Å`;
        tr.querySelector('.tP').textContent = `${isFinite(t)?rnd(t,1):'‚Äî'} —Å / ${rnd(PkW,2)} –∫–í—Ç`;

        sumP += PkW;
      } else {
        const Vd = Math.max(0,D);                   // —Å–º3/–æ–± (–ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ –ø–æ–ª–µ D)
        const nMot = Vd>0 ? (Q*1000)/Vd : 0;        // –æ–±/—Ö–≤
        const Tnm = (p * Vd * 0.1) / (2*Math.PI);   // –ù¬∑–º (–Ω–∞–±–ª–∏–∂–µ–Ω–æ)
        const PkW = (p*Q)/600;                      // –∫–í—Ç

        tr.querySelector('.ft').textContent = `${rnd(Tnm,1)} –ù¬∑–º`;
        tr.querySelector('.v').textContent  = `${rnd(nMot,0)} –æ–±/—Ö–≤`;
        tr.querySelector('.tP').textContent = `‚Äî / ${rnd(PkW,2)} –∫–í—Ç`;

        sumP += PkW;
      }
    });
    byId('sumPcons').textContent = rnd(sumP,2);
    return {sumP, anyName, anyMode};
  }

  // ==== –®–ª–∞–Ω–≥–∏ ====
  function hoseCalc(){
    const Q = +byId('hoseQ').value||0;      // –ª/—Ö–≤
    const L = +byId('hoseL').value||0;      // –º
    const Dmm = +byId('hoseD').value||0;    // –º–º
    const role = byId('hoseRole').value;

    const Dm = Dmm/1000;
    const area = Math.PI*Math.pow(Dm,2)/4;
    const v = area>0 ? ((Q/1000)/60)/area : 0; // –º/—Å

    // –û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ –≤—Ç—Ä–∞—Ç–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ (–Ω–∞–≤—á–∞–ª—å–Ω–æ)
    const K = 1.2e-6; // –µ–º–ø—ñ—Ä–∏—á–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞
    const dp = L>0 && Dmm>0 ? K * L * Math.pow(Q,2) / Math.pow(Dmm,5) : 0; // bar

    byId('hoseV').textContent  = rnd(v,2);
    byId('hoseDp').textContent = rnd(dp,2);

    // –ü—ñ–¥–±—ñ—Ä –¥—ñ–∞–º–µ—Ç—Ä–∞ –∑–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—é
    let vMin=0.5, vMax=1.5;
    if(role==='pressure'){ vMin=2; vMax=4; }
    if(role==='return'){ vMin=1; vMax=2; }
    const list = (byId('diamList').value||'').split(',').map(s=>+s.trim()).filter(x=>x>0).sort((a,b)=>a-b);
    let rec = '‚Äî';
    for(const d of list){
      const area2 = Math.PI*Math.pow(d/1000,2)/4;
      const v2 = ((Q/1000)/60)/area2;
      if(v2>=vMin && v2<=vMax){ rec = d; break; }
    }
    byId('hoseRec').textContent = rec;

    return {Q,L,Dmm,v,dp,rec};
  }

  // ==== –¢–µ–ø–ª–æ ====
  function heatCalc(PlossPump, sumPcons){
    const shiftH = +byId('shiftH').value||0;
    const tankL  = +byId('tankL').value||0;
    const rho = 0.87;               // –∫–≥/–ª
    const mass = tankL * rho;       // –∫–≥
    // –í—Ç—Ä–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω—ñ ‚âà P–≤–∞–ª—É ‚Äì Œ£P–∫–æ—Ä–∏—Å–Ω–∞ (–≥—Ä—É–±–æ)
    const lossSys = Math.max(0, PlossPump + Math.max(0, (pumpCalc().Phyd - sumPcons)));
    byId('lossSys').textContent = rnd(lossSys,2);

    // ŒîT –≥—Ä—É–±–æ –±–µ–∑ —Ä–∞–¥—ñ–∞—Ç–æ—Ä–∞
    const dT = mass>0 ? (lossSys * 860 * shiftH) / mass : 0; // ¬∞C
    byId('dT').textContent = rnd(dT,1);

    // –ú—ñ–Ω. –±–∞–∫: ~ 3√óQ–Ω–∞—Å–æ—Å–∞ (–µ–º–ø—ñ—Ä–∏—á–Ω–æ)
    const tankMin = 3 * pumpCalc().Qact;
    byId('tankMin').textContent = rnd(tankMin,0);

    return {lossSys,dT,tankMin};
  }

  // ==== –ö–≤–∏—Ç–æ–∫/NFC/CSV ====
  function buildTicket(){
    const p = pumpCalc(), h = hoseCalc(), c = calcConsumers();
    const d = new Date().toISOString().slice(0,10);
    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${d}</small>`;
    byId('tQ').textContent = rnd(p.Qact,1);
    byId('tP').textContent = (+byId('pBar').value||0);
    byId('tPh').textContent = rnd(p.Phyd,2);
    byId('tPs').textContent = rnd(p.Pshaft,2);
    byId('tHQ').textContent = h.Q;
    byId('tHD').textContent = h.Dmm;
    byId('tHV').textContent = rnd(h.v,2);
    byId('tCons').textContent = c.anyName;
    byId('tConsMode').textContent = c.anyMode;
    byId('tHdp').textContent = rnd(h.dp,2);
    byId('tLoss').textContent = rnd(heatCalc(p.Ploss, c.sumP).lossSys,2);
    byId('tNote').textContent = `–ü—Ä–∏–º.: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è ¬∑ Ref:${Math.random().toString(36).slice(2,8).toUpperCase()}`;
  }

  function buildNFC(){
    const p = pumpCalc(), h = hoseCalc(), c = calcConsumers();
    const text = [
      `HYDRO_NFC`,
      `MACHINE:${byId('nfcId').value}`,
      `CONTACT:${byId('nfcPhone').value}`,
      `PUMP_Q:${rnd(p.Qact,1)}LPM; P_SYS:${(+byId('pBar').value||0)}bar`,
      `HOSE:Q=${h.Q}LPM; D=${h.Dmm}mm; v=${rnd(h.v,2)}mps; dP=${rnd(h.dp,2)}bar`,
      `CONSUMER:${c.anyName}; MODE:${c.anyMode}; Psum=${rnd(c.sumP,2)}kW`,
      `HEAT_LOSS:${rnd(heatCalc(p.Ploss,c.sumP).lossSys,2)}kW`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = text;
  }

  function buildCSV(){
    const p = pumpCalc(), h = hoseCalc(), c = calcConsumers(), heat = heatCalc(p.Ploss,c.sumP);
    const sys = [
      `PUMP|Vg=${byId('Vg').value}cc_rev|n=${byId('n').value}rpm|etaV=${byId('etaV').value}|etaM=${byId('etaM').value}|p=${byId('pBar').value}bar|Q=${rnd(p.Qact,1)}|Phyd=${rnd(p.Phyd,2)}|Pshaft=${rnd(p.Pshaft,2)}|Ploss=${rnd(p.Ploss,2)}`,
      `HOSE|Q=${h.Q}|L=${h.L}|D=${h.Dmm}|v=${rnd(h.v,2)}|dP=${rnd(h.dp,2)}|recD=${h.rec}`,
      `HEAT|lossSys=${rnd(heat.lossSys,2)}|shift=${byId('shiftH').value}h|tank=${byId('tankL').value}L|dT=${rnd(heat.dT,1)}|tankMin=${rnd(heat.tankMin,0)}`
    ].join('\n');
    byId('csvFull').textContent = sys;

    // Consumers CSV
    const lines = [...bodyC.querySelectorAll('tr')].map(tr=>{
      const idx=tr.querySelector('.idx').textContent.trim();
      const type=tr.children[1].querySelector('select').value.trim();
      const name=tr.children[2].querySelector('input').value.trim();
      const Q=tr.children[3].querySelector('input').value.trim();
      const p=tr.children[4].querySelector('input').value.trim();
      const D=tr.children[5].querySelector('input').value.trim();
      const rod=tr.children[6].querySelector('input').value.trim();
      const stroke=tr.children[7].querySelector('input').value.trim();
      const ft=tr.querySelector('.ft').textContent.trim();
      const v =tr.querySelector('.v').textContent.trim();
      const tP=tr.querySelector('.tP').textContent.trim();
      return [idx,type,name,Q,p,D,rod,stroke,ft,v,tP].join(' | ');
    });
    byId('csvC').textContent = lines.join('\n') || '‚Äî';
  }

  function copyCSV(id){
    const t = byId(id).textContent.trim();
    if(!t || t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }

  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }
  function recalc(){ pumpCalc(); calcConsumers(); hoseCalc(); heatCalc(pumpCalc().Ploss, calcConsumers().sumP); buildCSV(); }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){
    addCons(); addCons({type:'mot',name:'–ì—ñ–¥—Ä–æ–º–æ—Ç–æ—Ä –∫–æ–Ω–≤–µ—î—Ä–∞',Q:22,p:140,D:160,rod:0,stroke:0});
    recalc();
  })();

  // –°–ª—É—Ö–∞—á—ñ
  ['Vg','n','etaV','etaM','pBar','duty','hoseQ','hoseL','hoseD','hoseRole','diamList','shiftH','tankL']
    .forEach(id=>byId(id).addEventListener('change', recalc));

  // –ï–∫—Å–ø–æ—Ä—Ç –∫–Ω–æ–ø–∫–∏
  document.addEventListener('change', e=>{
    if(e.target.closest('#tblC')) recalc();
  });

  // –ö–æ—Ä–∏—Å–Ω—ñ alias –¥–ª—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
  function addConsRow(){ addCons(); }
  window.addCons = addCons;
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
