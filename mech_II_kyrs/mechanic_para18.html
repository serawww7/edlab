<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 18 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –ê–∫—É—Å—Ç–∏—á–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≥—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º (WebAudio: –æ—Å—Ü–∏–ª–æ–≥—Ä–∞–º–∞+FFT, –∫–ª–∞—Å–∏, –∂—É—Ä–Ω–∞–ª)</title>
<meta name="description" content="–ë–µ–∑ Arduino: –º—ñ–∫—Ä–æ—Ñ–æ–Ω –≥–∞—Ä–Ω—ñ—Ç—É—Ä–∏ –∞–±–æ WAV ‚Üí –æ—Å—Ü–∏–ª–æ–≥—Ä–∞–º–∞, FFT, –æ–∑–Ω–∞–∫–∏ (—Å–º—É–≥–æ–≤—ñ –µ–Ω–µ—Ä–≥—ñ—ó, —Ü–µ–Ω—Ç—Ä–æ—ó–¥, –ø–ª–æ—Å–∫—ñ—Å—Ç—å, —Ç–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å, ZCR, SNR) ‚Üí –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è (–∫–∞–≤—ñ—Ç–∞—Ü—ñ—è/–ø–µ—Ä–µ–ø—É—Å–∫/–∞–µ—Ä–∞—Ü—ñ—è/–Ω–æ—Ä–º–∞) ‚Üí –∂—É—Ä–Ω–∞–ª, —á–µ–∫ 58 –º–º, CSV/TXT/PNG, ICS.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1140px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;white-space:pre-wrap}
.small{font-size:.9rem}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:220px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
</style>
<link rel="canonical" href="https://edlab.pp.ua/mech_II_kyrs/mechanic_para18.html"><meta property="og:type" content="article"><meta property="og:title" content="–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 18"><meta property="og:description" content="–ú–µ—Ç–∞: –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ –≥–∞—Ä–Ω—ñ—Ç—É—Ä–∏ –∞–±–æ –∞—É–¥—ñ–æ–∑–∞–ø–∏—Å—É –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–≤—É–∫ –≥—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º–∏ —Ç–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ –∫–∞–≤—ñ—Ç–∞—Ü—ñ—é –Ω–∞—Å–æ—Å–∞, —Ä–æ–±–æ—Ç—É –ø–µ—Ä–µ–ø—É—Å–∫–Ω–æ–≥–æ/–∑–∞–ø–æ–±—ñ–∂–Ω–æ–≥–æ –∫–ª–∞"><meta property="og:url" content="https://edlab.pp.ua/mech_II_kyrs/mechanic_para18.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 18","description":"–ú–µ—Ç–∞: –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ –≥–∞—Ä–Ω—ñ—Ç—É—Ä–∏ –∞–±–æ –∞—É–¥—ñ–æ–∑–∞–ø–∏—Å—É –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–≤—É–∫ –≥—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º–∏ —Ç–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ –∫–∞–≤—ñ—Ç–∞—Ü—ñ—é –Ω–∞—Å–æ—Å–∞, —Ä–æ–±–æ—Ç—É –ø–µ—Ä–µ–ø—É—Å–∫–Ω–æ–≥–æ/–∑–∞–ø–æ–±—ñ–∂–Ω–æ–≥–æ –∫–ª–∞","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/mech_II_kyrs/mechanic_para18.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üõ†Ô∏è</span>
      <div>
        <b>–ü–∞—Ä–∞ 18 ‚Äî –ê–∫—É—Å—Ç–∏—á–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≥—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º (–±–µ–∑ Arduino)</b><br>
        <span class="badge">–º—ñ–∫—Ä–æ—Ñ–æ–Ω/–≥–∞—Ä–Ω—ñ—Ç—É—Ä–∞ ‚Üí –æ—Å—Ü–∏–ª–æ–≥—Ä–∞–º–∞ + FFT ‚Üí –æ–∑–Ω–∞–∫–∏ ‚Üí –∫–ª–∞—Å–∏ (–∫–∞–≤—ñ—Ç–∞—Ü—ñ—è/–ø–µ—Ä–µ–ø—É—Å–∫/–∞–µ—Ä–∞—Ü—ñ—è/–Ω–æ—Ä–º–∞) ‚Üí –∂—É—Ä–Ω–∞–ª ‚Üí –µ–∫—Å–ø–æ—Ä—Ç</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">
    –ú–µ—Ç–∞: –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é <b>–º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ –≥–∞—Ä–Ω—ñ—Ç—É—Ä–∏</b> –∞–±–æ <b>–∞—É–¥—ñ–æ–∑–∞–ø–∏—Å—É</b> –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–≤—É–∫ –≥—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º–∏ —Ç–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ <b>–∫–∞–≤—ñ—Ç–∞—Ü—ñ—é –Ω–∞—Å–æ—Å–∞</b>, —Ä–æ–±–æ—Ç—É <b>–ø–µ—Ä–µ–ø—É—Å–∫–Ω–æ–≥–æ/–∑–∞–ø–æ–±—ñ–∂–Ω–æ–≥–æ –∫–ª–∞–ø–∞–Ω–∞</b>, <b>–∞–µ—Ä–∞—Ü—ñ—é (–ø–æ–≤—ñ—Ç—Ä—è –≤ –º–∞—Å–ª—ñ)</b> —á–∏ <b>–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º</b>. –£—Å–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–≥–æ –∫–ª–∞—Å—É.
  </p>

  <div class="card">
    <h2>üéôÔ∏è –î–∂–µ—Ä–µ–ª–æ –∑–≤—É–∫—É</h2>
    <div class="row">
      <div style="flex:1">
        <label for="src">–î–∂–µ—Ä–µ–ª–æ</label>
        <select id="src" class="input">
          <option value="mic" selected="">–ú—ñ–∫—Ä–æ—Ñ–æ–Ω (–≥–∞—Ä–Ω—ñ—Ç—É—Ä–∞/–Ω–æ—É—Ç–±—É–∫)</option>
          <option value="file">–ê—É–¥—ñ–æ—Ñ–∞–π–ª (WAV/MP3)</option>
          <option value="emu">–ï–º—É–ª—è—Ç–æ—Ä (—Å–∏–Ω—Ç–µ—Ç–∏–∫–∞)</option>
        </select>
      </div>
      <div class="row" style="gap:8px">
        <button class="btn good" id="start">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
        <button class="btn secondary" id="stop">‚è∏Ô∏è –°—Ç–æ–ø</button>
        <span id="stat" class="badge">–°—Ç–∞—Ç—É—Å: idle</span>
      </div>
    </div>
    <div id="fileBox" class="row" style="display:none;margin-top:6px">
      <input id="fileInp" class="input" type="file" accept="audio/*">
      <button class="btn" id="playFile">‚ñ∂Ô∏è –í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª</button>
    </div>
    <div id="emuBox" class="note" style="display:none;margin-top:6px">
      <b>–ï–º—É–ª—è—Ç–æ—Ä:</b>
      <div class="row">
        <div style="flex:1">
          <select id="emuType" class="input">
            <option value="normal" selected="">–ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º –Ω–∞—Å–æ—Å–∞</option>
            <option value="cav">–ö–∞–≤—ñ—Ç–∞—Ü—ñ—è (—à–∏—Ä–æ–∫–æ—Å–º—É–≥–æ–≤–∏–π ¬´—à—É—Ä—Ö—ñ—Ç¬ª 3‚Äì10 –∫–ì—Ü)</option>
            <option value="relief">–ü–µ—Ä–µ–ø—É—Å–∫/–∑–∞–ø–æ–±—ñ–∂–Ω–∏–π (—Ç–æ–Ω 400‚Äì1200 –ì—Ü)</option>
            <option value="aero">–ê–µ—Ä–∞—Ü—ñ—è (–±—É–ª—å–±–∞—à–∫–∏, –Ω–∏–∑—å–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–∏–π ¬´–±—É–ª—å–∫¬ª 100‚Äì400 –ì—Ü + —à—É–º)</option>
          </select>
        </div>
        <div style="flex:1">
          <label>–†—ñ–≤–µ–Ω—å <input id="emuLvl" class="input" type="range" min="0" max="1" step="0.01" value="0.7"></label>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>üìà –û—Å—Ü–∏–ª–æ–≥—Ä–∞–º–∞ —Ç–∞ —Å–ø–µ–∫—Ç—Ä</h2>
    <div class="canvasWrap"><canvas id="wave" width="1080" height="200"></canvas></div>
    <div class="canvasWrap" style="margin-top:8px"><canvas id="spec" width="1080" height="240"></canvas></div>
    <div class="row" style="margin-top:8px">
      <button class="btn" id="png">üñºÔ∏è PNG (–≥—Ä–∞—Ñ—ñ–∫–∏)</button>
      <button class="btn secondary" id="clearPlot">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      <span class="badge">Fs=–∞–≤—Ç–æ; FFT=4096</span>
    </div>
  </div>

  <div class="card">
    <h2>üß† –û–∑–Ω–∞–∫–∏ —Ç–∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è</h2>
    <div class="row">
      <div style="flex:1">
        <label for="auto">–ê–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è</label>
        <select id="auto" class="input"><option>–£–≤—ñ–º–∫–Ω–µ–Ω–∞</option><option>–í–∏–º–∫–Ω–µ–Ω–∞</option></select>
      </div>
      <div style="flex:1">
        <label for="k">k –¥–ª—è k-NN (–¥–æ–ø–æ–º—ñ–∂–Ω–æ)</label>
        <input id="k" class="input" type="number" min="1" step="1" value="3">
      </div>
      <div style="flex:2">
        <span id="pred" class="badge">Pred: ‚Äî</span>
        <span id="risk" class="badge">–°–∫–æ—Ä–∏–Ω–≥ —Ä–∏–∑–∏–∫—É (–∫–∞–≤—ñ—Ç–∞—Ü—ñ—è): ‚Äî</span>
      </div>
    </div>

    <h3 style="margin-top:8px">üìê –û–±—á–∏—Å–ª–µ–Ω—ñ –æ–∑–Ω–∞–∫–∏</h3>
    <table class="tbl">
      <tbody id="feat">
        <tr><th>–ï–Ω–µ—Ä–≥—ñ—è [0.5‚Äì1 –∫–ì—Ü]</th><td id="b1">‚Äî</td></tr>
        <tr><th>–ï–Ω–µ—Ä–≥—ñ—è [1‚Äì3 –∫–ì—Ü]</th><td id="b2">‚Äî</td></tr>
        <tr><th>–ï–Ω–µ—Ä–≥—ñ—è [3‚Äì8 –∫–ì—Ü]</th><td id="b3">‚Äî</td></tr>
        <tr><th>–ï–Ω–µ—Ä–≥—ñ—è [8‚Äì15 –∫–ì—Ü]</th><td id="b4">‚Äî</td></tr>
        <tr><th>–¶–µ–Ω—Ç—Ä–æ—ó–¥ —Å–ø–µ–∫—Ç—Ä–∞ (–ì—Ü)</th><td id="cent">‚Äî</td></tr>
        <tr><th>–ü–ª–æ—Å–∫—ñ—Å—Ç—å —Å–ø–µ–∫—Ç—Ä–∞</th><td id="flat">‚Äî</td></tr>
        <tr><th>–¢–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å (max/Œ£)</th><td id="ton">‚Äî</td></tr>
        <tr><th>Zero-Crossing Rate</th><td id="zcr">‚Äî</td></tr>
        <tr><th>SNR (–æ—Ü—ñ–Ω–∫–∞, –¥–ë)</th><td id="snr">‚Äî</td></tr>
      </tbody>
    </table>

    <div class="row" style="margin-top:8px">
      <button class="btn good" id="classify">‚úÖ –ö–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑</button>
      <button class="btn secondary" id="mark">üìå –î–æ–¥–∞—Ç–∏ –º—ñ—Ç–∫—É (–Ω–∞–≤—á–∏—Ç–∏ k-NN)</button>
      <select id="label" class="input" style="max-width:240px">
        <option value="normal" selected="">normal</option>
        <option value="cav">cav</option>
        <option value="relief">relief</option>
        <option value="aero">aero</option>
      </select>
    </div>

    <h3 style="margin-top:12px">üìú –ñ—É—Ä–Ω–∞–ª —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤</h3>
    <pre id="alog" class="code" style="max-height:180px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤</pre>
  </div>

  <div class="card">
    <h2>üíæ –ï–∫—Å–ø–æ—Ä—Ç</h2>
    <div class="row">
      <button class="btn" id="expCSV">üìÑ CSV (–æ–∑–Ω–∞–∫–∏)</button>
      <button class="btn" id="expTXT">üíæ TXT (–ø—ñ–¥—Å—É–º–æ–∫)</button>
      <button class="btn" id="expICS">üóìÔ∏è ICS (–≤—ñ–∫–Ω–∞ —Ä–∏–∑–∏–∫—É)</button>
      <button class="btn secondary" id="receipt">üñ®Ô∏è 58-–º–º —á–µ–∫</button>
    </div>
    <div id="rc" class="receipt" hidden=""></div>
  </div>

  <div class="card">
    <h2>üîå –°—Ö–µ–º–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ (SVG)</h2>
    <svg viewBox="0 0 980 320" role="img" aria-label="–ú—ñ–∫—Ä–æ—Ñ–æ–Ω –Ω–∞ –≥—ñ–¥—Ä–æ–ª—ñ–Ω—ñ—ó/–±—ñ–ª—è –Ω–∞—Å–æ—Å–∞">
      <rect x="40" y="40" width="280" height="160" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
      <text x="180" y="70" fill="#e5e7eb" font-size="16" text-anchor="middle">–ì—ñ–¥—Ä–æ–±–∞–∫ + –Ω–∞—Å–æ—Å</text>
      <text x="180" y="90" fill="#93c5fd" font-size="12" text-anchor="middle">–≤—Å–º–æ–∫—Ç—É–≤–∞–Ω–Ω—è ‚Üî –Ω–∞–≥–Ω—ñ—Ç–∞–Ω–Ω—è</text>

      <rect x="360" y="60" width="560" height="40" rx="8" fill="#1f2937" stroke="#9ca3af"></rect>
      <text x="640" y="85" fill="#e5e7eb" font-size="14" text-anchor="middle">–ù–∞–ø—ñ—Ä–Ω–∞ –ª—ñ–Ω—ñ—è</text>

      <rect x="360" y="140" width="560" height="40" rx="8" fill="#1f2937" stroke="#9ca3af"></rect>
      <text x="640" y="165" fill="#e5e7eb" font-size="14" text-anchor="middle">–ó–≤–æ—Ä–æ—Ç–Ω–∞ –ª—ñ–Ω—ñ—è (–∫—Ä–∞—â–µ —á—É—Ç–∏ –∫–∞–≤—ñ—Ç–∞—Ü—ñ—é)</text>

      <circle cx="420" cy="160" r="16" fill="#14532d" stroke="#22c55e"></circle>
      <text x="420" y="165" fill="#dcfce7" font-size="12" text-anchor="middle">üé§</text>
      <text x="420" y="185" fill="#a7f3d0" font-size="12" text-anchor="middle">–º—ñ–∫—Ä–æ—Ñ–æ–Ω 10‚Äì20 –º–º</text>

      <text x="120" y="250" fill="#fbbf24" font-size="12">‚ö†Ô∏è –ë–µ–∑–ø–µ–∫–∞: –Ω–µ —Ç–æ—Ä–∫–∞—Ç–∏—Å—è —Ä—É—Ö–æ–º–∏—Ö/–≥–∞—Ä—è—á–∏—Ö —á–∞—Å—Ç–∏–Ω; LOTO –ø–µ—Ä–µ–¥ —Å–µ—Ä–≤—ñ—Å–æ–º.</text>
    </svg>

    <div class="note small" style="margin-top:10px">
      <b>–ü–æ—Ä–∞–¥–∏:</b> –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó ‚Äî –∑–∞–ø–∏—à–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω/–¥–∏–∫—Ç–æ—Ñ–æ–Ω —Ä–µ–∞–ª—å–Ω–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä/–Ω–∞–≤—ñ—Å–Ω–µ (–Ω–∞ —Ö–æ–ª–æ—Å—Ç–∏—Ö —ñ –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º), –ø–æ—Ç—ñ–º –∑–∞–≤–∞–Ω—Ç–∞–∂ —É —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É. 
      –ú—ñ–∫—Ä–æ—Ñ–æ–Ω –ø—Ä–∏—Ç–∏—Å–Ω–∏ –¥–æ —à–ª–∞–Ω–≥–∞ –º‚Äô—è–∫–∏–º –∫—ñ–ª—å—Ü–µ–º –∞–±–æ —ñ–∑–æ–ª–µ–Ω—Ç–æ—é; —É –∫–ª–∞—Å—ñ —Ç–µ—Å—Ç—É–π –Ω–∞ –µ–º—É–ª—è—Ç–æ—Ä—ñ, —â–æ–± –≤—ñ–¥–∫–∞–ª—ñ–±—Ä—É–≤–∞—Ç–∏ ¬´–Ω—é—Ö¬ª –¥–æ –æ–∑–Ω–∞–∫.
    </div>
  </div>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>PNG –æ—Å—Ü–∏–ª–æ–≥—Ä–∞–º–∏+—Å–ø–µ–∫—Ç—Ä–∞ –∑—ñ –≤–∫–∞–∑–∞–Ω–∏–º –¥—ñ–∞–≥–Ω–æ–∑–æ–º.</li>
      <li>CSV –æ–∑–Ω–∞–∫ –∑–∞ 1‚Äì2 —Ö–≤ –∞–Ω–∞–ª—ñ–∑—É —Ç–∞ –∂—É—Ä–Ω–∞–ª —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤.</li>
      <li>–í–∏—Å–Ω–æ–≤–æ–∫: —á–∏ —î –∫–∞–≤—ñ—Ç–∞—Ü—ñ—è/–ø–µ—Ä–µ–ø—É—Å–∫/–∞–µ—Ä–∞—Ü—ñ—è, —è–∫—ñ –¥—ñ—ó: –ø–µ—Ä–µ–≤—ñ—Ä –∑–∞–±–æ—Ä—É –º–∞—Å–ª–∞, —Ñ—ñ–ª—å—Ç—Ä, —Ä—ñ–≤–µ–Ω—å, –≤‚Äô—è–∑–∫—ñ—Å—Ç—å, –∫–ª–∞–ø–∞–Ω–∏, —à–ª–∞–Ω–≥–∏.</li>
    </ul>
  </div>

  <div class="card">
    <h2>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
    <p class="muted small">
      –ú–µ—Ö–∞–Ω—ñ–∫–∏ ¬´—Å–ª—É—Ö–∞–ª–∏¬ª –Ω–∞—Å–æ—Å–∏ —â–µ —É 1960-—Ö: –∫–∞–≤—ñ—Ç–∞—Ü—ñ—é –æ–ø–∏—Å—É–≤–∞–ª–∏ —è–∫ ¬´—à–∏–ø—ñ–Ω–Ω—è –ø—ñ—Å–∫—É¬ª. –°—å–æ–≥–æ–¥–Ω—ñ –º—ñ–∫—Ä–æ—Ñ–æ–Ω –≥–∞—Ä–Ω—ñ—Ç—É—Ä–∏ + FFT —É –±—Ä–∞—É–∑–µ—Ä—ñ –¥–∞—î —Ç–∞–∫—ñ –∂ ¬´–≤—É—Ö–∞¬ª, 
      –∞–ª–µ –∑ —Ü–∏—Ñ—Ä–∞–º–∏ —ñ –∂—É—Ä–Ω–∞–ª–æ–º ‚Äî —ñ —Ü–µ –¥–æ—Å—Ç—É–ø–Ω–æ –∫–æ–∂–Ω–æ–º—É —Å—Ç—É–¥–µ–Ω—Ç—É –≤ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–º—É –∫–ª–∞—Å—ñ.
    </p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}

// ===== –ê—É–¥—ñ–æ –ø–∞–π–ø–ª–∞–π–Ω =====
let actx=null, analyser=null, srcNode=null, micStream=null, fileBuf=null, fileSrc=null, emuNodes=[];
let fs=48000;
const NFFT=4096;
const wfBuf=new Float32Array(NFFT);
const spBuf=new Float32Array(NFFT/2);

const wave=$('#wave'), wctx=wave.getContext('2d');
const spec=$('#spec'), sctx=spec.getContext('2d');

const logbook=[], featsLog=[];
function log(msg){const t=new Date().toLocaleTimeString(); const box=$('#alog'); if(box.textContent.startsWith('//')) box.textContent=''; box.textContent+=`[${t}] ${msg}\n`; box.scrollTop=box.scrollHeight; logbook.push({t,msg});}

function drawWave(arr){
  const W=wave.width,H=wave.height;
  wctx.clearRect(0,0,W,H);
  wctx.strokeStyle='#223049'; wctx.strokeRect(0.5,0.5,W-1,H-1);
  wctx.beginPath(); wctx.strokeStyle='#38bdf8'; wctx.lineWidth=1;
  for(let i=0;i<arr.length;i++){
    const x=i*(W/(arr.length-1));
    const y=H/2 - arr[i]*(H/2-12);
    i?wctx.lineTo(x,y):wctx.moveTo(x,y);
  }
  wctx.stroke();
}
function drawSpec(db){
  const W=spec.width,H=spec.height;
  sctx.clearRect(0,0,W,H);
  sctx.strokeStyle='#223049'; sctx.strokeRect(0.5,0.5,W-1,H-1);
  sctx.fillStyle='#94a3b8'; sctx.font='12px ui-monospace';
  for(let fk=1000; fk<=20000; fk+=1000){
    const i=Math.round(fk/(fs/NFFT));
    const x=i*(W/(NFFT/2-1));
    sctx.strokeStyle='#18243b'; sctx.beginPath(); sctx.moveTo(x,0); sctx.lineTo(x,H); sctx.stroke();
    sctx.fillText(fk/1000+'–∫', x+2, 12);
  }
  sctx.beginPath(); sctx.strokeStyle='#22c55e'; sctx.lineWidth=1.6;
  for(let i=0;i<db.length;i++){
    const x=i*(W/(db.length-1));
    const y=H-10 - ((Math.max(-100,Math.min(0,db[i]))+100)/100)*(H-20);
    i?sctx.lineTo(x,y):sctx.moveTo(x,y);
  }
  sctx.stroke();
}

function startAudio(){
  if(actx) return;
  actx=new (window.AudioContext||window.webkitAudioContext)({latencyHint:'interactive'});
  fs=actx.sampleRate;
  analyser=actx.createAnalyser();
  analyser.fftSize=NFFT;
  analyser.smoothingTimeConstant=0.4;
  $('#stat').textContent='–°—Ç–∞—Ç—É—Å: init '+fs+' –ì—Ü';

  const mode=$('#src').value;
  if(mode==='mic'){
    navigator.mediaDevices.getUserMedia({audio:{noiseSuppression:false,echoCancellation:false,autoGainControl:false}})
      .then(stream=>{
        micStream=stream;
        srcNode=actx.createMediaStreamSource(stream);
        srcNode.connect(analyser);
        $('#stat').textContent='–°—Ç–∞—Ç—É—Å: mic';
        loop();
        log('–ú—ñ–∫—Ä–æ—Ñ–æ–Ω —É–≤—ñ–º–∫–Ω–µ–Ω–æ');
      }).catch(err=>{ alert('–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞: '+err.message); $('#stat').textContent='–°—Ç–∞—Ç—É—Å: –ø–æ–º–∏–ª–∫–∞'; });
  }else if(mode==='file'){
    $('#fileBox').style.display='flex';
    log('–í–∏–±–µ—Ä–∏ –∞—É–¥—ñ–æ—Ñ–∞–π–ª (WAV/MP3)');
  }else{
    // –ï–º—É–ª—è—Ç–æ—Ä
    const g=actx.createGain(); g.gain.value=parseFloat($('#emuLvl').value)||0.7;
    emuNodes=[g];
    function mkOsc(f, gain, type='sine'){const o=actx.createOscillator(); o.type=type; o.frequency.value=f; const gg=actx.createGain(); gg.gain.value=gain; o.connect(gg).connect(g); o.start(); emuNodes.push(o,gg);}
    function mkNoise(center, bw, gain){const buf=actx.createBuffer(1,fs,fs),d=buf.getChannelData(0); for(let i=0;i<fs;i++) d[i]=Math.random()*2-1; const s=actx.createBufferSource(); s.buffer=buf; s.loop=true; const biq=actx.createBiquadFilter(); biq.type='bandpass'; biq.frequency.value=center; biq.Q=center/Math.max(10,bw); const gg=actx.createGain(); gg.gain.value=gain; s.connect(biq).connect(gg).connect(g); s.start(); emuNodes.push(s,biq,gg);}
    const t=$('#emuType').value;
    if(t==='normal'){ mkNoise(700,600,0.10); mkOsc(100,0.02,'sawtooth'); }
    if(t==='cav'){ mkNoise(5000,6000,0.45); mkNoise(1500,1000,0.12); }
    if(t==='relief'){ mkOsc(800,0.25,'square'); mkNoise(2000,2000,0.08); }
    if(t==='aero'){ mkNoise(250,300,0.22); mkNoise(1200,1200,0.10); }
    g.connect(analyser);
    srcNode=g;
    $('#stat').textContent='–°—Ç–∞—Ç—É—Å: –µ–º—É–ª—è—Ç–æ—Ä';
    loop(); log('–ï–º—É–ª—è—Ç–æ—Ä: '+t);
  }
}
function stopAudio(){
  if(emuNodes.length){ emuNodes.forEach(n=>{try{if(n.stop)n.stop(); if(n.disconnect)n.disconnect();}catch{}}); emuNodes.length=0; }
  if(fileSrc){ try{fileSrc.stop(); fileSrc.disconnect();}catch{} fileSrc=null; }
  if(micStream){ micStream.getTracks().forEach(t=>t.stop()); micStream=null; }
  if(actx){ try{actx.close();}catch{} }
  actx=null; analyser=null; srcNode=null;
  $('#stat').textContent='–°—Ç–∞—Ç—É—Å: idle';
  log('–ó—É–ø–∏–Ω–µ–Ω–æ');
}
$('#start').addEventListener('click', startAudio);
$('#stop').addEventListener('click', stopAudio);
$('#src').addEventListener('change', ()=>{
  $('#fileBox').style.display = ($('#src').value==='file')?'flex':'none';
  $('#emuBox').style.display  = ($('#src').value==='emu')?'block':'none';
});

$('#fileInp').addEventListener('change', async e=>{
  const f=e.target.files[0]; if(!f) return;
  const ab=await f.arrayBuffer();
  if(!actx) actx=new (window.AudioContext||window.webkitAudioContext)();
  fileBuf=await actx.decodeAudioData(ab);
  log('–§–∞–π–ª –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ: '+f.name);
});
$('#playFile').addEventListener('click', ()=>{
  if(!fileBuf){ alert('–ù–µ–º–∞—î —Ñ–∞–π–ª—É'); return; }
  if(!actx) actx=new (window.AudioContext||window.webkitAudioContext)();
  analyser=actx.createAnalyser(); analyser.fftSize=NFFT; analyser.smoothingTimeConstant=0.4; fs=actx.sampleRate;
  fileSrc=actx.createBufferSource(); fileSrc.buffer=fileBuf; fileSrc.connect(analyser).connect(actx.destination);
  fileSrc.start(); $('#stat').textContent='–°—Ç–∞—Ç—É—Å: file play'; loop(); log('–í—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É');
});

// ===== –û–±—á–∏—Å–ª–µ–Ω–Ω—è –æ–∑–Ω–∞–∫ =====
function computeFeatures(){
  if(!analyser) return null;
  analyser.getFloatTimeDomainData(wfBuf);
  analyser.getFloatFrequencyData(spBuf);
  drawWave(wfBuf);
  drawSpec(spBuf);

  const fstep=fs/NFFT;
  function bandEnergy(fa,fb){ const ia=Math.max(1,Math.floor(fa/fstep)), ib=Math.min(spBuf.length-1,Math.ceil(fb/fstep)); let s=0; for(let i=ia;i<=ib;i++){ const a=Math.pow(10, spBuf[i]/20); s+=a*a; } return Math.sqrt(s/(ib-ia+1)); }
  const b1=bandEnergy(500,1000);
  const b2=bandEnergy(1000,3000);
  const b3=bandEnergy(3000,8000);
  const b4=bandEnergy(8000,15000);

  let num=0,den=0; for(let k=1;k<spBuf.length;k++){ const a=Math.pow(10, spBuf[k]/20); num+=(k*fstep)*a; den+=a; }
  const cent = den>0? num/den : 0;

  let sum=0,sumLog=0,n=0; for(let i=1;i<spBuf.length;i++){ const a=Math.max(1e-8,Math.pow(10, spBuf[i]/20)); sum+=a; sumLog+=Math.log(a); n++; }
  const flat = (Math.exp(sumLog/n))/(sum/n);

  const arr=spBuf.slice(1).map(v=>Math.pow(10,v/20));
  const ton = (arr.reduce((a,b)=>a+b,0)>0)? (Math.max(...arr)/arr.reduce((a,b)=>a+b,0)) : 0;

  let z=0; for(let i=1;i<wfBuf.length;i++){ if((wfBuf[i-1]>=0)!==(wfBuf[i]>=0)) z++; }
  const zcr=z/wfBuf.length;

  const maxA=Math.max(...arr), med=arr.slice().sort((a,b)=>a-b)[Math.floor(arr.length*0.5)];
  const snr=20*Math.log10((maxA+1e-9)/(med+1e-9));

  // UI
  $('#b1').textContent=b1.toFixed(3);
  $('#b2').textContent=b2.toFixed(3);
  $('#b3').textContent=b3.toFixed(3);
  $('#b4').textContent=b4.toFixed(3);
  $('#cent').textContent=cent.toFixed(0);
  $('#flat').textContent=flat.toFixed(2);
  $('#ton').textContent=ton.toFixed(2);
  $('#zcr').textContent=zcr.toFixed(3);
  $('#snr').textContent=snr.toFixed(1)+' –¥–ë';

  const row={t:new Date().toISOString(), b1,b2,b3,b4,cent,flat,ton,zcr,snr};
  featsLog.push(row);
  return row;
}

// –ü—Ä–∞–≤–∏–ª–∞ + kNN
const MEMO=[]; // {x:[...], y:'label'}
function toVec(f){ return [f.b1,f.b2,f.b3,f.b4,f.cent,f.flat,f.ton,f.zcr,f.snr]; }
function dist2(a,b){ let s=0; for(let i=0;i<a.length;i++){ const d=a[i]-b[i]; s+=d*d; } return s; }
function knn(feat,k){
  if(MEMO.length<6) return null;
  const x=toVec(feat);
  const arr=MEMO.map(r=>({d:dist2(x,r.x), y:r.y})).sort((a,b)=>a.d-b.d).slice(0,k);
  const votes=new Map(); arr.forEach(o=>votes.set(o.y,(votes.get(o.y)||0)+1));
  let best=null,v=-1; for(const [y,c] of votes){ if(c>v){v=c; best=y;} }
  return best;
}
function rules(f){
  // –ö–∞–≤—ñ—Ç–∞—Ü—ñ—è: –≤–∏—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è (3‚Äì8, 8‚Äì15 –∫–ì—Ü) + –≤–∏—Å–æ–∫–∞ –ø–ª–æ—Å–∫—ñ—Å—Ç—å, –≤–∏—Å–æ–∫–∏–π –∑—Å—É–≤ —Ü–µ–Ω—Ç—Ä–æ—ó–¥–∞
  if((f.b3>0.10 && f.b4>0.05 && f.flat>0.55 && f.cent>3000) || (f.b3>0.14 && f.flat>0.5)) return 'cav';
  // –ü–µ—Ä–µ–ø—É—Å–∫/–ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω—ã–π: –¥–æ–º—ñ–Ω–∞–Ω—Ç–Ω–∞ —Ç–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å 0.4‚Äì1.2 –∫–ì—Ü (b1 –≤–∏—Å–æ–∫–∏–π), –Ω–∏–∑—å–∫–∞ –ø–ª–æ—Å–∫—ñ—Å—Ç—å, –≤–∏—Å–æ–∫–∞ —Ç–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
  if(f.b1>0.14 && f.ton>0.35 && f.flat<0.55 && f.cent>=400 && f.cent<=1500) return 'relief';
  // –ê–µ—Ä–∞—Ü—ñ—è: –ø—ñ–¥–≤–∏—â–µ–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è –≤ 100‚Äì400/500‚Äì1000 –ì—Ü, —Å–µ—Ä–µ–¥–Ω—ñ —á–∞—Å—Ç–æ—Ç–∏ —Å–ª–∞–±–∫—ñ, –ø–ª–æ—Å–∫—ñ—Å—Ç—å —Å–µ—Ä–µ–¥–Ω—è, ZCR –ø–æ–º—ñ—Ä–Ω–∏–π
  if(f.b1>0.10 && f.b2<0.09 && f.b3<0.06 && f.cent<1200 && f.flat>=0.40 && f.flat<=0.65) return 'aero';
  // –ù–æ—Ä–º–∞: –Ω–∏–∑—å–∫–∞ HF –µ–Ω–µ—Ä–≥—ñ—è, —Å–µ—Ä–µ–¥–Ω—ñ–π —Ü–µ–Ω—Ç—Ä–æ—ó–¥, –Ω–µ–≤–∏—Å–æ–∫–∞ –ø–ª–æ—Å–∫—ñ—Å—Ç—å
  if(f.b3<0.08 && f.b4<0.04 && f.cent<2500 && f.flat<0.55) return 'normal';
  return 'normal';
}
function riskScoreCav(f){ // 0..1
  const hf = Math.min(1, 0.6*(f.b3/0.15) + 0.4*(f.b4/0.08));
  const cf = Math.min(1, (f.cent-2500)/3500);
  const fl = Math.min(1, (f.flat-0.45)/0.4);
  return Math.max(0, Math.min(1, 0.5*hf + 0.3*cf + 0.2*fl));
}

function classifyNow(){
  const f=computeFeatures(); if(!f) return;
  let pred=rules(f);
  const k=parseInt($('#k').value)||3;
  const p2=knn(f,k); if(p2) pred=p2;
  $('#pred').textContent='Pred: '+pred;
  const score=riskScoreCav(f);
  $('#risk').textContent='–°–∫–æ—Ä–∏–Ω–≥ —Ä–∏–∑–∏–∫—É (–∫–∞–≤—ñ—Ç–∞—Ü—ñ—è): '+(score*100).toFixed(0)+'%';
  if(pred!=='normal'){ log(`–ê–Ω–æ–º–∞–ª—ñ—è: ${pred} | cent=${f.cent.toFixed(0)}–ì—Ü flat=${f.flat.toFixed(2)} b3=${f.b3.toFixed(2)} b4=${f.b4.toFixed(2)}`); }
  return {pred,f,score};
}
$('#classify').addEventListener('click', classifyNow);
$('#mark').addEventListener('click', ()=>{
  const f=computeFeatures(); if(!f) return;
  const y=$('#label').value;
  MEMO.push({x:toVec(f), y});
  if(MEMO.length>400) MEMO.shift();
  log('–î–æ–¥–∞–Ω–æ —É –ø–∞–º‚Äô—è—Ç—å k-NN —è–∫ '+y);
});

let autoTick=true;
$('#auto').addEventListener('change', ()=>{ autoTick = ($('#auto').value==='–£–≤—ñ–º–∫–Ω–µ–Ω–∞'); });

// –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª
function loop(){
  if(!analyser) return;
  const f=computeFeatures();
  if(autoTick) classifyNow();
  requestAnimationFrame(loop);
}

// ===== –ï–∫—Å–ø–æ—Ä—Ç =====
$('#png').addEventListener('click', ()=>{
  const tmp=document.createElement('canvas'); tmp.width=spec.width; tmp.height=spec.height+wave.height+10;
  const tctx=tmp.getContext('2d'); tctx.drawImage(wave,0,0); tctx.drawImage(spec,0,wave.height+10);
  tmp.toBlob(b=>{ const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download='mech_para18_spectrum_'+stamp()+'.png'; a.click(); URL.revokeObjectURL(u); });
});
$('#clearPlot').addEventListener('click', ()=>{ wctx.clearRect(0,0,wave.width,wave.height); sctx.clearRect(0,0,spec.width,spec.height); });

$('#expCSV').addEventListener('click', ()=>{
  const head='timestamp,b1_0.5-1k,b2_1-3k,b3_3-8k,b4_8-15k,cent,flat,ton,zcr,snr,pred\n';
  const body=featsLog.map(r=>`${r.t},${r.b1.toFixed(4)},${r.b2.toFixed(4)},${r.b3.toFixed(4)},${r.b4.toFixed(4)},${r.cent.toFixed(0)},${r.flat.toFixed(3)},${r.ton.toFixed(3)},${r.zcr.toFixed(4)},${r.snr.toFixed(1)},`).join('\n');
  download('mechanic_para18_feats_'+stamp()+'.csv', head+body, 'text/csv');
});
$('#expTXT').addEventListener('click', ()=>{
  const lines=['–ü–∞—Ä–∞ 18 ‚Äî –ê–∫—É—Å—Ç–∏—á–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≥—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º','–ü—ñ–¥—Å—É–º–æ–∫ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤:']; logbook.forEach(l=>lines.push(`[${l.t}] ${l.msg}`));
  download('mechanic_para18_summary_'+stamp()+'.txt', lines.join('\n'));
});
$('#expICS').addEventListener('click', ()=>{
  // —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–æ–¥—ñ—ó –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤ —ñ–∑ –≤–∏—Å–æ–∫–∏–º —Ä–∏–∑–∏–∫–æ–º –∫–∞–≤—ñ—Ç–∞—Ü—ñ—ó
  const recent=featsLog.slice(-120); // ~2 —Ö–≤
  const lines=['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//EDLab//HydroAudio//UA'];
  recent.forEach((r,i)=>{
    const score=riskScoreCav(r);
    if(score>0.65){
      const s=new Date(r.t); const e=new Date(s.getTime()+60000);
      const dt=d=>d.toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z$/,'Z');
      lines.push('BEGIN:VEVENT');
      lines.push('UID:'+('cav-'+i+'-'+Date.now())+'@edlab');
      lines.push('DTSTART:'+dt(s));
      lines.push('DTEND:'+dt(e));
      lines.push('SUMMARY:–†–∏–∑–∏–∫ –∫–∞–≤—ñ—Ç–∞—Ü—ñ—ó –≤–∏—Å–æ–∫–∏–π ('+(score*100).toFixed(0)+'%)');
      lines.push('DESCRIPTION:–ü–µ—Ä–µ–≤—ñ—Ä —Ä—ñ–≤–µ–Ω—å/–≤‚Äô—è–∑–∫—ñ—Å—Ç—å –º–∞—Å–ª–∞, —Ñ—ñ–ª—å—Ç—Ä, –≤—Å–º–æ–∫—Ç—É–≤–∞–Ω–Ω—è, –∫–ª–∞–ø–∞–Ω–∏.');
      lines.push('END:VEVENT');
    }
  });
  lines.push('END:VCALENDAR');
  download('mechanic_para18_cav_'+stamp()+'.ics', lines.join('\r\n'), 'text/calendar');
});
$('#receipt').addEventListener('click', ()=>{
  const items=logbook.slice(-10);
  const lines=['=== –ß–ï–ö –ì–Ü–î–†–û–î–Ü–ê–ì–ù–û–°–¢–ò–ö–ò (58–º–º) ===','–î–∞—Ç–∞: '+new Date().toISOString().slice(0,10),'---'];
  if(items.length===0){ lines.push('–ü–æ–¥—ñ–π –Ω–µ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ'); }
  else { items.forEach(l=>lines.push(`[${l.t}] ${l.msg}`)); }
  const el=$('#rc'); el.hidden=false; el.textContent=lines.join('\n');
  download('para18_receipt_'+stamp()+'.txt', lines.join('\n'));
});

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
if (window.self !== window.top) document.documentElement.classList.add('embedded'); // LMS-friendly
</script>


</body></html>