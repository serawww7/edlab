<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 22 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –®–Ü#2: –í—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω—Å–ø–µ–∫—Ç–æ—Ä —Ä–µ–º–µ–Ω—è/—à–ª–∞–Ω–≥—ñ–≤ (CV —É –±—Ä–∞—É–∑–µ—Ä—ñ)</title>
<meta name="description" content="–í–µ–±–∫–∞–º–µ—Ä–∞/—Ñ–æ—Ç–æ ‚Üí –∞–Ω–∞–ª—ñ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è: —Ç—Ä—ñ—â–∏–Ω–∏ (edge density), –º–∞—Å–ª—è–Ω—ñ –ø–ª—è–º–∏ (—Å–ø–µ–∫—É–ª—è—Ä/–Ω–∏–∑—å–∫–∞ –Ω–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å), –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ–π –ª—ñ–Ω—ñ—ó, —á–µ–∫-–ª–∏—Å—Ç, –ø—Ä–æ–º–ø—Ç–∏, –∂—É—Ä–Ω–∞–ª, –µ–∫—Å–ø–æ—Ä—Ç PNG/CSV/TXT, —á–µ–∫ 58 –º–º.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1180px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:100px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
small.mono,.mono{font-family:ui-monospace,monospace}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
video,canvas{display:block}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.grid{display:grid;gap:14px;grid-template-columns:1.25fr 1fr}
@media(max-width:1080px){.grid{grid-template-columns:1fr}}
</style>
<link rel="canonical" href="https://edlab.pp.ua/mech_II_kyrs/mechanic_para22.html"><meta property="og:type" content="article"><meta property="og:title" content="–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 22"><meta property="og:description" content="–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ —Å—Ç–∞–Ω—É —Ä–µ–º–µ–Ω—ñ–≤, —à–ª–∞–Ω–≥—ñ–≤ —Ç–∞ –æ–∫–æ–ª–∏—Ü—å –≤—É–∑–ª—ñ–≤. –ú–∏ –∞–Ω–∞–ª—ñ–∑—É—î–º–æ –∫–∞–¥—Ä –Ω–∞ —Ç—Ä—ñ—â–∏–Ω–∏ (—â—ñ–ª—å–Ω"><meta property="og:url" content="https://edlab.pp.ua/mech_II_kyrs/mechanic_para22.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 22","description":"–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ —Å—Ç–∞–Ω—É —Ä–µ–º–µ–Ω—ñ–≤, —à–ª–∞–Ω–≥—ñ–≤ —Ç–∞ –æ–∫–æ–ª–∏—Ü—å –≤—É–∑–ª—ñ–≤. –ú–∏ –∞–Ω–∞–ª—ñ–∑—É—î–º–æ –∫–∞–¥—Ä –Ω–∞ —Ç—Ä—ñ—â–∏–Ω–∏ (—â—ñ–ª—å–Ω","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/mech_II_kyrs/mechanic_para22.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">ü™õ</span>
      <div>
        <b>–ü–∞—Ä–∞ 22 ‚Äî –í—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω—Å–ø–µ–∫—Ç–æ—Ä —Ä–µ–º–µ–Ω—è/—à–ª–∞–Ω–≥—ñ–≤ (–®–Ü —É –±—Ä–∞—É–∑–µ—Ä—ñ)</b><br>
        <span class="badge">–∫–∞–º–µ—Ä–∞/—Ñ–æ—Ç–æ ‚Üí —Ç—Ä—ñ—â–∏–Ω–∏/–º–∞—Å–ª–æ/–≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è ‚Üí —á–µ–∫-–ª–∏—Å—Ç ‚Üí –ø—Ä–æ–º–ø—Ç–∏ ‚Üí –∂—É—Ä–Ω–∞–ª ‚Üí –µ–∫—Å–ø–æ—Ä—Ç</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ —Å—Ç–∞–Ω—É <b>—Ä–µ–º–µ–Ω—ñ–≤</b>, <b>—à–ª–∞–Ω–≥—ñ–≤</b> —Ç–∞ –æ–∫–æ–ª–∏—Ü—å –≤—É–∑–ª—ñ–≤. –ú–∏ –∞–Ω–∞–ª—ñ–∑—É—î–º–æ –∫–∞–¥—Ä –Ω–∞ <b>—Ç—Ä—ñ—â–∏–Ω–∏</b> (—â—ñ–ª—å–Ω—ñ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—å), <b>–º–∞—Å–ª–æ</b> (–Ω–∏–∑—å–∫–∞ –Ω–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å + —Å–ø–µ–∫—É–ª—è—Ä–Ω—ñ –±–ª–∏—Å–∫–∏), –∞ —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ <b>–≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è</b> –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ–π –ª—ñ–Ω—ñ—ó.</p>

  <div class="grid">
    <!-- –õ–Ü–í–û: –∫–∞–º–µ—Ä–∞/—Ñ–æ—Ç–æ + –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ -->
    <div class="card">
      <h2>üé• –î–∂–µ—Ä–µ–ª–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</h2>
      <div class="row">
        <select id="src" class="input" style="max-width:220px">
          <option value="cam" selected="">–í–µ–±–∫–∞–º–µ—Ä–∞</option>
          <option value="img">–§–æ—Ç–æ (–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏)</option>
        </select>
        <select id="camSel" class="input" style="max-width:260px"></select>
        <select id="res" class="input" style="max-width:160px">
          <option>640x480</option><option selected="">1280x720</option><option>1920x1080</option>
        </select>
        <input id="file" class="input" type="file" accept="image/*" style="display:none">
        <button class="btn good" id="start">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
        <button class="btn secondary" id="shot">üì∏ –ó–Ω—ñ–º–æ–∫</button>
        <button class="btn secondary" id="stop">‚èπÔ∏è –°—Ç–æ–ø</button>
        <span id="stat" class="badge">–°—Ç–∞—Ç—É—Å: idle</span>
      </div>

      <div class="row" style="margin-top:6px">
        <label>–ü–æ—Ä–æ–≥ edge<input id="thrE" class="input" type="range" min="8" max="80" step="1" value="24"></label>
        <label>–ü–æ—Ä–æ–≥ ¬´–º–∞—Å–ª–æ¬ª (V%)<input id="thrV" class="input" type="range" min="30" max="95" step="1" value="70"></label>
        <label>–ü–æ—Ä–æ–≥ –Ω–∞—Å–∏—á–µ–Ω–æ—Å—Ç—ñ (S%)<input id="thrS" class="input" type="range" min="5" max="60" step="1" value="18"></label>
        <label>–¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ—ó –≤–∏—Ä—ñ–≤–Ω., px<input id="aline" class="input" type="number" min="1" max="8" value="3"></label>
      </div>

      <div class="canvasWrap" style="margin-top:8px">
        <canvas id="view" width="960" height="540"></canvas>
      </div>
      <small class="muted">–ü–æ—Ä–∞–¥–∞: –Ω–∞–∫–ª–µ–π –±—ñ–ª—É —Å–º—É–∂–∫—É –Ω–∞ —Ä–µ–º—ñ–Ω—å —ñ –ø—Ä–æ–≤–µ–¥–∏ <b>–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É –ª—ñ–Ω—ñ—é</b> (Shift+–∫–ª—ñ–∫ –ø–æ—á–∞—Ç–æ–∫, —â–µ —Ä–∞–∑ ‚Äî –∫—ñ–Ω–µ—Ü—å). –í—ñ—Å—å —Ä–µ–º–µ–Ω—è –º–∞—î –π—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ –¥–æ –ª—ñ–Ω—ñ—ó.</small>

      <h3 style="margin-top:10px">üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞–¥—Ä—É</h3>
      <table class="tbl">
        <tbody>
          <tr><th>–©—ñ–ª—å–Ω—ñ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—å (—Ç—Ä—ñ—â–∏–Ω–∏)</th><td id="edgeD">‚Äî</td></tr>
          <tr><th>–ß–∞—Å—Ç–∫–∞ –º–∞—Å–ª—è–Ω–∏—Ö –ø—ñ–∫—Å–µ–ª—ñ–≤</th><td id="oilP">‚Äî</td></tr>
          <tr><th>–í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è (–∫—É—Ç –¥–æ –ª—ñ–Ω—ñ—ó)</th><td id="align">‚Äî</td></tr>
          <tr><th>–í–µ—Ä–¥–∏–∫—Ç ‚úçÔ∏è</th><td id="verdict">‚Äî</td></tr>
        </tbody>
      </table>

      <div class="row" style="margin-top:6px">
        <button class="btn" id="analyze">üîç –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–∞–¥—Ä</button>
        <button class="btn secondary" id="overlay">üß© –£–≤—ñ–º–∫./–≤–∏–º–∫. –Ω–∞–∫–ª–∞–¥–µ–Ω–Ω—è</button>
        <button class="btn secondary" id="savePng">üñºÔ∏è PNG (–æ—Ä–∏–≥—ñ–Ω–∞–ª+–º–∞—Å–∫–∏)</button>
        <button class="btn secondary" id="saveCsv">üìÑ CSV (–º–µ—Ç—Ä–∏–∫–∏)</button>
      </div>
    </div>

    <!-- –ü–†–ê–í–û: —á–µ–∫-–ª–∏—Å—Ç, –ø—Ä–æ–º–ø—Ç–∏, –∂—É—Ä–Ω–∞–ª -->
    <div class="card">
      <h2>‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥—ñ–π</h2>
      <div id="checklist" class="note small">
        <label><input type="checkbox"> –û—á–∏—Å—Ç–∏—Ç–∏ –∑–æ–Ω—É –≤—É–∑–ª–∞ –≤—ñ–¥ –ø–∏–ª—É/–º–∞—Å–ª–∞, –∑—Ä–æ–±–∏—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–∏–π –∫–∞–¥—Ä.</label><br>
        <label><input type="checkbox"> –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—Ç—è–≥ —Ä–µ–º–µ–Ω—è —Ç–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å —à–∫—ñ–≤—ñ–≤ (–ü–∞—Ä–∞ 19).</label><br>
        <label><input type="checkbox"> –û–≥–ª—è–Ω—É—Ç–∏ —à–ª–∞–Ω–≥–∏ –Ω–∞ –º—ñ–∫—Ä–æ—Ç—Ä—ñ—â–∏–Ω–∏, ¬´–º–æ–∫—Ä—ñ –º—ñ—Å—Ü—è¬ª, –ø—ñ–¥—Ç—ñ–∫ –Ω–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è—Ö.</label><br>
        <label><input type="checkbox"> –ü—Ä–æ—Ç–µ—Ä—Ç–∏ –ø–æ—Å–∞–¥–∫–∏ –ø—ñ–¥—à–∏–ø–Ω–∏–∫—ñ–≤, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—ñ–±—Ä–∞—Ü—ñ—é/—à—É–º (–ü–∞—Ä–∞ 20).</label><br>
        <label><input type="checkbox"> –£—Å—É–Ω—É—Ç–∏ –ø—ñ–¥—Ç—ñ–∫ (—Ö–æ–º—É—Ç/—Ñ—ñ—Ç–∏–Ω–≥/—à–ª–∞–Ω–≥), –ø—Ä–æ–º–∏—Ç–∏ –≤—É–∑–æ–ª, –ø–æ–≤—Ç–æ—Ä–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å.</label>
      </div>

      <h2 style="margin-top:10px">üß† –ü—Ä–æ–º–ø—Ç –¥–æ LLM</h2>
      <div class="row">
        <button class="btn" id="genUA">üá∫üá¶ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ (—É–∫—Ä)</button>
        <button class="btn" id="genEN">üá¨üáß Generate (eng)</button>
        <button class="btn secondary" id="copyPrompt">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      </div>
      <pre id="promptBox" class="code small">// –°–ø–µ—Ä—à—É –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∫–∞–¥—Ä</pre>

      <h2 style="margin-top:10px">üìú –ñ—É—Ä–Ω–∞–ª —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç</h2>
      <div class="row">
        <button class="btn" id="mark">üìå –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –ø–æ–¥—ñ—é</button>
        <select id="label" class="input" style="max-width:240px">
          <option value="ok" selected="">ok</option>
          <option value="crack">—Ç—Ä—ñ—â–∏–Ω–∏</option>
          <option value="oil">–º–∞—Å–ª–æ</option>
          <option value="misalign">–Ω–µ–≤–∏—Ä—ñ–≤–Ω—è–Ω–æ</option>
        </select>
      </div>
      <pre id="alog" class="code small" style="max-height:180px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –∑–∞–ø–∏—Å—ñ–≤</pre>

      <div class="row">
        <button class="btn" id="saveTxt">üíæ TXT (–ø—ñ–¥—Å—É–º–æ–∫)</button>
        <button class="btn" id="saveTasks">üìù TXT (–∑–∞–≤–¥–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞)</button>
        <button class="btn" id="receipt">üñ®Ô∏è 58 –º–º —á–µ–∫</button>
      </div>
      <div id="rc" class="receipt" hidden=""></div>
    </div>
  </div>

  <div class="card">
    <h2>üìö –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ (—É –∫–æ–¥—ñ –≤–∂–µ –≤—Ä–∞—Ö–æ–≤–∞–Ω–æ)</h2>
    <ol>
      <li>–ó—Ä–æ–±–∏ 2 –∫–∞–¥—Ä–∏ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª –ø—Ä–æ—Ç–∏—Ä–∞–Ω–Ω—è –≤—É–∑–ª–∞. –ó–±–µ—Ä–µ–∂–∏ <b>PNG</b> (–æ—Ä–∏–≥—ñ–Ω–∞–ª+–º–∞—Å–∫–∏) —Ç–∞ <b>CSV</b> (edge/oil/align).</li>
      <li>–ü–æ–±—É–¥—É–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É –ª—ñ–Ω—ñ—é (Shift+–∫–ª—ñ–∫ √ó2). –í–∏—Ä—ñ–≤–Ω—è–π —à–∫—ñ–≤–∏/—Ö–æ–º—É—Ç–∏, –¥–æ–º–æ–∂–∏—Å—è |–∫—É—Ç| &lt; <span class="mono">2¬∞</span>. –ó—Ä–æ–±–∏ –ø–æ–∑–Ω–∞—á–∫—É –≤ –∂—É—Ä–Ω–∞–ª—ñ.</li>
      <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>–ø—Ä–æ–º–ø—Ç</b> (—É–∫—Ä/eng) —ñ –æ—Ç—Ä–∏–º–∞–π —É –∑–æ–≤–Ω—ñ—à–Ω—ñ–π LLM –ø–æ–∫—Ä–æ–∫–æ–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –î–æ–¥–∞–π —É <b>TXT</b>-–∑–≤—ñ—Ç (–∫–Ω–æ–ø–∫–∞ ¬´TXT –ø—ñ–¥—Å—É–º–æ–∫¬ª).</li>
    </ol>
  </div>

  <div class="card">
    <h2>üîå –°—Ö–µ–º–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è (SVG)</h2>
    <svg viewBox="0 0 980 280" role="img" aria-label="–ö–∞–º–µ—Ä–∞ ‚Üí —Ä–µ–º—ñ–Ω—å/—à–ª–∞–Ω–≥; –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ –ª—ñ–Ω—ñ—è">
      <rect x="40" y="40" width="260" height="120" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
      <text x="170" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ù–æ—É—Ç–±—É–∫/–ü–ö</text>
      <text x="170" y="98" fill="#93c5fd" font-size="12" text-anchor="middle">–≤–µ–±–∫–∞–º–µ—Ä–∞ 720p+</text>
      <line x1="300" y1="90" x2="440" y2="90" stroke="#93c5fd" stroke-width="3"></line>
      <rect x="460" y="60" width="180" height="68" rx="10" fill="#14532d" stroke="#22c55e"></rect>
      <text x="550" y="92" fill="#dcfce7" font-size="12" text-anchor="middle">–†–µ–º—ñ–Ω—å/—à–ª–∞–Ω–≥</text>
      <line x1="460" y1="140" x2="780" y2="140" stroke="#fbbf24" stroke-width="3"></line>
      <text x="620" y="160" fill="#fde68a" font-size="12" text-anchor="middle">–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ –ª—ñ–Ω—ñ—è (–≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è)</text>
      <text x="540" y="220" fill="#fbbf24" font-size="12">‚ö†Ô∏è –ë–µ–∑–ø–µ–∫–∞: LOTO, –Ω–µ –ª—ñ–∑—Ç–∏ –¥–æ —Ä—É—Ö–æ–º–∏—Ö —á–∞—Å—Ç–∏–Ω –ø—ñ–¥ —á–∞—Å –∞–Ω–∞–ª—ñ–∑—É.</text>
    </svg>
  </div>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>PNG (–æ—Ä–∏–≥—ñ–Ω–∞–ª + –º–∞—Å–∫–∏ —Ç—Ä—ñ—â–∏–Ω/–º–∞—Å–ª–∞ + –ª—ñ–Ω—ñ—è).</li>
      <li>CSV –∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏: <span class="mono">edge_density, oil_ratio, align_deg</span>.</li>
      <li>TXT: –≤–µ—Ä–¥–∏–∫—Ç, —á–µ–∫-–ª–∏—Å—Ç, –ø—Ä–æ–º–ø—Ç, –∂—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π.</li>
    </ul>
  </div>

  <div class="card">
    <h2>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
    <p class="muted small">–ü–µ—Ä—à—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —ñ–Ω—Å–ø–µ–∫—Ç–æ—Ä–∏ –¥–µ—Ñ–µ–∫—Ç—ñ–≤ —Ä–µ–º–µ–Ω—ñ–≤ —É 1990-—Ö –±—É–ª–∏ –¥–æ—Ä–æ–≥–∏–º–∏. –°—å–æ–≥–æ–¥–Ω—ñ —Å—Ö–æ–∂—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ (–≥—Ä–∞–Ω–∏—Ü—ñ, –∫–æ–Ω—Ç—Ä–∞—Å—Ç, —Å–ø–µ–∫—É–ª—è—Ä) —Ä–æ–±–∏—Ç—å –∑–≤–∏—á–∞–π–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä –Ω–∞ —à–∫—ñ–ª—å–Ω–æ–º—É –ü–ö.</p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function clamp(x,a,b){return Math.max(a,Math.min(b,x));}

// ===== –ö–∞–º–µ—Ä–∞/–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è =====
let stream=null, video=null;
const camSel=$('#camSel'), resSel=$('#res'), srcSel=$('#src');
const view=$('#view'), vctx=view.getContext('2d');
let overlayOn=true;

async function listCams(){
  try{
    const devs=await navigator.mediaDevices.enumerateDevices();
    const cams=devs.filter(d=>d.kind==='videoinput');
    camSel.innerHTML=''; cams.forEach((c,i)=>{const o=document.createElement('option'); o.value=c.deviceId; o.textContent=c.label||('–ö–∞–º–µ—Ä–∞ '+(i+1)); camSel.appendChild(o);});
  }catch{}
}
listCams();

async function startCam(){
  try{
    const [w,h]=resSel.value.split('x').map(Number);
    stream = await navigator.mediaDevices.getUserMedia({video:{deviceId: camSel.value?{exact:camSel.value}:undefined, width:{ideal:w}, height:{ideal:h}}, audio:false});
    video=document.createElement('video'); video.srcObject=stream; video.muted=true; await video.play();
    view.width=video.videoWidth; view.height=video.videoHeight;
    $('#stat').textContent='–°—Ç–∞—Ç—É—Å: camera ok';
    loop();
  }catch(err){ alert('–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏: '+err.message); $('#stat').textContent='–°—Ç–∞—Ç—É—Å: –ø–æ–º–∏–ª–∫–∞'; }
}
function stopCam(){
  if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
  video=null; $('#stat').textContent='–°—Ç–∞—Ç—É—Å: idle';
}

// ===== –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ –ª—ñ–Ω—ñ—è (Shift+–∫–ª—ñ–∫) =====
let aline=null; // {x1,y1,x2,y2}
view.addEventListener('click',(e)=>{
  if(!e.shiftKey) return;
  const r=view.getBoundingClientRect();
  const x=(e.clientX-r.left)*(view.width/r.width);
  const y=(e.clientY-r.top)*(view.height/r.height);
  if(!aline){ aline={x1:x,y1:y,x2:x,y2:y}; }
  else if(aline && (aline.x1===aline.x2 && aline.y1===aline.y2)){ aline.x2=x; aline.y2=y; }
  else { aline={x1:x,y1:y,x2:x,y2:y}; }
});

// ===== –ê–Ω–∞–ª—ñ–∑ –∫–∞–¥—Ä—É =====
let lastMetrics=null, lastMasks=null, lastShot=null;
function rgb2hsv(r,g,b){
  const mx=Math.max(r,g,b), mn=Math.min(r,g,b); const d=mx-mn;
  const v=mx/255;
  const s= mx===0? 0 : d/mx;
  return {h:0,s,v}; // h –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω
}
function analyzeFrame(){
  const W=view.width, H=view.height;
  if(!W||!H) return null;
  const img=vctx.getImageData(0,0,W,H);
  const thrE=parseInt($('#thrE').value,10);
  const thrV=parseInt($('#thrV').value,10)/100;
  const thrS=parseInt($('#thrS').value,10)/100;

  // 1) Edge density (—Å—É—Ä–æ–≥–∞—Ç —Ç—Ä—ñ—â–∏–Ω) ‚Äî –≥—Ä–∞–¥—ñ—î–Ω—Ç –ø–æ —Å—É—Å—ñ–¥–∞—Ö (Sobel-lite)
  const edges=new Uint8ClampedArray(W*H);
  let eCount=0;
  for(let y=1;y<H-1;y++){
    for(let x=1;x<W-1;x++){
      const k=(y*W+x)*4;
      const g = 0.299*img.data[k]+0.587*img.data[k+1]+0.114*img.data[k+2];
      const gx = (0.299*img.data[k+4]+0.587*img.data[k+5]+0.114*img.data[k+6]) - (0.299*img.data[k-4]+0.587*img.data[k-3]+0.114*img.data[k-2]);
      const gy = (0.299*img.data[k+4*W]+0.587*img.data[k+4*W+1]+0.114*img.data[k+4*W+2]) - (0.299*img.data[k-4*W]+0.587*img.data[k-4*W+1]+0.114*img.data[k-4*W+2]);
      const m = Math.sqrt(gx*gx+gy*gy);
      edges[y*W+x] = (m>thrE)?255:0;
      if(m>thrE) eCount++;
    }
  }
  const edgeDensity = eCount / (W*H);

  // 2) –ú–∞—Å–ª—è–Ω—ñ –ø—ñ–∫—Å–µ–ª—ñ ‚Äî –Ω–∏–∑—å–∫–∞ –Ω–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å (S –Ω–∏–∑—å–∫–∞), –≤–∏—Å–æ–∫–∞ —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å (V –≤–∏—Å–æ–∫–∞) –∞–±–æ ¬´–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ¬ª —Å–ø–µ–∫—É–ª—è—Ä–∏ (–¥—É–∂–µ –≤–∏—Å–æ–∫–∞ V)
  const oilMask=new Uint8ClampedArray(W*H);
  let oilCount=0;
  for(let y=0;y<H;y++){
    for(let x=0;x<W;x++){
      const k=(y*W+x)*4;
      const r=img.data[k], g=img.data[k+1], b=img.data[k+2];
      const {s,v}=rgb2hsv(r,g,b);
      const shiny = v>Math.max(thrV,0.85); // —Å–ø–µ–∫—É–ª—è—Ä
      const oily = (s<thrS && v>thrV);
      const hit = (shiny || oily);
      oilMask[y*W+x]= hit?255:0;
      if(hit) oilCount++;
    }
  }
  const oilRatio = oilCount/(W*H);

  // 3) –í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è: –æ—Ü—ñ–Ω–∫–∞ –¥–æ–º—ñ–Ω–∞–Ω—Ç–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–º–∫—É –∫—Ä–∞—ó–≤ —ñ –∫—É—Ç –≤—ñ–¥–Ω–æ—Å–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó –ª—ñ–Ω—ñ—ó
  let alignDeg = NaN;
  if(aline && (aline.x1!==aline.x2 || aline.y1!==aline.y2)){
    const ax=aline.x2-aline.x1, ay=aline.y2-aline.y1;
    const aang = Math.atan2(ay,ax); // —Ä–∞–¥
    // –ø—Ä–∏–±–ª–∏–∑–Ω–∞ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—è —Ä–µ–±–µ—Ä ‚Äî —á–µ—Ä–µ–∑ ¬´—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏–π —Ç–µ–Ω–∑–æ—Ä¬ª (–≥—Ä–∞–¥—ñ—î–Ω—Ç–∏ gx,gy)
    let Sxx=0,Syy=0,Sxy=0, n=0;
    for(let y=2;y<H-2;y+=2){
      for(let x=2;x<W-2;x+=2){
        const k=(y*W+x)*4;
        const gx = (img.data[k+4]-img.data[k-4]) + (img.data[k+4*W]-img.data[k-4*W])*0.5;
        const gy = (img.data[k+4*W]-img.data[k-4*W]) + (img.data[k+4]-img.data[k-4])*0.5;
        Sxx+=gx*gx; Syy+=gy*gy; Sxy+=gx*gy; n++;
      }
    }
    const theta = 0.5*Math.atan2(2*Sxy, Sxx - Syy); // –≥–æ–ª–æ–≤–Ω–∏–π –Ω–∞–ø—Ä—è–º
    alignDeg = Math.abs((theta - aang) * 180/Math.PI);
    if(alignDeg>90) alignDeg = 180-alignDeg; // –¥–æ 90¬∞
  }

  lastMetrics={edgeDensity, oilRatio, alignDeg: isNaN(alignDeg)?null:alignDeg};
  lastMasks={edges, oilMask, W, H};
  return lastMetrics;
}

function verdict(metrics){
  if(!metrics) return '‚Äî';
  const ed=metrics.edgeDensity, oil=metrics.oilRatio, ad=metrics.alignDeg??999;
  const parts=[];
  if(ed>0.08) parts.push('üî¥ –±–∞–≥–∞—Ç–æ —Ç—Ä—ñ—â–∏–Ω/–≥—Ä–∞–Ω–∏—Ü—å');
  else if(ed>0.04) parts.push('üü† –ª–æ–∫–∞–ª—å–Ω—ñ —Ç—Ä—ñ—â–∏–Ω–∏/–ø–æ—Ç–µ—Ä—Ç–æ—Å—Ç—ñ');
  else parts.push('üü¢ –ø–æ–≤–µ—Ä—Ö–Ω—è —Ä—ñ–≤–Ω–∞');
  if(oil>0.06) parts.push('üî¥ –º–∞—Å–ª—è–Ω—ñ –ø–ª—è–º–∏/–±–ª–∏—Å–∫–∏');
  else if(oil>0.03) parts.push('üü† –º–æ–∂–ª–∏–≤–∞ —Ç–µ—á–∞');
  else parts.push('üü¢ —Å—É—Ö–æ');
  if(ad<2) parts.push('üü¢ –≤–∏—Ä—ñ–≤–Ω—è–Ω–æ');
  else if(ad<5) parts.push('üü† –Ω–µ–≤–µ–ª–∏–∫–∏–π –∫—É—Ç '+ad.toFixed(1)+'¬∞');
  else parts.push('üî¥ –Ω–µ–≤–∏—Ä—ñ–≤–Ω—è–Ω–æ '+ad.toFixed(1)+'¬∞');
  return parts.join(' ¬∑ ');
}

// ===== –í—ñ–¥–º–∞–ª—é–≤–∞–Ω–Ω—è =====
function drawFrame(){
  const W=view.width, H=view.height;
  if(video){ vctx.drawImage(video,0,0,W,H); }
  if(overlayOn && lastMasks){
    // –Ω–∞–∫–ª–∞–¥–µ–Ω–Ω—è –º–∞—Å–æ–∫
    const {edges, oilMask} = lastMasks;
    const img=vctx.getImageData(0,0,W,H);
    for(let i=0;i<W*H;i++){
      if(edges[i]){ img.data[i*4+1]=Math.max(img.data[i*4+1],220); }       // –∑–µ–ª–µ–Ω–∞ –≥—Ä–∞–Ω—å
      if(oilMask[i]){ img.data[i*4+0]=Math.max(img.data[i*4+0],220); }     // —á–µ—Ä–≤–æ–Ω–∏–π –º–∞—Å–∫
    }
    vctx.putImageData(img,0,0);
  }
  if(aline){
    vctx.beginPath(); vctx.strokeStyle='#fbbf24'; vctx.lineWidth=parseInt($('#aline').value,10)||3;
    vctx.moveTo(aline.x1,aline.y1); vctx.lineTo(aline.x2,aline.y2); vctx.stroke();
  }
}
function loop(){
  if(video){ drawFrame(); }
  requestAnimationFrame(loop);
}

// ===== –ü—Ä–æ–º–ø—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä =====
function makePrompt(lang='ua'){
  if(!lastMetrics){ alert('–°–ø–æ—á–∞—Ç–∫—É ¬´–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–∞–¥—Ä¬ª.'); return; }
  const m=lastMetrics, v=verdict(m);
  const ua=`SYSTEM:
–¢–∏ ‚Äî –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä –∑ –¢–û —Å/–≥ —Ç–µ—Ö–Ω—ñ–∫–∏. –î–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π –ø–ª–∞–Ω –¥—ñ–π –∑ –±–µ–∑–ø–µ–∫–æ—é (LOTO, –ó–Ü–ó).
USER:
–Ø –∑—Ä–æ–±–∏–≤ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —Ä–µ–º–µ–Ω—è/—à–ª–∞–Ω–≥—ñ–≤ —É –º–∞–π—Å—Ç–µ—Ä–Ω—ñ.
–ü–æ–∫–∞–∑–Ω–∏–∫–∏: edge_density=${m.edgeDensity.toFixed(3)}, oil_ratio=${m.oilRatio.toFixed(3)}, align_deg=${(m.alignDeg??NaN).toFixed?.(1)??'N/A'}.
–í–µ—Ä–¥–∏–∫—Ç: ${v}.
–ü—Ä–æ—à—É: 1) –ø–µ—Ä—à–æ—á–µ—Ä–≥–æ–≤—ñ –¥—ñ—ó, 2) —â–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–æ, 3) —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/–º–∞—Ç–µ—Ä—ñ–∞–ª–∏, 4) –∫–æ–ª–∏ –º–æ–∂–Ω–∞ –≤—ñ–¥–∫–ª–∞—Å—Ç–∏, 5) –∫–æ—Ä–æ—Ç–∫–∞ –ø—Ä–∏–º—ñ—Ç–∫–∞ –ø—Ä–æ –ø—Ä–∏—á–∏–Ω–∏.`;
  const en=`SYSTEM:
You are a seasoned agricultural machinery service engineer. Provide a concise action plan with safety (LOTO, PPE).
USER:
I ran a visual inspection of belts/hoses in the workshop.
Metrics: edge_density=${m.edgeDensity.toFixed(3)}, oil_ratio=${m.oilRatio.toFixed(3)}, align_deg=${(m.alignDeg??NaN).toFixed?.(1)??'N/A'}.
Verdict: ${v}.
Please provide: 1) immediate actions, 2) detailed checks, 3) tools/materials, 4) when it can be deferred, 5) brief root-cause note.`;
  $('#promptBox').textContent = (lang==='ua')? ua : en;
  return $('#promptBox').textContent;
}

// ===== –ñ—É—Ä–Ω–∞–ª/–µ–∫—Å–ø–æ—Ä—Ç–∏ =====
const logbook=[];
function log(msg){ const t=new Date().toLocaleTimeString(); const box=$('#alog'); if(box.textContent.startsWith('//')) box.textContent=''; box.textContent+=`[${t}] ${msg}\n`; box.scrollTop=box.scrollHeight; logbook.push({t,msg}); }

function savePNGs(){
  if(!lastMasks){ alert('–ù–µ–º–∞—î –∞–Ω–∞–ª—ñ–∑—É/–∫–∞–¥—Ä–∞'); return; }
  const W=view.width,H=view.height, pad=10;
  const over=document.createElement('canvas'); over.width=W; over.height=H;
  const ctx=over.getContext('2d'); ctx.drawImage(view,0,0);
  // —É–∂–µ –Ω–∞–∫–ª–∞–¥–µ–Ω–æ –≤ drawFrame; –∑–±–µ—Ä–µ–∂–µ–º–æ —è–∫ —î
  const big=document.createElement('canvas'); big.width=W; big.height=H;
  const bctx=big.getContext('2d'); bctx.drawImage(view,0,0);
  big.toBlob(b=>{ const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download='mech_para22_frame_'+stamp()+'.png'; a.click(); URL.revokeObjectURL(u); });
}
function saveCSV(){
  if(!lastMetrics){ alert('–ù–µ–º–∞—î –º–µ—Ç—Ä–∏–∫'); return; }
  const head='t_iso,edge_density,oil_ratio,align_deg\n';
  const body=`${new Date().toISOString()},${lastMetrics.edgeDensity.toFixed(4)},${lastMetrics.oilRatio.toFixed(4)},${(lastMetrics.alignDeg??NaN).toFixed?.(2)??''}\n`;
  download('mechanic_para22_metrics_'+stamp()+'.csv', head+body, 'text/csv');
}
function saveTXT(){
  if(!lastMetrics){ alert('–ù–µ–º–∞—î –º–µ—Ç—Ä–∏–∫'); return; }
  const v=verdict(lastMetrics);
  const lines=[
    '–ü–∞—Ä–∞ 22 ‚Äî –í—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω—Å–ø–µ–∫—Ç–æ—Ä (–®–Ü#2)',
    `edge_density=${lastMetrics.edgeDensity.toFixed(4)}`,
    `oil_ratio=${lastMetrics.oilRatio.toFixed(4)}`,
    `align_deg=${(lastMetrics.alignDeg??NaN).toFixed?.(2)??'N/A'}`,
    '–í–µ—Ä–¥–∏–∫—Ç: '+v,
    '--- –ß–µ–∫-–ª–∏—Å—Ç ---',
    ...Array.from($('#checklist').querySelectorAll('label')).map((el,i)=>`${i+1}. ${el.textContent.trim()} [${el.querySelector('input').checked?'x':' '}]`),
    '--- –ñ—É—Ä–Ω–∞–ª ---',
    ...logbook.map(l=>`[${l.t}] ${l.msg}`),
    '--- –ü—Ä–æ–º–ø—Ç ---',
    $('#promptBox').textContent||'‚Äî'
  ];
  download('mechanic_para22_summary_'+stamp()+'.txt', lines.join('\n'));
}
function saveTasksTXT(){
  const tasks=[
    '1) –ó—Ä–æ–±–∏—Ç–∏ 2 –∫–∞–¥—Ä–∏ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª, –∑–±–µ—Ä–µ–≥—Ç–∏ PNG —Ç–∞ CSV.',
    '2) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É –ª—ñ–Ω—ñ—é, –¥–æ–±–∏—Ç–∏—Å—å |–∫—É—Ç| < 2¬∞.',
    '3) –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç (—É–∫—Ä/eng) —ñ –¥–æ–¥–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å LLM –¥–æ TXT-–∑–≤—ñ—Ç—É.'
  ];
  download('mechanic_para22_tasks_'+stamp()+'.txt', tasks.join('\n'));
}
function makeReceipt(){
  const m=lastMetrics;
  const lines=[
    '=== –ß–ï–ö –í–Ü–ó.–Ü–ù–°–ü–ï–ö–¢–û–†–ê (58–º–º) ===',
    '–î–∞—Ç–∞: '+new Date().toISOString().slice(0,10),
    m?('edge='+m.edgeDensity.toFixed(3)+' | oil='+m.oilRatio.toFixed(3)):'edge=?, oil=?',
    m?('align='+(m.alignDeg?.toFixed(1)??'N/A')+'¬∞'):'align=?',
    '–í–µ—Ä–¥–∏–∫—Ç:',
    m?verdict(m):'‚Äî'
  ];
  const el=$('#rc'); el.hidden=false; el.textContent=lines.join('\n');
  download('para22_receipt_'+stamp()+'.txt', lines.join('\n'));
}

// ===== –ü–æ–¥—ñ—ó UI =====
$('#src').addEventListener('change', ()=>{
  const useImg = ($('#src').value==='img');
  $('#file').style.display = useImg?'block':'none';
  if(useImg){ stopCam(); $('#stat').textContent='–°—Ç–∞—Ç—É—Å: —Ñ–æ—Ç–æ'; }
});
$('#start').addEventListener('click', ()=>{
  if($('#src').value==='cam'){ startCam(); }
  else { $('#file').click(); }
});
$('#file').addEventListener('change', (e)=>{
  const f=e.target.files[0]; if(!f) return;
  const img=new Image();
  img.onload=()=>{ view.width=img.width; view.height=img.height; vctx.drawImage(img,0,0); $('#stat').textContent='–°—Ç–∞—Ç—É—Å: —Ñ–æ—Ç–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ'; };
  img.src=URL.createObjectURL(f);
});

$('#shot').addEventListener('click', ()=>{
  if(!video){ log('–ó–Ω—ñ–º–æ–∫: –Ω–µ–º–∞—î –≤—ñ–¥–µ–æ'); return; }
  vctx.drawImage(video,0,0,view.width,view.height);
  lastShot = view.toDataURL();
  log('–ó–±–µ—Ä–µ–∂–µ–Ω–æ –∫–∞–¥—Ä –Ω–∞ –ø–æ–ª–æ—Ç–Ω—ñ');
});

$('#stop').addEventListener('click', ()=>{ stopCam(); });

$('#overlay').addEventListener('click', ()=>{ overlayOn=!overlayOn; log('–û–≤–µ—Ä–ª–µ–π: '+(overlayOn?'—É–≤—ñ–º–∫–Ω–µ–Ω–æ':'–≤–∏–º–∫–Ω–µ–Ω–æ')); });
$('#analyze').addEventListener('click', ()=>{
  // —Å–ø–µ—Ä—à—É ¬´—Å–∏—Ä–∏–π¬ª –∫–∞–¥—Ä
  if(video){ vctx.drawImage(video,0,0,view.width,view.height); }
  analyzeFrame();
  if(!lastMetrics){ alert('–ù–µ–º–∞—î –∫–∞–¥—Ä—É'); return; }
  // –æ–Ω–æ–≤–∏—Ç–∏ UI
  $('#edgeD').textContent=(lastMetrics.edgeDensity*100).toFixed(1)+' %';
  $('#oilP').textContent=(lastMetrics.oilRatio*100).toFixed(1)+' %';
  $('#align').textContent = (lastMetrics.alignDeg==null)?'‚Äî':(lastMetrics.alignDeg.toFixed(2)+' ¬∞');
  $('#verdict').textContent = verdict(lastMetrics);
  log('–ê–Ω–∞–ª—ñ–∑: '+$('#verdict').textContent);
  drawFrame();
});

$('#savePng').addEventListener('click', savePNGs);
$('#saveCsv').addEventListener('click', saveCSV);
$('#saveTxt').addEventListener('click', saveTXT);
$('#saveTasks').addEventListener('click', saveTasksTXT);
$('#receipt').addEventListener('click', makeReceipt);

$('#genUA').addEventListener('click', ()=>makePrompt('ua'));
$('#genEN').addEventListener('click', ()=>makePrompt('en'));
$('#copyPrompt').addEventListener('click', ()=>{
  const ta=document.createElement('textarea'); ta.value=$('#promptBox').textContent; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
  log('–ü—Ä–æ–º–ø—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
});
$('#mark').addEventListener('click', ()=>{
  const lab=$('#label').value;
  const m=lastMetrics || {edgeDensity:0,oilRatio:0,alignDeg:0};
  log(`–ü–æ–∑–Ω–∞—á–∫–∞: ${lab} | edge=${m.edgeDensity.toFixed(3)} oil=${m.oilRatio.toFixed(3)} align=${(m.alignDeg??NaN).toFixed?.(1)??'N/A'}¬∞`);
});

// ===== –°—Ç–∞—Ä—Ç —Ü–∏–∫–ª—É —Ä–µ–Ω–¥–µ—Ä—É =====
loop();

// ===== LMS-friendly =====
if (window.self !== window.top) document.documentElement.classList.add('embedded');
</script>


</body></html>