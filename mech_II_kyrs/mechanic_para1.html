<!-- mechanic_para1.html --><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 1 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –¶–∏—Ñ—Ä–æ–≤–∏–π –∂—É—Ä–Ω–∞–ª –¢–û, —á–µ–∫ 58 –º–º, NFC, CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --line:#1f2937;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:#94a3b8; letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  .small{font-size:12px; color:#9fb0c8}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:#0b1324; color:#e6eef9}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:8px 10px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left; position:sticky; top:0}
  .table tbody tr:nth-child(even){background:#0b1324; color:#e5e7eb}
  .out{background:#0b1324; color:#e5e7eb; border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}

  /* –ß–µ–∫ 58 –º–º (–≤–∏–≥–ª—è–¥ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ) ‚Äî –ñ–ò–†–ù–ò–ô –¥–ª—è —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä–∞ */
  .ticket{
    width:58mm; background:#fff; color:#000; padding:6mm 4mm;
    border-radius:6px; box-shadow:0 0 0 1px #e5e7eb inset;
    font-family:"Courier New", Courier, monospace;
    font-weight:700; letter-spacing:0.1px;
  }
  .ticket h4{margin:0 0 6px; font-size:13px; text-align:center; font-weight:700}
  .ticket p{margin:2px 0; font-size:12px; font-weight:700}
  .ticket .line{border-top:1px dashed #111; margin:6px 0}
  .ticket small{font-size:10px; font-weight:700}
  .ticket b, .ticket strong, .ticket span{font-weight:700}

  /* –°–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ —É –≤–±—É–¥—É–≤–∞–Ω–Ω—ñ (Moodle iFrame) */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}
  html.embedded .box{background:#f8fafc; color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6; color:#111}
</style>
<meta name="description" content="–°—Ç–≤–æ—Ä—é—î–º–æ –¥–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω, –∑–∞–ø–æ–≤–Ω—é—î–º–æ –∂—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç, —Ä–∞—Ö—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–µ –¢–û, –≥–µ–Ω–µ—Ä—É—î–º–æ —á–µ–∫ 58 –º–º —ñ NFC-—Ç–µ–∫—Å—Ç, –µ–∫—Å–ø–æ—Ä—Ç—É—î–º–æ CSV."><link rel="canonical" href="https://edlab.pp.ua/mech_II_kyrs/mechanic_para1.html"><meta property="og:type" content="article"><meta property="og:title" content="üîß –¶–∏—Ñ—Ä–æ–≤–∏–π –∂—É—Ä–Ω–∞–ª –¢–û: —Ç–µ—Ö–Ω—ñ–∫–∞, –Ω–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —á–µ–∫ 58 –º–º, NFC, CSV"><meta property="og:description" content="–°—Ç–≤–æ—Ä—é—î–º–æ –¥–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω, –∑–∞–ø–æ–≤–Ω—é—î–º–æ –∂—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç, —Ä–∞—Ö—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–µ –¢–û, –≥–µ–Ω–µ—Ä—É—î–º–æ —á–µ–∫ 58 –º–º —ñ NFC-—Ç–µ–∫—Å—Ç, –µ–∫—Å–ø–æ—Ä—Ç—É—î–º–æ CSV."><meta property="og:url" content="https://edlab.pp.ua/mech_II_kyrs/mechanic_para1.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üîß –¶–∏—Ñ—Ä–æ–≤–∏–π –∂—É—Ä–Ω–∞–ª –¢–û: —Ç–µ—Ö–Ω—ñ–∫–∞, –Ω–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —á–µ–∫ 58 –º–º, NFC, CSV","description":"–°—Ç–≤–æ—Ä—é—î–º–æ –¥–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω, –∑–∞–ø–æ–≤–Ω—é—î–º–æ –∂—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç, —Ä–∞—Ö—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–µ –¢–û, –≥–µ–Ω–µ—Ä—É—î–º–æ —á–µ–∫ 58 –º–º —ñ NFC-—Ç–µ–∫—Å—Ç, –µ–∫—Å–ø–æ—Ä—Ç—É—î–º–æ CSV.","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/mech_II_kyrs/mechanic_para1.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 1 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
    <h1>üîß –¶–∏—Ñ—Ä–æ–≤–∏–π –∂—É—Ä–Ω–∞–ª –¢–û: —Ç–µ—Ö–Ω—ñ–∫–∞, –Ω–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —á–µ–∫ 58 –º–º, NFC, CSV</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>–°—Ç–≤–æ—Ä—é—î–º–æ <b>–¥–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω</b>, –∑–∞–ø–æ–≤–Ω—é—î–º–æ <b>–∂—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç</b>, —Ä–∞—Ö—É—î–º–æ <b>–Ω–∞—Å—Ç—É–ø–Ω–µ –¢–û</b>, –≥–µ–Ω–µ—Ä—É—î–º–æ <b>—á–µ–∫ 58 –º–º</b> —ñ <b>NFC-—Ç–µ–∫—Å—Ç</b>, –µ–∫—Å–ø–æ—Ä—Ç—É—î–º–æ <b>CSV</b>.</p>
      <p class="small">–ü—Ä–∞–≤–∏–ª–æ: –¢–û –Ω–∞—Å—Ç–∞—î —Ä–∞–Ω—ñ—à–µ –∑ –¥–≤–æ—Ö ‚Äî –∑–∞ <span class="mono">–º–æ—Ç–æ–≥–æ–¥–∏–Ω–∞–º–∏</span> –∞–±–æ –∑–∞ <span class="mono">–∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º</span>.</p>
    </div>

    <div class="card">
      <h2>üöú –î–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω</h2>
      <div class="row">
        <button class="btn" onclick="addMachine()">‚ûï –î–æ–¥–∞—Ç–∏ –º–∞—à–∏–Ω—É</button>
        <button class="btn" onclick="demoMachines()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="copyCSV('csvM')">üìã CSV (–º–∞—à–∏–Ω–∏)</button>
      </div>
      <div style="overflow:auto; margin-top:8px">
        <table class="table" id="tblM">
          <thead>
            <tr>
              <th>#</th><th>–ú–∞—à–∏–Ω–∞ ID</th><th>–ú–æ–¥–µ–ª—å</th><th>–ú–æ—Ç–æ–≥–æ–¥., h</th>
              <th>–¢–û –æ—Å—Ç–∞–Ω–Ω—î: –¥–∞—Ç–∞</th><th>–¢–û –æ—Å—Ç–∞–Ω–Ω—î: h</th>
              <th>–Ü–Ω—Ç–µ—Ä–≤–∞–ª –¢–û: h</th><th>–Ü–Ω—Ç–µ—Ä–≤–∞–ª –¢–û: –¥–Ω—ñ–≤</th>
              <th>–ó–∞–ª–∏—à–æ–∫ –¥–æ –¢–û, h</th><th>–ó–∞–ª–∏—à–æ–∫ –¥–æ –¢–û, –¥–Ω—ñ–≤</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
            </tr>
          </thead>
          <tbody id="bodyM"></tbody>
        </table>
      </div>
      <div id="csvM" class="out">‚Äî</div>
    </div>

    <div class="card">
      <h2>üß± –ñ—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç</h2>
      <div class="row">
        <button class="btn" onclick="addJob()">‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å</button>
        <button class="btn" onclick="demoJobs()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="copyCSV('csvJ')">üìã CSV (—Ä–æ–±–æ—Ç–∏)</button>
      </div>
      <div style="overflow:auto; margin-top:8px">
        <table class="table" id="tblJ">
          <thead>
            <tr>
              <th>#</th><th>–î–∞—Ç–∞</th><th>–ú–∞—à–∏–Ω–∞ ID</th><th>–¢–∏–ø —Ä–æ–±—ñ—Ç</th>
              <th>–õ—é–¥.-–≥–æ–¥</th><th>–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏, –≥—Ä–Ω</th><th>–í–∞—Ä—Ç—ñ—Å—Ç—å —Ä–æ–±—ñ—Ç, –≥—Ä–Ω</th><th>–†–∞–∑–æ–º, –≥—Ä–Ω</th><th>–ù–æ—Ç–∞—Ç–∫–∞</th>
            </tr>
          </thead>
          <tbody id="bodyJ"></tbody>
        </table>
      </div>
      <div id="csvJ" class="out">‚Äî</div>
    </div>

    <div class="card">
      <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è / NFC / –ß–µ–∫ 58 –º–º</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
          <div class="row">
            <div style="flex:1"><label>–¢–∞—Ä–∏—Ñ, –≥—Ä–Ω/–≥–æ–¥</label><input id="rate" type="number" step="1" value="220"></div>
            <div style="flex:1"><label>–î–∞—Ç–∞ ¬´—Å—å–æ–≥–æ–¥–Ω—ñ¬ª</label><input id="today" type="date"></div>
          </div>
          <p class="small">–î–∞—Ç–∞ ¬´—Å—å–æ–≥–æ–¥–Ω—ñ¬ª –≤–ø–ª–∏–≤–∞—î –Ω–∞ –¥–Ω—ñ –¥–æ –¢–û.</p>
        </div>

        <div class="box">
          <h3>NFC ‚Äî —Ç–µ–∫—Å—Ç</h3>
          <div class="row">
            <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞ ID</label><input id="nfcId" type="text" value="TR-001"></div>
            <div style="flex:1"><label>–°–µ—Ä–≤—ñ—Å-–∫–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcContact" type="text" value="+380XXXXXXXXX"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
            <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
          <div id="nfcOut" class="out">‚Äî</div>
        </div>

        <div class="box">
          <h3>–ù–∞—Ä—è–¥-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (—á–µ–∫ 58 –º–º)</h3>
          <div class="row">
            <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
            <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
            <button id="openOnlyBtn" class="btn" style="display:none" title="–§–æ–ª–±–µ–∫, —è–∫—â–æ –∑–≤–∏—á–∞–π–Ω–∏–π –¥—Ä—É–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π" onclick="openTicketOnly()">‚ÜóÔ∏è –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ —á–µ–∫</button>
          </div>
          <div class="ticket" id="ticket" style="margin-top:8px">
            <h4>–ù–ê–†–Ø–î-–ó–ê–ú–û–í–õ–ï–ù–ù–Ø</h4>
            <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
            <div class="line"></div>
            <p><b>–ú–∞—à–∏–Ω–∞:</b> <span id="tId">‚Äî</span> ¬∑ <b>–ú–æ–¥–µ–ª—å:</b> <span id="tModel">‚Äî</span></p>
            <p><b>–ü–æ—Ç–æ—á–Ω—ñ h:</b> <span id="tH">‚Äî</span> ¬∑ <b>–ù–∞—Å—Ç. –¢–û —á–µ—Ä–µ–∑:</b> <span id="tDue">‚Äî</span></p>
            <div class="line"></div>
            <p><b>–†–æ–±–æ—Ç–∞:</b> <span id="tJob">‚Äî</span></p>
            <p><b>–¢—Ä—É–¥–æ–º—ñ—Å—Ç–∫—ñ—Å—Ç—å:</b> <span id="tHours">‚Äî</span> –≥–æ–¥ √ó <span id="tRate">‚Äî</span> = <span id="tWorkCost">‚Äî</span> –≥—Ä–Ω</p>
            <p><b>–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏:</b> <span id="tParts">‚Äî</span> –≥—Ä–Ω</p>
            <p><b>–†–∞–∑–æ–º:</b> <span id="tTotal">‚Äî</span> –≥—Ä–Ω</p>
            <div class="line"></div>
            <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
      <ol>
        <li>–ó–∞–ø–æ–≤–Ω–∏ <b>–î–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—à–∏–Ω</b> —ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –¢–û.</li>
        <li>–î–æ–¥–∞–π 3‚Äì5 –∑–∞–ø–∏—Å—ñ–≤ —É <b>–ñ—É—Ä–Ω–∞–ª —Ä–æ–±—ñ—Ç</b>.</li>
        <li>–ü–µ—Ä–µ–≤—ñ—Ä <b>–∑–∞–ª–∏—à–æ–∫ –¥–æ –¢–û</b> (–≥–æ–¥/–¥–Ω—ñ) —ñ —Å—Ç–∞—Ç—É—Å.</li>
        <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>NFC</b>-—Ç–µ–∫—Å—Ç —ñ <b>—á–µ–∫ 58 –º–º</b>.</li>
        <li>–°–∫–æ–ø—ñ—é–π <b>CSV</b> —É Google Sheets.</li>
      </ol>
    </div>
  </div>

<script>
  // –í–±—É–¥—É–≤–∞–Ω–Ω—è (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const bodyM = document.getElementById('bodyM');
  const bodyJ = document.getElementById('bodyJ');
  const byId = id => document.getElementById(id);

  (function setToday(){
    const d = new Date().toISOString().slice(0,10);
    byId('today').value = d;
  })();

  // ====== –ú–∞—à–∏–Ω–∏ ======
  function addMachine(sample){
    const d = new Date().toISOString().slice(0,10);
    const def = { id:'TR-001', model:'–ú–¢–ó-82', h:4200, lastDate:d, lastH:4000, intH:250, intD:180, note:'' };
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.id}"></td>
      <td><input type="text" value="${s.model}"></td>
      <td><input type="number" step="1" value="${s.h}"></td>
      <td><input type="date" value="${s.lastDate}"></td>
      <td><input type="number" step="1" value="${s.lastH}"></td>
      <td><input type="number" step="1" value="${s.intH}"></td>
      <td><input type="number" step="1" value="${s.intD}"></td>
      <td class="dark dueH">‚Äî</td>
      <td class="dark dueD">‚Äî</td>
      <td class="dark status">‚Äî</td>
      <td><input type="text" value="${s.note}"></td>`;
    bodyM.appendChild(tr);
    reindex(bodyM);
  }
  function reindex(tbody){ [...tbody.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  function demoMachines(){
    bodyM.innerHTML='';
    addMachine({id:'TR-001', model:'–ú–¢–ó-82',   h:4200, lastDate:'2025-06-15', lastH:4000, intH:250, intD:180});
    addMachine({id:'COM-12', model:'John Deere S', h:1350, lastDate:'2025-08-20', lastH:1200, intH:200, intD:150});
    addMachine({id:'SPR-07', model:'TeeJet 18–º',   h:800,  lastDate:'2025-07-10', lastH:700,  intH:150, intD:120});
    recalc();
  }

  // ====== –†–æ–±–æ—Ç–∏ ======
  function addJob(sample){
    const d = new Date().toISOString().slice(0,10);
    const def = { date:d, id:'TR-001', job:'–ó–∞–º—ñ–Ω–∞ –º–∞—Å–ª–∞', hours:2.5, parts:1800, note:'' };
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="date" value="${s.date}"></td>
      <td><input type="text" value="${s.id}"></td>
      <td><input type="text" value="${s.job}"></td>
      <td><input type="number" step="0.1" value="${s.hours}"></td>
      <td><input type="number" step="1" value="${s.parts}"></td>
      <td class="dark workCost">‚Äî</td>
      <td class="dark total">‚Äî</td>
      <td><input type="text" value="${s.note}"></td>`;
    bodyJ.appendChild(tr); reindex(bodyJ);
  }
  function demoJobs(){
    bodyJ.innerHTML='';
    addJob({id:'TR-001', job:'–ó–∞–º—ñ–Ω–∞ –º–∞—Å–ª–∞', hours:2.5, parts:1800});
    addJob({id:'COM-12', job:'–†–µ–≥—É–ª—é–≤–∞–Ω–Ω—è –ª–∞–Ω—Ü—é–≥—ñ–≤', hours:1.2, parts:450});
    addJob({id:'SPR-07', job:'–ü—Ä–æ–º–∏–≤–∫–∞ —Ñ–æ—Ä—Å—É–Ω–æ–∫', hours:1.0, parts:220});
    recalc();
  }

  // ====== –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ ======
  function recalc(){
    const today = new Date(byId('today').value||new Date().toISOString().slice(0,10));
    [...bodyM.querySelectorAll('tr')].forEach(tr=>{
      const h = +tr.children[3].querySelector('input').value || 0;
      const lastDate = tr.children[4].querySelector('input').value;
      const lastH = +tr.children[5].querySelector('input').value || 0;
      const intH = +tr.children[6].querySelector('input').value || 0;
      const intD = +tr.children[7].querySelector('input').value || 0;
      const dueH = (lastH + intH) - h;
      tr.querySelector('.dueH').textContent = (isFinite(dueH)? Math.round(dueH) : '‚Äî');
      let dueDays = '‚Äî';
      if(lastDate){ const next = new Date(lastDate); next.setDate(next.getDate()+intD); dueDays = Math.ceil((next-today)/86400000); }
      tr.querySelector('.dueD').textContent = isFinite(+dueDays)? dueDays : '‚Äî';
      let status='OK'; const riskH = isFinite(dueH)&&dueH<=20; const riskD = isFinite(+dueDays)&&+dueDays<=7;
      if((isFinite(dueH)&&dueH<=0)||(isFinite(+dueDays)&&+dueDays<=0)) status='–¢–ï–†–ú–Ü–ù–û–í–û';
      else if(riskH||riskD) status='–°–ö–û–†–û';
      tr.querySelector('.status').textContent=status;
      tr.querySelector('.status').style.color = status==='–¢–ï–†–ú–Ü–ù–û–í–û'? '#ef4444' : (status==='–°–ö–û–†–û'? '#f59e0b' : '#10b981');
    });

    const rate = +byId('rate').value || 0;
    [...bodyJ.querySelectorAll('tr')].forEach(tr=>{
      const hours = +tr.children[4].querySelector('input').value || 0;
      const parts = +tr.children[5].querySelector('input').value || 0;
      const work = hours * rate; const total = work + parts;
      tr.querySelector('.workCost').textContent = Math.round(work).toLocaleString('uk-UA');
      tr.querySelector('.total').textContent    = Math.round(total).toLocaleString('uk-UA');
    });

    buildCSV();
  }

  function buildCSV(){
    const linesM = [...bodyM.querySelectorAll('tr')].map(tr=>{
      const idx = tr.querySelector('.idx').textContent.trim();
      const id  = tr.children[1].querySelector('input').value.trim();
      const model = tr.children[2].querySelector('input').value.trim();
      const h = tr.children[3].querySelector('input').value.trim();
      const lastDate = tr.children[4].querySelector('input').value.trim();
      const lastH = tr.children[5].querySelector('input').value.trim();
      const intH = tr.children[6].querySelector('input').value.trim();
      const intD = tr.children[7].querySelector('input').value.trim();
      const dueH = tr.querySelector('.dueH').textContent.trim();
      const dueD = tr.querySelector('.dueD').textContent.trim();
      const status = tr.querySelector('.status').textContent.trim();
      const note = tr.children[11].querySelector('input').value.trim();
      return [idx,id,model,h,lastDate,lastH,intH,intD,dueH,dueD,status,note].join(' | ');
    });
    byId('csvM').textContent = linesM.join('\n') || '‚Äî';

    const linesJ = [...bodyJ.querySelectorAll('tr')].map(tr=>{
      const idx = tr.querySelector('.idx').textContent.trim();
      const d   = tr.children[1].querySelector('input').value.trim();
      const id  = tr.children[2].querySelector('input').value.trim();
      const job = tr.children[3].querySelector('input').value.trim();
      const hours = tr.children[4].querySelector('input').value.trim();
      const parts = tr.children[5].querySelector('input').value.trim();
      const work  = tr.querySelector('.workCost').textContent.trim();
      const total = tr.querySelector('.total').textContent.trim();
      const note  = tr.children[8].querySelector('input').value.trim();
      return [idx,d,id,job,hours,parts,work,total,note].join(' | ');
    });
    byId('csvJ').textContent = linesJ.join('\n') || '‚Äî';
  }

  // ====== NFC —ñ –ß–ï–ö ======
  function buildNFC(){
    const id = byId('nfcId').value.trim();
    const contact = byId('nfcContact').value.trim();
    let model='‚Äî', h='‚Äî', due='‚Äî';
    const tr = bodyM.querySelector('tr');
    if(tr){
      model = tr.children[2].querySelector('input').value.trim();
      h     = tr.children[3].querySelector('input').value.trim();
      const dueH = tr.querySelector('.dueH').textContent.trim();
      const dueD = tr.querySelector('.dueD').textContent.trim();
      due = `h:${dueH}; d:${dueD}`;
    }
    const text = [`ID:${id}`,`MODEL:${model}`,`HOURS:${h}`,`NEXT:${due}`,`CONTACT:${contact}`,`DATE:${new Date().toISOString().slice(0,19).replace('T',' ')}`].join('\n');
    byId('nfcOut').textContent = text;
  }

  function buildTicket(){
    const trJ = bodyJ.querySelector('tr');
    const trM = bodyM.querySelector('tr');
    if(!trJ || !trM){ alert('–î–æ–¥–∞–π —Ö–æ—á–∞ –± –æ–¥–Ω—É –º–∞—à–∏–Ω—É —ñ –æ–¥–∏–Ω –∑–∞–ø–∏—Å —Ä–æ–±–æ—Ç–∏.'); return; }

    const date = trJ.children[1].querySelector('input').value.trim();
    const id = trJ.children[2].querySelector('input').value.trim();
    const job = trJ.children[3].querySelector('input').value.trim();
    const hours = parseFloat(trJ.children[4].querySelector('input').value||'0');
    const parts = parseFloat(trJ.children[5].querySelector('input').value||'0');

    const model = trM.children[2].querySelector('input').value.trim();
    const hNow = trM.children[3].querySelector('input').value.trim();
    const dueH = trM.querySelector('.dueH').textContent.trim();
    const dueD = trM.querySelector('.dueD').textContent.trim();

    const rate = +byId('rate').value || 0;
    const workCost = Math.round(hours*rate);
    const total = Math.round(workCost + parts);

    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${date}</small>`;
    byId('tId').textContent = id;
    byId('tModel').textContent = model;
    byId('tH').textContent = hNow;
    byId('tDue').textContent = `h:${dueH} / –¥:${dueD}`;
    byId('tJob').textContent = job;
    byId('tHours').textContent = hours.toFixed(1);
    byId('tRate').textContent = rate;
    byId('tWorkCost').textContent = workCost.toLocaleString('uk-UA');
    byId('tParts').textContent = parts.toLocaleString('uk-UA');
    byId('tTotal').textContent = total.toLocaleString('uk-UA');
    byId('tNote').textContent = `–ü—Ä–∏–º.: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è ¬∑ Ref:${Math.random().toString(36).slice(2,8).toUpperCase()}`;
  }

  // ====== –ù–æ–≤–∏–π —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –¥—Ä—É–∫ —á–µ—Ä–µ–∑ –æ–∫—Ä–µ–º—É —Å—Ç–æ—Ä—ñ–Ω–∫—É ======
function printTicketNewTab(){
    const ticket = document.getElementById('ticket');
    if(!ticket){ alert('–ù–µ–º–∞—î #ticket'); return; }
    const idText = (document.getElementById('tId')||{}).textContent||'';
    if(!idText || idText.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }

    const css = `
      @media print { @page { size:58mm auto; margin:0 } }
      html,body{ margin:0; padding:0; background:#fff; color:#000 }
      .ticket{ width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
               font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
               border:none; box-shadow:none; border-radius:0 }
      .ticket h4{margin:0 0 6px; font-size:13px; text-align:center; font-weight:700}
      .ticket p{margin:2px 0; font-size:12px; font-weight:700}
      .ticket b,.ticket strong,.ticket span{font-weight:700}
      .line{border-top:1px dashed #111; margin:6px 0}
      small{font-size:10px; font-weight:700}
    `;
const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{
        window.focus();
        window.print();
        // –ø–æ–≤—ñ–¥–æ–º–∏–º–æ ¬´–±–∞—Ç—å–∫–∞¬ª, —â–æ –¥—Ä—É–∫ –≤–∏–∫–ª–∏–∫–∞–Ω–æ
        if(window.opener){ window.opener.postMessage({type:'ticketPrint', status:'invoked'}, '*'); }
      }catch(e){
        if(window.opener){ window.opener.postMessage({type:'ticketPrint', status:'error'}, '*'); }
      }
    });
  <\/script>
  </body></html>`;

const fallbackBtn = document.getElementById('openOnlyBtn')
  const w = window.open('', '_blank');
  if(!w){
    // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É-—Ñ–æ–ª–±–µ–∫ —ñ –æ–¥—Ä–∞–∑—É –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –≤–∞—Ä—ñ–∞–Ω—Ç ¬´—Ç—ñ–ª—å–∫–∏ —á–µ–∫¬ª
    if(fallbackBtn) fallbackBtn.style.display = 'inline-block';
    openTicketOnly();
    return;
  }
  w.document.open(); w.document.write(html); w.document.close();

  // —è–∫—â–æ –≤ –¥–æ—á—ñ—Ä–Ω—å–æ–º—É –≤—ñ–∫–Ω—ñ –¥—Ä—É–∫ –Ω–µ —Å—Ç–∞—Ä—Ç—É–≤–∞–≤ ‚Äî —É–≤—ñ–º–∫–Ω–µ–º–æ —Ñ–æ–ª–±–µ–∫
  let timer = setTimeout(()=>{
    if(fallbackBtn) fallbackBtn.style.display = 'inline-block';
  }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){
      clearTimeout(timer);
      // —è–∫—â–æ –ø–æ–º–∏–ª–∫–∞ ‚Äî –ø–æ–∫–∞–∂–µ–º–æ –∫–Ω–æ–ø–∫—É-—Ñ–æ–ª–±–µ–∫ —ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É—î–º–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É
      if(ev.data.status==='error' && fallbackBtn){
        fallbackBtn.style.display = 'inline-block';
        openTicketOnly();
      }
    }
  }, {once:true});
  }

  // ====== –§–æ–ª–±–µ–∫: –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ —á–µ–∫ —É –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ —Ç–∞ –æ–¥—Ä–∞–∑—É –¥—Ä—É–∫ ======
  function openTicketOnly(){
    const ticket = document.getElementById('ticket');
    if(!ticket){ alert('–ù–µ–º–∞—î #ticket'); return; }
    if((document.getElementById('tId')?.textContent||'‚Äî').trim()==='‚Äî'){ buildTicket(); }

    const css = `
      @page { size:58mm auto; margin:0 }
      body{ margin:0; background:#fff; color:#000 }
      .ticket{ width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
               font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
               border:none; box-shadow:none; border-radius:0 }
      .ticket h4{margin:0 0 6px; font-size:13px; text-align:center; font-weight:700}
      .ticket p{margin:2px 0; font-size:12px; font-weight:700}
      .ticket b, .ticket strong, .ticket span{font-weight:700}
      .line{border-top:1px dashed #111; margin:6px 0}
      small{font-size:10px; font-weight:700}
    `;
    const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    window.open(url, '_blank');
    setTimeout(()=>URL.revokeObjectURL(url), 60000);
  }

  // ====== –£—Ç–∏–ª—ñ—Ç–∏ ======
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){ addMachine(); addJob(); recalc(); })();
</script>


</body></html>