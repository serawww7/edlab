<!-- mechanic_para2.html
     –ü–ê–†–ê 2 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤
     –¢–µ–º–∞: –ö–û–ù–¢–†–û–õ–¨ –ü–ú–ú ‚Äî –∑–∞–ø—Ä–∞–≤–∫–∏, –≤–∏—Ç—Ä–∞—Ç–∞ –ª/–≥–æ–¥, –ª/100 –∫–º, –ª/–≥–∞, –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, –∫–≤–∏—Ç–∞–Ω—Ü—ñ—è 58 –º–º, NFC, CSV
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –ø—Ä–∞—Ü—é—î –Ω–∞ GitHub Pages —ñ –≤ Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º (–æ–ø—Ü.), NFC-–º—ñ—Ç–∫–∏ (–æ–ø—Ü.). –ö–æ–Ω—Ç—Ä–∞—Å—Ç —Ç–µ–º–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫ ‚Üí —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç.

     –©–æ –≤–º—ñ—î:
     ‚Ä¢ –ñ—É—Ä–Ω–∞–ª –∑–∞–ø—Ä–∞–≤–æ–∫ –∑ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞–º–∏ (–º–æ—Ç–æ–≥–æ–¥–∏–Ω–∏, –∫–º, –≥–∞) —Ç–∞ —Ä–µ–∂–∏–º–∞–º–∏ —Ä–æ–±–æ—Ç–∏.
     ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ñ–∞–∫—Ç–∏—á–Ω–æ—ó –≤–∏—Ç—Ä–∞—Ç–∏: –ª/–≥–æ–¥, –ª/100 –∫–º, –ª/–≥–∞. –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –Ω–æ—Ä–º–∞–º–∏, –ø—Ä–∞–ø–æ—Ä–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω—å.
     ‚Ä¢ –ü—ñ–¥—Å—É–º–∫–∏ –ø–æ —Ç–µ—Ö–Ω—ñ—Ü—ñ/–∑–º—ñ–Ω—ñ, –≤–∞—Ä—Ç—ñ—Å—Ç—å –ø–∞–ª—å–Ω–æ–≥–æ, –±—é–¥–∂–µ—Ç.
     ‚Ä¢ –ö–≤–∏—Ç–∞–Ω—Ü—ñ—è 58 –º–º –Ω–∞ –∑–∞–ø—Ä–∞–≤–∫—É —Ç–∞ NFC-—Ç–µ–∫—Å—Ç –¥–ª—è –º—ñ—Ç–∫–∏ –ø—ñ—Å—Ç–æ–ª–µ—Ç–∞/–º–∞—à–∏–Ω–∏.
     ‚Ä¢ –ï–∫—Å–ø–æ—Ä—Ç —É CSV (–∑–∞–ø—Ä–∞–≤–∫–∏) –¥–ª—è Google Sheets.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ü–∞—Ä–∞ 2 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –ü–ú–ú: –≤–∏—Ç—Ä–∞—Ç–∏, –Ω–æ—Ä–º–∏, —á–µ–∫ 58 –º–º, NFC, CSV</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted); letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  .small{font-size:12px; color:#9fb0c8}
  .muted{color:#93a3b5}
  .pill{display:inline-block; padding:4px 10px; border:1px solid #223049; border-radius:999px; font-size:12px; color:#a5b4fc; background:#0d1a2e; margin-right:6px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:var(--darkcell); color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:8px 10px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left; position:sticky; top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell); color:var(--darkink2)}
  .table td.dark, .table th.dark{background:var(--darkcell) !important; color:var(--darkink2) !important}
  .out{background:var(--darkcell); color:var(--darkink2); border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}

  input[type="text"], input[type="number"], input[type="date"], select, textarea{
    width:100%; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e6eef9
  }

  /* –ß–µ–∫ 58 –º–º */
  .ticket{ width:58mm; background:#fff; color:#000; padding:6mm 4mm; border-radius:6px; box-shadow:0 0 0 1px #e5e7eb inset; font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px; font-size:13px; text-align:center}
  .ticket p{margin:2px 0; font-size:12px}
  .ticket .line{border-top:1px dashed #111; margin:6px 0}
  .ticket small{font-size:10px}

  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}
  html.embedded .box{background:#f8fafc; color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6; color:#111}

  @media print{
    @page{ margin:4mm }
    .no-print{ display:none !important }
  }
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 2 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
    <h1>‚õΩ –ö–æ–Ω—Ç—Ä–æ–ª—å –ü–ú–ú: –∑–∞–ø—Ä–∞–≤–∫–∏ ‚Üí —Ñ–∞–∫—Ç–∏—á–Ω–∞ –≤–∏—Ç—Ä–∞—Ç–∞ ‚Üí –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –Ω–æ—Ä–º–∞–º–∏ ‚Üí —á–µ–∫ 58 –º–º, NFC</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>
        –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ —Å—Ç–≤–æ—Ä—è—Ç—å <b>–∂—É—Ä–Ω–∞–ª –∑–∞–ø—Ä–∞–≤–æ–∫</b>, –ø–æ—Ä–∞—Ö—É—é—Ç—å <b>—Ñ–∞–∫—Ç–∏—á–Ω—É –≤–∏—Ç—Ä–∞—Ç—É</b> —É —Ñ–æ—Ä–º–∞—Ç–∞—Ö
        <b>–ª/–≥–æ–¥</b>, <b>–ª/100 –∫–º</b> —Ç–∞ <b>–ª/–≥–∞</b>, –ø–æ—Ä—ñ–≤–Ω—è—é—Ç—å —ñ–∑ <b>–Ω–æ—Ä–º–∞–º–∏</b>, –ø–æ–∑–Ω–∞—á–∞—Ç—å <b>–≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</b>,
        —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>–∫–≤–∏—Ç–∞–Ω—Ü—ñ—é 58 –º–º</b> —Ç–∞ <b>NFC</b>-—Ç–µ–∫—Å—Ç –¥–ª—è –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏ –∑–∞–ø—Ä–∞–≤–æ–∫, —ñ –µ–∫—Å–ø–æ—Ä—Ç—É—é—Ç—å <b>CSV</b>.
      </p>
      <p class="small">–ü—Ä–∞–ø–æ—Ä –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è: <span class="mono">|—Ñ–∞–∫—Ç ‚àí –Ω–æ—Ä–º–∞| / –Ω–æ—Ä–º–∞</span> ‚â• 10% ‚Üí –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è; ‚â• 25% ‚Üí –∫—Ä–∏—Ç–∏—á–Ω–æ.</p>
    </div>

    <!-- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ù–û–†–ú -->
    <div class="card">
      <h2>‚öôÔ∏è –ù–æ—Ä–º–∏ —Ç–∞ —Ü—ñ–Ω–∏</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–ù–æ—Ä–º–∏ (–±–∞–∑–æ–≤—ñ)</h3>
          <div class="row">
            <div style="flex:1"><label>–ü–æ–ª–µ, –ª/–≥–∞</label><input id="norm_ha" type="number" step="0.1" value="10.0"></div>
            <div style="flex:1"><label>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ª/100 –∫–º</label><input id="norm_km" type="number" step="0.1" value="28.0"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–•–æ–ª–æ—Å—Ç–∏–π/–º–∞–Ω–µ–≤—Ä–∏, –ª/–≥–æ–¥</label><input id="norm_h" type="number" step="0.1" value="2.2"></div>
            <div style="flex:1"><label>–ü–æ–ª—å–æ–≤—ñ —Ä–æ–±–æ—Ç–∏, –ª/–≥–æ–¥</label><input id="norm_h_field" type="number" step="0.1" value="7.5"></div>
          </div>
          <p class="small">–ù–æ—Ä–º–∏ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ø—ñ–¥ –º–∞—Ä–∫—É/–º–æ–¥–µ–ª—å —ñ —É–º–æ–≤–∏.</p>
        </div>

        <div class="box">
          <h3>–ï–∫–æ–Ω–æ–º—ñ–∫–∞</h3>
          <div class="row">
            <div style="flex:1"><label>–¶—ñ–Ω–∞ –¥–∏–∑–ø–∞–ª—å–Ω–æ–≥–æ, –≥—Ä–Ω/–ª</label><input id="price" type="number" step="0.01" value="63.50"></div>
            <div style="flex:1"><label>–ì—É—Å—Ç–∏–Ω–∞, –∫–≥/–ª (–æ–ø—Ü.)</label><input id="density" type="number" step="0.001" value="0.835"></div>
          </div>
          <p class="small">–ì—É—Å—Ç–∏–Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω–∞, —è–∫—â–æ –Ω–∞ —Å–∫–ª–∞–¥—ñ –æ–±–ª—ñ–∫ —É –∫–≥.</p>
        </div>

        <div class="box">
          <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
          <div class="row">
            <button class="btn" onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–ø—Ä–∞–≤–∫—É</button>
            <button class="btn" onclick="preset()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
            <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
            <button class="btn" onclick="copyCSV()">üìã CSV</button>
          </div>
        </div>
      </div>
    </div>

    <!-- –ñ–£–†–ù–ê–õ –ó–ê–ü–†–ê–í–û–ö -->
    <div class="card">
      <h2>üß± –ñ—É—Ä–Ω–∞–ª –∑–∞–ø—Ä–∞–≤–æ–∫</h2>
      <div style="overflow:auto">
        <table class="table" id="tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>–î–∞—Ç–∞</th>
              <th>–ú–∞—à–∏–Ω–∞ ID</th>
              <th>–†–µ–∂–∏–º</th>
              <th>–õ—ñ—Ç—Ä–∏, –ª</th>
              <th>–ú–æ—Ç–æ–≥–æ–¥. –¥–æ</th>
              <th>–ú–æ—Ç–æ–≥–æ–¥. –ø—ñ—Å–ª—è</th>
              <th>–ö—ñ–ª–æ–º–µ—Ç—Ä–∏, –∫–º (–∑–∞ –ø–µ—Ä—ñ–æ–¥)</th>
              <th>–ü–ª–æ—â–∞, –≥–∞ (–∑–∞ –ø–µ—Ä—ñ–æ–¥)</th>
              <th class="dark">–ª/–≥–æ–¥</th>
              <th class="dark">–ª/100 –∫–º</th>
              <th class="dark">–ª/–≥–∞</th>
              <th class="dark">–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</th>
              <th class="dark">–ü—Ä–∞–ø–æ—Ä</th>
              <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
            </tr>
          </thead>
          <tbody id="tblBody"></tbody>
          <tfoot>
            <tr>
              <th class="dark" colspan="4">–†–∞–∑–æ–º</th>
              <th class="dark" id="sumL">‚Äî</th>
              <th class="dark" colspan="3">–í–∞—Ä—Ç—ñ—Å—Ç—å, –≥—Ä–Ω</th>
              <th class="dark" id="sumCost">‚Äî</th>
              <th class="dark" id="avgLh">‚Äî</th>
              <th class="dark" id="avgL100">‚Äî</th>
              <th class="dark" id="avgLha">‚Äî</th>
              <th class="dark" colspan="2">‚Äî</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>
      <div id="csv" class="out" style="margin-top:8px">‚Äî</div>
      <p class="small">CSV: <span class="mono"># | –î–∞—Ç–∞ | –ú–∞—à–∏–Ω–∞ | –†–µ–∂–∏–º | –õ—ñ—Ç—Ä–∏ | H_–¥–æ | H_–ø—ñ—Å–ª—è | –ö–º | –ì–∞ | –ª/–≥–æ–¥ | –ª/100–∫–º | –ª/–≥–∞ | –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è% | –ü—Ä–∞–ø–æ—Ä | –ü—Ä–∏–º.</span></p>
      <p class="small muted">–ö–æ–Ω—Ç—Ä–∞—Å—Ç –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–æ: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ (<span class="mono">.dark</span>) –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç.</p>
    </div>

    <!-- –ö–í–ò–¢–ê–ù–¶–Ü–Ø 58 –ú–ú + NFC -->
    <div class="card">
      <h2>üßæ –ö–≤–∏—Ç–∞–Ω—Ü—ñ—è 58 –º–º —Ç–∞ NFC</h2>
      <div class="grid g2">
        <div class="box">
          <h3>NFC ‚Äî —Ç–µ–∫—Å—Ç –¥–ª—è –ø—ñ—Å—Ç–æ–ª–µ—Ç–∞/–º–∞—à–∏–Ω–∏</h3>
          <div class="row">
            <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞ ID</label><input id="nfcId" type="text" value="TR-001"></div>
            <div style="flex:1"><label>–í–ª–∞—Å–Ω–∏–∫/—Å–∫–ª–∞–¥</label><input id="nfcOwner" type="text" value="–ü–ú–ú-–°–∫–ª–∞–¥ ‚Ññ1"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
            <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
          <div id="nfcOut" class="out">‚Äî</div>
        </div>

        <div class="box">
          <h3>–ö–≤–∏—Ç–∞–Ω—Ü—ñ—è (–æ—Å—Ç–∞–Ω–Ω—è –∑–∞–ø—Ä–∞–≤–∫–∞)</h3>
          <div class="row">
            <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
            <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
          </div>
          <div class="ticket" id="ticket" style="margin-top:8px">
            <h4>–ö–í–ò–¢–ê–ù–¶–Ü–Ø –ó–ê–ü–†–ê–í–ö–ò</h4>
            <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
            <div class="line"></div>
            <p><b>–ú–∞—à–∏–Ω–∞:</b> <span id="tId">‚Äî</span></p>
            <p><b>–†–µ–∂–∏–º:</b> <span id="tMode">‚Äî</span></p>
            <p><b>–û–±—Å—è–≥:</b> <span id="tLiters">‚Äî</span> –ª ¬∑ <b>–°—É–º–∞:</b> <span id="tAmount">‚Äî</span> –≥—Ä–Ω</p>
            <p><b>–õ—ñ—á–∏–ª—å–Ω–∏–∫–∏:</b> h <span id="tHfrom">‚Äî</span> ‚Üí <span id="tHto">‚Äî</span> ¬∑ –∫–º/–≥–∞ <span id="tCounter">‚Äî</span></p>
            <div class="line"></div>
            <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
          </div>
        </div>
      </div>
    </div>

    <!-- –•–Ü–î –†–û–ë–û–¢–ò -->
    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
      <ol>
        <li>–ó–∞–¥–∞–π <b>–Ω–æ—Ä–º–∏</b> —Ç–∞ <b>—Ü—ñ–Ω—É</b>. –î–æ–¥–∞–π 3‚Äì6 –∑–∞–ø–∏—Å—ñ–≤ –ø—Ä–æ –∑–∞–ø—Ä–∞–≤–∫—É (—Ä—ñ–∑–Ω—ñ —Ä–µ–∂–∏–º–∏).</li>
        <li>–ù–∞—Ç–∏—Å–Ω–∏ <b>–ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</b> ‚Üí –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π <b>–ª/–≥–æ–¥</b>, <b>–ª/100 –∫–º</b>, <b>–ª/–≥–∞</b> —Ç–∞ –ø—Ä–∞–ø–æ—Ä–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω—å.</li>
        <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>NFC</b>-—Ç–µ–∫—Å—Ç —ñ <b>–∫–≤–∏—Ç–∞–Ω—Ü—ñ—é</b> –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—é –∑–∞–ø—Ä–∞–≤–∫—É. –°–∫–æ–ø—ñ—é–π <b>CSV</b> —É Sheets (<span class="mono">FuelLog</span>).</li>
      </ol>
    </div>

    <div class="card">
      <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="table">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π –∂—É—Ä–Ω–∞–ª –∑–∞–ø—Ä–∞–≤–æ–∫ (‚â• 3 –∑–∞–ø–∏—Å–∏)</td><td>3</td></tr>
          <tr><td>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∏—Ç—Ä–∞—Ç —ñ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –Ω–æ—Ä–º–∞–º–∏ (–ª–æ–≥—ñ—á–Ω—ñ –≤–∏—Å–Ω–æ–≤–∫–∏)</td><td>4</td></tr>
          <tr><td>–ö–≤–∏—Ç–∞–Ω—Ü—ñ—è 58 –º–º —Ç–∞ NFC-—Ç–µ–∫—Å—Ç</td><td>2</td></tr>
          <tr><td>CSV —É Sheets + –∫–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏</td><td>1</td></tr>
        </tbody>
      </table>
      <p class="pill">‚õΩ –ü–ú–ú</p><p class="pill">üìä –ù–æ—Ä–º–∏</p><p class="pill">üßæ –ß–µ–∫ 58 –º–º</p><p class="pill">üîñ NFC</p><p class="pill">üìÑ CSV</p>
    </div>
  </div>

<script>
  // –†–µ–∂–∏–º –≤–±—É–¥—É–≤–∞–Ω–Ω—è –¥–ª—è Moodle iFrame
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const bodyEl = document.getElementById('tblBody');
  const csvEl  = document.getElementById('csv');
  const rnd = (n,d=2) => Number((+n).toFixed(d));

  function addRow(sample){
    const today = new Date().toISOString().slice(0,10);
    const def = {date:today, id:'TR-001', mode:'field', liters:120, h1:4200, h2:4216, km:0, ha:16.0, note:''};
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="date" value="${s.date}"></td>
      <td><input type="text" value="${s.id}"></td>
      <td>
        <select>
          <option value="field" ${s.mode==='field'?'selected':''}>–ø–æ–ª–µ</option>
          <option value="transport" ${s.mode==='transport'?'selected':''}>—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
          <option value="idle" ${s.mode==='idle'?'selected':''}>—Ö–æ–ª–æ—Å—Ç–∏–π/–º–∞–Ω–µ–≤—Ä–∏</option>
        </select>
      </td>
      <td><input type="number" step="0.1" value="${s.liters}"></td>
      <td><input type="number" step="0.1" value="${s.h1}"></td>
      <td><input type="number" step="0.1" value="${s.h2}"></td>
      <td><input type="number" step="0.1" value="${s.km}"></td>
      <td><input type="number" step="0.1" value="${s.ha}"></td>
      <td class="dark lh">‚Äî</td>
      <td class="dark l100">‚Äî</td>
      <td class="dark lha">‚Äî</td>
      <td class="dark dev">‚Äî</td>
      <td class="dark flag">‚Äî</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyEl.appendChild(tr);
    reindex();
  }
  function reindex(){ [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  function recalc(){
    let sumL=0, sumCost=0, accLh=[], accL100=[], accLha=[];
    const price = parseFloat(byId('price').value||'0');

    const norm = {
      ha: parseFloat(byId('norm_ha').value||'0'),
      km: parseFloat(byId('norm_km').value||'0'),
      h_idle: parseFloat(byId('norm_h').value||'0'),
      h_field: parseFloat(byId('norm_h_field').value||'0')
    };

    [...bodyEl.querySelectorAll('tr')].forEach(tr=>{
      const mode = tr.children[3].querySelector('select').value;
      const L = parseFloat(tr.children[4].querySelector('input').value||'0');
      const h1 = parseFloat(tr.children[5].querySelector('input').value||'0');
      const h2 = parseFloat(tr.children[6].querySelector('input').value||'0');
      const km = parseFloat(tr.children[7].querySelector('input').value||'0');
      const ha = parseFloat(tr.children[8].querySelector('input').value||'0');

      sumL += L; sumCost += L*price;

      // –±–∞–∑–æ–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏
      const hours = Math.max(0, h2 - h1);
      const l_per_h = hours>0 ? (L / hours) : 0;
      const l_per_100km = km>0 ? (L / km) * 100 : 0;
      const l_per_ha = ha>0 ? (L / ha) : 0;

      tr.querySelector('.lh').textContent   = (l_per_h? rnd(l_per_h,2) : '‚Äî');
      tr.querySelector('.l100').textContent = (l_per_100km? rnd(l_per_100km,1) : '‚Äî');
      tr.querySelector('.lha').textContent  = (l_per_ha? rnd(l_per_ha,2) : '‚Äî');

      if(l_per_h>0) accLh.push(l_per_h);
      if(l_per_100km>0) accL100.push(l_per_100km);
      if(l_per_ha>0) accLha.push(l_per_ha);

      // –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –Ω–æ—Ä–º–æ—é
      let devPct=0, flag='‚Äî', n=0;
      if(mode==='field'){
        if(ha>0 && L>0){
          n = norm.ha;
          devPct = n>0 ? ( (l_per_ha - n) / n )*100 : 0;
        } else if(hours>0){
          n = norm.h_field;
          devPct = n>0 ? ( (l_per_h - n) / n )*100 : 0;
        }
      } else if(mode==='transport' && km>0){
        n = norm.km;
        devPct = n>0 ? ( (l_per_100km - n) / n )*100 : 0;
      } else if(mode==='idle' && hours>0){
        n = norm.h_idle;
        devPct = n>0 ? ( (l_per_h - n) / n )*100 : 0;
      }

      if(n>0){
        const a = Math.abs(devPct);
        if(a>=25)      { flag='üî¥ –∫—Ä–∏—Ç–∏—á–Ω–æ'; }
        else if(a>=10) { flag='üü† –≤—ñ–¥—Ö–∏–ª.'; }
        else           { flag='üü¢ –æ–∫'; }
      }

      tr.querySelector('.dev').textContent  = n>0 ? rnd(devPct,1)+'%' : '‚Äî';
      tr.querySelector('.flag').textContent = flag;
      tr.querySelector('.flag').style.color = flag.startsWith('üî¥')? '#ef4444' : (flag.startsWith('üü†')? '#f59e0b' : '#10b981');
    });

    byId('sumL').textContent    = rnd(sumL,1);
    byId('sumCost').textContent = Math.round(sumCost).toLocaleString('uk-UA');

    byId('avgLh').textContent   = accLh.length? rnd(accLh.reduce((a,b)=>a+b,0)/accLh.length,2) : '‚Äî';
    byId('avgL100').textContent = accL100.length? rnd(accL100.reduce((a,b)=>a+b,0)/accL100.length,1) : '‚Äî';
    byId('avgLha').textContent  = accLha.length? rnd(accLha.reduce((a,b)=>a+b,0)/accLha.length,2) : '‚Äî';

    buildCSV();
  }

  function buildCSV(){
    const lines = [...bodyEl.querySelectorAll('tr')].map(tr=>{
      const idx=tr.querySelector('.idx').textContent.trim();
      const d  = tr.children[1].querySelector('input').value.trim();
      const id = tr.children[2].querySelector('input').value.trim();
      const mode=tr.children[3].querySelector('select').value.trim();
      const L  = tr.children[4].querySelector('input').value.trim();
      const h1 = tr.children[5].querySelector('input').value.trim();
      const h2 = tr.children[6].querySelector('input').value.trim();
      const km = tr.children[7].querySelector('input').value.trim();
      const ha = tr.children[8].querySelector('input').value.trim();
      const lh = tr.querySelector('.lh').textContent.trim();
      const l100 = tr.querySelector('.l100').textContent.trim();
      const lha = tr.querySelector('.lha').textContent.trim();
      const dev = tr.querySelector('.dev').textContent.trim();
      const flag= tr.querySelector('.flag').textContent.trim();
      const note= tr.children[14].querySelector('input').value.trim();
      return [idx,d,id,mode,L,h1,h2,km,ha,lh,l100,lha,dev,flag,note].join(' | ');
    });
    csvEl.textContent = lines.join('\n') || '‚Äî';
  }

  function copyCSV(){
    const t = csvEl.textContent.trim();
    if(!t || t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }

  function preset(){
    bodyEl.innerHTML='';
    addRow({date:'2025-10-10', id:'TR-001', mode:'field',     liters:120, h1:4200, h2:4216, km:0,   ha:16.0, note:'–æ—Ä–∞–Ω–∫–∞'});
    addRow({date:'2025-10-11', id:'SPR-07', mode:'transport', liters:60,  h1:800,  h2:802,  km:210, ha:0,    note:'–ø–µ—Ä–µ–≥—ñ–Ω –Ω–∞ –ø–æ–ª–µ'});
    addRow({date:'2025-10-12', id:'TR-001', mode:'idle',      liters:8,   h1:4216, h2:4220, km:0,   ha:0,    note:'–º–∞–Ω–µ–≤—Ä–∏/–ø—Ä–æ–≥—Ä—ñ–≤'});
    addRow({date:'2025-10-13', id:'COM-12', mode:'field',     liters:140, h1:1350, h2:1366, km:0,   ha:14.2, note:'–∑–±–∏—Ä–∞–Ω–Ω—è'});
    recalc();
  }

  // ===== NFC —ñ –ö–≤–∏—Ç–∞–Ω—Ü—ñ—è =====
  function buildNFC(){
    const id = byId('nfcId').value.trim();
    const owner = byId('nfcOwner').value.trim();
    const tr = bodyEl.querySelector('tr:last-child') || bodyEl.querySelector('tr');
    let lastLiters='‚Äî', lastDate='‚Äî';
    if(tr){
      lastLiters = tr.children[4].querySelector('input').value.trim();
      lastDate = tr.children[1].querySelector('input').value.trim();
    }
    const text = [
      `FUEL_NFC`,
      `UNIT:${owner}`,
      `MACHINE:${id}`,
      `LAST_REFUEL_L:${lastLiters}`,
      `LAST_REFUEL_DATE:${lastDate}`,
      `CREATED:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = text;
  }

  function buildTicket(){
    const tr = bodyEl.querySelector('tr:last-child') || bodyEl.querySelector('tr');
    if(!tr){ alert('–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤ —É –∂—É—Ä–Ω–∞–ª—ñ.'); return; }

    const d  = tr.children[1].querySelector('input').value.trim();
    const id = tr.children[2].querySelector('input').value.trim();
    const modeTxt = tr.children[3].querySelector('select').value;
    const L = parseFloat(tr.children[4].querySelector('input').value||'0');
    const h1 = tr.children[5].querySelector('input').value.trim();
    const h2 = tr.children[6].querySelector('input').value.trim();
    const km = tr.children[7].querySelector('input').value.trim();
    const ha = tr.children[8].querySelector('input').value.trim();
    const price = parseFloat(byId('price').value||'0');
    const amount = Math.round(L*price);

    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${d}</small>`;
    byId('tId').textContent = id;
    byId('tMode').textContent = modeTxt;
    byId('tLiters').textContent = L.toFixed(1);
    byId('tAmount').textContent = amount.toLocaleString('uk-UA');
    const counter = (km>0? `${km} –∫–º` : (ha>0? `${ha} –≥–∞` : '‚Äî'));
    byId('tCounter').textContent = counter;
    byId('tHfrom').textContent = h1 || '‚Äî';
    byId('tHto').textContent   = h2 || '‚Äî';
    byId('tNote').textContent  = `–ü—Ä–∏–º.: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è ¬∑ Ref:${Math.random().toString(36).slice(2,8).toUpperCase()}`;
  }

 
// PRINT PATCH (—è–∫ —É mechanic_para12.html): about:blank + fallback —á–µ—Ä–µ–∑ Blob; –¥—Ä—É–∫—É—î–º–æ –õ–ò–®–ï —á–µ–∫
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
   .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){ addRow(); addRow(); recalc(); })();
</script>
</body>
</html>
