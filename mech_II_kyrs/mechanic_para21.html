<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 21 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –®–Ü Copilot –¢–û: –∞–Ω–∞–ª—ñ–∑ —Å–∏–º–ø—Ç–æ–º—ñ–≤, –∫–ª–∞—Å–∏, —á–µ–∫-–ª–∏—Å—Ç, –ø—Ä–æ–º–ø—Ç–∏, ICS</title>
<meta name="description" content="–®–Ü –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤ #1: —Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å ‚Üí zero-shot –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø–æ–ª–æ–º–æ–∫ ‚Üí —á–µ–∫-–ª–∏—Å—Ç –¥—ñ–π ‚Üí –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç—ñ–≤ –¥–ª—è LLM ‚Üí –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ ICS ‚Üí —á–µ–∫ 58 –º–º, –µ–∫—Å–ø–æ—Ä—Ç CSV/TXT.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1180px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:110px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
.small{font-size:.9rem}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;white-space:pre-wrap}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.grid{display:grid;gap:14px;grid-template-columns:1.3fr 1fr}
@media(max-width:1080px){.grid{grid-template-columns:1fr}}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
</style>
<link rel="canonical" href="https://edlab.pp.ua/mech_II_kyrs/mechanic_para21.html"><meta property="og:type" content="article"><meta property="og:title" content="–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 21"><meta property="og:description" content="–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –®–Ü —è–∫ ¬´—Å–ø—ñ–≤–º–µ—Ö–∞–Ω—ñ–∫–∞¬ª. –í–≤–æ–¥–∏—à —Å–∏–º–ø—Ç–æ–º–∏ —Ç–µ–∫—Å—Ç–æ–º –∞–±–æ –≥–æ–ª–æ—Å–æ–º ‚Äî –æ—Ç—Ä–∏–º—É—î—à –∫–ª–∞—Å –ø–æ–ª–æ–º–∫–∏, —á–µ–∫-–ª–∏—Å—Ç –¥—ñ–π, –≥–æ—Ç–æ–≤—ñ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è LLM, –ø–ª"><meta property="og:url" content="https://edlab.pp.ua/mech_II_kyrs/mechanic_para21.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 21","description":"–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –®–Ü —è–∫ ¬´—Å–ø—ñ–≤–º–µ—Ö–∞–Ω—ñ–∫–∞¬ª. –í–≤–æ–¥–∏—à —Å–∏–º–ø—Ç–æ–º–∏ —Ç–µ–∫—Å—Ç–æ–º –∞–±–æ –≥–æ–ª–æ—Å–æ–º ‚Äî –æ—Ç—Ä–∏–º—É—î—à –∫–ª–∞—Å –ø–æ–ª–æ–º–∫–∏, —á–µ–∫-–ª–∏—Å—Ç –¥—ñ–π, –≥–æ—Ç–æ–≤—ñ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è LLM, –ø–ª","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/mech_II_kyrs/mechanic_para21.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">ü§ñ</span>
      <div>
        <b>–ü–∞—Ä–∞ 21 ‚Äî –®–Ü Copilot –¢–û (–¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤)</b><br>
        <span class="badge">—Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å ‚Üí –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è ‚Üí —á–µ–∫-–ª–∏—Å—Ç ‚Üí –ø—Ä–æ–º–ø—Ç–∏ ‚Üí –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ ‚Üí –µ–∫—Å–ø–æ—Ä—Ç</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –®–Ü —è–∫ ¬´—Å–ø—ñ–≤–º–µ—Ö–∞–Ω—ñ–∫–∞¬ª. –í–≤–æ–¥–∏—à —Å–∏–º–ø—Ç–æ–º–∏ —Ç–µ–∫—Å—Ç–æ–º –∞–±–æ –≥–æ–ª–æ—Å–æ–º ‚Äî –æ—Ç—Ä–∏–º—É—î—à –∫–ª–∞—Å –ø–æ–ª–æ–º–∫–∏, —á–µ–∫-–ª–∏—Å—Ç –¥—ñ–π, –≥–æ—Ç–æ–≤—ñ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è LLM, –ø–ª–∞–Ω —Ä–æ–±—ñ—Ç (ICS), —á–µ–∫ 58 –º–º —Ç–∞ CSV –¥–ª—è –∑–≤—ñ—Ç—É.</p>

  <div class="grid">
    <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="card">
      <h2>üìù –û–ø–∏—Å —Å–∏–º–ø—Ç–æ–º—ñ–≤</h2>
      <div class="row">
        <div style="flex:1">
          <label>–ú–∞—à–∏–Ω–∞</label>
          <input id="machine" class="input" placeholder="–¢—Ä–∞–∫—Ç–æ—Ä / –ö–æ–º–±–∞–π–Ω / –ù–∞–≤—ñ—Å–Ω–µ...">
        </div>
        <div style="flex:1">
          <label>–ù–∞—Ä–æ–±—ñ—Ç–æ–∫, –º/–≥</label>
          <input id="hours" class="input" type="number" min="0" step="1" value="3500">
        </div>
        <div style="flex:1">
          <label>–ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å</label>
          <select id="crit" class="input">
            <option value="low">–Ω–∏–∑—å–∫–∞</option>
            <option value="medium" selected="">—Å–µ—Ä–µ–¥–Ω—è</option>
            <option value="high">–≤–∏—Å–æ–∫–∞</option>
          </select>
        </div>
      </div>
      <textarea id="text" class="input" placeholder="–û–ø–∏—à–∏ —Å–∏–º–ø—Ç–æ–º–∏: ¬´—Å–≤–∏—Å—Ç —Ä–µ–º–µ–Ω—è –ø—Ä–∏ —Ä–æ–∑–≥–æ–Ω—ñ, –∑–∞–ø–∞—Ö –≥—É–º–∏, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –û–ñ —Ä–æ—Å—Ç–µ, –≤—ñ–±—Ä–∞—Ü—ñ—è –Ω–∞ 1800 –æ–±/—Ö–≤...¬ª"></textarea>
      <div class="row" style="margin-top:6px">
        <button class="btn" id="mic">üéôÔ∏è –ì–æ–ª–æ—Å–æ–º</button>
        <button class="btn good" id="analyze">üîç –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
        <button class="btn secondary" id="clear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
        <span id="stat" class="badge">–°—Ç–∞—Ç—É—Å: –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è</span>
      </div>

      <h3 style="margin-top:10px">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É</h3>
      <table class="tbl">
        <tbody>
          <tr><th>–ö–ª–∞—Å –ø–æ–ª–æ–º–∫–∏ (–ø—Ä–µ–¥–∏–∫—Ç)</th><td id="pred">‚Äî</td></tr>
          <tr><th>–¢–æ–ø-–æ–∑–Ω–∞–∫–∏</th><td id="feat">‚Äî</td></tr>
          <tr><th>–°–∫–æ—Ä–∏–Ω–≥ —Ä–∏–∑–∏–∫—É</th><td id="risk">‚Äî</td></tr>
          <tr><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</th><td id="reco">‚Äî</td></tr>
          <tr><th>–ü–æ—Ç—Ä—ñ–±–Ω—ñ –ó–Ü–ó/—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th><td id="ppe">‚Äî</td></tr>
        </tbody>
      </table>

      <h3 style="margin-top:10px">‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥—ñ–π</h3>
      <div id="checklist" class="note small">–ù–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏¬ª, —â–æ–± –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥—ñ–π.</div>
    </div>

    <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="card">
      <h2>üß† –ù–∞–≤—á–∞–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ (few-shot k-NN)</h2>
      <p class="small muted">–î–æ–¥–∞–π 3‚Äì5 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –Ω–∞ –∫–æ–∂–µ–Ω –∫–ª–∞—Å ‚Äî –ª–æ–∫–∞–ª—å–Ω–∏–π –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Å—Ç–∞–Ω–µ —Ç–æ—á–Ω—ñ—à–∏–º.</p>
      <div class="row">
        <select id="label" class="input" style="flex:1;max-width:220px">
          <option value="belt">—Ä–µ–º—ñ–Ω–Ω–∏–π –ø—Ä–∏–≤—ñ–¥</option>
          <option value="bearing">–ø—ñ–¥—à–∏–ø–Ω–∏–∫</option>
          <option value="hydraulic">–≥—ñ–¥—Ä–∞–≤–ª—ñ–∫–∞</option>
          <option value="electric">–µ–ª–µ–∫—Ç—Ä–∏–∫–∞</option>
          <option value="cooling">–æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è</option>
          <option value="fuel">–ø–∞–ª–∏–≤–æ</option>
        </select>
        <input id="shot" class="input" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Å–∏–º–ø—Ç–æ–º—É –¥–ª—è —Ü—å–æ–≥–æ –∫–ª–∞—Å—É">
        <button class="btn" id="addShot">‚ûï –î–æ–¥–∞—Ç–∏</button>
        <button class="btn secondary" id="exportShots">üíæ –ï–∫—Å–ø–æ—Ä—Ç –ø—Ä–∏–∫–ª–∞–¥—ñ–≤</button>
      </div>
      <pre id="shotsBox" class="code small" style="max-height:180px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤</pre>

      <h2 style="margin-top:10px">üß© –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç—ñ–≤ –¥–ª—è LLM</h2>
      <div class="row">
        <button class="btn" id="genUA">üá∫üá¶ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ (—É–∫—Ä)</button>
        <button class="btn" id="genEN">üá¨üáß Generate (eng)</button>
        <button class="btn secondary" id="copyPrompt">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      </div>
      <pre id="promptBox" class="code small">// –ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É, —â–æ–± –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç</pre>

      <h2 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç / –ü–ª–∞–Ω</h2>
      <div class="row">
        <button class="btn" id="saveTxt">üíæ TXT (–ø—ñ–¥—Å—É–º–æ–∫)</button>
        <button class="btn" id="saveCsv">üìÑ CSV (–∞–Ω–∞–ª—ñ–∑)</button>
        <button class="btn" id="saveIcs">üóìÔ∏è ICS (–ø–ª–∞–Ω —Ä–æ–±—ñ—Ç)</button>
        <button class="btn secondary" id="receipt">üñ®Ô∏è 58 –º–º —á–µ–∫</button>
      </div>
      <div id="rc" class="receipt" hidden=""></div>
    </div>
  </div>

  <div class="card">
    <h2>üîå –°—Ö–µ–º–∞ —Ä–æ–±–æ—Ç–∏ Copilot (SVG)</h2>
    <svg viewBox="0 0 980 260" role="img" aria-label="–ü–æ—Ç—ñ–∫: —Å–∏–º–ø—Ç–æ–º–∏ ‚Üí –∫–ª–∞—Å–∏ ‚Üí –¥—ñ—ó ‚Üí –ø—Ä–æ–º–ø—Ç ‚Üí –ø–ª–∞–Ω">
      <rect x="40" y="60" width="200" height="80" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
      <text x="140" y="92" fill="#e5e7eb" font-size="14" text-anchor="middle">–°–∏–º–ø—Ç–æ–º–∏</text>
      <text x="140" y="112" fill="#93c5fd" font-size="12" text-anchor="middle">—Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å</text>

      <rect x="270" y="50" width="210" height="100" rx="12" fill="#14532d" stroke="#22c55e"></rect>
      <text x="375" y="90" fill="#dcfce7" font-size="14" text-anchor="middle">Zero-shot –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ç–æ—Ä</text>

      <rect x="510" y="50" width="210" height="100" rx="12" fill="#1f2937" stroke="#9ca3af"></rect>
      <text x="615" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ß–µ–∫-–ª–∏—Å—Ç –¥—ñ–π</text>
      <text x="615" y="96" fill="#93c5fd" font-size="12" text-anchor="middle">–ü–ï–ï, —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</text>

      <rect x="750" y="50" width="190" height="100" rx="12" fill="#0b1a2f" stroke="#64748b"></rect>
      <text x="845" y="80" fill="#e5e7eb" font-size="14" text-anchor="middle">–ü—Ä–æ–º–ø—Ç ‚Üí LLM</text>
      <text x="845" y="96" fill="#93c5fd" font-size="12" text-anchor="middle">–∑–≤—ñ—Ç/—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è</text>

      <line x1="240" y1="100" x2="270" y2="100" stroke="#93c5fd" stroke-width="3"></line>
      <line x1="480" y1="100" x2="510" y2="100" stroke="#22c55e" stroke-width="3"></line>
      <line x1="720" y1="100" x2="750" y2="100" stroke="#64748b" stroke-width="3"></line>

      <text x="140" y="180" fill="#fbbf24" font-size="12" text-anchor="middle">ICS –ø–ª–∞–Ω —Ä–æ–±—ñ—Ç, —á–µ–∫ 58 –º–º, CSV</text>
    </svg>
  </div>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>TXT —ñ–∑ –¥—ñ–∞–≥–Ω–æ–∑–æ–º, —Ä–∏–∑–∏–∫–æ–º, —á–µ–∫-–ª–∏—Å—Ç–æ–º —Ç–∞ –ø—Ä–æ–º–ø—Ç–æ–º.</li>
      <li>CSV –∑ –ø–æ–ª—è–º–∏: –º–∞—à–∏–Ω–∞, –º/–≥, —Å–∏–º–ø—Ç–æ–º–∏, –∫–ª–∞—Å, —Ä–∏–∑–∏–∫, –¥—ñ—ó, —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.</li>
      <li>ICS —ñ–∑ –∑–∞–¥–∞—á–∞–º–∏: ¬´–ù–µ–≥–∞–π–Ω–æ/–°—å–æ–≥–æ–¥–Ω—ñ/–ü–ª–∞–Ω–æ–≤–µ –¢–û¬ª.</li>
    </ul>
  </div>

  <div class="card">
    <h2>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
    <p class="muted small">–ü–µ—Ä—à—ñ –µ–∫—Å–ø–µ—Ä—Ç–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ –¥–ª—è —Å–µ—Ä–≤—ñ—Å—É —Ç—Ä–∞–∫—Ç–æ—Ä—ñ–≤ —É 1980-—Ö –ø—Ä–∞—Ü—é–≤–∞–ª–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞—Ö ¬´—è–∫—â–æ-—Ç–æ¬ª. –ú–∏ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ —Ü—ñ—î—ó —ñ–¥–µ—ó: –¥–æ–¥–∞—î–º–æ –Ω–∞–≤—á–∞–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –π –ø—Ä–æ–º–ø—Ç–∏ ‚Äî —ñ –º–∞—î–º–æ ¬´–∫–∏—à–µ–Ω—å–∫–æ–≤–æ–≥–æ –º–∞–π—Å—Ç—Ä–∞ –∑–º—ñ–Ω–∏¬ª –Ω–∞ –∫–æ–∂–Ω–æ–º—É –ü–ö.</p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}

// ===== –ë–∞–∑–∞ –∑–Ω–∞–Ω—å (–º—ñ–Ω—ñ–¥–æ–≤—ñ–¥–Ω–∏–∫) =====
const KB = {
  belt:{
    name:'–†–µ–º—ñ–Ω–Ω–∏–π –ø—Ä–∏–≤—ñ–¥',
    keywords:['—Å–≤–∏—Å—Ç','—Å–∫—Ä–∏–ø','–ø—Ä–æ—Å–ª–∏–∑','—Ä–µ–º—ñ–Ω','–∑–∞–ø–∞—Ö –≥—É–º–∏','—à–∫—ñ–≤','–Ω–∞—Ç—è–≥','—Å—Ç—Ä–æ–±','–±–∏—Ç—Ç—è'],
    actions:[
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—Ç—è–≥ —Ä–µ–º–µ–Ω—è —Ç–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å —à–∫—ñ–≤—ñ–≤',
      '–û–≥–ª—è–Ω—É—Ç–∏ –∑–Ω–æ—Å –∫–∞–Ω–∞–≤–æ–∫, –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è, –º–∞—Å–ª–æ –Ω–∞ —Ä–µ–º–µ–Ω—ñ',
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥—à–∏–ø–Ω–∏–∫–∏ –Ω–∞—Ç—è–∂–Ω–∏—Ö —Ä–æ–ª–∏–∫—ñ–≤ —ñ –±–∏—Ç—Ç—è —à–∫—ñ–≤—ñ–≤',
      '–ó–∞ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî –∑–∞–º—ñ–Ω–∞ —Ä–µ–º–µ–Ω—è/—Ä–µ–≥—É–ª—é–≤–∞–Ω–Ω—è'
    ],
    ppe:['–û–∫—É–ª—è—Ä–∏','–†—É–∫–∞–≤–∏—Ü—ñ','LOTO –Ω–∞ –¥–≤–∏–≥—É–Ω—ñ/–í–í–ü'],
    tools:['–ö–ª—é—á—ñ','–õ—ñ–Ω—ñ–π–∫–∞/—Ä—ñ–≤–µ–Ω—å','–°—Ç—Ä–æ–±–æ—Å–∫–æ–ø (–¥–∏–≤. –ü–∞—Ä–∞ 19)']
  },
  bearing:{
    name:'–ü—ñ–¥—à–∏–ø–Ω–∏–∫',
    keywords:['—Å–∫—Ä–µ–≥—ñ—Ç','–≥—É–ª','–¥–∑–∏–∂—á','–≤–∏–±—Ä–∞—Ü—ñ—è','–ø–µ—Ä–µ–≥—Ä—ñ–≤','–ª—é—Ñ—Ç','—É–¥–∞—Ä–∏','–æ–≥–∏–Ω–∞—é—á–∞','–∫–µ–ø—Å—Ç—Ä—É–º'],
    actions:[
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª—é—Ñ—Ç/–ø–æ—Å–∞–¥–∫—É, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É',
      '–ü—Ä–æ—Å–ª—É—Ö–∞—Ç–∏ —Å—Ç–µ—Ç–æ—Å–∫–æ–ø–æ–º (–¥–∏–≤. –ü–∞—Ä–∞ 20): envelope/–∫–µ–ø—Å—Ç—Ä—É–º',
      '–ó–∞–º—ñ–Ω–∏—Ç–∏ –ø—ñ–¥—à–∏–ø–Ω–∏–∫ –∑–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è–º Kurtosis/ENV-–ø—ñ–∫—ñ–≤',
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–º–∞—â–µ–Ω–Ω—è —ñ —Å–∞–ª—å–Ω–∏–∫–∏'
    ],
    ppe:['–û–∫—É–ª—è—Ä–∏','–†—É–∫–∞–≤–∏—Ü—ñ'],
    tools:['–¢–µ—Ä–º–æ–º–µ—Ç—Ä –Ü–ß','–°—Ç–µ—Ç–æ—Å–∫–æ–ø/–º—ñ–∫—Ä–æ—Ñ–æ–Ω','–ó–Ω—ñ–º–∞—á –ø—ñ–¥—à–∏–ø–Ω–∏–∫—ñ–≤']
  },
  hydraulic:{
    name:'–ì—ñ–¥—Ä–∞–≤–ª—ñ–∫–∞',
    keywords:['–ø—ñ–¥—Ç—ñ–∫','–º–∞—Å–ª–æ','—à–ª–∞–Ω–≥','—Ü–∏–ª—ñ–Ω–¥—Ä','–∫–ª–∞–ø–∞–Ω','–ø–æ–≤—ñ—Ç—Ä—è','–∫–∞–≤—ñ—Ç–∞—Ü','—Å–≤–∏—Å—Ç –Ω–∞—Å–æ—Å–∞','—Ä–∏–≤–∫–∏'],
    actions:[
      '–û–≥–ª—è–Ω—É—Ç–∏ —à–ª–∞–Ω–≥–∏/—Ñ—ñ—Ç–∏–Ω–≥–∏, –ø—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ –∞–±–æ –∑–∞–º—ñ–Ω–∏—Ç–∏',
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å —ñ –≤‚Äô—è–∑–∫—ñ—Å—Ç—å –º–∞—Å–ª–∞, —Ñ—ñ–ª—å—Ç—Ä–∏',
      '–ü—Ä–æ—Å–ª—É—Ö–∞—Ç–∏ –≥—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º—É –Ω–∞ –∫–∞–≤—ñ—Ç–∞—Ü—ñ—é (–ü–∞—Ä–∞ 18)',
      '–¢–µ—Å—Ç –ø–µ—Ä–µ–ø—É—Å–∫–Ω–æ–≥–æ/–ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–ª–∞–ø–∞–Ω–∞'
    ],
    ppe:['–û–∫—É–ª—è—Ä–∏','–§–∞—Ä—Ç—É—Ö','–†—É–∫–∞–≤–∏—Ü—ñ'],
    tools:['–ö–ª—é—á—ñ','–ú–∞–Ω–æ–º–µ—Ç—Ä','–ú—ñ–∫—Ä–æ—Ñ–æ–Ω/–≥–∞—Ä–Ω—ñ—Ç—É—Ä–∞']
  },
  electric:{
    name:'–ï–ª–µ–∫—Ç—Ä–∏–∫–∞',
    keywords:['–Ω–µ –∑–∞–≤–æ–¥–∏—Ç—å—Å—è','–ø—Ä–æ—Å—ñ–¥–∞—î –Ω–∞–ø—Ä—É–≥–∞','—ñ—Å–∫—Ä–∞','–∫–æ—Ä–æ–∑—ñ—è –∫–ª–µ–º','–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä','–ê–ö–ë','—Ä–µ–ª–µ'],
    actions:[
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞—Ç–∏—Å–∫–∞—á—ñ –ê–ö–ë, –ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ –Ω–∞ –º–∞—Å–∞—Ö',
      '–¢–µ—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞/—Ä–µ–ª–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞ (–ü–∞—Ä–∏ 6/11)',
      '–û–≥–ª—è–¥ –ø—Ä–æ–≤–æ–¥–∫–∏ –Ω–∞ –ø–µ—Ä–µ—Ç–∏—Ä–∞–Ω–Ω—è/–æ–∫–∏—Å–Ω–µ–Ω–Ω—è',
      '–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è —Å—Ç—Ä—É–º—É –≤ —Å–ø–æ–∫–æ—ó'
    ],
    ppe:['–î—ñ–µ–ª–µ–∫—Ç—Ä–∏—á–Ω—ñ —Ä—É–∫–∞–≤–∏—Ü—ñ','–û–∫—É–ª—è—Ä–∏'],
    tools:['–ú—É–ª—å—Ç–∏–º–µ—Ç—Ä','–°—Ç—Ä—É–º–æ–≤—ñ –∫–ª—ñ—â—ñ','–ù–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–∞ –≤–∏–ª–∫–∞']
  },
  cooling:{
    name:'–û—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è',
    keywords:['–ø–µ—Ä–µ–≥—Ä—ñ–≤','—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –û–ñ','–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä','—Ä–∞–¥—ñ–∞—Ç–æ—Ä','–∞–Ω—Ç–∏—Ñ—Ä–∏–∑','—Ç–µ—Ä–º–æ—Å—Ç–∞—Ç','–ø—Ä–æ—Ç—ñ–∫','–∑–∞–ø–∞—Ö'],
    actions:[
      '–ü—Ä–æ–º–∏—Ç–∏ —Ä–∞–¥—ñ–∞—Ç–æ—Ä, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç/–≤‚Äô—è–∑–∫—ñ—Å—Ç—å –º—É—Ñ—Ç–∏',
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–º—ñ–Ω—å –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ (–ü–∞—Ä–∞ 19)',
      '–û–≥–ª—è–¥ –ø–∞—Ç—Ä—É–±–∫—ñ–≤, —Ç–µ—Å—Ç –Ω–∞ CO‚ÇÇ —É —Å–∏—Å—Ç–µ–º—ñ –û–ñ (—è–∫—â–æ —î)',
      '–î–æ–ª–∏–≤/–∑–∞–º—ñ–Ω–∞ –∞–Ω—Ç–∏—Ñ—Ä–∏–∑—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—É'
    ],
    ppe:['–û–∫—É–ª—è—Ä–∏','–†—É–∫–∞–≤–∏—Ü—ñ'],
    tools:['–¢–µ—Ä–º–æ–º–µ—Ç—Ä –Ü–ß','–¢–µ—Å—Ç–µ—Ä —Ç–∏—Å–∫—É —Å–∏—Å—Ç–µ–º–∏ –û–ñ']
  },
  fuel:{
    name:'–ü–∞–ª–∏–≤–Ω–∞ —Å–∏—Å—Ç–µ–º–∞',
    keywords:['–¥–≤–∏–≥—É–Ω —Ç—Ä–æ—ó—Ç—å','–¥–∏–º–Ω—ñ—Å—Ç—å','–Ω–µ —Ä–æ–∑–≤–∏–≤–∞—î –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å','–ø–æ–≤—ñ—Ç—Ä—è –≤ –ø–∞–ª–∏–≤—ñ','—Ñ—ñ–ª—å—Ç—Ä –ø–∞–ª–∏–≤–∞','—Ñ–æ—Ä—Å—É–Ω–∫–∞'],
    actions:[
      '–ó–∞–º—ñ–Ω–∏—Ç–∏/–ø—Ä–æ–¥—É—Ç–∏ –ø–∞–ª–∏–≤–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–æ–¥—É',
      '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥—Å–º–æ–∫—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ—Ç—Ä—è –Ω–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è—Ö',
      '–û—Ü—ñ–Ω–∏—Ç–∏ —Ç–∏—Å–∫/—Ä–æ–∑–ø–∏–ª —Ñ–æ—Ä—Å—É–Ω–æ–∫, –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è',
      '–ü–∞–ª–∏–≤–æ–ø—Ä–æ–≤–æ–¥–∏: –∑–∞–ª–æ–º–∏/–±—Ä—É–¥'
    ],
    ppe:['–û–∫—É–ª—è—Ä–∏','–†—É–∫–∞–≤–∏—Ü—ñ'],
    tools:['–ú–∞–Ω–æ–º–µ—Ç—Ä –ø–∞–ª–∏–≤–∞','–¢–µ—Å—Ç–µ—Ä —Ñ–æ—Ä—Å—É–Ω–æ–∫','–ó–±—ñ—Ä–Ω–∏–∫ –∑–≤–æ—Ä–æ—Ç—É']
  }
};

// –ü–æ—á–∞—Ç–∫–æ–≤—ñ few-shot –ø—Ä–∏–∫–ª–∞–¥–∏
const SHOTS=[
  {y:'belt', x:'—Å–≤–∏—Å—Ç –ø—Ä–∏ —Ä–æ–∑–≥–æ–Ω—ñ, –∑–∞–ø–∞—Ö –≥—É–º–∏, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–æ—Å—Ç–µ, –ø—Ä–æ—Å–ª–∏–∑–∞–Ω–Ω—è —Ä–µ–º–µ–Ω—è'},
  {y:'bearing', x:'–≥—É–ª —ñ –≤—ñ–±—Ä–∞—Ü—ñ—è –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º, –ø—ñ—Å–ª—è 10 —Ö–≤–∏–ª–∏–Ω —Ç–µ–ø–ª—ñ—à–∞—î –∫–æ—Ä–ø—É—Å'},
  {y:'hydraulic', x:'—Ä–∏–≤–∫–∏ –≥—ñ–¥—Ä–æ—Ü–∏–ª—ñ–Ω–¥—Ä–∞, —à—É–º –Ω–∞—Å–æ—Å–∞ —Å—Ö–æ–∂–∏–π –Ω–∞ —à—É—Ä—Ö—ñ—Ç, –º–∞—Å–ª–æ –∑ –ø—ñ–Ω–æ—é'},
  {y:'electric', x:'–ø–æ–≥–∞–Ω–∏–π –∑–∞–ø—É—Å–∫, –ø—Ä–æ—Å—ñ–¥–∞–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ—Ä—ñ, –æ–∫–∏—Å–ª–µ–Ω—ñ –∫–ª–µ–º–∏'},
  {y:'cooling', x:'–ø–µ—Ä–µ–≥—Ä—ñ–≤ —É –ø–æ–ª—ñ, –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∫—Ä—É—Ç–∏—Ç—å—Å—è –ø–æ–≤—ñ–ª—å–Ω–æ, —Ä–∞–¥—ñ–∞—Ç–æ—Ä –∑–∞–±–∏—Ç–∏–π'},
  {y:'fuel', x:'–¥–≤–∏–≥—É–Ω –Ω–µ —Ç—è–≥–Ω–µ, —á–æ—Ä–Ω–∏–π –¥–∏–º, –∑–∞–±–∏—Ç–∏–π –ø–∞–ª–∏–≤–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä'}
];

// ===== TF-IDF k-NN + –ø—Ä–∞–≤–∏–ª–∞ =====
function tokenize(s){
  return (s.toLowerCase().replace(/[^\p{L}\p{N}\s]+/gu,' ').split(/\s+/).filter(w=>w.length>1));
}
function buildTfidf(shots){
  const docs=shots.map(r=>tokenize(r.x));
  const df=new Map();
  docs.forEach(d=>{ new Set(d).forEach(t=>df.set(t,(df.get(t)||0)+1)); });
  const N=docs.length;
  function vec(doc){
    const tf=new Map();
    doc.forEach(t=>tf.set(t,(tf.get(t)||0)+1));
    const v=new Map();
    tf.forEach((cnt,t)=>{
      const idf=Math.log((N+1)/((df.get(t)||1)))+1;
      v.set(t, (cnt/doc.length)*idf);
    });
    return v;
  }
  return {df,N,vec};
}
function cosSim(a,b){
  let dot=0,na=0,nb=0;
  a.forEach((va,t)=>{ if(b.has(t)) dot+=va*b.get(t); na+=va*va; });
  b.forEach(v=>{ nb+=v*v; });
  return dot/(Math.sqrt(na*nb)+1e-9);
}
function knnPredict(text, shots, k=3){
  if(shots.length===0) return {y:'unknown', score:0};
  const tfidf=buildTfidf(shots);
  const q=tfidf.vec(tokenize(text));
  const sims=shots.map(r=>({y:r.y, s:cosSim(q, tfidf.vec(tokenize(r.x)))})).sort((a,b)=>b.s-a.s).slice(0,k);
  const votes=new Map(); sims.forEach(o=>votes.set(o.y,(votes.get(o.y)||0)+o.s));
  let best='unknown', sc=-1; votes.forEach((v,y)=>{ if(v>sc){sc=v; best=y;} });
  return {y:best, score: Math.max(0, Math.min(1, sc))};
}
function ruleBoost(text, pred){
  // –Ø–∫—â–æ –ø—Ä–∏—Å—É—Ç–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—É–∑–ª–∞ ‚Äî –ø—ñ–¥—Å–∏–ª—é—î–º–æ –∫–ª–∞—Å
  const t=text.toLowerCase();
  let best=pred;
  Object.entries(KB).forEach(([k,obj])=>{
    const hits=obj.keywords.filter(w=>t.includes(w));
    if(hits.length>=2 && (best.y!==k)) best={y:k, score:Math.max(pred.score, 0.75)};
  });
  return best;
}
function riskScore(pred, crit){
  const base={low:0.3, medium:0.6, high:0.8}[crit]||0.6;
  const clsBoost={belt:0.5,bearing:0.8,hydraulic:0.7,electric:0.7,cooling:0.7,fuel:0.7}[pred.y]||0.4;
  return Math.max(0, Math.min(1, 0.4*base + 0.6*clsBoost));
}

// ===== –ì–æ–ª–æ—Å–æ–≤–∏–π –≤–≤—ñ–¥ =====
let recog=null;
function startMic(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î SpeechRecognition. –í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É.'); return; }
  recog = new SR(); recog.lang='uk-UA'; recog.interimResults=true; recog.continuous=false;
  $('#stat').textContent='–°—Ç–∞—Ç—É—Å: —Å–ª—É—Ö–∞—é...';
  recog.onresult = (e)=>{
    let s=''; for(let i=0;i<e.results.length;i++){ s+=e.results[i][0].transcript+' '; }
    $('#text').value = ($('#text').value+' '+s).trim();
  };
  recog.onend=()=>$('#stat').textContent='–°—Ç–∞—Ç—É—Å: —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ';
  recog.start();
}

// ===== –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —á–µ–∫-–ª–∏—Å—Ç—É, –ø—Ä–æ–º–ø—Ç—ñ–≤, –µ–∫—Å–ø–æ—Ä—Ç—ñ–≤ =====
const SHOTS_STORE=[...SHOTS];
$('#addShot').addEventListener('click', ()=>{
  const lab=$('#label').value; const s=($('#shot').value||'').trim();
  if(!s) return;
  SHOTS_STORE.push({y:lab,x:s});
  $('#shot').value='';
  renderShots();
});
$('#exportShots').addEventListener('click', ()=>{
  download('mechanic_para21_shots_'+stamp()+'.json', JSON.stringify(SHOTS_STORE,null,2));
});
function renderShots(){
  const box=$('#shotsBox');
  box.textContent = SHOTS_STORE.map((r,i)=> `${i+1}. [${r.y}] ${r.x}`).join('\n') || '// –ü–æ–∫–∏ –±–µ–∑ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤';
}
renderShots();

function analyze(){
  const machine=$('#machine').value||'–ù/–î';
  const hours=parseInt($('#hours').value||'0',10);
  const crit=$('#crit').value;
  const text=($('#text').value||'').trim();
  if(!text){ alert('–í–≤–µ–¥–∏ —Å–∏–º–ø—Ç–æ–º–∏.'); return; }

  $('#stat').textContent='–°—Ç–∞—Ç—É—Å: –∞–Ω–∞–ª—ñ–∑...';
  // 1) TF-IDF k-NN
  let pred = knnPredict(text, SHOTS_STORE, 3);
  // 2) –ü—Ä–∞–≤–∏–ª–∞/–∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞
  pred = ruleBoost(text, pred);
  // 3) –†–∏–∑–∏–∫
  const risk = riskScore(pred, crit);

  // 4) –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –±–∞–∑–∏
  const kb = KB[pred.y] || {name:'–ù–µ–≤—ñ–¥–æ–º–æ',actions:['–ü–æ–ø—Ä–æ—Å–∏ –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É'],'ppe':[],tools:[]};

  // 5) –¢–æ–ø-–æ–∑–Ω–∞–∫–∏ (–∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞, —â–æ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∏)
  const feats = (KB[pred.y]?.keywords||[]).filter(w=>text.toLowerCase().includes(w)).slice(0,6);

  // 6) –ß–µ–∫-–ª–∏—Å—Ç
  const checklist = (KB[pred.y]?.actions||['–ó–±–µ—Ä–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ']).map((a,i)=>`<label style="display:block;margin:.2em 0"><input type="checkbox" data-i="${i}"/> ${a}</label>`).join('');
  $('#checklist').innerHTML = checklist;

  // 7) –ü–ï–ï/–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
  $('#ppe').textContent = ((KB[pred.y]?.ppe||[]).join(', ') || '–ù/–î') + ' | –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ' + ((KB[pred.y]?.tools||[]).join(', ')||'–ù/–î');

  // 8) –í–∏–≤—ñ–¥
  $('#pred').textContent = `${KB[pred.y]?.name||pred.y} (score ${ (pred.score*100).toFixed(0)}%)`;
  $('#feat').textContent = feats.length? feats.join(', '): '–∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
  $('#risk').textContent = (risk*100).toFixed(0)+'%';
  $('#reco').textContent = (KB[pred.y]?.actions||[]).slice(0,3).join('; ');

  // –ó–±–µ—Ä–µ–≥—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  lastResult = {machine,hours,crit,text,pred:pred.y,predName:KB[pred.y]?.name||pred.y,score:pred.score,risk,feats,actions:KB[pred.y]?.actions||[],ppe:KB[pred.y]?.ppe||[],tools:KB[pred.y]?.tools||[]};
  $('#stat').textContent='–°—Ç–∞—Ç—É—Å: –≥–æ—Ç–æ–≤–æ';
}
let lastResult=null;

function makePrompt(lang='ua'){
  if(!lastResult){ alert('–°–ø–æ—á–∞—Ç–∫—É –ø—Ä–æ–≤–µ–¥–∏ –∞–Ω–∞–ª—ñ–∑.'); return; }
  const r=lastResult;
  const sysUA = `–¢–∏ ‚Äî –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä –∑ –¢–û —Å/–≥ —Ç–µ—Ö–Ω—ñ–∫–∏. –ü–æ—è—Å–Ω—é–π —Å—Ç–∏—Å–ª–æ, –∫—Ä–æ–∫–∞–º–∏, –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ —Ä–∏–∑–∏–∫–∏ –±–µ–∑–ø–µ–∫–∏ (LOTO, –ó–Ü–ó). –í–∏–¥–∞–≤–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å —è–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –ø–ª–∞–Ω –∑ –ø—Ä—ñ–æ—Ä–∏—Ç–µ–∑–∞—Ü—ñ—î—é.`;
  const sysEN = `You are a seasoned agricultural machinery service engineer. Explain concisely, step-by-step, highlighting safety risks (LOTO, PPE). Return a structured, prioritized plan.`;
  const userUA = [
    `–ú–∞—à–∏–Ω–∞: ${r.machine}`,
    `–ù–∞—Ä–æ–±—ñ—Ç–æ–∫: ${r.hours} –º/–≥, –∫—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å: ${r.crit}`,
    `–°–∏–º–ø—Ç–æ–º–∏: ${r.text}`,
    `–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–ª–∞—Å: ${r.predName}`,
    `–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ: 1) –¥—ñ–∞–≥–Ω–æ–∑ –∑ —ñ–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é, 2) –¥–µ—Ç–∞–ª—å–Ω–∏–π —á–µ–∫-–ª–∏—Å—Ç, 3) –ø–æ—Ç—Ä—ñ–±–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏/–∑–∞–ø—á–∞—Å—Ç–∏–Ω–∏, 4) –∫–æ–ª–∏ –º–æ–∂–Ω–∞ –≤—ñ–¥–∫–ª–∞—Å—Ç–∏, 5) –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä.`
  ].join('\n');
  const userEN = [
    `Machine: ${r.machine}`,
    `Hours: ${r.hours}, criticality: ${r.crit}`,
    `Symptoms: ${r.text}`,
    `Preliminary class: ${r.predName}`,
    `Need: 1) diagnosis with likelihood, 2) detailed checklist, 3) required tools/spares, 4) when it can be deferred, 5) brief technical note.`
  ].join('\n');

  const prompt = (lang==='ua')
    ? `SYSTEM:\n${sysUA}\n\nUSER:\n${userUA}\n\nFORMAT: Markdown with numbered steps, and a final "Safety" section.`
    : `SYSTEM:\n${sysEN}\n\nUSER:\n${userEN}\n\nFORMAT: Markdown with numbered steps, and a final "Safety" section.`;

  $('#promptBox').textContent = prompt;
  return prompt;
}

function copyPrompt(){ const ta=document.createElement('textarea'); ta.value=$('#promptBox').textContent; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }

// ===== –ï–∫—Å–ø–æ—Ä—Ç–∏ =====
function saveTXT(){
  if(!lastResult){ alert('–°–ø–æ—á–∞—Ç–∫—É –∞–Ω–∞–ª—ñ–∑.'); return; }
  const r=lastResult;
  const lines=[
    '–ü–∞—Ä–∞ 21 ‚Äî –®–Ü Copilot –¢–û',
    `–ú–∞—à–∏–Ω–∞: ${r.machine} | –º/–≥: ${r.hours} | –∫—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å: ${r.crit}`,
    `–°–∏–º–ø—Ç–æ–º–∏: ${r.text}`,
    `–ö–ª–∞—Å: ${r.predName} (score ${(r.score*100).toFixed(0)}%), —Ä–∏–∑–∏–∫ ${(r.risk*100).toFixed(0)}%`,
    `–¢–æ–ø-–æ–∑–Ω–∞–∫–∏: ${r.feats.join(', ')||'‚Äî'}`,
    '--- –ß–µ–∫-–ª–∏—Å—Ç –¥—ñ–π ---',
    ...(r.actions.map((a,i)=>`${i+1}. ${a}`)),
    '--- –ü–ï–ï/–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ---',
    `–ü–ï–ï: ${(r.ppe||[]).join(', ')||'‚Äî'}`,
    `–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ${(r.tools||[]).join(', ')||'‚Äî'}`,
    '--- –ü—Ä–æ–º–ø—Ç (—É–∫—Ä) ---',
    makePrompt('ua')
  ];
  download('mechanic_para21_summary_'+stamp()+'.txt', lines.join('\n'));
}

function saveCSV(){
  if(!lastResult){ alert('–°–ø–æ—á–∞—Ç–∫—É –∞–Ω–∞–ª—ñ–∑.'); return; }
  const r=lastResult;
  const head='machine,hours,criticality,symptoms,class,score,risk,features,actions,ppe,tools\n';
  const row=[
    `"${r.machine}"`,r.hours,r.crit,
    `"${r.text.replace(/"/g,'""')}"`,
    `"${r.predName}"`,
    (r.score.toFixed(3)),(r.risk.toFixed(3)),
    `"${(r.feats||[]).join('|')}"`,
    `"${(r.actions||[]).join('|')}"`,
    `"${(r.ppe||[]).join('|')}"`,
    `"${(r.tools||[]).join('|')}"`
  ].join(',');
  download('mechanic_para21_analysis_'+stamp()+'.csv', head+row+'\n','text/csv');
}

function saveICS(){
  if(!lastResult){ alert('–°–ø–æ—á–∞—Ç–∫—É –∞–Ω–∞–ª—ñ–∑.'); return; }
  const r=lastResult;
  const now=new Date(); const dt=d=>d.toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z$/,'Z');
  const lines=[
    'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//EDLab//MechCopilot//UA'
  ];
  // –ù–µ–≥–∞–π–Ω–æ (—è–∫—â–æ —Ä–∏–∑–∏–∫ > 0.7)
  if(r.risk>0.7){
    const s=new Date(now.getTime()+15*60*1000), e=new Date(s.getTime()+60*60*1000);
    lines.push('BEGIN:VEVENT');
    lines.push('UID:'+('urgent-'+Date.now())+'@edlab');
    lines.push('DTSTART:'+dt(s)); lines.push('DTEND:'+dt(e));
    lines.push('SUMMARY:–ù–µ–≥–∞–π–Ω–∞ –¥—ñ—è ‚Äî '+r.predName);
    lines.push('DESCRIPTION:'+('–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏: '+(r.actions[0]||'‚Äî')));
    lines.push('END:VEVENT');
  }
  // –°—å–æ–≥–æ–¥–Ω—ñ
  const s2=new Date(now.getFullYear(),now.getMonth(),now.getDate(),17,0,0);
  const e2=new Date(s2.getTime()+60*60*1000);
  lines.push('BEGIN:VEVENT');
  lines.push('UID:'+('today-'+Date.now())+'@edlab');
  lines.push('DTSTART:'+dt(s2)); lines.push('DTEND:'+dt(e2));
  lines.push('SUMMARY:–î—ñ—ó –∑–∞ —á–µ–∫-–ª–∏—Å—Ç–æ–º ‚Äî '+r.predName);
  lines.push('DESCRIPTION:'+(r.actions.slice(0,3).join('; ')));
  lines.push('END:VEVENT');

  // –ü–ª–∞–Ω–æ–≤–µ –¢–û —á–µ—Ä–µ–∑ —Ç–∏–∂–¥–µ–Ω—å
  const s3=new Date(now.getTime()+7*24*3600*1000); s3.setHours(9,0,0,0);
  const e3=new Date(s3.getTime()+2*3600*1000);
  lines.push('BEGIN:VEVENT');
  lines.push('UID:'+('plan-'+Date.now())+'@edlab');
  lines.push('DTSTART:'+dt(s3)); lines.push('DTEND:'+dt(e3));
  lines.push('SUMMARY:–ü–ª–∞–Ω–æ–≤–µ –¢–û (–∫–æ–Ω—Ç—Ä–æ–ª—å –ø—ñ—Å–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)');
  lines.push('DESCRIPTION:–ú–∞—à–∏–Ω–∞: '+r.machine+' | –°–∏–º–ø—Ç–æ–º–∏: '+r.text.slice(0,120));
  lines.push('END:VEVENT');

  lines.push('END:VCALENDAR');
  download('mechanic_para21_plan_'+stamp()+'.ics', lines.join('\r\n'), 'text/calendar');
}

function makeReceipt(){
  if(!lastResult){ alert('–°–ø–æ—á–∞—Ç–∫—É –∞–Ω–∞–ª—ñ–∑.'); return; }
  const r=lastResult;
  const lines=[
    '=== –ß–ï–ö –®–Ü COPILOT –¢–û (58–º–º) ===',
    '–î–∞—Ç–∞: '+new Date().toISOString().slice(0,10),
    '–ú–∞—à–∏–Ω–∞: '+r.machine,
    '–ö–ª–∞—Å: '+r.predName,
    '–†–∏–∑–∏–∫: '+(r.risk*100).toFixed(0)+'%',
    '--- –ü–µ—Ä—à—ñ –¥—ñ—ó ---',
    ...(r.actions.slice(0,3).map(a=>'- '+a))
  ];
  const el=$('#rc'); el.hidden=false; el.textContent=lines.join('\n');
  download('para21_receipt_'+stamp()+'.txt', lines.join('\n'));
}

// ===== –ü–æ–¥—ñ—ó UI =====
$('#mic').addEventListener('click', startMic);
$('#analyze').addEventListener('click', analyze);
$('#clear').addEventListener('click', ()=>{ $('#text').value=''; $('#stat').textContent='–°—Ç–∞—Ç—É—Å: –æ—á–∏—â–µ–Ω–æ'; });

$('#genUA').addEventListener('click', ()=>makePrompt('ua'));
$('#genEN').addEventListener('click', ()=>makePrompt('en'));
$('#copyPrompt').addEventListener('click', copyPrompt);

$('#saveTxt').addEventListener('click', saveTXT);
$('#saveCsv').addEventListener('click', saveCSV);
$('#saveIcs').addEventListener('click', saveICS);
$('#receipt').addEventListener('click', makeReceipt);

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
if (window.self !== window.top) document.documentElement.classList.add('embedded'); // LMS-friendly
</script>


</body></html>