<!-- mechanic_para6.html
     –ü–ê–†–ê 6 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤
     –¢–µ–º–∞: –ï–õ–ï–ö–¢–†–ò–ö–ê –¢–ê –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê ‚Äî –ê–ö–ë, –ø—É—Å–∫/–∑–∞—Ä—è–¥, –ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏, —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è —É —Å–ø–æ–∫–æ—ó, –≤–∏–±—ñ—Ä –¥—Ä–æ—Ç—É/–∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫–∞, —á–µ–∫ 58 –º–º, NFC, CSV
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –ø—Ä–∞—Ü—é—î –Ω–∞ GitHub Pages / —É Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏, 58 –º–º —Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä (–æ–ø—Ü.), NFC-–º—ñ—Ç–∫–∏ (–æ–ø—Ü.), –º—É–ª—å—Ç–∏–º–µ—Ç—Ä (—Ä–µ–∞–ª—å–Ω–∏–π/–≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π –≤–≤—ñ–¥).

     –©–æ –≤–º—ñ—î:
     ‚Ä¢ –¢–µ—Å—Ç–∏ –ê–ö–ë/–ø—É—Å–∫—É/–∑–∞—Ä—è–¥—É: –Ω–∞–ø—Ä—É–≥–∞ —Å–ø–æ–∫–æ—é, ‚Äú–ø—Ä–æ–≤–∞–ª‚Äù –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É, –Ω–∞–ø—Ä—É–≥–∞ –∑–∞—Ä—è–¥–∂–∞–Ω–Ω—è, —Å—Ç—Ä—É–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ ‚Üí –≤–∏—Å–Ω–æ–≤–∫–∏.
     ‚Ä¢ –ü–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ –ª–∞–Ω—Ü—é–≥—ñ–≤ (+ —Ç–∞ ‚àí): Udrop = I¬∑R –∞–±–æ –∑–∞ –¥–æ–≤–∂–∏–Ω–æ—é/–º–∞—Ç–µ—Ä—ñ–∞–ª–æ–º, –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –Ω–æ—Ä–º–æ—é (‚â§3% –∂–∏–≤–ª–µ–Ω–Ω—è, ‚â§0.5 –í –Ω–∞ –ø—É—Å–∫).
     ‚Ä¢ –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è –≤ —Å–ø–æ–∫–æ—ó: Iquiescent √ó —á–∞—Å ‚Üí –≤–∏—Ç—Ä–∞—Ç–∞ —î–º–Ω–æ—Å—Ç—ñ, –æ—Ü—ñ–Ω–∫–∞ ‚Äú—Å—è–¥–µ –∑–∞ ___ –¥—ñ–±‚Äù.
     ‚Ä¢ –í–∏–±—ñ—Ä –¥—Ä–æ—Ç—É (–ø–µ—Ä–µ—Ç–∏–Ω) —Ç–∞ –∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫–∞: –∑–∞ —Å—Ç—Ä—É–º–æ–º/–¥–æ–≤–∂–∏–Ω–æ—é/–¥–æ–ø—É—Å—Ç–∏–º–∏–º –ø–∞–¥—ñ–Ω–Ω—è–º; –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–µ—Ä–º—ñ—á–Ω–æ–≥–æ –∑–∞–ø–∞—Å—É.
     ‚Ä¢ –ö–≤–∏—Ç–æ–∫ 58 –º–º ‚Äú–ï–ª–µ–∫—Ç—Ä–æ—Ç–µ—Å—Ç‚Äù + NFC-—Ç–µ–∫—Å—Ç; –µ–∫—Å–ø–æ—Ä—Ç CSV.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 6 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –ï–ª–µ–∫—Ç—Ä–∏–∫–∞: –ê–ö–ë, –ø—É—Å–∫/–∑–∞—Ä—è–¥, –ø–∞–¥—ñ–Ω–Ω—è U, —Å–ø–æ–∫—ñ–π–Ω–∏–π —Å—Ç—Ä—É–º, –¥—Ä–æ—Ç–∏/–∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫–∏, —á–µ–∫ 58 –º–º, NFC</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.55}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--line);background:#0b1220;border-radius:999px;
         font-size:12px;color:var(--muted);letter-spacing:.3px}
  h1{font-size:34px;margin:6px 0 12px;line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  h2{font-size:22px;margin:28px 0 12px} h3{font-size:18px;margin:20px 0 8px;color:#cbd5e1}
  p{margin:10px 0}.small{font-size:12px;color:#9fb0c8}.muted{color:#93a3b5}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#dbeafe;text-decoration:none;cursor:pointer}
  .btn:hover{background:#0f1f39}
  .grid{display:grid;gap:12px}.g2{grid-template-columns:repeat(2,minmax(0,1fr))}.g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049;border-radius:12px;padding:12px;background:var(--darkcell);color:var(--darkink)}
  .table{width:100%;border-collapse:separate;border-spacing:0;overflow:auto;border-radius:12px;border:1px solid #223049}
  .table th,.table td{padding:8px 10px;border-bottom:1px solid #1f2937;font-size:14px;vertical-align:top}
  .table thead th{background:#0c1629;color:#a5b4fc;text-align:left;position:sticky;top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell);color:var(--darkink2)}
  .table td.dark,.table th.dark{background:var(--darkcell)!important;color:var(--darkink2)!important}
  .out{background:var(--darkcell);color:var(--darkink2);border:1px dashed #263042;padding:10px 12px;border-radius:10px;word-break:break-all}
  input[type="text"],input[type="number"],input[type="date"],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #223049;background:#0d1a2e;color:#e6eef9}
  .ok{color:#10b981}.warn{color:#f59e0b}.bad{color:#ef4444}
  /* –ß–µ–∫ 58 –º–º */
  .ticket{width:58mm;background:#fff;color:#000;padding:6mm 4mm;border-radius:6px;box-shadow:0 0 0 1px #e5e7eb inset;font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px;font-size:13px;text-align:center}.ticket p{margin:2px 0;font-size:12px}.ticket .line{border-top:1px dashed #111;margin:6px 0}
  .ticket small{font-size:10px}
  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff;color:#111}
  html.embedded .card{background:#fff;border:1px solid #e5e7eb;box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial;background:none;color:#111}
  html.embedded .box{background:#f8fafc;color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6;color:#111}
  @media print{@page{margin:4mm}.no-print{display:none!important}}
</style>

<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

</head>
<body>
<div class="wrap">
  <span class="badge">–ü–∞—Ä–∞ 6 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
  <h1>üîã –ï–ª–µ–∫—Ç—Ä–∏–∫–∞: –ê–ö–ë ‚Üí –ø—É—Å–∫/–∑–∞—Ä—è–¥ ‚Üí –ø–∞–¥—ñ–Ω–Ω—è U ‚Üí —Å–ø–æ–∫—ñ–π–Ω–∏–π —Å—Ç—Ä—É–º ‚Üí –¥—Ä–æ—Ç–∏/–∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫–∏ ‚Üí —á–µ–∫ 58 –º–º, NFC, CSV</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞</h2>
    <p>
      –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –≤–∏–∫–æ–Ω–∞—é—Ç—å –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ-—Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ <b>–≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è</b> (–≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –º—É–ª—å—Ç–∏–º–µ—Ç—Ä–∞),
      –æ—Ç—Ä–∏–º–∞—é—Ç—å <b>–≤–∏—Å–Ω–æ–≤–æ–∫ –ø–æ —Å–∏—Å—Ç–µ–º—ñ –ø—É—Å–∫/–∑–∞—Ä—è–¥</b>, –ø–æ—Ä–∞—Ö—É—é—Ç—å <b>–ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏</b>, <b>—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è —É —Å–ø–æ–∫–æ—ó</b>,
      –ø—ñ–¥–±–µ—Ä—É—Ç—å <b>–ø–µ—Ä–µ—Ç–∏–Ω –¥—Ä–æ—Ç—É</b> —ñ <b>–∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫</b>, –∑–≥–µ–Ω–µ—Ä—É—é—Ç—å <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>, <b>NFC</b>-—Ç–µ–∫—Å—Ç —ñ <b>CSV</b>.
    </p>
    <p class="small">–ù–æ—Ä–º–∏ (–æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–æ): 12–í –ê–ö–ë ‚Äî —Å–ø–æ–∫—ñ–π 12.6‚Äì12.8 –í; –ø—Ä–∏ –ø—É—Å–∫—É –Ω–µ –Ω–∏–∂—á–µ 9.6 –í (10 —Å, +20¬∞C). –ó–∞—Ä—è–¥ 13.8‚Äì14.6 –í. –°–ø–æ–∫—ñ–π–Ω–∏–π —Å—Ç—Ä—É–º
      <span class="mono">‚â§50 –º–ê</span> (—Ç–∏–ø–æ–≤–æ –¥–æ 30 –º–ê).</p>
  </div>

  <!-- –ê–ö–ë / –ü–£–°–ö / –ó–ê–†–Ø–î -->
  <div class="card">
    <h2>üß™ –¢–µ—Å—Ç –ê–ö–ë / –ø—É—Å–∫ / –∑–∞—Ä—è–¥</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏–º—ñ—Ä–∏</h3>
        <div class="row">
          <div style="flex:1"><label>U —Å–ø–æ–∫–æ—é, –í</label><input id="uRest" type="number" step="0.01" value="12.55"></div>
          <div style="flex:1"><label>U –ø—ñ–¥ —á–∞—Å –ø—É—Å–∫—É (–º—ñ–Ω), –í</label><input id="uCrank" type="number" step="0.01" value="9.9"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>U –∑–∞—Ä—è–¥–∂–∞–Ω–Ω—è, –í</label><input id="uCharge" type="number" step="0.01" value="14.2"></div>
          <div style="flex:1"><label>I –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞, –ê (–æ—Ü—ñ–Ω–∫–∞)</label><input id="iAlt" type="number" step="1" value="45"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–Ñ–º–Ω—ñ—Å—Ç—å –ê–ö–ë, –ê¬∑–≥–æ–¥</label><input id="capAh" type="number" step="1" value="90"></div>
          <div style="flex:1"><label>–°–∏—Å—Ç–µ–º–∞</label>
            <select id="sysV"><option value="12" selected>12 –í</option><option value="24">24 –í</option></select>
          </div>
        </div>
      </div>
      <div class="box">
        <h3>–ü—ñ–¥—Å—É–º–∫–∏</h3>
        <p>–°—Ç–∞–Ω –ê–ö–ë: <b><span id="batState">‚Äî</span></b></p>
        <p>–ü—É—Å–∫–æ–≤–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å: <b><span id="crankOK">‚Äî</span></b></p>
        <p>–ó–∞—Ä—è–¥/—Ä–µ–≥—É–ª—è—Ç–æ—Ä: <b><span id="chargeOK">‚Äî</span></b></p>
        <p>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞: <b><span id="altPower">‚Äî</span></b> –∫–í—Ç</p>
      </div>
      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="calcAll()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="preset()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
          <button class="btn" onclick="copyCSV('csv1')">üìã CSV (—Ç–µ—Å—Ç)</button>
        </div>
        <div id="csv1" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- –ü–ê–î–Ü–ù–ù–Ø –ù–ê–ü–†–£–ì–ò -->
  <div class="card">
    <h2>‚ö° –ü–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ (–ª–∞–Ω—Ü—é–≥–∏ + —Ç–∞ ‚àí)</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏—Ö—ñ–¥–Ω—ñ</h3>
        <div class="row">
          <div style="flex:1"><label>–°—Ç—Ä—É–º I, –ê</label><input id="vdI" type="number" step="0.1" value="120"></div>
          <div style="flex:1"><label>–î–æ–≤–∂–∏–Ω–∞ —Ç—É–¥–∏-–Ω–∞–∑–∞–¥, –º</label><input id="vdL" type="number" step="0.1" value="3.2"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–ü–µ—Ä–µ—Ç–∏–Ω S, –º–º¬≤</label><input id="vdS" type="number" step="0.1" value="25"></div>
          <div style="flex:1"><label>–î–æ–ø—É—Å—Ç–∏–º–µ –ø–∞–¥—ñ–Ω–Ω—è, % U</label><input id="vdPct" type="number" step="0.1" value="3"></div>
        </div>
      </div>
      <div class="box">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p>R –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫–∞: <b><span id="vdR">‚Äî</span></b> –û–º ¬∑ Udrop: <b><span id="vdU">‚Äî</span></b> –í</p>
        <p>–í—ñ–¥—Å–æ—Ç–æ–∫ –≤—ñ–¥ U—Å–∏—Å—Ç: <b><span id="vdUp">‚Äî</span></b> % ¬∑ –°—Ç–∞—Ç—É—Å: <b><span id="vdFlag">‚Äî</span></b></p>
      </div>
      <div class="box">
        <h3>–ü—ñ–¥–±—ñ—Ä –ø–µ—Ä–µ—Ç–∏–Ω—É</h3>
        <p>–°–ø–∏—Å–æ–∫ S (–º–º¬≤):</p>
        <input id="vdList" type="text" value="10,16,25,35,50,70">
        <p>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ S: <b><span id="vdRec">‚Äî</span></b> –º–º¬≤</p>
      </div>
    </div>
  </div>

  <!-- –°–ü–û–ö–Ü–ô–ù–ò–ô –°–¢–†–£–ú -->
  <div class="card">
    <h2>üåô –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è —É —Å–ø–æ–∫–æ—ó</h2>
    <div class="grid g2">
      <div class="box">
        <h3>–î–∞–Ω—ñ</h3>
        <div class="row">
          <div style="flex:1"><label>I—Å–ø–æ–∫, –º–ê</label><input id="iqmA" type="number" step="1" value="35"></div>
          <div style="flex:1"><label>–ß–∞—Å, –≥–æ–¥/–¥–æ–±—É</label><input id="iqH" type="number" step="0.5" value="24"></div>
        </div>
      </div>
      <div class="box">
        <h3>–û—Ü—ñ–Ω–∫–∞</h3>
        <p>–í–∏—Ç—Ä–∞—Ç–∞ –∑–∞ –¥–æ–±—É: <b><span id="iqDaily">‚Äî</span></b> –ê¬∑–≥–æ–¥</p>
        <p>–ß–∞—Å –¥–æ 50% —î–º–Ω–æ—Å—Ç—ñ: <b><span id="iqDays">‚Äî</span></b> –¥—ñ–±</p>
        <p>–°—Ç–∞—Ç—É—Å: <b><span id="iqFlag">‚Äî</span></b></p>
      </div>
    </div>
  </div>

  <!-- –î–†–û–¢–ò / –ó–ê–ü–û–ë–Ü–ñ–ù–ò–ö -->
  <div class="card">
    <h2>üßµ –î—Ä—ñ—Ç —ñ –∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫</h2>
    <div class="grid g3">
      <div class="box">
        <h3>–í–∏—Ö—ñ–¥–Ω—ñ</h3>
        <div class="row">
          <div style="flex:1"><label>–†–æ–±–æ—á–∏–π —Å—Ç—Ä—É–º, –ê</label><input id="fwI" type="number" step="0.1" value="22"></div>
          <div style="flex:1"><label>–î–æ–≤–∂–∏–Ω–∞ (–¥–≤–æ–±—ñ—á–Ω–æ), –º</label><input id="fwL" type="number" step="0.1" value="4"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div style="flex:1"><label>–î–æ–ø. –ø–∞–¥—ñ–Ω–Ω—è, %</label><input id="fwPct" type="number" step="0.1" value="3"></div>
          <div style="flex:1"><label>–¢–µ–º–ø. —Å–µ—Ä–µ–¥., ¬∞C</label><input id="fwT" type="number" step="1" value="25"></div>
        </div>
      </div>
      <div class="box">
        <h3>–ü—ñ–¥–±—ñ—Ä</h3>
        <p>–ú—ñ–Ω. –ø–µ—Ä–µ—Ç–∏–Ω S: <b><span id="fwS">‚Äî</span></b> –º–º¬≤</p>
        <p>–ó–∞–ø–æ–±—ñ–∂–Ω–∏–∫: <b><span id="fwFuse">‚Äî</span></b> –ê (–ø–æ–≤—ñ–ª—å–Ω–∏–π/–∞–≤—Ç–æ)</p>
        <p>–ó–∞–ø–∞—Å –ø–æ —Å—Ç—Ä—É–º—É: <b><span id="fwHead">‚Äî</span></b> %</p>
      </div>
      <div class="box">
        <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <div class="row">
          <button class="btn" onclick="calcAll()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="copyCSV('csv2')">üìã CSV (–ø—Ä–æ–≤—ñ–¥/–∑–∞—Ö–∏—Å—Ç)</button>
        </div>
        <div id="csv2" class="out" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- –ö–í–ò–¢–û–ö + NFC -->
  <div class="card">
    <h2>üßæ –ö–≤–∏—Ç–æ–∫ 58 –º–º —Ç–∞ NFC</h2>
    <div class="grid g2">
      <div class="box">
        <h3>NFC ‚Äî ‚ÄúElectrical test‚Äù</h3>
        <div class="row">
          <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞ ID</label><input id="nfcId" type="text" value="TR-001"></div>
          <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
          <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div id="nfcOut" class="out">‚Äî</div>
      </div>

      <div class="box">
        <h3>–ö–≤–∏—Ç–æ–∫ ‚Äú–ï–ª–µ–∫—Ç—Ä–æ—Ç–µ—Å—Ç‚Äù</h3>
        <div class="row">
          <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>
        <div class="ticket" id="ticket" style="margin-top:8px">
          <h4>–ï–õ–ï–ö–¢–†–û–¢–ï–°–¢</h4>
          <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
          <div class="line"></div>
          <p><b>U —Å–ø–æ–∫–æ—é:</b> <span id="tUR">‚Äî</span> –í ¬∑ <b>U –ø—É—Å–∫:</b> <span id="tUC">‚Äî</span> –í</p>
          <p><b>U –∑–∞—Ä—è–¥:</b> <span id="tUCH">‚Äî</span> –í ¬∑ <b>P –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞:</b> <span id="tAP">‚Äî</span> –∫–í—Ç</p>
          <div class="line"></div>
          <p><b>–ü–∞–¥—ñ–Ω–Ω—è U:</b> <span id="tVD">‚Äî</span> –í ( <span id="tVDp">‚Äî</span> % )</p>
          <p><b>–°–ø–æ–∫. —Å—Ç—Ä—É–º:</b> <span id="tIQ">‚Äî</span> –º–ê ¬∑ <b>–î–æ 50%:</b> <span id="tIQd">‚Äî</span> –¥—ñ–±</p>
          <div class="line"></div>
          <p><b>–î—Ä—ñ—Ç/–∑–∞–ø–æ–±.:</b> <span id="tW">‚Äî</span></p>
          <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- –•–Ü–î –†–û–ë–û–¢–ò + –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
  <div class="card">
    <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤) —Ç–∞ CSV</h2>
    <ol>
      <li>–í–≤–µ–¥–∏ –≤–∏–º—ñ—Ä–∏ –º—É–ª—å—Ç–∏–º–µ—Ç—Ä–∞: <b>U —Å–ø–æ–∫–æ—é, U –ø—ñ–¥ —á–∞—Å –ø—É—Å–∫—É, U –∑–∞—Ä—è–¥–∂–∞–Ω–Ω—è, I –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞</b>. –û—Ç—Ä–∏–º–∞–π –≤–∏—Å–Ω–æ–≤–æ–∫.</li>
      <li>–ü—Ä–æ—Ä–∞—Ö—É–π <b>–ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏</b> –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –¥–æ–≤–∂–∏–Ω–∏/–ø–µ—Ä–µ—Ä—ñ–∑—É/—Å—Ç—Ä—É–º—É ‚Üí –∑–≤—ñ—Ä —ñ–∑ –Ω–æ—Ä–º–æ—é.</li>
      <li>–û—Ü—ñ–Ω–∏ <b>—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è —É —Å–ø–æ–∫–æ—ó</b> —Ç–∞ —á–∞—Å –¥–æ 50% —î–º–Ω–æ—Å—Ç—ñ –ê–ö–ë.</li>
      <li>–ü—ñ–¥–±–µ—Ä–∏ <b>–ø–µ—Ä–µ—Ç–∏–Ω –¥—Ä–æ—Ç—É</b> —ñ <b>–∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫</b> –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.</li>
      <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>NFC</b> —ñ <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b>; —Å–∫–æ–ø—ñ—é–π <b>CSV</b> —É Sheets (<span class="mono">Electrics</span>).</li>
    </ol>
    <div class="row">
      <button class="btn" onclick="copyCSV('csvAll')">üìã CSV (—É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è)</button>
    </div>
    <div id="csvAll" class="out" style="margin-top:8px">‚Äî</div>
  </div>

  <div class="card">
    <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
    <table class="table">
      <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
      <tbody>
        <tr><td>–¢–µ—Å—Ç –ê–ö–ë/–ø—É—Å–∫/–∑–∞—Ä—è–¥ –≤–∏–∫–æ–Ω–∞–Ω–æ, –≤–∏—Å–Ω–æ–≤–∫–∏ –∞–¥–µ–∫–≤–∞—Ç–Ω—ñ</td><td>3</td></tr>
        <tr><td>–ü–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ, –Ω–æ—Ä–º–∏ –≤–∏—Ç—Ä–∏–º–∞–Ω–æ –∞–±–æ –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–æ —Ä—ñ—à–µ–Ω–Ω—è</td><td>3</td></tr>
        <tr><td>–°–ø–æ–∫—ñ–π–Ω–∏–π —Å—Ç—Ä—É–º —Ç–∞ –ø—ñ–¥–±—ñ—Ä –¥—Ä–æ—Ç—É/–∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫–∞ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω—ñ</td><td>3</td></tr>
        <tr><td>–ö–≤–∏—Ç–æ–∫/NFC + CSV</td><td>1</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // –†–µ–∂–∏–º –≤–±—É–¥—É–≤–∞–Ω–Ω—è –¥–ª—è Moodle
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const byId = id => document.getElementById(id);
  const rnd = (n,d=2)=>Number((+n).toFixed(d));

  // ===== –¢–µ—Å—Ç –ê–ö–ë/–ø—É—Å–∫/–∑–∞—Ä—è–¥ =====
  function batteryTest(){
    const uRest = +byId('uRest').value||0;
    const uCrank= +byId('uCrank').value||0;
    const uCharge=+byId('uCharge').value||0;
    const iAlt  = +byId('iAlt').value||0;
    const sysV  = +byId('sysV').value||12;

    let batState = '–Ω–æ—Ä–º–∞';
    if(uRest>=12.6 && uRest<=12.9) batState='–Ω–æ—Ä–º–∞';
    else if(uRest>=12.3) batState='–ø–æ—Ç—Ä–µ–±—É—î –ø—ñ–¥–∑–∞—Ä—è–¥—É';
    else batState='—Å–ª–∞–±–∫–∞/–∑–Ω–æ—à–µ–Ω–∞';

    let crankOK = (sysV===12? (uCrank>=9.6) : (uCrank>=19.2)) ? '–Ω–æ—Ä–º–∞' : '–Ω–∏–∑—å–∫–æ (–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ê–ö–ë/—Å—Ç–∞—Ä—Ç–µ—Ä/–∫–∞–±–µ–ª—ñ)';
    let chargeOK= (uCharge>=13.8 && uCharge<=14.6) ? '–Ω–æ—Ä–º–∞' : (uCharge<13.5? '–Ω–µ–¥–æ–∑–∞—Ä—è–¥ (—Ä–µ–≥—É–ª—è—Ç–æ—Ä/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä)':'–ø–µ—Ä–µ–∑–∞—Ä—è–¥ (—Ä–µ–≥—É–ª—è—Ç–æ—Ä)');
    const altPower = rnd((uCharge>0?uCharge:(sysV))*iAlt/1000,2);

    byId('batState').textContent = batState;
    byId('crankOK').textContent = crankOK;
    byId('chargeOK').textContent = chargeOK;
    byId('altPower').textContent = altPower;

    const csv = [
      `TEST|Urest=${uRest}V|Ucrank=${uCrank}V|Ucharge=${uCharge}V|Ialt=${iAlt}A|AltPower=${altPower}kW|Sys=${sysV}V`,
      `STATE|Battery=${batState}|Crank=${crankOK}|Charge=${chargeOK}`
    ].join('\n');
    byId('csv1').textContent = csv;

    return {uRest,uCrank,uCharge,iAlt,sysV,altPower,batState,crankOK,chargeOK};
  }

  // ===== –ü–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ =====
  function voltageDrop(){
    const I = +byId('vdI').value||0;
    const L = +byId('vdL').value||0;     // —Ç—É–¥–∏-–Ω–∞–∑–∞–¥
    const S = +byId('vdS').value||0;     // –º–º¬≤
    const sysV=+byId('sysV').value||12;
    const rho = 0.0175; // –º–û–º¬∑–º–º¬≤/–º (–º—ñ–¥—å) ‚Üí 0.0175 –û–º¬∑–º–º¬≤/–º / 1000? –ù—ñ: 0.0175 –û–º¬∑–º–º¬≤/–º —Ü–µ –ºŒ©*? –ü—Ä–∏–π–º–∞—î–º–æ 0.0175 –û–º¬∑–º–º¬≤/–º

    // R = œÅ * L / S, –¥–µ œÅ (–û–º*–º–º¬≤/–º)
    const R = (S>0)? (rho*L/S) : 0; // –û–º
    const Ud = I * R;               // –í
    const UdPct = sysV>0? (Ud/sysV*100) : 0;

    const limitPct = +byId('vdPct').value||3;
    const flag = UdPct<=limitPct ? '–æ–∫' : '–∑–∞–≤–µ–ª–∏–∫–µ (–∑–±—ñ–ª—å—à–∏—Ç–∏ S –∞–±–æ –∑–º–µ–Ω—à–∏—Ç–∏ –¥–æ–≤–∂–∏–Ω—É)';

    // –ü—ñ–¥–±—ñ—Ä –ø–µ—Ä–µ—Ç–∏–Ω—É –∑ –ø–µ—Ä–µ–ª—ñ–∫—É
    const list = (byId('vdList').value||'').split(',').map(s=>+s.trim()).filter(x=>x>0).sort((a,b)=>a-b);
    let rec='‚Äî';
    for(const s of list){
      const r2 = rho*L/s; const u2 = I*r2; const p2 = sysV>0? (u2/sysV*100):0;
      if(p2<=limitPct){ rec = s; break; }
    }

    byId('vdR').textContent = rnd(R,4);
    byId('vdU').textContent = rnd(Ud,3);
    byId('vdUp').textContent= rnd(UdPct,2);
    byId('vdFlag').textContent = flag;
    byId('vdRec').textContent  = rec;

    return {I,L,S,R,Ud,UdPct,flag,rec};
  }

  // ===== –°–ø–æ–∫—ñ–π–Ω–∏–π —Å—Ç—Ä—É–º =====
  function quiescent(){
    const iq = +byId('iqmA').value||0; // –º–ê
    const hours = +byId('iqH').value||24;
    const capAh = +byId('capAh').value||60;

    const daily = rnd((iq/1000)*hours,2); // –ê¬∑–≥–æ–¥/–¥–æ–±—É
    const daysTo50 = (capAh*0.5)/((iq/1000)*24 || 1e-9);
    let flag = iq<=30? '–æ–∫' : (iq<=50? '–Ω–∞ –º–µ–∂—ñ' : '–∑–∞–≤–µ–ª–∏–∫–µ (—à—É–∫–∞—Ç–∏ –≤–∏—Ç—ñ–∫)');

    byId('iqDaily').textContent = daily;
    byId('iqDays').textContent  = rnd(daysTo50,1);
    byId('iqFlag').textContent  = flag;

    return {iq,hours,capAh,daily,daysTo50,flag};
  }

  // ===== –î—Ä—ñ—Ç/–∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫ =====
  function wireFuse(){
    const I = +byId('fwI').value||0;
    const L = +byId('fwL').value||0;
    const pct = +byId('fwPct').value||3;
    const sysV= +byId('sysV').value||12;
    const rho = 0.0175; // –û–º¬∑–º–º¬≤/–º
    // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –ø–µ—Ä–µ—Ç–∏–Ω –∑–∞ –ø–∞–¥—ñ–Ω–Ω—è–º U: I*œÅ*L/S <= pct%*U  ‚Üí S >= I*œÅ*L / (pct%*U)
    const Smin = (pct>0 && sysV>0) ? (I*rho*L)/((pct/100)*sysV) : 0;

    // –¢–∏–ø–æ–≤—ñ –¥–æ–ø—É—Å—Ç–∏–º—ñ —Å—Ç—Ä—É–º–∏ (–æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–æ, –∞–≤—Ç–æ): 1.5–º–º¬≤~15–ê, 2.5–º–º¬≤~21–ê, 4–º–º¬≤~28–ê, 6–º–º¬≤~36–ê, 10–º–º¬≤~50–ê, 16–º–º¬≤~70–ê, 25–º–º¬≤~95–ê
    const table = [{s:1.5,a:15},{s:2.5,a:21},{s:4,a:28},{s:6,a:36},{s:10,a:50},{s:16,a:70},{s:25,a:95},{s:35,a:120}];
    let Srec = Math.max(Smin,1.5);
    for(const t of table){ if(t.a>=I){ Srec = Math.max(Smin,t.s); break; } }

    // –ó–∞–ø–æ–±—ñ–∂–Ω–∏–∫: 125‚Äì150% –≤—ñ–¥ —Ä–æ–±–æ—á–æ–≥–æ —Å—Ç—Ä—É–º—É, –∞–ª–µ ‚â§ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–ª—è –¥—Ä–æ—Ç—É
    const fuseNom = Math.min(Math.ceil(I*1.25/5)*5, // –æ–∫—Ä—É–≥–ª–∏—Ç–∏ –¥–æ –Ω–∞–π–±–ª–∏–∂—á–∏—Ö 5–ê
                             (table.find(t=>t.s>=Srec)||table[table.length-1]).a);
    const headroom = rnd(( ( (table.find(t=>t.s>=Srec)||table[table.length-1]).a - I )/I )*100,0);

    byId('fwS').textContent = rnd(Srec,1);
    byId('fwFuse').textContent = fuseNom;
    byId('fwHead').textContent = isFinite(headroom)? headroom : '‚Äî';

    const csv = `WIRE|I=${I}A|L=${L}m|pct=${pct}%|Sys=${sysV}V|Smin=${rnd(Smin,2)}mm2|Srec=${rnd(Srec,1)}mm2|Fuse=${fuseNom}A|Headroom=${headroom}%`;
    byId('csv2').textContent = csv;

    return {I,L,pct,sysV,Smin,Srec,fuseNom,headroom};
  }

  // ===== –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è, –∫–≤–∏—Ç–æ–∫, NFC, CSV =====
  function calcAll(){
    const t = batteryTest();
    const v = voltageDrop();
    const q = quiescent();
    const w = wireFuse();

    // –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–∏–π CSV
    const all = [
      byId('csv1').textContent.trim(),
      byId('csv2').textContent.trim(),
      `VDROP|I=${v.I}A|L=${v.L}m|S=${v.S}mm2|Ud=${rnd(v.Ud,3)}V|UdPct=${rnd(v.UdPct,2)}%|RecS=${v.rec}`,
      `QUIESCENT|Iq=${q.iq}mA|Daily=${q.daily}Ah|Days50=${rnd(q.daysTo50,1)}|Flag=${q.flag}`
    ].join('\n');
    byId('csvAll').textContent = all;
  }

  function buildTicket(){
    const t = batteryTest(), v = voltageDrop(), q = quiescent(), w = wireFuse();
    const d = new Date().toISOString().slice(0,10);
    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${d}</small>`;
    byId('tUR').textContent = t.uRest;
    byId('tUC').textContent = t.uCrank;
    byId('tUCH').textContent= t.uCharge;
    byId('tAP').textContent = t.altPower;
    byId('tVD').textContent = rnd(v.Ud,3);
    byId('tVDp').textContent= rnd(v.UdPct,2);
    byId('tIQ').textContent = (+byId('iqmA').value||0);
    byId('tIQd').textContent= rnd(q.daysTo50,1);
    byId('tW').textContent  = `${rnd(w.Srec,1)} –º–º¬≤ / ${w.fuseNom} –ê`;
    byId('tNote').textContent= `–ê–ö–ë: ${t.batState}; –ü—É—Å–∫: ${t.crankOK}; –ó–∞—Ä—è–¥: ${t.chargeOK}`;
  }

  function buildNFC(){
    const t = batteryTest(), v = voltageDrop(), q = quiescent(), w = wireFuse();
    const text = [
      `ELECTRIC_NFC`,
      `MACHINE:${byId('nfcId').value}`,
      `CONTACT:${byId('nfcPhone').value}`,
      `Urest:${t.uRest}V; Ucrank:${t.uCrank}V; Ucharge:${t.uCharge}V; AltP:${t.altPower}kW`,
      `VDROP:${rnd(v.Ud,3)}V(${rnd(v.UdPct,2)}%); RecS:${v.rec}mm2`,
      `QUIET:${q.iq}mA; D50:${rnd(q.daysTo50,1)}d`,
      `WIRE:${rnd(w.Srec,1)}mm2; FUSE:${w.fuseNom}A`,
      `STAMP:${new Date().toISOString().slice(0,19).replace('T',' ')}`
    ].join('\n');
    byId('nfcOut').textContent = text;
  }

  function copyCSV(id){
    const t = document.getElementById(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  function preset(){
    byId('uRest').value = 12.48;
    byId('uCrank').value= 10.2;
    byId('uCharge').value=14.1;
    byId('iAlt').value  = 55;
    byId('capAh').value = 100;
    byId('vdI').value   = 160;
    byId('vdL').value   = 4.0;
    byId('vdS').value   = 35;
    byId('iqmA').value  = 42;
    byId('fwI').value   = 28;
    byId('fwL').value   = 3.0;
    byId('fwPct').value = 3;
    calcAll();
  }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){ calcAll(); })();

  // –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –±—É–¥—å-—è–∫–∏—Ö –ø–æ–ª—ñ–≤
  document.addEventListener('change', e=>{
    if(e.target.matches('input,select,textarea')) calcAll();
  });
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>

</body>
</html>
