<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 16 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî Arduino: —Ç–∞—Ö–æ–º–µ—Ç—Ä –í–í–ü/—à–∫—ñ–≤—ñ–≤ ‚Üí RPM, –∫–æ–≤–∑–∞–Ω–Ω—è —Ä–µ–º–µ–Ω—è %, –∞–ª–µ—Ä—Ç–∏, –µ–∫—Å–ø–æ—Ä—Ç</title>
<meta name="description" content="–û–ø—Ç–∏—á–Ω–∏–π/–•–æ–ª–ª–∞ —Ç–∞—Ö–æ–º–µ—Ç—Ä: RPM –æ–¥–Ω–æ–≥–æ –∞–±–æ –¥–≤–æ—Ö –≤–∞–ª—ñ–≤, –∫–æ–≤–∑–∞–Ω–Ω—è —Ä–µ–º–µ–Ω—è %, –∂–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫, –∞–ª–µ—Ä—Ç–∏, —á–µ–∫ 58 –º–º, CSV/TXT, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏ (.ino).">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;white-space:pre-wrap}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:260px}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.small{font-size:.9rem}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
</style>
<link rel="canonical" href="https://edlab.pp.ua/mech_II_kyrs/mechanic_para16.html"><meta property="og:type" content="article"><meta property="og:title" content="–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 16"><meta property="og:description" content="–ú–µ—Ç–∞: –∑—ñ–±—Ä–∞—Ç–∏ —Ç–∞—Ö–æ–º–µ—Ç—Ä –¥–ª—è –≤–∞–ª—É –í–í–ü –∞–±–æ —à–∫—ñ–≤—ñ–≤ –Ω–∞ –æ–ø—Ç–∏—á–Ω–æ–º—É –¥–∞—Ç—á–∏–∫—É (TCRT5000) —á–∏ –¥–∞—Ç—á–∏–∫—É –•–æ–ª–ª–∞ (A3144+–º–∞–≥–Ω—ñ—Ç), –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ RPM –æ–¥–Ω–æ–≥–æ/–¥–≤–æ—Ö –≤–∞–ª—ñ–≤, –æ–±—á–∏—Å–ª—é–≤–∞"><meta property="og:url" content="https://edlab.pp.ua/mech_II_kyrs/mechanic_para16.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ú–µ—Ö–∞–Ω—ñ–∑–∞—Ü—ñ—è ‚Äî –ü–∞—Ä–∞ 16","description":"–ú–µ—Ç–∞: –∑—ñ–±—Ä–∞—Ç–∏ —Ç–∞—Ö–æ–º–µ—Ç—Ä –¥–ª—è –≤–∞–ª—É –í–í–ü –∞–±–æ —à–∫—ñ–≤—ñ–≤ –Ω–∞ –æ–ø—Ç–∏—á–Ω–æ–º—É –¥–∞—Ç—á–∏–∫—É (TCRT5000) —á–∏ –¥–∞—Ç—á–∏–∫—É –•–æ–ª–ª–∞ (A3144+–º–∞–≥–Ω—ñ—Ç), –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ RPM –æ–¥–Ω–æ–≥–æ/–¥–≤–æ—Ö –≤–∞–ª—ñ–≤, –æ–±—á–∏—Å–ª—é–≤–∞","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/mech_II_kyrs/mechanic_para16.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">‚öôÔ∏è</span>
      <div>
        <b>–ü–∞—Ä–∞ 16 ‚Äî Arduino: —Ç–∞—Ö–æ–º–µ—Ç—Ä –í–í–ü/—à–∫—ñ–≤—ñ–≤</b><br>
        <span class="badge">–û–ø—Ç–æ–ø–∞—Ä–∞/–•–æ–ª–ª ‚Üí RPM1/RPM2 ‚Üí –∫–æ–≤–∑–∞–Ω–Ω—è —Ä–µ–º–µ–Ω—è (%) ‚Üí –≥—Ä–∞—Ñ—ñ–∫ ‚Üí –∞–ª–µ—Ä—Ç–∏ ‚Üí –µ–∫—Å–ø–æ—Ä—Ç</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">–ú–µ—Ç–∞: –∑—ñ–±—Ä–∞—Ç–∏ <b>—Ç–∞—Ö–æ–º–µ—Ç—Ä</b> –¥–ª—è –≤–∞–ª—É –í–í–ü –∞–±–æ —à–∫—ñ–≤—ñ–≤ –Ω–∞ <b>–æ–ø—Ç–∏—á–Ω–æ–º—É –¥–∞—Ç—á–∏–∫—É (TCRT5000)</b> —á–∏ <b>–¥–∞—Ç—á–∏–∫—É –•–æ–ª–ª–∞ (A3144+–º–∞–≥–Ω—ñ—Ç)</b>, –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ <b>RPM</b> –æ–¥–Ω–æ–≥–æ/–¥–≤–æ—Ö –≤–∞–ª—ñ–≤, –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ <b>–∫–æ–≤–∑–∞–Ω–Ω—è —Ä–µ–º–µ–Ω—è %</b> –≤—ñ–¥–Ω–æ—Å–Ω–æ –æ—á—ñ–∫—É–≤–∞–Ω–æ–≥–æ –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω–æ–≥–æ, —Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ <b>—Ç—Ä–∏–≤–æ–≥–∏</b>, –±—É–¥—É–≤–∞—Ç–∏ <b>–∂–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫</b> —ñ —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ <b>—á–µ–∫ 58 –º–º</b> —Ç–∞ CSV.</p>

  <div class="card">
    <h2>üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
    <div class="row">
      <div style="flex:1">
        <label>–°–µ–Ω—Å–æ—Ä 1 (–ø—Ä–∏–≤—ñ–¥)</label>
        <select id="s1" class="input"><option>–û–ø—Ç–∏—á–Ω–∏–π (–±—ñ–ª–∏–π –º–∞—Ä–∫–µ—Ä)</option><option selected="">–•–æ–ª–ª–∞ (–º–∞–≥–Ω—ñ—Ç)</option></select>
      </div>
      <div style="flex:1">
        <label>–°–µ–Ω—Å–æ—Ä 2 (–≤–µ–¥–µ–Ω–∏–π)</label>
        <select id="s2" class="input"><option>–ù–µ–º–∞—î</option><option selected="">–û–ø—Ç–∏—á–Ω–∏–π (–±—ñ–ª–∏–π –º–∞—Ä–∫–µ—Ä)</option><option>–•–æ–ª–ª–∞ (–º–∞–≥–Ω—ñ—Ç)</option></select>
      </div>
      <div style="flex:1">
        <label>–ü—ñ–Ω–∏ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å (UNO):</label>
        <select id="pin1" class="input"><option value="2" selected="">D2</option><option value="3">D3</option></select>
      </div>
      <div style="flex:1">
        <label>–î—Ä—É–≥–∏–π –ø—ñ–Ω:</label>
        <select id="pin2" class="input"><option value="-1" selected="">‚Äî</option><option value="3">D3</option><option value="2">D2</option></select>
      </div>
    </div>

    <div class="row">
      <div style="flex:1">
        <label>–Ü–º–ø—É–ª—å—Å—ñ–≤/–æ–±–µ—Ä—Ç (–≤–∞–ª 1)</label>
        <input id="ppr1" class="input" type="number" min="1" step="1" value="1">
      </div>
      <div style="flex:1">
        <label>–Ü–º–ø—É–ª—å—Å—ñ–≤/–æ–±–µ—Ä—Ç (–≤–∞–ª 2)</label>
        <input id="ppr2" class="input" type="number" min="1" step="1" value="1">
      </div>
      <div style="flex:1">
        <label>–î—ñ–∞–º–µ—Ç—Ä —à–∫—ñ–≤–∞ –ø—Ä–∏–≤—ñ–¥–Ω–æ–≥–æ, –º–º (D1)</label>
        <input id="d1" class="input" type="number" min="10" step="1" value="150">
      </div>
      <div style="flex:1">
        <label>–î—ñ–∞–º–µ—Ç—Ä —à–∫—ñ–≤–∞ –≤–µ–¥–µ–Ω–æ–≥–æ, –º–º (D2)</label>
        <input id="d2" class="input" type="number" min="10" step="1" value="300">
      </div>
    </div>

    <div class="row">
      <div style="flex:1">
        <label>–í—ñ–∫–Ω–æ —É—Å–µ—Ä–µ–¥–Ω–µ–Ω–Ω—è, –º—Å</label>
        <input id="win" class="input" type="number" min="100" step="100" value="500">
      </div>
      <div style="flex:1">
        <label>–î–µ–±–∞—É–Ω—Å, –º–∫—Å</label>
        <input id="deb" class="input" type="number" min="0" step="50" value="200">
      </div>
      <div style="flex:1">
        <label>–ü–æ—Ä—ñ–≥ —Ç—Ä–∏–≤–æ–≥–∏ (SLIP %)</label>
        <input id="thr" class="input" type="number" step="0.5" value="3.0">
      </div>
      <div style="flex:1">
        <label>–ú—ñ—Ç–∫–∞ —Ä–æ–±–æ—Ç–∏</label>
        <input id="job" class="input" placeholder="–¢–û –ø—Ä–∏–≤–æ–¥—É –∂–∞—Ç–∫–∏ / –í–í–ü 540 –æ–±/—Ö–≤">
      </div>
    </div>
  </div>

  <div class="card">
    <h2>üß™ –ï–º—É–ª—è—Ç–æ—Ä (–±–µ–∑ ¬´–∑–∞–ª—ñ–∑–∞¬ª)</h2>
    <div class="row">
      <label><input id="emu" type="checkbox"> –£–≤—ñ–º–∫–Ω—É—Ç–∏ –µ–º—É–ª—è—Ç–æ—Ä</label>
      <label style="flex:1">RPM –≤–∞–ª 1 <input id="rpm1s" class="input" type="range" min="100" max="2500" step="10" value="540" disabled=""></label>
      <label style="flex:1">RPM –≤–∞–ª 2 <input id="rpm2s" class="input" type="range" min="50" max="2000" step="10" value="270" disabled=""></label>
      <button class="btn" id="tick">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ—á–∫—É</button>
      <button class="btn secondary" id="clear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      <span id="stat" class="badge">–°—Ç–∞—Ç—É—Å: ‚Äî</span>
    </div>
  </div>

  <div class="card">
    <h2>üìà –ñ–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫</h2>
    <div class="canvasWrap"><canvas id="chart" width="1000" height="260"></canvas></div>
    <div class="row small" style="margin-top:8px">
      <span class="badge">–û—á—ñ–∫. –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω–µ (–±–µ–∑ –∫–æ–≤–∑–∞–Ω–Ω—è): n2* = n1 √ó D1/D2</span>
      <span id="last" class="badge">RPM1=‚Äî, RPM2=‚Äî, SLIP=‚Äî%</span>
    </div>
  </div>

  <div class="card">
    <h2>üß© –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥ (Arduino .ino)</h2>
    <div class="row">
      <button class="btn good" id="gen">‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É</button>
      <button class="btn secondary" id="copy">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      <button class="btn secondary" id="dl">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .ino</button>
    </div>
    <pre class="code" id="code">// –ù–∞—Ç–∏—Å–Ω–∏ ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É¬ª ‚Üë</pre>
  </div>

  <div class="card">
    <h2>üíæ –ü—Ä–æ—Ç–æ–∫–æ–ª —ñ –µ–∫—Å–ø–æ—Ä—Ç</h2>
    <div class="row">
      <input id="fio" class="input" placeholder="–ü–Ü–ë –º–µ—Ö–∞–Ω—ñ–∫–∞">
      <button class="btn" id="saveTxt">üíæ TXT</button>
      <button class="btn" id="saveCsv">üìÑ CSV</button>
      <button class="btn" id="receipt">üñ®Ô∏è 58 –º–º —á–µ–∫</button>
    </div>
    <div id="rc" class="receipt" hidden=""></div>
  </div>

  <div class="card">
    <h2>üîå –°—Ö–µ–º–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (SVG)</h2>
    <svg viewBox="0 0 900 320" role="img" aria-label="Arduino + A3144/TCRT5000">
      <!-- Arduino -->
      <rect x="40" y="40" width="220" height="140" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
      <text x="150" y="65" fill="#e5e7eb" font-size="16" text-anchor="middle">Arduino UNO/Nano</text>
      <text x="55" y="95" fill="#93c5fd" font-size="12">5V</text>
      <text x="55" y="115" fill="#93c5fd" font-size="12">GND</text>
      <text x="55" y="135" fill="#93c5fd" font-size="12">D2 (INT0)</text>
      <text x="55" y="155" fill="#93c5fd" font-size="12">D3 (INT1)</text>
      <!-- Hall A3144 -->
      <rect x="320" y="40" width="200" height="90" rx="12" fill="#14532d" stroke="#22c55e"></rect>
      <text x="420" y="65" fill="#dcfce7" font-size="15" text-anchor="middle">A3144 (–•–æ–ª–ª–∞)</text>
      <text x="420" y="85" fill="#a7f3d0" font-size="12" text-anchor="middle">VCC ‚Äî OUT ‚Äî GND (–ø–æ—Ç—Ä—ñ–±–µ–Ω pull-up)</text>
      <!-- Opto -->
      <rect x="320" y="150" width="200" height="90" rx="12" fill="#7c2d12" stroke="#fb923c"></rect>
      <text x="420" y="175" fill="#fed7aa" font-size="15" text-anchor="middle">TCRT5000 (–æ–ø—Ç–∏—á–Ω–∏–π)</text>
      <text x="420" y="195" fill="#fed7aa" font-size="12" text-anchor="middle">VCC ‚Äî OUT ‚Äî GND</text>
      <!-- Resistor -->
      <line x1="260" y1="130" x2="320" y2="70" stroke="#fbbf24" stroke-width="2"></line>
      <rect x="300" y="60" width="20" height="10" fill="#fbbf24"></rect>
      <text x="340" y="68" fill="#fde68a" font-size="12">10k Œ© pull-up</text>
      <!-- Wires -->
      <line x1="260" y1="90" x2="320" y2="60" stroke="#93c5fd" stroke-width="3"></line><text x="280" y="80" fill="#93c5fd" font-size="12">5V ‚Üí VCC</text>
      <line x1="260" y1="110" x2="320" y2="100" stroke="#64748b" stroke-width="3"></line><text x="280" y="110" fill="#94a3b8" font-size="12">GND ‚Üí GND</text>
      <line x1="260" y1="130" x2="320" y2="80" stroke="#22c55e" stroke-width="3"></line><text x="280" y="95" fill="#86efac" font-size="12">D2 ‚Üí OUT (—Å–µ–Ω—Å–æ—Ä 1)</text>
      <line x1="260" y1="150" x2="320" y2="190" stroke="#38bdf8" stroke-width="3"></line><text x="280" y="160" fill="#93c5fd" font-size="12">D3 ‚Üí OUT (—Å–µ–Ω—Å–æ—Ä 2)</text>
      <text x="120" y="210" fill="#fbbf24" font-size="12">‚ö†Ô∏è –ú–∞—Ä–∫–µ—Ä: –±—ñ–ª–∞/—Å—Ä—ñ–±–Ω–∞ —Å–º—É–∂–∫–∞ –∞–±–æ –º–∞–≥–Ω—ñ—Ç ‚Äî 1 —ñ–º–ø./–æ–±–µ—Ä—Ç</text>
    </svg>
    <div class="note small" style="margin-top:8px">
      <b>–ü–æ—Ä–∞–¥–∏:</b> –æ–ø—Ç–∏—á–Ω–∏–π –¥–∞—Ç—á–∏–∫ –ø—Ä–∞—Ü—é—î –∫—Ä–∞—â–µ –∑ –º–∞—Ç–æ–≤–∏–º –±—ñ–ª–∏–º –º–∞—Ä–∫–µ—Ä–æ–º; –•–æ–ª–ª–∞ ‚Äî –∑ –Ω–µ–æ–¥–∏–º–æ–≤–∏–º –º–∞–≥–Ω—ñ—Ç–æ–º √ò6‚Äì8 –º–º. –¢—Ä–∏–º–∞–π –∑–∞–∑–æ—Ä 2‚Äì3 –º–º, –∑–∞—Ö–∏—Å—Ç–∏ –≤—ñ–¥ –ø–∏–ª—É. –î–ª—è –í–í–ü 540/1000 –æ–±/—Ö–≤ –¥–æ—Ç—Ä–∏–º—É–π—Å—è –±–µ–∑–ø–µ—á–Ω–æ—ó –≤—ñ–¥—Å—Ç–∞–Ω—ñ!
    </div>
  </div>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>–ì—Ä–∞—Ñ—ñ–∫ RPM1/RPM2 —ñ SLIP% (—Å–∫—Ä—ñ–Ω).</li>
      <li>CSV-–ª–æ–≥ 2‚Äì3 —Ö–≤ —ñ–∑ —Ç—Ä–∏–≤–æ–≥–∞–º–∏.</li>
      <li>–ü–æ—è—Å–Ω–∏ –≤–ø–ª–∏–≤ –Ω–∞—Ç—è–≥—É —Ä–µ–º–µ–Ω—è/–ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ—Å—Ç—ñ —à–∫—ñ–≤—ñ–≤ –Ω–∞ –∫–æ–≤–∑–∞–Ω–Ω—è —Ç–∞ 1X/2X –≤—ñ–±—Ä–∞—Ü—ñ—ó.</li>
    </ul>
  </div>

  <div class="card">
    <h2>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
    <p class="muted small">–ü–µ—Ä—à—ñ —Ç–∞—Ö–æ–º–µ—Ç—Ä–∏ —É —Å/–≥ —Ç–µ—Ö–Ω—ñ—Ü—ñ –±—É–ª–∏ –º–µ—Ö–∞–Ω—ñ—á–Ω–∏–º–∏ –∑ –≥–Ω—É—á–∫–∏–º –≤–∞–ª–æ–º. –°—å–æ–≥–æ–¥–Ω—ñ –¥–µ—à–µ–≤–∏–π –¥–∞—Ç—á–∏–∫ –•–æ–ª–ª–∞/–æ–ø—Ç–æ–ø–∞—Ä–∞ –∑ Arduino –¥–∞—î —Ç–æ—á–Ω—ñ—Å—Ç—å –¥–æ –æ–¥–∏–Ω–∏—Ü—å –æ–±/—Ö–≤, –∞ –∫–æ–≤–∑–∞–Ω–Ω—è —Ä–µ–º–µ–Ω—è –≤–∏–¥–Ω–æ ¬´–≤–∂–∏–≤—É¬ª, –ø–µ—Ä—à –Ω—ñ–∂ –∑–∞–ø–∞—Ö–Ω–µ –≥—É–º–æ—é.</p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}

// ===== –°—Ç–∞–Ω —ñ –∑–º—ñ–Ω–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∞ =====
const cvs=$('#chart'), ctx=cvs.getContext('2d');
const series=[]; // {t, rpm1, rpm2, slip, alarm}
let t0=Date.now();

// –ï–º—É–ª—è—Ç–æ—Ä
const emu=$('#emu'), rpm1s=$('#rpm1s'), rpm2s=$('#rpm2s');
emu.addEventListener('change',()=>{ rpm1s.disabled=rpm2s.disabled=!emu.checked; });

function expectedRatio(){ const D1=parseFloat($('#d1').value)||1, D2=parseFloat($('#d2').value)||1; return D1/D2; }
function addPoint(r1, r2){
  const n1=parseFloat(r1)||0, n2=parseFloat(r2)||0;
  const ratio=expectedRatio();
  const n2exp = n1 * ratio * (parseFloat($('#ppr1').value)||1)/(parseFloat($('#ppr2').value)||1) * (parseFloat($('#ppr2').value)||1)/(parseFloat($('#ppr1').value)||1); // —Å–∫–æ—Ä–æ—á—É—î—Ç—å—Å—è ‚Üí n1*D1/D2
  const slip = (n2exp>0)? (100*(n2exp - n2)/n2exp) : 0;
  const thr=parseFloat($('#thr').value)||3;
  const alarm = (Math.abs(slip)>=thr);
  series.push({t:Date.now(), rpm1:n1, rpm2:n2, slip, alarm});
  if(series.length>600) series.shift();
  $('#last').textContent = `RPM1=${n1.toFixed(0)}, RPM2=${n2>0?n2.toFixed(0):'‚Äî'}, SLIP=${isFinite(slip)?slip.toFixed(2):'‚Äî'}%`;
  $('#stat').textContent = alarm? '–°—Ç–∞—Ç—É—Å: ‚ö†Ô∏è –∫–æ–≤–∑–∞–Ω–Ω—è' : '–°—Ç–∞—Ç—É—Å: –æ–∫';
  draw();
}

// –ú–∞–ª—é–≤–∞–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞
function draw(){
  const W=cvs.width,H=cvs.height;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#223049'; ctx.strokeRect(0.5,0.5,W-1,H-1);
  if(series.length<2) return;
  const maxN=300; const s=series.slice(-maxN);
  const rpmMax = Math.max(100, Math.max(...s.map(o=>Math.max(o.rpm1, o.rpm2||0))) * 1.2);
  const slipMax = Math.max(5, Math.max(...s.map(o=>Math.abs(o.slip))) * 1.2);

  const xs=s.map((_,i)=> 60 + i*((W-80)/(maxN-1)));

  // –°—ñ—Ç–∫–∞
  ctx.fillStyle='#94a3b8'; ctx.font='12px ui-monospace';
  ctx.fillText('RPM', 12, 14); ctx.fillText('SLIP %', 12, 28);

  // RPM1 (–±–ª–∞–∫–∏—Ç–Ω–∏–π)
  ctx.beginPath(); ctx.strokeStyle='#38bdf8'; ctx.lineWidth=2;
  xs.forEach((x,i)=>{ const y=H-10-(s[i].rpm1/rpmMax)*(H-20); i?ctx.lineTo(x,y):ctx.moveTo(x,y); }); ctx.stroke();

  // RPM2 (–∑–µ–ª–µ–Ω–∏–π) —è–∫—â–æ —î
  ctx.beginPath(); ctx.strokeStyle='#22c55e'; ctx.lineWidth=2;
  xs.forEach((x,i)=>{ const v=s[i].rpm2||0; const y=H-10-(v/rpmMax)*(H-20); i?ctx.lineTo(x,y):ctx.moveTo(x,y); }); ctx.stroke();

  // SLIP % —è–∫ –¥—Ä—É–≥–∞ —à–∫–∞–ª–∞ (–∂–æ–≤—Ç–∞)
  ctx.beginPath(); ctx.strokeStyle='#fbbf24'; ctx.lineWidth=1.7;
  xs.forEach((x,i)=>{ const y=H-10-(Math.min(slipMax,Math.max(-slipMax,s[i].slip))/slipMax)*(H-20); i?ctx.lineTo(x,y):ctx.moveTo(x,y); }); ctx.stroke();

  // –ü–æ—Ä—ñ–≥ SLIP
  const thr=parseFloat($('#thr').value)||3;
  const yThr=H-10-(thr/slipMax)*(H-20);
  const yThrN=H-10-(-thr/slipMax)*(H-20);
  ctx.setLineDash([6,4]); ctx.strokeStyle='#fbbf24'; ctx.beginPath(); ctx.moveTo(60,yThr); ctx.lineTo(W-10,yThr); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(60,yThrN); ctx.lineTo(W-10,yThrN); ctx.stroke(); ctx.setLineDash([]);

  // –ú–∞—Ä–∫–µ—Ä–∏ —Ç—Ä–∏–≤–æ–≥
  s.forEach((o,i)=>{ if(o.alarm){ const x=xs[i], y=H-14; ctx.fillStyle='#f87171'; ctx.fillRect(x-2,y,4,4); } });
}

$('#tick').addEventListener('click', ()=>{
  if(emu.checked){
    addPoint(parseFloat(rpm1s.value), parseFloat(rpm2s.value));
  }else{
    const a=prompt('–í–≤–µ–¥–∏ RPM –≤–∞–ª 1:','540'); if(a===null) return;
    const b=prompt('–í–≤–µ–¥–∏ RPM –≤–∞–ª 2 (—è–∫—â–æ —î):','270'); if(b===null) return;
    addPoint(parseFloat(a), parseFloat(b));
  }
});
$('#clear').addEventListener('click', ()=>{ series.length=0; $('#last').textContent='RPM1=‚Äî, RPM2=‚Äî, SLIP=‚Äî%'; draw(); });

// ===== –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏ =====
function makeSketch(){
  const pin1=parseInt($('#pin1').value,10);
  const pin2=parseInt($('#pin2').value,10);
  const ppr1=parseInt($('#ppr1').value,10)||1;
  const ppr2=parseInt($('#ppr2').value,10)||1;
  const win =parseInt($('#win').value,10)||500;
  const deb =parseInt($('#deb').value,10)||200;

  const dual = (pin2===2 || pin2===3);

  const code=`/*
  –ü–∞—Ä–∞ 16 ‚Äî Arduino —Ç–∞—Ö–æ–º–µ—Ç—Ä (–æ–ø—Ç–æ–ø–∞—Ä–∞/–•–æ–ª–ª–∞), 1‚Äì2 –∫–∞–Ω–∞–ª–∏
  –í–∏–º—ñ—Ä: RPM –ø–æ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É —ñ–º–ø—É–ª—å—Å—ñ–≤ —É –≤—ñ–∫–Ω—ñ ${win} –º—Å + –≤—ñ–¥—Å—ñ–∫–∞–Ω–Ω—è —ñ–º–ø—É–ª—å—Å—ñ–≤ –º–µ–Ω—à–µ ${deb} –º–∫—Å (debounce).
  CSV: millis,RPM1,RPM2
  ‚ö† –ë–µ–∑–ø–µ–∫–∞: –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –ø–æ–¥–∞–ª—ñ –≤—ñ–¥ –æ–±–µ—Ä—Ç–æ–≤–∏—Ö –≤—É–∑–ª—ñ–≤, —Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ —Å–µ–Ω—Å–æ—Ä!
*/
volatile unsigned long lastMicros1=0${dual?', lastMicros2=0':''};
volatile unsigned long cnt1=0${dual?', cnt2=0':''};
const byte PIN1=${pin1};${dual?'\nconst byte PIN2='+pin2+';':''}
const byte PPR1=${ppr1};${dual?'\nconst byte PPR2='+ppr2+';':''}
const unsigned long DEB=${deb}; // –º–∫—Å
const unsigned long WIN=${win}; // –º—Å

void IRAM_ATTR isr1(){
  unsigned long now=micros();
  if(now - lastMicros1 >= DEB){ cnt1++; lastMicros1=now; }
}
${dual?`void IRAM_ATTR isr2(){
  unsigned long now=micros();
  if(now - lastMicros2 >= DEB){ cnt2++; lastMicros2=now; }
}`:''}

void setup(){
  Serial.begin(115200);
  pinMode(PIN1, INPUT_PULLUP);
  attachInterrupt(digitalPinToInterrupt(PIN1), isr1, FALLING);
  ${dual?`pinMode(PIN2, INPUT_PULLUP);
  attachInterrupt(digitalPinToInterrupt(PIN2), isr2, FALLING);`:''}
  Serial.println(F("millis,RPM1,RPM2"));
}

void loop(){
  static unsigned long t0=millis();
  if(millis()-t0 >= WIN){
    noInterrupts();
    unsigned long c1=cnt1; cnt1=0;
    ${dual?`unsigned long c2=cnt2; cnt2=0;`:''}
    interrupts();

    float rpm1 = (c1 * (60000.0/WIN)) / PPR1;
    ${dual?`float rpm2 = (c2 * (60000.0/WIN)) / PPR2;`:''}

    Serial.print(millis()); Serial.print(',');
    Serial.print(rpm1,1); Serial.print(',');
    ${dual?`Serial.println(rpm2,1);`:`Serial.println(0);`}
    t0 = millis();
  }
}
`;
  return code;
}
$('#gen').addEventListener('click', ()=>{ const txt=makeSketch(); $('#code').textContent=txt; window.scrollTo({top: $('#code').parentElement.getBoundingClientRect().top + window.scrollY - 12, behavior:'smooth'}); });
$('#copy').addEventListener('click', ()=>{ const ta=document.createElement('textarea'); ta.value=$('#code').textContent; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); const old=document.title; document.title='‚úÖ –ö–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'; setTimeout(()=>document.title=old,900); });
$('#dl').addEventListener('click', ()=>{ const txt=$('#code').textContent||makeSketch(); download('mechanic_para16_tachometer.ino',txt,'text/x-arduino'); });

// ===== –ï–∫—Å–ø–æ—Ä—Ç =====
$('#saveTxt').addEventListener('click', ()=>{
  const lines=[
    '–ü–∞—Ä–∞ 16 ‚Äî Arduino: —Ç–∞—Ö–æ–º–µ—Ç—Ä –í–í–ü/—à–∫—ñ–≤—ñ–≤',
    '–ú–µ—Ö–∞–Ω—ñ–∫: '+($('#fio').value||''),
    '–†–æ–±–æ—Ç–∞: '+($('#job').value||''),
    `–°–µ–Ω—Å–æ—Ä–∏: 1=${$('#s1').value}, 2=${$('#s2').value}`,
    `PPR: 1=${$('#ppr1').value}, 2=${$('#ppr2').value}; –í—ñ–∫–Ω–æ=${$('#win').value} –º—Å; –î–µ–±–∞—É–Ω—Å=${$('#deb').value} –º–∫—Å`,
    `D1=${$('#d1').value} –º–º, D2=${$('#d2').value} –º–º, –ü–æ—Ä—ñ–≥ SLIP=${$('#thr').value}%`,
    `–û—Å—Ç–∞–Ω–Ω—ñ –≤–∏–º—ñ—Ä–∏: ${$('#last').textContent}`
  ];
  download('mechanic_para16_'+stamp()+'.txt', lines.join('\n'));
});
$('#saveCsv').addEventListener('click', ()=>{
  const head='t_iso,RPM1,RPM2,SLIP%\n';
  const body=series.map(o=> new Date(o.t).toISOString()+','+o.rpm1.toFixed(1)+','+(o.rpm2?o.rpm2.toFixed(1):'0')+','+(isFinite(o.slip)?o.slip.toFixed(2):'0')).join('\n');
  download('mechanic_para16_'+stamp()+'.csv', head+body, 'text/csv');
});
$('#receipt').addEventListener('click', ()=>{
  const lines=['=== –ß–ï–ö –¢–ê–•–û–ú–ï–¢–†–ê (58–º–º) ===','–†–æ–±–æ—Ç–∞: '+($('#job').value||'-'),'---'];
  const M=series.slice(-12);
  M.forEach(o=>lines.push(`${new Date(o.t).toISOString().slice(11,19)} RPM1=${o.rpm1.toFixed(0)} RPM2=${o.rpm2?o.rpm2.toFixed(0):'‚Äî'} SLIP=${isFinite(o.slip)?o.slip.toFixed(1):'‚Äî'}% ${o.alarm?'!':''}`));
  const el=$('#rc'); el.hidden=false; el.textContent=lines.join('\n');
  download('para16_receipt_'+stamp()+'.txt', lines.join('\n'));
});

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
draw();
if (window.self !== window.top) document.documentElement.classList.add('embedded'); // LMS-friendly
</script>


</body></html>