<!-- mechanic_para3.html
     –ü–ê–†–ê 3 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∫—ñ–≤
     –¢–µ–º–∞: –ü–†–û–î–£–ö–¢–ò–í–ù–Ü–°–¢–¨ –¢–ê –°–û–ë–Ü–í–ê–†–¢–Ü–°–¢–¨ –†–û–ë–û–¢–ò –ê–ì–†–ï–ì–ê–¢–£ ‚Äî —à–∏—Ä–∏–Ω–∞, —à–≤–∏–¥–∫—ñ—Å—Ç—å, –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è, –∫–æ–µ—Ñ. –ø–æ–ª—å–æ–≤–æ—ó –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ, —á–∞—Å, –ü–ú–ú, –≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –ª–æ–∫–∞–ª—å–Ω–æ; –≥–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages / Moodle (iframe).
     –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è: —Ç–µ–ª–µ—Ñ–æ–Ω–∏, –ø—Ä–∏–Ω—Ç–µ—Ä 58 –º–º (–æ–ø—Ü.) –¥–ª—è ‚Äú–ø–ª–∞–Ω-–∑–º—ñ–Ω–∏‚Äù, NFC (–æ–ø—Ü.) –¥–ª—è —Ç–µ–≥—É —Ä–æ–±–æ—Ç–∏.

     –©–æ –≤–º—ñ—î:
     ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–æ—ó (TFC) —ñ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—ó (EFC) –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ, —á–∞—Å—É –Ω–∞ –ø–æ–ª–µ, –ø—ñ–¥–≥–æ—Ç–æ–≤—á–æ-–∑–∞–≤–µ—Ä—à–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É —ñ –ø—Ä–æ—Å—Ç–æ—ó–≤.
     ‚Ä¢ –ü–∞–ª—å–Ω–µ: –∑ –Ω–æ—Ä–º ‚Äú–ª/–≥–∞‚Äù –∞–±–æ ‚Äú–ª/–≥–æ–¥‚Äù; –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –ü–ú–ú.
     ‚Ä¢ –ï–∫–æ–Ω–æ–º—ñ–∫–∞: —Ç–∞—Ä–∏—Ñ/–≥–æ–¥, —Å—Ç–∞–≤–∫–∞ –º–∞—à–∏–Ω–∏/–≥–æ–¥ ‚Üí —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞ —ñ –Ω–∞ –ø–æ–ª–µ.
     ‚Ä¢ –ü–ª–∞–Ω –∑–∞—ó–∑–¥—ñ–≤ (–∑–∞ –º—ñ—Å—Ç–∫—ñ—Å—Ç—é –±—É–Ω–∫–µ—Ä–∞/—Ü–∏—Å—Ç–µ—Ä–Ω–∏) ‚Äî –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ.
     ‚Ä¢ –ö–≤–∏—Ç–æ–∫ 58 –º–º ‚Äú–ü–ª–∞–Ω –∑–º—ñ–Ω–∏‚Äù —ñ NFC-—Ç–µ–∫—Å—Ç —ñ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–≤–¥–∞–Ω–Ω—è.
     ‚Ä¢ –ï–∫—Å–ø–æ—Ä—Ç CSV.

     –§–æ—Ä–º—É–ª–∏ (–Ω–∞–≤—á–∞–ª—å–Ω–æ):
     ‚Ä¢ –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: TFC = W(m) √ó V(km/h) / 10  ‚Üí  –≥–∞/–≥–æ–¥
     ‚Ä¢ –ï—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: EFC = TFC √ó FE, –¥–µ FE ‚Äî –∫–æ–µ—Ñ. –ø–æ–ª—å–æ–≤–æ—ó –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (0..1)
     ‚Ä¢ –ß–∞—Å –Ω–∞ –ø–æ–ª–µ: T_field = Area / EFC
     ‚Ä¢ –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: T_total = T_field + T_prep + T_delays
     ‚Ä¢ –ü–ú–ú: —è–∫—â–æ —î –ª/–≥–∞ ‚Üí F = Area √ó (–ª/–≥–∞); —ñ–Ω–∞–∫—à–µ F = T_total √ó (–ª/–≥–æ–¥)
     ‚Ä¢ –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞: C_ha = (Rate_lab * T_total + Rate_mach * T_total + Fuel_cost) / Area
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 3 (–º–µ—Ö–∞–Ω—ñ–∫–∏) ‚Äî –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, —á–∞—Å, –ü–ú–ú, —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞, –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted); letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  .small{font-size:12px; color:#9fb0c8}
  .muted{color:#93a3b5}
  .pill{display:inline-block; padding:4px 10px; border:1px solid #223049; border-radius:999px; font-size:12px; color:#a5b4fc; background:#0d1a2e; margin-right:6px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:var(--darkcell); color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:8px 10px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left; position:sticky; top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell); color:var(--darkink2)}
  .table td.dark, .table th.dark{background:var(--darkcell) !important; color:var(--darkink2) !important}
  .out{background:var(--darkcell); color:var(--darkink2); border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}

  input[type="text"], input[type="number"], input[type="date"], select, textarea{
    width:100%; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e6eef9
  }

  /* –ö–≤–∏—Ç–æ–∫ 58 –º–º */
  .ticket{ width:58mm; background:#fff; color:#000; padding:6mm 4mm; border-radius:6px; box-shadow:0 0 0 1px #e5e7eb inset; font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px; font-size:13px; text-align:center}
  .ticket p{margin:2px 0; font-size:12px}
  .ticket .line{border-top:1px dashed #111; margin:6px 0}
  .ticket small{font-size:10px}

  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}
  html.embedded .box{background:#f8fafc; color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6; color:#111}

  @media print{
    @page{ margin:4mm }
    .no-print{ display:none !important }
  }
</style>
<!-- Moodle iFrame Click Guard: –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–ª—ñ–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∞–º –∫–µ—Ä—É–≤–∞–Ω–Ω—è
     (–ø—Ä–æ–±–ª–µ–º–∞ –∑ –Ω–∞–∫–ª–∞–¥–Ω–∏–º–∏ –æ–≤–µ—Ä–ª–µ—è–º–∏/—à–∞—Ä–æ–º —Ç–µ–º–∏ —É –≤–±—É–¥–æ–≤–∞–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ) -->
<style>
  .wrap{ position:relative; z-index: 9999; }          /* –ø—ñ–¥–Ω—è—Ç–∏ –Ω–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞–¥ –º–æ–∂–ª–∏–≤–∏–º –æ–≤–µ—Ä–ª–µ—î–º */
  .btn, button, input, select, textarea, a{
    pointer-events:auto !important;
    position:relative; z-index: 10000;               /* –ø—ñ–¥–Ω—è—Ç–∏ —Å–∞–º–µ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ */
 }
  /* –Ø–∫—â–æ —Ç–µ–º–∞ –ø—ñ–¥—Å–æ–≤—É—î —Ñ–æ–Ω–æ–≤–∏–π overlay –∑ position:fixed ‚Äî –ø—Ä–∏–±–µ—Ä–µ–º–æ –π–æ–≥–æ –∑ –ø–æ—Ç–æ–∫—É –∫–ª—ñ–∫—ñ–≤ */
  .print-overlay, .print__overlay, .moodle-overlay{ pointer-events:none !important; }
</style>
<style>
/* PRINT PATCH v1 CSS (auto) */
.ticket{ font-weight:700; letter-spacing:0.1px }
.ticket h4{ font-weight:700 }
.ticket p,
.ticket b,
.ticket strong,
.ticket span,
.ticket small{ font-weight:700 }
</style>

<meta name="description" content="–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–∏ –∫—ñ–ª—å–∫–æ—Ö –ø–æ–ª—ñ–≤ —Ä–æ–∑—Ä–∞—Ö—É—é—Ç—å TFC/EFC, —á–∞—Å, –ø–∞–ª—å–Ω–µ —Ç–∞ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞, —Å–ø–ª–∞–Ω—É—é—Ç—å –∑–∞—ó–∑–¥–∏ (–æ–ø—Ü.) —Ç–∞ —Å—Ñ–æ—Ä–º—É—é—Ç—å –∫–≤–∏—Ç–æ–∫ 58 –º–º ‚Äú–ü–ª–∞–Ω –∑–º"><link rel="canonical" href="https://edlab.pp.ua/mech_II_kyrs/mechanic_para3.html"><meta property="og:type" content="article"><meta property="og:title" content="üìà –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—É: TFC/EFC ‚Üí —á–∞—Å ‚Üí –ü–ú–ú ‚Üí —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞ ‚Üí –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC"><meta property="og:description" content="–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–∏ –∫—ñ–ª—å–∫–æ—Ö –ø–æ–ª—ñ–≤ —Ä–æ–∑—Ä–∞—Ö—É—é—Ç—å TFC/EFC, —á–∞—Å, –ø–∞–ª—å–Ω–µ —Ç–∞ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞, —Å–ø–ª–∞–Ω—É—é—Ç—å –∑–∞—ó–∑–¥–∏ (–æ–ø—Ü.) —Ç–∞ —Å—Ñ–æ—Ä–º—É—é—Ç—å –∫–≤–∏—Ç–æ–∫ 58 –º–º ‚Äú–ü–ª–∞–Ω –∑–º"><meta property="og:url" content="https://edlab.pp.ua/mech_II_kyrs/mechanic_para3.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üìà –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—É: TFC/EFC ‚Üí —á–∞—Å ‚Üí –ü–ú–ú ‚Üí —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞ ‚Üí –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC","description":"–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–∏ –∫—ñ–ª—å–∫–æ—Ö –ø–æ–ª—ñ–≤ —Ä–æ–∑—Ä–∞—Ö—É—é—Ç—å TFC/EFC, —á–∞—Å, –ø–∞–ª—å–Ω–µ —Ç–∞ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞, —Å–ø–ª–∞–Ω—É—é—Ç—å –∑–∞—ó–∑–¥–∏ (–æ–ø—Ü.) —Ç–∞ —Å—Ñ–æ—Ä–º—É—é—Ç—å –∫–≤–∏—Ç–æ–∫ 58 –º–º ‚Äú–ü–ª–∞–Ω –∑–º","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/mech_II_kyrs/mechanic_para3.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 3 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –º–µ—Ö–∞–Ω—ñ–∫–∏</span>
    <h1>üìà –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—É: TFC/EFC ‚Üí —á–∞—Å ‚Üí –ü–ú–ú ‚Üí —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞ ‚Üí –∫–≤–∏—Ç–æ–∫ 58 –º–º, NFC</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>
        –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–∏ –∫—ñ–ª—å–∫–æ—Ö –ø–æ–ª—ñ–≤ —Ä–æ–∑—Ä–∞—Ö—É—é—Ç—å <b>TFC/EFC</b>, <b>—á–∞—Å</b>, <b>–ø–∞–ª—å–Ω–µ</b> —Ç–∞
        <b>—Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞</b>, —Å–ø–ª–∞–Ω—É—é—Ç—å <b>–∑–∞—ó–∑–¥–∏</b> (–æ–ø—Ü.) —Ç–∞ —Å—Ñ–æ—Ä–º—É—é—Ç—å <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b> ‚Äú–ü–ª–∞–Ω –∑–º—ñ–Ω–∏‚Äù —ñ <b>NFC</b>-—Ç–µ–∫—Å—Ç –∑–∞–≤–¥–∞–Ω–Ω—è.
      </p>
      <p class="small">–ö–æ–µ—Ñ. –ø–æ–ª—å–æ–≤–æ—ó –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (FE) –≤—Ä–∞—Ö–æ–≤—É—î —Ä–æ–∑–≤–æ—Ä–æ—Ç–∏, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, –ø—Ä–æ—Å—Ç–æ—ó: –∑–∞–∑–≤–∏—á–∞–π <span class="mono">0.6‚Äì0.85</span>.</p>
    </div>

    <!-- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ê–ì–†–ï–ì–ê–¢–£ –¢–ê –ï–ö–û–ù–û–ú–Ü–ö–ê -->
    <div class="card">
      <h2>‚öôÔ∏è –ê–≥—Ä–µ–≥–∞—Ç, –ø–∞–ª—å–Ω–µ —Ç–∞ –µ–∫–æ–Ω–æ–º—ñ–∫–∞</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–ê–≥—Ä–µ–≥–∞—Ç</h3>
          <div class="row">
            <div style="flex:1"><label>–ú–∞—à–∏–Ω–∞ ID</label><input id="machId" type="text" value="TR-001"></div>
            <div style="flex:1"><label>–ú–æ–¥–µ–ª—å</label><input id="machModel" type="text" value="–ú–¢–ó-82 + “ë—Ä—É–Ω—Ç–æ–æ–±—Ä–æ–±–Ω–∏–π 4 –º"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–®–∏—Ä–∏–Ω–∞ –∑–∞—Ö–≤–∞—Ç—É W, –º</label><input id="W" type="number" step="0.01" value="4.0"></div>
            <div style="flex:1"><label>–®–≤–∏–¥–∫—ñ—Å—Ç—å V, –∫–º/–≥–æ–¥</label><input id="V" type="number" step="0.1" value="8.0"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–ü–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è, %</label><input id="Ov" type="number" step="1" value="7"></div>
            <div style="flex:1"><label>FE (0..1)</label><input id="FE" type="number" step="0.01" value="0.78"></div>
          </div>
          <p class="small">–ï—Ñ–µ–∫—Ç–∏–≤–Ω–∞ —à–∏—Ä–∏–Ω–∞ <span class="mono">W·µâ·∂†·∂† = W √ó (1 ‚àí Ov%)</span>.</p>
        </div>

        <div class="box">
          <h3>–ü–∞–ª—å–Ω–µ</h3>
          <div class="row">
            <div style="flex:1"><label>–í–∏—Ç—Ä–∞—Ç–∞, –ª/–≥–∞ (—è–∫—â–æ –≤—ñ–¥–æ–º–∞)</label><input id="fuel_ha" type="number" step="0.1" value="0"></div>
            <div style="flex:1"><label>–í–∏—Ç—Ä–∞—Ç–∞, –ª/–≥–æ–¥ (–∞–ª—å—Ç–µ—Ä–Ω.)</label><input id="fuel_h" type="number" step="0.1" value="7.5"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–¶—ñ–Ω–∞ –¥–∏–∑–ø–∞–ª—å–Ω–æ–≥–æ, –≥—Ä–Ω/–ª</label><input id="price" type="number" step="0.01" value="63.50"></div>
            <div style="flex:1"><label>–ú—ñ—Å—Ç–∫—ñ—Å—Ç—å –±–∞–∫–∞/–±—É–Ω–∫–µ—Ä–∞, –ª/–∫–≥ (–æ–ø—Ü.)</label><input id="tank" type="number" step="1" value="0"></div>
          </div>
        </div>

        <div class="box">
          <h3>–ï–∫–æ–Ω–æ–º—ñ–∫–∞</h3>
          <div class="row">
            <div style="flex:1"><label>–¢–∞—Ä–∏—Ñ –ø—Ä–∞—Ü—ñ, –≥—Ä–Ω/–≥–æ–¥</label><input id="rate_lab" type="number" step="1" value="220"></div>
            <div style="flex:1"><label>–°—Ç–∞–≤–∫–∞ –º–∞—à–∏–Ω–∏, –≥—Ä–Ω/–≥–æ–¥</label><input id="rate_mach" type="number" step="1" value="450"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>T –ø—ñ–¥–≥–æ—Ç.-–∑–∞–≤–µ—Ä—à., –≥–æ–¥</label><input id="t_prep" type="number" step="0.1" value="0.5"></div>
            <div style="flex:1"><label>T –ø—Ä–æ—Å—Ç–æ—ó–≤ (–ø–ª–∞–Ω), –≥–æ–¥</label><input id="t_delay" type="number" step="0.1" value="0.3"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- –¢–ê–ë–õ–ò–¶–Ø –ü–û–õ–Ü–í -->
    <div class="card">
      <h2>üß± –ü–æ–ª—è / —Ä–æ–±–æ—Ç–∏</h2>
      <div class="row">
        <button class="btn" onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ</button>
        <button class="btn" onclick="preset()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="copyCSV()">üìã CSV</button>
      </div>
      <div style="overflow:auto; margin-top:8px">
        <table class="table" id="tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>–ü–æ–ª–µ / –∑–∞–≤–¥–∞–Ω–Ω—è</th>
              <th>–ü–ª–æ—â–∞, –≥–∞</th>
              <th>–û–ø–∏—Å —Ä–æ–±—ñ—Ç</th>
              <th class="dark">TFC, –≥–∞/–≥–æ–¥</th>
              <th class="dark">EFC, –≥–∞/–≥–æ–¥</th>
              <th class="dark">–ß–∞—Å –Ω–∞ –ø–æ–ª–µ, –≥–æ–¥</th>
              <th class="dark">–ó–∞–≥. —á–∞—Å, –≥–æ–¥</th>
              <th class="dark">–ü–ú–ú, –ª</th>
              <th class="dark">–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å, –≥—Ä–Ω/–≥–∞</th>
              <th class="dark">–í–∞—Ä—Ç—ñ—Å—Ç—å, –≥—Ä–Ω (–ø–æ–ª–µ)</th>
              <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
            </tr>
          </thead>
          <tbody id="body"></tbody>
          <tfoot>
            <tr>
              <th class="dark" colspan="8">–†–∞–∑–æ–º</th>
              <th class="dark" id="sumFuel">‚Äî</th>
              <th class="dark" id="avgCostHa">‚Äî</th>
              <th class="dark" id="sumCost">‚Äî</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>
      <div id="csv" class="out" style="margin-top:8px">‚Äî</div>
      <p class="small">CSV: <span class="mono"># | –ü–æ–ª–µ | –ü–ª–æ—â–∞_–≥–∞ | –û–ø–∏—Å | TFC | EFC | T_field | T_total | –ü–ú–ú_–ª | –≥—Ä–Ω_–≥–∞ | –≥—Ä–Ω_–ø–æ–ª–µ | –ü—Ä–∏–º.</span></p>
      <p class="small muted">–ö–æ–Ω—Ç—Ä–∞—Å—Ç –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–æ: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ (<span class="mono">.dark</span>) –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç.</p>
    </div>

    <!-- –†–ï–ó–Æ–ú–ï + –ö–í–ò–¢–û–ö + NFC -->
    <div class="card">
      <h2>üßæ –ü—ñ–¥—Å—É–º–∫–∏, –∫–≤–∏—Ç–æ–∫ 58 –º–º —Ç–∞ NFC</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–ü—ñ–¥—Å—É–º–∫–∏</h3>
          <p>–ü–æ–ª—ñ–≤: <b><span id="fieldsCount">‚Äî</span></b> ¬∑ –ó–∞–≥. –ø–ª–æ—â–∞: <b><span id="areaSum">‚Äî</span> –≥–∞</b></p>
          <p>–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: <b><span id="timeSum">‚Äî</span> –≥–æ–¥</b> ¬∑ –ü–ú–ú: <b><span id="fuelSum">‚Äî</span> –ª</b></p>
          <p>–°–µ—Ä–µ–¥–Ω—è —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å: <b><span id="costHaAvg">‚Äî</span> –≥—Ä–Ω/–≥–∞</b></p>
        </div>

        <div class="box">
          <h3>–ö–≤–∏—Ç–æ–∫ 58 –º–º ‚Äî ‚Äú–ü–ª–∞–Ω –∑–º—ñ–Ω–∏‚Äù</h3>
          <div class="row">
            <button class="btn" onclick="buildTicket()">üßæ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
            <button class="btn" onclick="printTicketNewTab()">üñ®Ô∏è –î—Ä—É–∫</button>
          </div>
          <div class="ticket" id="ticket" style="margin-top:8px">
            <h4>–ü–õ–ê–ù –ó–ú–Ü–ù–ò</h4>
            <p id="tDate"><small>–î–∞—Ç–∞: ‚Äî</small></p>
            <div class="line"></div>
            <p><b>–ú–∞—à–∏–Ω–∞:</b> <span id="tId">‚Äî</span></p>
            <p><b>–ú–æ–¥–µ–ª—å:</b> <span id="tModel">‚Äî</span></p>
            <p><b>W√óV√óFE:</b> <span id="tSpec">‚Äî</span></p>
            <div class="line"></div>
            <p><b>–ü–æ–ª–µ/–∑–∞–≤–¥–∞–Ω–Ω—è:</b> <span id="tField">‚Äî</span></p>
            <p><b>–ü–ª–æ—â–∞:</b> <span id="tArea">‚Äî</span> –≥–∞ ¬∑ <b>EFC:</b> <span id="tEFC">‚Äî</span> –≥–∞/–≥–æ–¥</p>
            <p><b>–ß–∞—Å:</b> <span id="tTime">‚Äî</span> –≥–æ–¥ ¬∑ <b>–ü–ú–ú:</b> <span id="tFuel">‚Äî</span> –ª</p>
            <p><b>–°–æ–±/–≥–∞:</b> <span id="tCostHa">‚Äî</span> ¬∑ <b>–†–∞–∑–æ–º:</b> <span id="tCost">‚Äî</span> –≥—Ä–Ω</p>
            <div class="line"></div>
            <p><small id="tNote">–ü—Ä–∏–º.: ‚Äî</small></p>
          </div>
        </div>

        <div class="box">
          <h3>NFC ‚Äî —Ç–µ–∫—Å—Ç –∑–∞–≤–¥–∞–Ω–Ω—è</h3>
          <div class="row">
            <div style="flex:1"><label>–ö—É—Ä–∞—Ç–æ—Ä/–±—Ä–∏–≥–∞–¥–∏—Ä</label><input id="nfcBoss" type="text" value="–ú–∞–π—Å—Ç–µ—Ä –¥—ñ–ª. ‚Ññ1"></div>
            <div style="flex:1"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="nfcPhone" type="text" value="+380XXXXXXXXX"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="buildNFC()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
            <button class="btn" onclick="copyEl('nfcOut')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
          <div id="nfcOut" class="out">‚Äî</div>
        </div>
      </div>
    </div>

    <!-- –•–Ü–î –†–û–ë–û–¢–ò -->
    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
      <ol>
        <li>–ó–∞–ø–æ–≤–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ç—É (W, V, –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è, FE) —Ç–∞ –µ–∫–æ–Ω–æ–º—ñ–∫—É (—Å—Ç–∞–≤–∫–∏, —á–∞—Å–∏).</li>
        <li>–î–æ–¥–∞–π 2‚Äì4 –ø–æ–ª—è. –ù–∞—Ç–∏—Å–Ω–∏ <b>–ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</b> —ñ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π EFC, —á–∞—Å, –ü–ú–ú, —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å.</li>
        <li>–ó–≥–µ–Ω–µ—Ä—É–π <b>–∫–≤–∏—Ç–æ–∫ 58 –º–º</b> —ñ <b>NFC</b>-—Ç–µ–∫—Å—Ç. –ï–∫—Å–ø–æ—Ä—Ç—É–π <b>CSV</b> —É Sheets (<span class="mono">CapacityCost</span>).</li>
      </ol>
    </div>

    <div class="card">
      <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="table">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ TFC/EFC, —á–∞—Å—É —Ç–∞ –ü–ú–ú</td><td>4</td></tr>
          <tr><td>–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞ —ñ –ø—ñ–¥—Å—É–º–∫–∏ –ø–æ –ø–æ–ª—è—Ö –ª–æ–≥—ñ—á–Ω—ñ</td><td>3</td></tr>
          <tr><td>–ö–≤–∏—Ç–æ–∫ 58 –º–º —ñ NFC-—Ç–µ–∫—Å—Ç –∑—ñ–±—Ä–∞–Ω—ñ</td><td>2</td></tr>
          <tr><td>CSV —É Sheets + –∫–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏</td><td>1</td></tr>
        </tbody>
      </table>
      <p class="pill">üìê EFC</p><p class="pill">‚õΩ –ü–ú–ú</p><p class="pill">üí∏ –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å</p><p class="pill">üßæ –ö–≤–∏—Ç–æ–∫</p><p class="pill">üîñ NFC</p>
    </div>
  </div>

<script>
  // –†–µ–∂–∏–º –≤–±—É–¥—É–≤–∞–Ω–Ω—è (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const bodyEl = document.getElementById('body');
  const csvEl  = document.getElementById('csv');
  const byId = id => document.getElementById(id);
  const rnd = (n,d=2) => Number((+n).toFixed(d));

  function effectiveW(){ const W=+byId('W').value||0; const Ov=(+byId('Ov').value||0)/100; return W*Math.max(0,1-Ov); }
  function TFC(){ return (effectiveW() * ((+byId('V').value)||0)) / 10; }       // –≥–∞/–≥–æ–¥
  function EFC(){ return TFC() * ((+byId('FE').value)||0); }                    // –≥–∞/–≥–æ–¥

  function addRow(sample){
    const def = { field:'F-01', area: 20.0, task:'–î–∏—Å–∫–æ–≤–∞–Ω–Ω—è', note:'' };
    const s = Object.assign({}, def, sample||{});
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${s.field}"></td>
      <td><input type="number" step="0.01" value="${s.area}"></td>
      <td><input type="text" value="${s.task}"></td>
      <td class="dark tfc">‚Äî</td>
      <td class="dark efc">‚Äî</td>
      <td class="dark tField">‚Äî</td>
      <td class="dark tTotal">‚Äî</td>
      <td class="dark fuel">‚Äî</td>
      <td class="dark cHa">‚Äî</td>
      <td class="dark cost">‚Äî</td>
      <td><input type="text" value="${s.note}"></td>
    `;
    bodyEl.appendChild(tr);
    reindex();
  }
  function reindex(){ [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  function recalc(){
    const tfc = TFC();
    const efc = EFC();

    const rateLab = +byId('rate_lab').value||0;
    const rateMach= +byId('rate_mach').value||0;
    const tPrep   = +byId('t_prep').value||0;
    const tDelay  = +byId('t_delay').value||0;
    const price   = +byId('price').value||0;
    const f_ha    = +byId('fuel_ha').value||0;
    const f_h     = +byId('fuel_h').value||0;

    let sumFuel=0, sumCost=0, sumArea=0, sumTime=0, rows=0, costsHa=[];

    [...bodyEl.querySelectorAll('tr')].forEach(tr=>{
      const area = +tr.children[2].querySelector('input').value||0;

      const T_field = efc>0 ? area / efc : 0;                 // –≥–æ–¥
      const T_total = T_field + tPrep + tDelay;

      let Fuel = 0;
      if(f_ha>0) Fuel = area * f_ha;
      else if(f_h>0) Fuel = T_total * f_h;

      const FuelCost = Fuel * price;
      const WorkCost = (rateLab + rateMach) * T_total;
      const CostTotal = FuelCost + WorkCost;
      const CostHa = area>0 ? (CostTotal / area) : 0;

      tr.querySelector('.tfc').textContent    = tfc? rnd(tfc,2) : '‚Äî';
      tr.querySelector('.efc').textContent    = efc? rnd(efc,2) : '‚Äî';
      tr.querySelector('.tField').textContent = rnd(T_field,2);
      tr.querySelector('.tTotal').textContent = rnd(T_total,2);
      tr.querySelector('.fuel').textContent   = rnd(Fuel,1);
      tr.querySelector('.cHa').textContent    = rnd(CostHa,0).toLocaleString('uk-UA');
      tr.querySelector('.cost').textContent   = Math.round(CostTotal).toLocaleString('uk-UA');

      sumFuel += Fuel; sumCost += CostTotal; sumArea += area; sumTime += T_total; rows++;
      if(CostHa>0) costsHa.push(CostHa);
    });

    byId('sumFuel').textContent = rnd(sumFuel,1);
    byId('sumCost').textContent = Math.round(sumCost).toLocaleString('uk-UA');
    byId('avgCostHa').textContent = (costsHa.length? Math.round(costsHa.reduce((a,b)=>a+b,0)/costsHa.length) : 0).toLocaleString('uk-UA');

    byId('fieldsCount').textContent = rows || '‚Äî';
    byId('areaSum').textContent  = rnd(sumArea,2);
    byId('timeSum').textContent  = rnd(sumTime,2);
    byId('fuelSum').textContent  = rnd(sumFuel,1);
    byId('costHaAvg').textContent= byId('avgCostHa').textContent;

    buildCSV();
  }

  function buildCSV(){
    const lines = [...bodyEl.querySelectorAll('tr')].map(tr=>{
      const idx=tr.querySelector('.idx').textContent.trim();
      const field=tr.children[1].querySelector('input').value.trim();
      const area =tr.children[2].querySelector('input').value.trim();
      const task =tr.children[3].querySelector('input').value.trim();
      const tfc  =tr.querySelector('.tfc').textContent.trim();
      const efc  =tr.querySelector('.efc').textContent.trim();
      const tf   =tr.querySelector('.tField').textContent.trim();
      const tt   =tr.querySelector('.tTotal').textContent.trim();
      const fuel =tr.querySelector('.fuel').textContent.trim();
      const cha  =tr.querySelector('.cHa').textContent.trim();
      const cost =tr.querySelector('.cost').textContent.trim();
      const note =tr.children[11].querySelector('input').value.trim();
      return [idx,field,area,task,tfc,efc,tf,tt,fuel,cha,cost,note].join(' | ');
    });
    csvEl.textContent = lines.join('\n') || '‚Äî';
  }

  function copyCSV(){
    const t = csvEl.textContent.trim();
    if(!t || t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }

  function preset(){
    bodyEl.innerHTML='';
    addRow({field:'F-01', area:18.5, task:'–î–∏—Å–∫–æ–≤–∞–Ω–Ω—è 1-–π —Å–ª—ñ–¥'});
    addRow({field:'F-02', area:12.3, task:'–ö—É–ª—å—Ç–∏–≤–∞—Ü—ñ—è'});
    addRow({field:'F-03', area:25.0, task:'–ü–µ—Ä–µ–¥–ø–æ—Å—ñ–≤–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞'});
    recalc();
  }

  // ===== –ö–≤–∏—Ç–æ–∫ 58 –º–º =====
  function buildTicket(){
    const tr = bodyEl.querySelector('tr') || null;
    const d  = new Date().toISOString().slice(0,10);
    byId('tDate').innerHTML = `<small>–î–∞—Ç–∞: ${d}</small>`;
    byId('tId').textContent = byId('machId').value || '‚Äî';
    byId('tModel').textContent = byId('machModel').value || '‚Äî';
    byId('tSpec').textContent = `${(+byId('W').value||0)}–º √ó ${(+byId('V').value||0)}–∫–º/–≥–æ–¥ √ó FE ${(+byId('FE').value||0)}`;

    if(tr){
      const field = tr.children[1].querySelector('input').value.trim();
      const area  = tr.children[2].querySelector('input').value.trim();
      const efc = tr.querySelector('.efc').textContent.trim();
      const tt  = tr.querySelector('.tTotal').textContent.trim();
      const fuel= tr.querySelector('.fuel').textContent.trim();
      const cha = tr.querySelector('.cHa').textContent.trim();
      const cost= tr.querySelector('.cost').textContent.trim();

      byId('tField').textContent = field;
      byId('tArea').textContent  = area;
      byId('tEFC').textContent   = efc;
      byId('tTime').textContent  = tt;
      byId('tFuel').textContent  = fuel;
      byId('tCostHa').textContent= cha;
      byId('tCost').textContent  = cost;
      byId('tNote').textContent  = `–ü—Ä–∏–º.: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è ¬∑ Ref:${Math.random().toString(36).slice(2,8).toUpperCase()}`;
    }
  }

  // ===== NFC =====
  function buildNFC(){
    const d  = new Date().toISOString().slice(0,19).replace('T',' ');
    const tr = bodyEl.querySelector('tr') || null;
    let field='‚Äî', area='‚Äî', efc='‚Äî', t='‚Äî', fuel='‚Äî';
    if(tr){
      field = tr.children[1].querySelector('input').value.trim();
      area  = tr.children[2].querySelector('input').value.trim();
      efc   = tr.querySelector('.efc').textContent.trim();
      t     = tr.querySelector('.tTotal').textContent.trim();
      fuel  = tr.querySelector('.fuel').textContent.trim();
    }
    const text = [
      `TASK_NFC`,
      `MACHINE:${byId('machId').value}`,
      `MODEL:${byId('machModel').value}`,
      `SPEC:W=${byId('W').value}m; V=${byId('V').value}kmh; FE=${byId('FE').value}`,
      `FIELD:${field}; AREA:${area}ha`,
      `EFC:${efc}ha_h; TIME:${t}h; FUEL:${fuel}L`,
      `BOSS:${byId('nfcBoss').value}; PHONE:${byId('nfcPhone').value}`,
      `STAMP:${d}`
    ].join('\n');
    byId('nfcOut').textContent = text;
  }

  // ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
  function copyEl(id){
    const t = byId(id).textContent.trim();
    if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){ addRow(); addRow(); recalc(); })();

  // –†–µ–∫–∞–ª—å–∫—É–ª—è—Ü—ñ—è –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
  ['W','V','Ov','FE','fuel_ha','fuel_h','price','rate_lab','rate_mach','t_prep','t_delay'].forEach(id=>{
    document.getElementById(id).addEventListener('change', recalc);
  });
      /* Interaction Guard JS: –Ω–∞ –≤–∏–ø–∞–¥–æ–∫ —è–∫—â–æ —Ç–µ–º–∞/iframe –∑–Ω—è–ª–∞ –∫–ª—ñ–∫–∏ –∞–±–æ –∑–∞–±–ª–æ–∫—É–≤–∞–ª–∞ –µ–ª–µ–º–µ–Ω—Ç–∏ */
  (function unlockInteraction(){
    function enable(){
      document.querySelectorAll('button, .btn, input, select, textarea, a').forEach(el=>{
        try{
          el.disabled = false;
          el.style.pointerEvents = 'auto';
        }catch(_){}
      });
      // –ø—Ä–∏–±—Ä–∞—Ç–∏ —Ç–∏–ø–æ–≤—ñ –æ–≤–µ—Ä–ª–µ—ó, —â–æ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—Ç—å –∫–ª—ñ–∫–∏ —É –¥–µ—è–∫–∏—Ö —Ç–µ–º–∞—Ö
      document.querySelectorAll(
        '[data-print-overlay], .print-overlay, .print__overlay, .overlay, [aria-hidden="true"][style*="position: fixed"]'
      ).forEach(el=>{
        const st=getComputedStyle(el);
        if(st.position==='fixed' || st.position==='absolute'){ el.style.pointerEvents='none'; }
      });
    }
    enable(); setTimeout(enable,200); setTimeout(enable,600); setTimeout(enable,1200);
    window.addEventListener('focus', enable, {passive:true});
  })();
</script>

<script>
// PRINT PATCH v1 (auto)
function printTicketNewTab(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; padding:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .ticket b,.ticket strong,.ticket span{ font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
  <script>
    window.addEventListener('load',()=>{
      try{ window.focus(); window.print(); if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'invoked'},'*'); }
      catch(e){ if(window.opener) window.opener.postMessage({type:'ticketPrint',status:'error'},'*'); }
    });
  <\/script>
  </body></html>`;

  var w = window.open('', '_blank');
  if(!w){ openTicketOnly(); return; }  // –ø–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚Äî —Ñ–æ–ª–±–µ–∫
  w.document.open(); w.document.write(html); w.document.close();

  var timer = setTimeout(()=>{ openTicketOnly(); }, 1200);
  window.addEventListener('message', (ev)=>{
    if(ev && ev.data && ev.data.type==='ticketPrint'){ clearTimeout(timer); }
  }, {once:true});
}

function openTicketOnly(){
  var ticket = document.getElementById('ticket');
  if(!ticket){ alert('–ù–µ–º–∞—î #ticket –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ'); return; }
  try{
    var someTxt = (document.querySelector('#ticket span, #ticket p, #ticket h4')||{}).textContent||'';
    if(!someTxt || someTxt.trim()==='‚Äî'){ if(typeof buildTicket==='function') buildTicket(); }
  }catch(_){}

  var css = `
    @media print { @page { size:58mm auto; margin:0 } }
    html,body{ margin:0; background:#fff; color:#000 }
    .ticket{
      width:58mm; margin:0; padding:6mm 4mm; background:#fff; color:#000;
      font-family:"Courier New", Courier, monospace; font-weight:700; letter-spacing:0.1px;
      border:none; box-shadow:none; border-radius:0
    }
    .ticket h4{ margin:0 0 6px; font-size:13px; text-align:center; font-weight:700 }
    .ticket p{ margin:2px 0; font-size:12px; font-weight:700 }
    .line{ border-top:1px dashed #111; margin:6px 0 }
    small{ font-size:10px; font-weight:700 }
  `;
  var html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ß–µ–∫ 58 –º–º</title><style>${css}</style></head><body>${ticket.outerHTML}
<script>window.addEventListener('load',()=>{ try{ window.focus(); window.print(); }catch(e){} });<\/script>
</body></html>`;

  var blob = new Blob([html], {type:'text/html'});
  var url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 60000);
}
</script>



</body></html>