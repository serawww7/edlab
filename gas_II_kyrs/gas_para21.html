<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 21 (–≥–∞–∑–æ–≤–∏–∫–∏) ‚Äî AI-–ø–æ–º—ñ—á–Ω–∏–∫ –±—Ä–∏–≥–∞–¥–∏: NLP –∑–∞—è–≤–∫–∏ ‚Üí P1/P2/P3 ‚Üí –∫—Ä–æ–∫–∏ –¥—ñ–π ‚Üí –∞–∫—Ç, –ø—ñ–¥–ø–∏—Å, —á–µ–∫, –µ–∫—Å–ø–æ—Ä—Ç</title>
<meta name="description" content="–í—Å—Ç–∞–≤ —Ç–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏ –∞–±–æ –Ω–∞–¥–∏–∫—Ç—É–π: –ª–æ–∫–∞–ª—å–Ω–∏–π AI –≤–∏—Ç—è–≥–∞—î —Å—É—Ç–Ω–æ—Å—Ç—ñ, –≤–∏–∑–Ω–∞—á–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç (P1/P2/P3), –ø—Ä–æ–ø–æ–Ω—É—î –∞–ª–≥–æ—Ä–∏—Ç–º –¥—ñ–π —ñ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω—é—î –∞–∫—Ç. –ï–∫—Å–ø–æ—Ä—Ç CSV/TXT, —á–µ–∫ 58 –º–º, QR –Ω–∞ –¥–æ–∫–∞–∑–∏."/>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1320px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.grid{display:grid;gap:14px;grid-template-columns:1.25fr 1fr}
@media(max-width:1140px){.grid{grid-template-columns:1fr}}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:#e6eef9}
textarea{min-height:120px}
.btn{border:1px solid var(--line);background:#0f1f39;color:#e6eef9;padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
small.mono,.mono{font-family:ui-monospace,monospace}
h2{margin:.2em 0 .4em}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:0 8px;color:#e5e7eb;margin-right:6px;margin-top:6px}
.muted{color:var(--muted)}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
pre.log{max-height:220px;overflow:auto;background:#0c182a;border-radius:12px;padding:10px}
canvas.chart{display:block;width:100%;height:220px;background:#0b1220;border:1px solid var(--line);border-radius:12px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace;white-space:pre}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:0 10px;color:#e5e7eb}
.tag.ok{border-color:#1d3e2a;background:#0f2f1e}
.tag.warn{border-color:#4a3b13;background:#2b2310}
.tag.bad{border-color:#5a1f1f;background:#2a1212}
.sig{border:1px solid var(--line);border-radius:12px;background:#0b1220}
.footer{margin-top:20px;color:#94a3b8;font-size:.9rem}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">ü§ñüßØ</span>
      <div>
        <b>–ü–∞—Ä–∞ 21 ‚Äî AI-–ø–æ–º—ñ—á–Ω–∏–∫ –±—Ä–∏–≥–∞–¥–∏</b><br/>
        <span class="badge">–ó–∞—è–≤–∫–∞ ‚Üí NLP —Å—É—Ç–Ω–æ—Å—Ç—ñ ‚Üí –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó ‚Üí –∞–∫—Ç/–ø—ñ–¥–ø–∏—Å ‚Üí —á–µ–∫/CSV/TXT/QR</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <div class="card">
    <h2>üìö –ö–æ–Ω—Ç–µ–∫—Å—Ç</h2>
    <p>–í—Å—Ç–∞–≤ —Ç–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏ (–∞–±–æ –∫—ñ–ª—å–∫–∞), –Ω–∞—Ç–∏—Å–Ω–∏ <b>–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</b> ‚Äî –ª–æ–∫–∞–ª—å–Ω–∏–π AI –≤–∏—Ç—è–≥–Ω–µ —Å—É—Ç–Ω–æ—Å—Ç—ñ (<span class="mono">–ê–î–†–ï–°–ê, –ü–Ü–ë, –¢–ï–õ, –õ–Ü–ß–ò–õ–¨–ù–ò–ö, –û–ó–ù–ê–ö–ò, –¢–ò–°–ö, –ß–ê–°</span>), –æ—Ü—ñ–Ω–∏—Ç—å —Ä–∏–∑–∏–∫, –ø—Ä—ñ–æ—Ä–∏—Ç–µ–∑—É—î <b>P1/P2/P3</b>, –∑–≥–µ–Ω–µ—Ä—É—î <b>—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</b> —ñ –∑–∞–ø–æ–≤–Ω–∏—Ç—å <b>–∞–∫—Ç –≤–∏—ó–∑–¥—É</b>. –î–∞–ª—ñ ‚Äî –ø—ñ–¥–ø–∏—Å –∞–±–æ–Ω–µ–Ω—Ç–∞, —á–µ–∫ 58 –º–º, CSV/TXT, QR –Ω–∞ –¥–æ–∫–∞–∑–∏.</p>
    <div class="row">
      <button class="btn" id="ex">üß™ –ü—Ä–∏–∫–ª–∞–¥–∏ (3 –∑–∞—è–≤–∫–∏)</button>
      <button class="btn secondary" id="clr">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      <button class="btn good" id="an">üîé –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
      <span class="badge">–ó–∞—è–≤–æ–∫: <b id="cnt">0</b></span>
    </div>
    <textarea id="txt" placeholder="–ü—Ä–∏–∫–ª–∞–¥ —Ñ–æ—Ä–º–∞—Ç—É (–≤—ñ–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç, –æ–¥–Ω–∞ –∑–∞—è–≤–∫–∞ –≤ —Ä—è–¥–∫—É –∞–±–æ —á–µ—Ä–µ–∑ –ø–æ—Ä–æ–∂–Ω—ñ–π —Ä—è–¥–æ–∫):
–ö–∏—ó–≤, –≤—É–ª. –°–∏–º–∏—Ä–µ–Ω–∫–∞ 12, –∫–≤. 47. –¢–µ–ª 0671234567, –∞–±–æ–Ω–µ–Ω—Ç: –Ü–≤–∞–Ω–µ–Ω–∫–æ –û–ª–µ–Ω–∞. –†—ñ–∑–∫–∏–π –∑–∞–ø–∞—Ö –≥–∞–∑—É —É –ø—ñ–¥‚Äô—ó–∑–¥—ñ, —á—É—Ç–Ω–æ —Å–≤–∏—Å—Ç –±—ñ–ª—è —Å—Ç–æ—è–∫–∞, —Ç–∏—Å–∫ 0.7. –ß–∞—Å: 08:35. –õ—ñ—á–∏–ª—å–Ω–∏–∫ G4 ‚Ññ 00123456.
"></textarea>

    <div class="row">
      <label>–í–∞–≥–∞ ¬´–ó–∞–ø–∞—Ö/–°–≤–∏—Å—Ç/–ü–æ–ª—É–º‚Äô—è¬ª, –±–∞–ª <input id="wDanger" class="input" type="number" step="1" value="50"></label>
      <label>–í–∞–≥–∞ ¬´–¢–∏—Å–∫/–±–µ–∑ –≥–∞–∑—É¬ª, –±–∞–ª <input id="wPress" class="input" type="number" step="1" value="30"></label>
      <label>–ü–æ—Ä–æ–≥–∏: P1 / P2 <input id="thr" class="input" type="text" value="70/40"><small class="muted">–±–∞–ª—ñ–≤ (—ñ–Ω–∞–∫—à–µ P3)</small></label>
      <label>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å (–±—Ä–∏–≥–∞–¥–∞) <input id="crew" class="input" value="–ê–≤–∞—Ä—ñ–π–Ω–∞-1"></label>
    </div>
  </div>

  <div class="grid">
    <!-- –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å: —Ä–µ–∑—É–ª—å—Ç–∞—Ç AI -->
    <div class="card">
      <h2>üß† –í–∏—Ç—è–≥ —Å—É—Ç–Ω–æ—Å—Ç–µ–π / –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç / —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h2>
      <table class="tbl">
        <thead>
          <tr><th>#</th><th>–ê–¥—Ä–µ—Å–∞</th><th>–ê–±–æ–Ω–µ–Ω—Ç</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–õ—ñ—á–∏–ª—å–Ω–∏–∫</th><th>–û–∑–Ω–∞–∫–∏</th><th>–¢–∏—Å–∫</th><th>–ß–∞—Å</th><th>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</th></tr>
        </thead>
        <tbody id="entBody"><tr><td colspan="9" class="muted">‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏¬ª ‚Äî</td></tr></tbody>
      </table>

      <h3 style="margin-top:10px">üìã –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –¥—ñ—ó</h3>
      <ol id="steps"><li class="muted">‚Äî –±—É–¥–µ –ø—ñ—Å–ª—è –∞–Ω–∞–ª—ñ–∑—É ‚Äî</li></ol>

      <h3 style="margin-top:10px">üìà –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∏–∑–∏–∫—É</h3>
      <canvas id="risk" class="chart" width="560" height="220"></canvas>
    </div>

    <!-- –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å: –∞–∫—Ç, –ø—ñ–¥–ø–∏—Å, –µ–∫—Å–ø–æ—Ä—Ç -->
    <div class="card">
      <h2>üìù –ê–∫—Ç –≤–∏—ó–∑–¥—É (–∞–≤—Ç–æ-–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è)</h2>
      <div class="row">
        <label style="flex:1">–ê–¥—Ä–µ—Å–∞<input id="actAddr" class="input"></label>
        <label style="flex:1">–ê–±–æ–Ω–µ–Ω—Ç<input id="actName" class="input"></label>
        <label style="flex:1">–¢–µ–ª–µ—Ñ–æ–Ω<input id="actTel" class="input"></label>
      </div>
      <div class="row">
        <label style="flex:1">–õ—ñ—á–∏–ª—å–Ω–∏–∫<input id="actMeter" class="input"></label>
        <label style="flex:1">–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç<input id="actPrio" class="input"></label>
        <label style="flex:1">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å<input id="actCrew" class="input"></label>
      </div>
      <label>–û–ø–∏—Å —Å–∏—Ç—É–∞—Ü—ñ—ó<textarea id="actDesc"></textarea></label>
      <label>–í–∏–∫–æ–Ω–∞–Ω—ñ –¥—ñ—ó<textarea id="actActions"></textarea></label>

      <h3 style="margin-top:10px">‚úçÔ∏è –ü—ñ–¥–ø–∏—Å –∞–±–æ–Ω–µ–Ω—Ç–∞</h3>
      <canvas id="sig" class="sig" width="500" height="160"></canvas>
      <div class="row">
        <button class="btn secondary" id="sigClr">üßΩ –û—á–∏—Å—Ç–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å</button>
        <button class="btn" id="saveTxt">üíæ TXT (–∞–∫—Ç)</button>
        <button class="btn" id="saveCsv">üìÑ CSV (—Å—É—Ç–Ω–æ—Å—Ç—ñ)</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="qrGen">üîó QR (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –¥–æ–∫–∞–∑–∏)</button>
      </div>
      <div id="rc" class="receipt" hidden></div>
      <div style="margin-top:8px"><canvas id="qr" width="220" height="220" style="background:#0b1220;border:1px solid var(--line);border-radius:12px"></canvas></div>

      <h3 style="margin-top:10px">üõéÔ∏è –ñ—É—Ä–Ω–∞–ª</h3>
      <pre id="alog" class="log">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>
    </div>
  </div>

  <div class="card">
    <h2>üéØ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
    <ol>
      <li>–í—Å—Ç–∞–≤ 3‚Äì5 –∑–∞—è–≤–æ–∫ —Ä—ñ–∑–Ω–æ–≥–æ —Ç–∏–ø—É (–∑–∞–ø–∞—Ö/—Å–≤–∏—Å—Ç/–±–µ–∑ –≥–∞–∑—É/—Ä–æ–±–æ—Ç–∏ –ø–æ—Ä—É—á). –ü–æ—è—Å–Ω–∏, —á–æ–º—É AI –≤—ñ–¥–Ω—ñ—Å —ó—Ö –¥–æ P1/P2/P3.</li>
      <li>–í—ñ–¥—Ä–µ–¥–∞–≥—É–π –≤–∞–≥–∏ —Ç–∞ –ø–æ—Ä–æ–≥–∏ —Ç–∞–∫, —â–æ–± <b>–∑–Ω–∏–∑–∏—Ç–∏ —Ö–∏–±–Ω—ñ P1</b>, –∞–ª–µ –Ω–µ –≤—Ç—Ä–∞—Ç–∏—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω—ñ –∫–µ–π—Å–∏.</li>
      <li>–ó–≥–µ–Ω–µ—Ä—É–π –∞–∫—Ç, –ø—ñ–¥–ø–∏—à–∏, –Ω–∞–¥—Ä—É–∫—É–π —á–µ–∫ 58 –º–º, —Å—Ç–≤–æ—Ä–∏ QR –Ω–∞ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ –¥–æ–∫–∞–∑—ñ–≤ (—Ö–º–∞—Ä–∞/–ø–∞–ø–∫–∞ –∫–æ–ª–µ–¥–∂—É).</li>
      <li>–ï–∫—Å–ø–æ—Ä—Ç—É–π CSV —Å—É—Ç–Ω–æ—Å—Ç–µ–π —ñ –ø–æ—Ä—ñ–≤–Ω—è–π —ñ–∑ ¬´—Ä—É—á–Ω–∏–º¬ª —Ä–æ–∑–±–æ—Ä–æ–º ‚Äî —â–æ AI –ø—Ä–æ–ø—É—Å—Ç–∏–≤, —è–∫ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞?</li>
    </ol>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time id="upd"></time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
/* ===== –£—Ç–∏–ª—ñ—Ç–∏ ===== */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function log(msg){const t=new Date().toLocaleTimeString('uk-UA');const box=$('#alog');if(box.textContent.startsWith('//'))box.textContent='';box.textContent+=`[${t}] ${msg}\n`;box.scrollTop=box.scrollHeight;}
$('#upd').textContent=new Date().toLocaleDateString('uk-UA');

/* ===== –í–≤—ñ–¥/–ø—Ä–∏–∫–ª–∞–¥–∏ ===== */
$('#ex').addEventListener('click', ()=>{
  $('#txt').value = [
'–ö–∏—ó–≤, –≤—É–ª. –°–∏–º–∏—Ä–µ–Ω–∫–∞ 12, –∫–≤. 47. –¢–µ–ª 0671234567, –∞–±–æ–Ω–µ–Ω—Ç: –Ü–≤–∞–Ω–µ–Ω–∫–æ –û–ª–µ–Ω–∞. –†—ñ–∑–∫–∏–π –∑–∞–ø–∞—Ö –≥–∞–∑—É —É –ø—ñ–¥‚Äô—ó–∑–¥—ñ, —á—É—Ç–Ω–æ —Å–≤–∏—Å—Ç –±—ñ–ª—è —Å—Ç–æ—è–∫–∞, —Ç–∏—Å–∫ 0.7. –ß–∞—Å: 08:35. –õ—ñ—á–∏–ª—å–Ω–∏–∫ G4 ‚Ññ 00123456.',
'–ë—Ä–æ–≤–∞—Ä–∏, –≤—É–ª. –ì–µ—Ä–æ—ó–≤ 5. –ê–±–æ–Ω–µ–Ω—Ç: –ü–ï–¢–†–ï–ù–ö–û –Ü.–ì., —Ç–µ–ª. +380631112233. –ì–∞–∑—É –Ω–µ–º–∞—î –∑—Ä–∞–Ω–∫—É, —Ç–∏—Å–∫ 0.2, —Ä–æ–±—ñ—Ç–Ω–∏–∫–∏ –∫–æ–ø–∞—é—Ç—å –±—ñ–ª—è –≤–≤–æ–¥—É. –õ—ñ—á–∏–ª—å–Ω–∏–∫ BK-G6 ‚Ññ 998877. –ß–∞—Å 11:10.',
'–Ü—Ä–ø—ñ–Ω—å, –°–æ–±–æ—Ä–Ω–∞ 101 –æ—Ñ. 12. –¢–µ–ª: 044-123-45-67, –∫–ª—ñ—î–Ω—Ç –¢–û–í ¬´–°–µ—Ä–≤—ñ—Å-–•¬ª. –í–∏–¥–∏–º–æ–≥–æ –ø–æ–ª—É–º‚Äô—è –Ω–µ–º–∞—î, –∞–ª–µ –∑–∞–ø–∞—Ö —Å–ª–∞–±–∫–∏–π —É –ø—ñ–¥–≤–∞–ª—ñ, –¥–∞—Ç—á–∏–∫ —Å–ø—Ä–∞—Ü—é–≤–∞–≤ –≤–Ω–æ—á—ñ. –ß–∞—Å 03:20. –õ—ñ—á–∏–ª—å–Ω–∏–∫ –Ü—Ä–≤—ñ–Ω–≥ G10 ‚Ññ 555222.'
  ].join('\n');
  updCnt();
  log('–ü—ñ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ 3 –ø—Ä–∏–∫–ª–∞–¥–∏ –∑–∞—è–≤–æ–∫');
});
$('#clr').addEventListener('click', ()=>{ $('#txt').value=''; updCnt(); $('#entBody').innerHTML='<tr><td colspan="9" class="muted">‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏¬ª ‚Äî</td></tr>'; $('#steps').innerHTML='<li class="muted">‚Äî –±—É–¥–µ –ø—ñ—Å–ª—è –∞–Ω–∞–ª—ñ–∑—É ‚Äî</li>'; drawRisk([]); });

function splitRecs(text){ return text.split(/\n+/).map(s=>s.trim()).filter(Boolean); }
function updCnt(){ $('#cnt').textContent = String(splitRecs($('#txt').value).length); }
$('#txt').addEventListener('input', updCnt);

/* ===== –õ–æ–∫–∞–ª—å–Ω–∏–π ¬´–º—ñ–Ω—ñ-NLP¬ª ===== */
const RX={
  addr: /((?:–º\.|–º—ñ—Å—Ç–æ|–ö–∏—ó–≤|–ë—Ä–æ–≤–∞—Ä–∏|–Ü—Ä–ø—ñ–Ω—å|–ë—É—á–∞|–í–∏—à–Ω–µ–≤–µ|–ë–æ—Ä–∏—Å–ø—ñ–ª—å|–û–±—É—Ö—ñ–≤|–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞|[\p{Lu}\p{Ll} º‚Äô\-]+)\s*,?\s*(?:–≤—É–ª\.|–≤—É–ª–∏—Ü—è|–ø—Ä–æ—Å–ø\.|–ø—Ä–æ—Å–ø–µ–∫—Ç|–ø—Ä–æ–≤\.|–ø—Ä–æ–≤—É–ª–æ–∫|–ø–ª\.|–ø–ª–æ—â–∞|—à–æ—Å–µ|–ø—Ä-—Ç|–±—É–ª—å–≤\.|–±—É–ª—å–≤–∞—Ä)\s*[\p{L}\d\-\s]+(?:[, ]+(?:–∫–≤\.|–æ—Ñ\.)\s*\d+)?)|((?:–≤—É–ª\.|–≤—É–ª–∏—Ü—è|–ø—Ä–æ—Å–ø–µ–∫—Ç|–±—É–ª—å–≤–∞—Ä)\s*[\p{L}\d\-\s]+(?:\s*\d+)?(?:[, ]+(?:–∫–≤\.|–æ—Ñ\.)\s*\d+)?)|((?:–≤—É–ª\.|–≤—É–ª–∏—Ü—è|–ø—Ä–æ—Å–ø–µ–∫—Ç|–±—É–ª—å–≤–∞—Ä)\s*[\p{L}\d\-\s]+)/ui,
  tel: /(?:\+?380|0)\s?\d{2}\s?\d{3}\s?\d{2}\s?\d{2}|(?:\+?38|)\s?0\d{2}[-\s]?\d{3}[-\s]?\d{2}[-\s]?\d{2}/g,
  name: /(?:–∞–±–æ–Ω–µ–Ω—Ç|–∫–ª—ñ—î–Ω—Ç|–ü–Ü–ë)\s*[:\-]?\s*([A-Z–ê-–Ø–Ü–á–Ñ“ê][\p{L}\.'‚Äô\-]+(?:\s+[A-Z–ê-–Ø–Ü–á–Ñ“ê][\p{L}\.'‚Äô\-]+){0,2}|–¢–û–í ¬´[^¬ª]+¬ª|–§–û–ü [^.,;]+)/u,
  meter: /(G[2-9]|BK\-?G\d+|–Ü—Ä–≤—ñ–Ω–≥\s*G\d+|RS|LV)\s*‚Ññ?\s*([0-9]{5,8})/i,
  press: /(—Ç–∏—Å–∫)\s*([0-9]+(?:[\.,][0-9]+)?)/i,
  time: /\b(0?\d|1\d|2[0-3])[:.]\d{2}\b/,
  danger: /(–ø–æ–ª—É–º'—è|–ø–æ–ª—É–º‚Äô—è|–∑–∞–ø–∞—Ö|—Å–º–µ—Ä–¥|—Å–≤–∏—Å—Ç|—à—É–º|–≤–∏—Ç—ñ–∫|–≤–∏—Ç—ñ–∫–∞—î|—É–¥–∞—Ä|–≤–∏–±—É—Ö|—ñ—Å–∫—Ä|–¥–∞—Ç—á–∏–∫|—Å–ø—Ä–∞—Ü—é–≤–∞–≤|–∫–æ–ø–∞[—é–µ]—Ç—å|—Ä–æ–±–æ—Ç–∏\s+–ø–æ—Ä—É—á)/gi,
  noGas: /(–Ω–µ–º–∞—î\s*–≥–∞–∑—É|–±–µ–∑\s*–≥–∞–∑—É|–Ω–µ–º–∞\s*–≥–∞–∑—É)/i
};
function parseRec(text){
  const addr=(text.match(RX.addr)||[''])[0];
  const tel=(text.match(RX.tel)||[])[0]||'';
  const name=(text.match(RX.name)||[])[1]||'';
  const meterM=text.match(RX.meter); const meter = meterM? (meterM[1].toUpperCase()+' ‚Ññ '+meterM[2]) : '';
  const pressM=text.match(RX.press); const press = pressM? parseFloat(String(pressM[2]).replace(',','.')): null;
  const time=(text.match(RX.time)||[])[0]||'';
  const dangerAll=(text.match(RX.danger)||[]).map(s=>s.toLowerCase());
  const noGas=RX.noGas.test(text);
  const signs = [...new Set(dangerAll)];
  return {raw:text, addr, tel, name, meter, press, time, signs, noGas};
}

/* ===== –û—Ü—ñ–Ω–∫–∞ —Ä–∏–∑–∏–∫—É / –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç ===== */
function assess(r, cfg){
  let score=0; const tags=[];
  const s=r.signs.join(' ');
  // –Ω–µ–±–µ–∑–ø–µ–∫–∞
  if(/–ø–æ–ª—É–º/.test(s)){ score+=cfg.wDanger+30; tags.push('–ø–æ–ª—É–º‚Äô—è'); }
  if(/–∑–∞–ø–∞—Ö/.test(s)){ score+=cfg.wDanger; tags.push('–∑–∞–ø–∞—Ö –≥–∞–∑—É'); }
  if(/—Å–≤–∏—Å—Ç|—à—É–º/.test(s)){ score+=cfg.wDanger*0.7; tags.push('—Å–≤–∏—Å—Ç/—à—É–º'); }
  if(/–≤–∏—Ç—ñ–∫|–≤–∏—Ç—ñ–∫–∞—î/.test(s)){ score+=cfg.wDanger*0.9; tags.push('–ø—ñ–¥–æ–∑—Ä–∞ –≤–∏—Ç–æ–∫—É'); }
  if(/–¥–∞—Ç—á–∏–∫|—Å–ø—Ä–∞—Ü—é–≤–∞–≤/.test(s)){ score+=cfg.wDanger*0.6; tags.push('–¥–∞—Ç—á–∏–∫ —Å–ø—Ä–∞—Ü—é–≤–∞–≤'); }
  if(/–∫–æ–ø–∞|—Ä–æ–±–æ—Ç–∏\s+–ø–æ—Ä—É—á/.test(s)){ score+=20; tags.push('—Ä–æ–±–æ—Ç–∏ –ø–æ—Ä—É—á'); }
  // —Ç–∏—Å–∫ / –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≥–∞–∑—É
  if(r.press!=null){
    if(r.press<0.5){ score+=cfg.wPress+20; tags.push('–Ω–∏–∑—å–∫–∏–π —Ç–∏—Å–∫'); }
    else if(r.press<0.9){ score+=cfg.wPress*0.6; tags.push('–∑–∞–Ω–∏–∂–µ–Ω–∏–π —Ç–∏—Å–∫'); }
  }
  if(r.noGas){ score+=cfg.wPress*0.5; tags.push('–≤—ñ–¥—Å—É—Ç–Ω—ñ–π –≥–∞–∑'); }
  // –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
  const [thr1,thr2]=cfg.thr; // P1>=thr1, P2>=thr2, —ñ–Ω–∞–∫—à–µ P3
  let prio='P3'; if(score>=thr1) prio='P1'; else if(score>=thr2) prio='P2';
  return {score:Math.round(score), prio, tags:[...new Set(tags)]};
}

/* ===== –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó (–¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞) ===== */
function recommend(r, prio){
  const steps=[];
  // –±–∞–∑–æ–≤—ñ –±–µ–∑–ø–µ–∫–∞
  steps.push('1) –ü–æ–ø–µ—Ä–µ–¥–∏—Ç–∏ –∞–±–æ–Ω–µ–Ω—Ç–∞: –Ω–µ –≤–º–∏–∫–∞—Ç–∏ –µ–ª–µ–∫—Ç—Ä–æ–ø—Ä–∏–ª–∞–¥–∏, –Ω–µ –ø–∞–ª–∏—Ç–∏, –ø—Ä–æ–≤—ñ—Ç—Ä–∏—Ç–∏ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è (–∑–∞ –±–µ–∑–ø–µ—á–Ω–∏—Ö —É–º–æ–≤).');
  if(prio==='P1'){
    steps.push('2) –ù–µ–≥–∞–π–Ω–∏–π –≤–∏—ó–∑–¥ –±—Ä–∏–≥–∞–¥–∏. –£—Ç–æ—á–Ω–∏—Ç–∏ –Ω–∞ –ø—ñ–¥‚Äô—ó–∑–¥—ñ: –¥–∂–µ—Ä–µ–ª–æ –∑–∞–ø–∞—Ö—É/—Å–≤–∏—Å—Ç—É, –ø–µ—Ä–µ–∫—Ä–∏—Ç–∏ –∫—Ä–∞–Ω –ø–µ—Ä–µ–¥ –ª—ñ—á–∏–ª—å–Ω–∏–∫–æ–º.');
    steps.push('3) –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏—Ç–æ–∫—ñ–≤: –º–∏–ª—å–Ω–∏–π —Ä–æ–∑—á–∏–Ω/–¥–µ—Ç–µ–∫—Ç–æ—Ä –≥–∞–∑—É, –æ–≥–ª—è–¥ —Å—Ç–æ—è–∫–∞/–≥–Ω—É—á–∫–∏—Ö –ø—ñ–¥–≤–æ–¥–æ–∫/–æ–±–≤‚Äô—è–∑–∫–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞.');
    steps.push('4) –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî –ª–æ–∫–∞–ª—å–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥—ñ–ª—è–Ω–∫–∏/–ø—ñ–¥‚Äô—ó–∑–¥—É, –≤–∏–∫–ª–∏–∫ —Å—É–º—ñ–∂–Ω–∏—Ö —Å–ª—É–∂–± (–î–°–ù–°) –ø—Ä–∏ –∑–∞–≥—Ä–æ–∑—ñ.');
  }else if(prio==='P2'){
    steps.push('2) –í–∏—ó–∑–¥ –ø—Ä–æ—Ç—è–≥–æ–º –Ω–æ—Ä–º–∞—Ç–∏–≤—É. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–∏—Å–∫ –Ω–∞ –≤–≤–æ–¥—ñ, —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –∑‚Äô—î–¥–Ω–∞–Ω—å, –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—é.');
    steps.push('3) –£—Å—É–Ω–µ–Ω–Ω—è –Ω–µ—â—ñ–ª—å–Ω–æ—Å—Ç–µ–π/–∑–∞–º—ñ–Ω–∞ –ø—Ä–æ–∫–ª–∞–¥–æ–∫, –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–¥–∞—á—ñ –ø—ñ—Å–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –±–µ–∑–ø–µ–∫–∏.');
  }else{
    steps.push('2) –í–∏—ó–∑–¥ –ø–ª–∞–Ω–æ–≤–æ/–≤ –º–µ–∂–∞—Ö —á–µ—Ä–≥–∏. –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å–∫–∞—Ä–≥–∏, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –∞–±–æ–Ω–µ–Ω—Ç–∞ —â–æ–¥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó.');
  }
  if(r.press!=null) steps.push(`‚Ä¢ –ó–∞—è–≤–ª–µ–Ω–æ —Ç–∏—Å–∫: ${r.press} (—É–º–æ–≤–Ω. –æ–¥.) ‚Äî –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ —Ñ–∞–∫—Ç–∏—á–Ω—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –ø—Ä–∏ –æ–±—Å—Ç–µ–∂–µ–Ω–Ω—ñ.`);
  if(r.meter) steps.push(`‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—É–∑–æ–ª –æ–±–ª—ñ–∫—É: ${r.meter} (–≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å, —Å—Ç–∞–Ω –ø–ª–æ–º–±–∏).`);
  return steps;
}

/* ===== –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–∏–∑–∏–∫—É ===== */
const cRisk=$('#risk'), gr=cRisk.getContext('2d');
function drawRisk(items){
  const W=cRisk.width,H=cRisk.height; gr.clearRect(0,0,W,H);
  gr.strokeStyle='#223049'; gr.strokeRect(0.5,0.5,W-1,H-1);
  if(items.length===0){ gr.fillStyle='#94a3b8'; gr.fillText('–ì—Ä–∞—Ñ—ñ–∫ —Ä–∏–∑–∏–∫—É –∑‚Äô—è–≤–∏—Ç—å—Å—è –ø—ñ—Å–ª—è –∞–Ω–∞–ª—ñ–∑—É', 16, 24); return; }
  const left=40,right=W-10,top=20,bottom=H-28; const bw=(right-left)/items.length;
  const max=Math.max(100, ...items.map(i=>i.score));
  // —Å—ñ—Ç–∫–∞
  gr.strokeStyle='#1f2a44'; for(let i=0;i<=4;i++){ const y=top+i*(bottom-top)/4; gr.beginPath(); gr.moveTo(left,y); gr.lineTo(right,y); gr.stroke(); }
  // bars
  items.forEach((it,i)=>{
    const x=left+i*bw+4; const h=(it.score/max)*(bottom-top);
    const col = it.prio==='P1'? '#f87171' : it.prio==='P2'? '#fbbf24' : '#22c55e';
    gr.fillStyle=col; gr.fillRect(x, bottom-h, bw-8, h);
    gr.fillStyle='#e5e7eb'; gr.font='11px ui-monospace'; gr.fillText(it.prio, x+2, bottom-4);
  });
}

/* ===== –ê–Ω–∞–ª—ñ–∑ –Ω–∞—Ç–∏—Å–∫–æ–º ===== */
$('#an').addEventListener('click', ()=>{
  const recs = splitRecs($('#txt').value).map(parseRec);
  if(!recs.length){ alert('–ù–µ–º–∞—î —Ç–µ–∫—Å—Ç—ñ–≤'); return; }
  const cfg={
    wDanger: Math.max(0, parseInt($('#wDanger').value)||50),
    wPress: Math.max(0, parseInt($('#wPress').value)||30),
    thr: (function(){ const m=$('#thr').value.split('/').map(s=>parseInt(s.trim())); return [m[0]||70, m[1]||40]; })()
  };
  const rows=$('#entBody'); rows.innerHTML='';
  const scored=[];
  recs.forEach((r,i)=>{
    const a=assess(r,cfg);
    scored.push({...a, idx:i+1});
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td>${escape(r.addr)||'‚Äî'}</td><td>${escape(r.name)||'‚Äî'}</td><td>${escape(r.tel)||'‚Äî'}</td>
    <td>${escape(r.meter)||'‚Äî'}</td><td>${escape((r.signs.join(', ')||'‚Äî'))}</td><td>${r.press!=null?r.press:'‚Äî'}</td><td>${escape(r.time||'‚Äî')}</td>
    <td class="${a.prio==='P1'?'bad':a.prio==='P2'?'warn':'ok'}"><b>${a.prio}</b> ¬∑ ${a.score}</td>`;
    rows.appendChild(tr);
  });
  // –≤–∑—è—Ç–∏ –Ω–∞–π–∫—Ä–∏—Ç–∏—á–Ω—ñ—à—É –¥–ª—è –∞–≤—Ç–æ-–∞–∫—Ç–∞
  const top = scored.slice().sort((a,b)=>b.score-a.score)[0];
  const r0 = recs[top.idx-1];
  fillAct(r0, top);
  // —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
  const steps = recommend(r0, top.prio);
  const ol=$('#steps'); ol.innerHTML=''; steps.forEach(s=>{ const li=document.createElement('li'); li.textContent=s; ol.appendChild(li); });
  // –≥—Ä–∞—Ñ—ñ–∫
  drawRisk(scored);
  log(`–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ ${recs.length} –∑–∞—è–≤(–æ–∫). –¢–æ–ø: #${top.idx} (${top.prio}, ${top.score} –±–∞–ª—ñ–≤).`);
});

function escape(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m])); }

/* ===== –ê–∫—Ç: –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è ===== */
function fillAct(r,a){
  $('#actAddr').value = r.addr||'';
  $('#actName').value = r.name||'';
  $('#actTel').value  = r.tel||'';
  $('#actMeter').value= r.meter||'';
  $('#actPrio').value = a.prio+' ('+a.score+' –±.)';
  $('#actCrew').value = $('#crew').value||'–ê–≤–∞—Ä—ñ–π–Ω–∞-1';
  $('#actDesc').value = (r.raw||'').trim();
  const base = [
    `–í–∏—ó–∑–¥ –±—Ä–∏–≥–∞–¥–∏ ${$('#actCrew').value}.`,
    `–û–≥–ª—è–¥ –º—ñ—Å—Ü—è: ${r.addr||'‚Äî'}.`,
    a.tags.includes('–∑–∞–ø–∞—Ö –≥–∞–∑—É')?'–õ–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∑–∞–ø–∞—Ö, –≤–∏–∫–æ–Ω–∞–Ω–æ –ø—Ä–æ–≤—ñ—Ç—Ä—é–≤–∞–Ω–Ω—è.':'–ó–∞–ø–∞—Ö –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ.',
    a.tags.includes('–ø—ñ–¥–æ–∑—Ä–∞ –≤–∏—Ç–æ–∫—É')||a.tags.includes('—Å–≤–∏—Å—Ç/—à—É–º')?'–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è, –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä, –º–∏–ª—å–Ω–∞ –µ–º—É–ª—å—Å—ñ—è.':'–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –ø—Ä–æ—Ñ—ñ–ª–∞–∫—Ç–∏—á–Ω–∏–π –æ–≥–ª—è–¥.',
    r.meter?`–í—É–∑–æ–ª –æ–±–ª—ñ–∫—É ${r.meter}: –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ—Å—Ç—å/–ø–ª–æ–º–±–∏ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ.`:'–í—É–∑–æ–ª –æ–±–ª—ñ–∫—É –æ–≥–ª—è–Ω—É—Ç–æ.',
    '–ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –≤–∏–∫–æ–Ω–∞–Ω–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è/–æ–±–º–µ–∂–µ–Ω–Ω—è –ø–æ–¥–∞—á—ñ, –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –ø–æ–¥–∞—á—ñ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫.'
  ];
  $('#actActions').value = base.join('\n');
}

/* ===== –ü—ñ–¥–ø–∏—Å –∞–±–æ–Ω–µ–Ω—Ç–∞ (canvas) ===== */
const sig=$('#sig'); const gs=sig.getContext('2d');
let drawing=false,last=[0,0];
function drawLine(x1,y1,x2,y2){ gs.strokeStyle='#e6eef9'; gs.lineWidth=2; gs.lineCap='round'; gs.beginPath(); gs.moveTo(x1,y1); gs.lineTo(x2,y2); gs.stroke(); }
sig.addEventListener('mousedown',e=>{drawing=true; const r=sig.getBoundingClientRect(); last=[e.clientX-r.left,e.clientY-r.top];});
sig.addEventListener('mousemove',e=>{ if(!drawing) return; const r=sig.getBoundingClientRect(); const x=e.clientX-r.left,y=e.clientY-r.top; drawLine(last[0],last[1],x,y); last=[x,y];});
sig.addEventListener('mouseup',()=>drawing=false); sig.addEventListener('mouseleave',()=>drawing=false);
$('#sigClr').addEventListener('click',()=>{ gs.clearRect(0,0,sig.width,sig.height); });

/* ===== –ï–∫—Å–ø–æ—Ä—Ç / —á–µ–∫ / QR ===== */
$('#saveTxt').addEventListener('click',()=>{
  const lines=[
    '–ê–∫—Ç –≤–∏—ó–∑–¥—É (AI-–ø–æ–º—ñ—á–Ω–∏–∫)',
    `–ê–¥—Ä–µ—Å–∞: ${$('#actAddr').value}`,
    `–ê–±–æ–Ω–µ–Ω—Ç: ${$('#actName').value} | –¢–µ–ª: ${$('#actTel').value}`,
    `–õ—ñ—á–∏–ª—å–Ω–∏–∫: ${$('#actMeter').value}`,
    `–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: ${$('#actPrio').value}`,
    `–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å: ${$('#actCrew').value}`,
    '',
    '–û–ø–∏—Å —Å–∏—Ç—É–∞—Ü—ñ—ó:',
    $('#actDesc').value.trim(),
    '',
    '–í–∏–∫–æ–Ω–∞–Ω—ñ –¥—ñ—ó:',
    $('#actActions').value.trim()
  ];
  download('gas_para21_act_'+stamp()+'.txt', lines.join('\n'));
  log('TXT (–∞–∫—Ç) –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
});
$('#saveCsv').addEventListener('click',()=>{
  const rows=$$('#entBody tr'); let csv='idx,address,name,phone,meter,signs,press,time,priority\n';
  rows.forEach((tr,i)=>{
    const tds=tr.querySelectorAll('td'); if(tds.length<9) return;
    csv+=`${i+1},"${tds[1].innerText}","${tds[2].innerText}","${tds[3].innerText}","${tds[4].innerText}","${tds[5].innerText}",${tds[6].innerText},"${tds[7].innerText}","${tds[8].innerText}"\n`;
  });
  download('gas_para21_entities_'+stamp()+'.csv', csv, 'text/csv');
  log('CSV (—Å—É—Ç–Ω–æ—Å—Ç—ñ) –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
});
$('#print58').addEventListener('click',()=>{
  const rc=$('#rc'); rc.hidden=false;
  const lines=[
    '=== AI-HELPER (58–º–º) ===',
    `–ê–¥—Ä–µ—Å–∞: ${($('#actAddr').value||'‚Äî').slice(0,28)}`,
    `–ê–±–æ–Ω–µ–Ω—Ç: ${($('#actName').value||'‚Äî').slice(0,28)}`,
    `–¢–µ–ª: ${($('#actTel').value||'‚Äî')}`,
    `–ü—Ä—ñ–æ—Ä: ${($('#actPrio').value||'‚Äî')}`,
    `–ë—Ä–∏–≥–∞–¥–∞: ${($('#actCrew').value||'‚Äî')}`,
    '--- –î–Ü–á ---',
    ...$('#actActions').value.split('\n').slice(0,6).map(s=>s.slice(0,28)),
    '--------------------------'
  ];
  rc.textContent = lines.join('\n');
  download('gas_para21_receipt_'+stamp()+'.txt', rc.textContent);
  log('–ß–µ–∫ 58 –º–º –∑–±–µ—Ä–µ–∂–µ–Ω–æ (TXT)');
});
$('#qrGen').addEventListener('click',()=>{
  const data = prompt('–í—Å—Ç–∞–≤ URL/—Ç–µ–∫—Å—Ç (–ø–∞–ø–∫–∞ –∑ –¥–æ–∫–∞–∑–∞–º–∏/—Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ):', 'https://');
  if(data===null) return;
  const url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=2&data='+encodeURIComponent(data);
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.drawImage(img,0,0,220,220); };
  img.onerror=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.fillStyle='#e5e7eb'; q.font='14px ui-monospace'; q.fillText('QR offline', 62,110); q.fillText((data.length>14?data.slice(0,14)+'‚Ä¶':data), 36,132); };
  img.src=url;
  log('QR –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ');
});

/* ===== –ü–æ—á–∞—Ç–∫–æ–≤—ñ —Ä–∞–º–∫–∏ –≥—Ä–∞—Ñ—ñ–∫–∞ ===== */
function initRisk(){ gr.clearRect(0,0,cRisk.width,cRisk.height); gr.strokeStyle='#223049'; gr.strokeRect(0.5,0.5,cRisk.width-1,cRisk.height-1); }
initRisk();
</script>
</body>
</html>
