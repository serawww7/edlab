<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 2 (–≥–∞–∑–æ–≤–∏–∫–∏) ‚Äî –ú–∞—Ä—à—Ä—É—Ç –±—Ä–∏–≥–∞–¥–∏: –∑—É–ø–∏–Ω–∫–∏, NFC, —Ñ–æ—Ç–æ/–∞—É–¥—ñ–æ, —Ç–∞–π–º–ª–∞–π–Ω, —á–µ–∫ 58 –º–º, CSV/QR</title>
<meta name="description" content="–ú–∞—Ä—à—Ä—É—Ç–Ω–∏–π –ª–∏—Å—Ç –±—Ä–∏–≥–∞–¥–∏: –¥–æ–¥–∞–π –∑—É–ø–∏–Ω–∫–∏, —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–π –æ–±‚Äô—î–∫—Ç–∏ NFC/–∫–æ–¥–æ–º, —Ä–æ–±–∏ —Ñ–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è —ñ –≥–æ–ª–æ—Å–æ–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏, —Ñ—ñ–∫—Å—É–π —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å, –±—É–¥—É–π –≥—Ä–∞—Ñ—ñ–∫ —Ç–∞–π–º–ª–∞–π–Ω, –¥—Ä—É–∫—É–π —á–µ–∫ 58 –º–º, –µ–∫—Å–ø–æ—Ä—Ç—É–π CSV/QR.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1280px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.grid{display:grid;gap:14px;grid-template-columns:1.25fr 1fr}
@media(max-width:1140px){.grid{grid-template-columns:1fr}}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:90px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
small.mono,.mono{font-family:ui-monospace,monospace}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
canvas.chart{display:block;width:100%;height:220px;background:#0b1220;border:1px solid var(--line);border-radius:12px}
.canvasWrap{overflow:hidden;border-radius:12px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace;white-space:pre;min-height:140px}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.photo{width:100%;max-width:240px;border:1px solid var(--line);border-radius:12px;display:block}
.gallery{display:flex;gap:8px;flex-wrap:wrap}
.stop{border:1px dashed var(--line);border-radius:12px;padding:10px;margin-top:10px;background:#0c182a}
.stop h3{margin:0 0 8px 0;font-size:1.05rem}
.stop .minirow{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
hr.sep{border:none;border-top:1px solid var(--line);margin:10px 0}
</style>
<link rel="canonical" href="https://edlab.pp.ua/gas_II_kyrs/gas_para2.html"><meta property="og:type" content="article"><meta property="og:title" content="–ì–∞–∑–æ–≤–∏–∫–∏ ‚Äî –ü–∞—Ä–∞ 2"><meta property="og:description" content="–°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Ä—à—Ä—É—Ç–Ω–∏–π –ª–∏—Å—Ç –Ω–∞ –¥–µ–Ω—å: –¥–æ–¥–∞—î–º–æ –∑—É–ø–∏–Ω–∫–∏ (–∞–¥—Ä–µ—Å–∏/—Ç–∏–ø–∏ —Ä–æ–±—ñ—Ç), —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î–º–æ –∫–æ–∂–µ–Ω –æ–±‚Äô—î–∫—Ç —á–µ—Ä–µ–∑ NFC –∞–±–æ –∫–æ–¥, —Ä–æ–±–∏–º–æ —Ñ–æ—Ç–æ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª —ñ –≥–æ–ª–æ—Å–æ–≤—ñ –Ω–æ—Ç"><meta property="og:url" content="https://edlab.pp.ua/gas_II_kyrs/gas_para2.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ì–∞–∑–æ–≤–∏–∫–∏ ‚Äî –ü–∞—Ä–∞ 2","description":"–°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Ä—à—Ä—É—Ç–Ω–∏–π –ª–∏—Å—Ç –Ω–∞ –¥–µ–Ω—å: –¥–æ–¥–∞—î–º–æ –∑—É–ø–∏–Ω–∫–∏ (–∞–¥—Ä–µ—Å–∏/—Ç–∏–ø–∏ —Ä–æ–±—ñ—Ç), —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î–º–æ –∫–æ–∂–µ–Ω –æ–±‚Äô—î–∫—Ç —á–µ—Ä–µ–∑ NFC –∞–±–æ –∫–æ–¥, —Ä–æ–±–∏–º–æ —Ñ–æ—Ç–æ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª —ñ –≥–æ–ª–æ—Å–æ–≤—ñ –Ω–æ—Ç","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/gas_II_kyrs/gas_para2.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üß≠</span>
      <div>
        <b>–ü–∞—Ä–∞ 2 ‚Äî –ú–∞—Ä—à—Ä—É—Ç –±—Ä–∏–≥–∞–¥–∏</b><br>
        <span class="badge">–ó—É–ø–∏–Ω–∫–∏ ‚Üí NFC/–∫–æ–¥ ‚Üí —Ñ–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è ‚Üí –∞—É–¥—ñ–æ ‚Üí —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å ‚Üí —Ç–∞–π–º–ª–∞–π–Ω ‚Üí —á–µ–∫ 58 –º–º ‚Üí CSV/QR</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <!-- –í–≤—ñ–¥–Ω—ñ -->
  <div class="card">
    <h2>üìö –°—Ü–µ–Ω–∞—Ä—ñ–π –∑–∞–Ω—è—Ç—Ç—è</h2>
    <p>–°—Ç–≤–æ—Ä—é—î–º–æ <b>–º–∞—Ä—à—Ä—É—Ç–Ω–∏–π –ª–∏—Å—Ç</b> –Ω–∞ –¥–µ–Ω—å: –¥–æ–¥–∞—î–º–æ <b>–∑—É–ø–∏–Ω–∫–∏</b> (–∞–¥—Ä–µ—Å–∏/—Ç–∏–ø–∏ —Ä–æ–±—ñ—Ç), —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î–º–æ –∫–æ–∂–µ–Ω –æ–±‚Äô—î–∫—Ç —á–µ—Ä–µ–∑ <b>NFC</b> –∞–±–æ –∫–æ–¥, —Ä–æ–±–∏–º–æ <b>—Ñ–æ—Ç–æ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª</b> —ñ <b>–≥–æ–ª–æ—Å–æ–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏</b>, —Ñ—ñ–∫—Å—É—î–º–æ <b>—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</b> —Ä–æ–±—ñ—Ç —ñ –æ—Ç—Ä–∏–º—É—î–º–æ <b>—Ç–∞–π–º–ª–∞–π–Ω</b>. –ù–∞–ø—Ä–∏–∫—ñ–Ω—Ü—ñ ‚Äî <b>—á–µ–∫ 58 –º–º</b>, <b>CSV/TXT</b>, <b>QR</b>.</p>
    <div class="row">
      <label style="flex:1">–î–∞—Ç–∞<input id="day" class="input" type="date"></label>
      <label style="flex:1">–ë—Ä–∏–≥–∞–¥–∞ (–ü–Ü–ë)<input id="crew" class="input" placeholder="–°–ª–∞–≤—ñ–Ω—Å—å–∫–∏–π –í., –ö–æ—à—É—Ç–∞ –í."></label>
      <label style="flex:1">–î–∏—Å–ø–µ—Ç—á–µ—Ä<input id="disp" class="input" placeholder="–ë–∞–ª–∞–Ω—á—É–∫ –û."></label>
    </div>
    <div class="row">
      <button class="btn good" id="mkRoute">üß∞ –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</button>
      <button class="btn" id="addStop">‚ûï –î–æ–¥–∞—Ç–∏ –∑—É–ø–∏–Ω–∫—É</button>
      <button class="btn secondary" id="addExamples">üß™ –ü—Ä–∏–∫–ª–∞–¥–∏ –∑—É–ø–∏–Ω–æ–∫ (3)</button>
      <span class="badge" id="rid">–ú–∞—Ä—à—Ä—É—Ç: ‚Äî</span>
      <span class="badge" id="sCount">–ó—É–ø–∏–Ω–æ–∫: 0</span>
    </div>
    <div class="row">
      <div class="badge">–ê–∫—Ç–∏–≤–Ω–∞ –∑—É–ø–∏–Ω–∫–∞:</div>
      <select id="activeSel" class="input" style="max-width:260px"></select>
      <button class="btn secondary" id="delStop">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É</button>
    </div>
  </div>

  <div class="grid">
    <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: –ó—É–ø–∏–Ω–∫–∏ + –ö–∞–º–µ—Ä–∞ + –ê—É–¥—ñ–æ -->
    <div class="card">
      <h2>üõë –ó—É–ø–∏–Ω–∫–∏ –º–∞—Ä—à—Ä—É—Ç—É</h2>
      <div id="stops"></div>

      <hr class="sep">

      <h2>üé• –ö–∞–º–µ—Ä–∞ —Ç–∞ —Ñ–æ—Ç–æ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª (–¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏)</h2>
      <div class="row">
        <video id="vid" class="photo" autoplay="" playsinline="" muted=""></video>
        <div>
          <button class="btn" id="camOn">üé• –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</button>
          <button class="btn" id="shotBefore">üì∑ –§–æ—Ç–æ ¬´–¥–æ¬ª</button>
          <button class="btn" id="shotAfter">üì∑ –§–æ—Ç–æ ¬´–ø—ñ—Å–ª—è¬ª</button><br>
          <small class="muted">–§–æ—Ç–æ –ø—Ä–∏–≤‚Äô—è–∑—É—é—Ç—å—Å—è –¥–æ <b>–∞–∫—Ç–∏–≤–Ω–æ—ó</b> –∑—É–ø–∏–Ω–∫–∏.</small>
        </div>
      </div>
      <div class="gallery" id="gal"></div>

      <h2 style="margin-top:10px">üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞ (–¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏)</h2>
      <div class="row">
        <button class="btn" id="recStart">‚è∫Ô∏è –ó–∞–ø–∏—Å</button>
        <button class="btn secondary" id="recStop" disabled="">‚èπÔ∏è –°—Ç–æ–ø</button>
        <span class="badge" id="rstat">–ù–µ–º–∞—î –∑–∞–ø–∏—Å—É</span>
      </div>
      <audio id="player" controls="" style="margin-top:8px;max-width:100%"></audio>
    </div>

    <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: –¢–∞–π–º–ª–∞–π–Ω/–û—Ü—ñ–Ω–∫–∞/–ï–∫—Å–ø–æ—Ä—Ç -->
    <div class="card">
      <h2>üïí –¢–∞–π–º–ª–∞–π–Ω —ñ –º–µ—Ç—Ä–∏–∫–∏</h2>
      <div class="canvasWrap"><canvas id="timeline" class="chart" width="520" height="220"></canvas></div>
      <table class="tbl" style="margin-top:8px">
        <tbody>
          <tr><th>–ó—É–ø–∏–Ω–æ–∫</th><td id="mStops">0</td></tr>
          <tr><th>–§–æ—Ç–æ (–¥–æ/–ø—ñ—Å–ª—è)</th><td id="mPhotos">0 / 0</td></tr>
          <tr><th>–ê—É–¥—ñ–æ-–Ω–æ—Ç–∞—Ç–æ–∫</th><td id="mAud">0</td></tr>
          <tr><th>–°—É–º–∞ —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ, —Ö–≤</th><td id="mDur">0</td></tr>
          <tr><th>–°—Ç–∞—Ç—É—Å</th><td id="mState"><b class="warn">–ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫—Ä–æ–∫–∏</b></td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <ul>
        <li>–ú–∞—Ä—à—Ä—É—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ (–¥–∞—Ç–∞/–±—Ä–∏–≥–∞–¥–∞/–¥–∏—Å–ø–µ—Ç—á–µ—Ä) ‚Äî <b>2</b></li>
        <li>‚â•3 –∑—É–ø–∏–Ω–∫–∏ –∑ –∞–¥—Ä–µ—Å–æ—é/—Ç–∏–ø–æ–º —Ä–æ–±—ñ—Ç ‚Äî <b>2</b></li>
        <li>NFC/–∫–æ–¥ –Ω–∞ –∫–æ–∂–Ω—ñ–π –∑—É–ø–∏–Ω—Ü—ñ ‚Äî <b>2</b></li>
        <li>–§–æ—Ç–æ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª ‚â•2 –∑—É–ø–∏–Ω–∫–∏ ‚Äî <b>2</b></li>
        <li>–ê—É–¥—ñ–æ-–Ω–æ—Ç–∞—Ç–∫–∏ ‚â•1 –∑—É–ø–∏–Ω–∫–∞ ‚Äî <b>1</b></li>
        <li>–¢–∞–π–º–ª–∞–π–Ω (–≤–Ω–µ—Å–µ–Ω—ñ —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ) ‚Äî <b>1</b></li>
      </ul>

      <h2 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç / –¥—Ä—É–∫</h2>
      <div class="row">
        <button class="btn" id="saveCsv">üìÑ CSV (–º–∞—Ä—à—Ä—É—Ç+–∑—É–ø–∏–Ω–∫–∏)</button>
        <button class="btn" id="saveTxt">üíæ TXT (–ø—ñ–¥—Å—É–º–æ–∫)</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="qrGen">üîó QR (Route ID/–ø–æ—Å–∏–ª–∞–Ω–Ω—è)</button>
      </div>
      <div id="rc" class="receipt" hidden=""></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="qr" width="220" height="220"></canvas></div>

      <h2 style="margin-top:10px">üõéÔ∏è –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</h2>
      <pre id="alog" class="card" style="max-height:220px;overflow:auto;margin-top:6px">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>
    </div>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time id="upd"></time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function log(msg){const t=new Date().toLocaleTimeString();const box=$('#alog');if(box.textContent.startsWith('//'))box.textContent='';box.textContent+=`[${t}] ${msg}\n`;box.scrollTop=box.scrollHeight;}
function clean(s){return String(s).replace(/\s+/g,' ').trim();}

$('#upd').textContent = new Date().toLocaleDateString('uk-UA');

// ===== –î–∞–Ω—ñ –º–∞—Ä—à—Ä—É—Ç—É =====
let ROUTE_ID=null;
let STOPS=[]; // {id, addr, job, contact, asset, beforeImg, afterImg, audioUrl, durMin}
function uid(p='S'){ return p+'-'+Math.random().toString(36).slice(2,7).toUpperCase(); }

function refreshStopsUI(){
  $('#stops').innerHTML='';
  const sel=$('#activeSel'); const had=sel.value;
  sel.innerHTML='';
  STOPS.forEach((s,i)=>{
    // —Å–µ–ª–µ–∫—Ç–æ—Ä
    const opt=document.createElement('option'); opt.value=s.id; opt.textContent=`${i+1}. ${s.addr||'(–±–µ–∑ –∞–¥—Ä–µ—Å–∏)'} ‚Äî ${s.job||'—Ç–∏–ø?'}`; sel.appendChild(opt);
    // –±–ª–æ–∫ –∑—É–ø–∏–Ω–∫–∏
    const d=document.createElement('div'); d.className='stop'; d.dataset.sid=s.id;
    d.innerHTML = `
      <h3>–ó—É–ø–∏–Ω–∫–∞ #${i+1} <span class="badge mono">${s.id}</span></h3>
      <div class="minirow">
        <label style="flex:2">–ê–¥—Ä–µ—Å–∞<input class="input in-addr" value="${s.addr||''}" placeholder="–º. –¢–∞–ª—å–Ω–µ, –≤—É–ª. –®–µ–≤—á–µ–Ω–∫–∞, 10"/></label>
        <label style="flex:1">–¢–∏–ø —Ä–æ–±—ñ—Ç
          <select class="input in-job">
            <option ${s.job==='–û–≥–ª—è–¥ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞'?'selected':''}>–û–≥–ª—è–¥ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞</option>
            <option ${s.job==='–£—Å—É–Ω–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—É'?'selected':''}>–£—Å—É–Ω–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—É</option>
            <option ${s.job==='–ó–∞–º—ñ–Ω–∞ –∫—Ä–∞–Ω–∞/—à–ª–∞–Ω–≥–∞'?'selected':''}>–ó–∞–º—ñ–Ω–∞ –∫—Ä–∞–Ω–∞/—à–ª–∞–Ω–≥–∞</option>
            <option ${s.job==='–û–ø–ª–æ–º–±—É–≤–∞–Ω–Ω—è'?'selected':''}>–û–ø–ª–æ–º–±—É–≤–∞–Ω–Ω—è</option>
            <option ${s.job==='–ü—É—Å–∫ –≥–∞–∑—É'?'selected':''}>–ü—É—Å–∫ –≥–∞–∑—É</option>
          </select>
        </label>
        <label style="flex:1">–ö–æ–Ω—Ç–∞–∫—Ç<input class="input in-contact" value="${s.contact||''}" placeholder="+380..."/></label>
      </div>
      <div class="minirow" style="margin-top:6px">
        <button class="btn btn-nfc">üì∂ NFC</button>
        <input class="input in-asset" placeholder="ID –æ–±‚Äô—î–∫—Ç–∞ (—è–∫—â–æ NFC –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π)" value="${s.asset||''}"/>
        <button class="btn secondary btn-asset">üíæ –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
        <span class="badge">–§–æ—Ç–æ: <b class="phc">${s.beforeImg?1:0} / ${s.afterImg?1:0}</b></span>
        <span class="badge">–ê—É–¥—ñ–æ: <b class="audc">${s.audioUrl?'—î':'–Ω–µ–º–∞—î'}</b></span>
      </div>
      <div class="minirow" style="margin-top:6px">
        <label>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å, —Ö–≤<input type="number" min="0" step="1" class="input in-dur" value="${Number.isFinite(s.durMin)?s.durMin:0}"/></label>
      </div>
      <div class="gallery gal-stop">${s.beforeImg?`<img class="photo" src="${s.beforeImg}" alt="–¥–æ"/>`:''}${s.afterImg?`<img class="photo" src="${s.afterImg}" alt="–ø—ñ—Å–ª—è"/>`:''}</div>
    `;
    $('#stops').appendChild(d);
  });
  // –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π –≤–∏–±—ñ—Ä
  const exists = STOPS.some(s=>s.id===had);
  sel.value = exists? had : (STOPS[0]?.id || '');
  updateMetrics();
  drawTimeline();
}

function addStop(data={}){
  STOPS.push({
    id: uid(),
    addr: data.addr||'',
    job: data.job||'–û–≥–ª—è–¥ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞',
    contact: data.contact||'',
    asset: data.asset||'',
    beforeImg: data.beforeImg||null,
    afterImg: data.afterImg||null,
    audioUrl: data.audioUrl||null,
    durMin: Number.isFinite(data.durMin)?data.durMin:0
  });
  refreshStopsUI();
  $('#sCount').textContent='–ó—É–ø–∏–Ω–æ–∫: '+STOPS.length;
  log('–î–æ–¥–∞–Ω–æ –∑—É–ø–∏–Ω–∫—É');
}

function removeActive(){
  const sid=$('#activeSel').value;
  if(!sid) return;
  STOPS = STOPS.filter(s=>s.id!==sid);
  refreshStopsUI();
  $('#sCount').textContent='–ó—É–ø–∏–Ω–æ–∫: '+STOPS.length;
  log('–í–∏–¥–∞–ª–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—É –∑—É–ø–∏–Ω–∫—É');
}

// –ø–æ–¥—ñ—ó –≤ —Å–ø–∏—Å–∫—É –∑—É–ø–∏–Ω–æ–∫ (–¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è)
$('#stops').addEventListener('input',(e)=>{
  const wrap=e.target.closest('.stop'); if(!wrap) return;
  const sid=wrap.dataset.sid; const s=STOPS.find(x=>x.id===sid); if(!s) return;
  if(e.target.classList.contains('in-addr')) s.addr = clean(e.target.value);
  if(e.target.classList.contains('in-job')) s.job = e.target.value;
  if(e.target.classList.contains('in-contact')) s.contact = clean(e.target.value);
  if(e.target.classList.contains('in-asset')) { /* —Ä—É—á–Ω–µ –ø–æ–ª–µ, –∑–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –Ω–∞ –∫–Ω–æ–ø–∫—É */ }
  if(e.target.classList.contains('in-dur')) { s.durMin = Math.max(0, parseInt(e.target.value)||0); drawTimeline(); updateMetrics(); }
});

$('#stops').addEventListener('click', async (e)=>{
  const wrap=e.target.closest('.stop'); if(!wrap) return;
  const sid=wrap.dataset.sid; const s=STOPS.find(x=>x.id===sid); if(!s) return;
  if(e.target.classList.contains('btn-asset')){
    const val = clean(wrap.querySelector('.in-asset').value||'');
    if(!val){ alert('–í–≤–µ–¥–∏ ID –æ–±‚Äô—î–∫—Ç–∞'); return; }
    s.asset=val; updateMetrics(); log(`–ó—É–ø–∏–Ω–∫–∞ ${sid}: –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ ID –æ–±‚Äô—î–∫—Ç–∞: ${val}`);
  }
  if(e.target.classList.contains('btn-nfc')){
    if('NDEFReader' in window){
      try{
        const reader=new NDEFReader(); await reader.scan();
        log('–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è NFC...');
        reader.addEventListener('reading', ({message, serialNumber})=>{
          let text=''; for(const rec of message.records){ if(rec.recordType==='text'){ const dec=new TextDecoder(rec.encoding||'utf-8'); text = dec.decode(rec.data); } }
          s.asset = (text||serialNumber||('NFC-'+uid().slice(2))).toString();
          wrap.querySelector('.in-asset').value = s.asset;
          log(`–ó—á–∏—Ç–∞–Ω–æ NFC –¥–ª—è –∑—É–ø–∏–Ω–∫–∏ ${sid}: ${s.asset}`);
          updateMetrics();
        });
      }catch(err){ alert('NFC –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π/–∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏–π'); }
    }else{
      alert('Web NFC –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è. –í–≤–µ–¥–∏ –∫–æ–¥ –≤—Ä—É—á–Ω—É.');
    }
  }
});

// ===== –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∏ =====
$('#mkRoute').addEventListener('click',()=>{
  const day=$('#day').value, crew=clean($('#crew').value||''), disp=clean($('#disp').value||'');
  if(!day||!crew||!disp){ alert('–í–∫–∞–∂–∏ –¥–∞—Ç—É, –±—Ä–∏–≥–∞–¥—É —Ç–∞ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞'); return; }
  ROUTE_ID = 'R-'+Math.random().toString(36).slice(2,8).toUpperCase();
  $('#rid').textContent = '–ú–∞—Ä—à—Ä—É—Ç: '+ROUTE_ID;
  log(`–°—Ç–≤–æ—Ä–µ–Ω–æ –º–∞—Ä—à—Ä—É—Ç ${ROUTE_ID} (–¥–∞—Ç–∞ ${day}, –±—Ä–∏–≥–∞–¥–∞: ${crew}, –¥–∏—Å–ø–µ—Ç—á–µ—Ä: ${disp})`);
  updateMetrics();
});
$('#addStop').addEventListener('click',()=>addStop({}));
$('#delStop').addEventListener('click', removeActive);
$('#addExamples').addEventListener('click',()=>{
  addStop({addr:'–º. –¢–∞–ª—å–Ω–µ, –≤—É–ª. –°–æ–±–æ—Ä–Ω–∞, 21', job:'–û–≥–ª—è–¥ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞', contact:'+38067...', durMin:25});
  addStop({addr:'—Å–º—Ç. –õ–∏—Å—è–Ω–∫–∞, –≤—É–ª. –®–µ–≤—á–µ–Ω–∫–∞, 8', job:'–û–ø–ª–æ–º–±—É–≤–∞–Ω–Ω—è', contact:'+38096...', durMin:18});
  addStop({addr:'–º. –ú–∞–Ω—å–∫—ñ–≤–∫–∞, –≤—É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞, 3', job:'–£—Å—É–Ω–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—É', contact:'+38050...', durMin:40});
  log('–î–æ–¥–∞–Ω–æ 3 –ø—Ä–∏–∫–ª–∞–¥–∏ –∑—É–ø–∏–Ω–æ–∫');
});

// ===== –ê–∫—Ç–∏–≤–Ω–∞ –∑—É–ø–∏–Ω–∫–∞ =====
$('#activeSel').addEventListener('change', renderActiveArtifacts);
function activeStop(){
  const sid=$('#activeSel').value; return STOPS.find(s=>s.id===sid)||null;
}

// ===== –ö–∞–º–µ—Ä–∞ / —Ñ–æ—Ç–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏ =====
let stream=null;
async function startCam(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    $('#vid').srcObject = stream;
    log('–ö–∞–º–µ—Ä—É —É–≤—ñ–º–∫–Ω–µ–Ω–æ');
  }catch(e){ alert('–ö–∞–º–µ—Ä—É –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –∞–±–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'); }
}
$('#camOn').addEventListener('click', startCam);

function takeShot(kind){
  const s=activeStop(); if(!s){ alert('–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏'); return; }
  const video=$('#vid'); if(!video.srcObject){ alert('–°–ø–µ—Ä—à—É —É–≤—ñ–º–∫–Ω–∏ –∫–∞–º–µ—Ä—É'); return; }
  const c=document.createElement('canvas'); c.width=video.videoWidth||640; c.height=video.videoHeight||480;
  const g=c.getContext('2d'); g.drawImage(video,0,0,c.width,c.height);
  const url=c.toDataURL('image/png');
  if(kind==='–¥–æ') s.beforeImg=url; else s.afterImg=url;
  renderStopGallery(s.id);
  renderActiveArtifacts();
  updateMetrics();
  log(`–ó—É–ø–∏–Ω–∫–∞ ${s.id}: –∑–Ω—è—Ç–æ —Ñ–æ—Ç–æ ¬´${kind}¬ª`);
}
$('#shotBefore').addEventListener('click',()=>takeShot('–¥–æ'));
$('#shotAfter').addEventListener('click',()=>takeShot('–ø—ñ—Å–ª—è'));

function renderStopGallery(sid){
  const s=STOPS.find(x=>x.id===sid); if(!s) return;
  const wrap=$(`[data-sid="${sid}"]`);
  const gal=wrap.querySelector('.gal-stop'); gal.innerHTML='';
  if(s.beforeImg){ const i=document.createElement('img'); i.className='photo'; i.src=s.beforeImg; i.alt='–¥–æ'; gal.appendChild(i); }
  if(s.afterImg){ const i=document.createElement('img'); i.className='photo'; i.src=s.afterImg; i.alt='–ø—ñ—Å–ª—è'; gal.appendChild(i); }
  wrap.querySelector('.phc').textContent = (s.beforeImg?1:0)+' / '+(s.afterImg?1:0);
}

// –ü–ª–∏—Ç–∫–∞ –ø—ñ–¥ –≤—ñ–¥–µ–æ –∑ –∞–∫—Ç–∏–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏
function renderActiveArtifacts(){
  const s=activeStop(); const box=$('#gal'); box.innerHTML='';
  if(!s) return;
  if(s.beforeImg){ const i=document.createElement('img'); i.className='photo'; i.src=s.beforeImg; i.alt='–¥–æ'; box.appendChild(i); }
  if(s.afterImg){ const i=document.createElement('img'); i.className='photo'; i.src=s.afterImg; i.alt='–ø—ñ—Å–ª—è'; box.appendChild(i); }
  $('#rstat').textContent = s.audioUrl?'–ó–∞–ø–∏—Å –≥–æ—Ç–æ–≤–∏–π':'–ù–µ–º–∞—î –∑–∞–ø–∏—Å—É';
  $('#player').src = s.audioUrl||'';
}

// ===== –ê—É–¥—ñ–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏ =====
let mediaRec=null; let chunks=[];
$('#recStart').addEventListener('click', async ()=>{
  const s=activeStop(); if(!s){ alert('–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏'); return; }
  try{
    const st = await navigator.mediaDevices.getUserMedia({audio:true, video:false});
    mediaRec = new MediaRecorder(st);
    chunks=[];
    mediaRec.ondataavailable = e=>{ if(e.data.size>0) chunks.push(e.data); };
    mediaRec.onstop = ()=>{
      const blob=new Blob(chunks,{type:'audio/webm'});
      const url=URL.createObjectURL(blob);
      s.audioUrl = url;
      $('#player').src=url;
      $('#rstat').textContent='–ó–∞–ø–∏—Å –≥–æ—Ç–æ–≤–∏–π';
      // –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
      const a=document.createElement('a'); a.href=url; a.download=`voice_${s.id}_`+stamp()+'.webm'; document.body.appendChild(a); a.click(); a.remove();
      updateMetrics();
      log(`–ó—É–ø–∏–Ω–∫–∞ ${s.id}: –≥–æ–ª–æ—Å–æ–≤—É –Ω–æ—Ç–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ`);
    };
    mediaRec.start();
    $('#recStart').disabled=true; $('#recStop').disabled=false;
    $('#rstat').textContent='–ô–¥–µ –∑–∞–ø–∏—Å...';
    log('–ü–æ—á–∞—Ç–æ –∞—É–¥—ñ–æ–∑–∞–ø–∏—Å');
  }catch(e){ alert('–ú—ñ–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π'); }
});
$('#recStop').addEventListener('click', ()=>{
  if(mediaRec && mediaRec.state!=='inactive'){ mediaRec.stop(); }
  $('#recStart').disabled=false; $('#recStop').disabled=true;
});

// ===== –¢–∞–π–º–ª–∞–π–Ω (–≥—Ä–∞—Ñ—ñ–∫ —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç–µ–π) =====
const tl=$('#timeline'), gt=tl.getContext('2d');
function drawTimeline(){
  const W=tl.width,H=tl.height; gt.clearRect(0,0,W,H);
  gt.strokeStyle='#223049'; gt.strokeRect(0.5,0.5,W-1,H-1);
  gt.fillStyle='#94a3b8'; gt.font='11px ui-monospace';
  gt.fillText('–¢–∞–π–º–ª–∞–π–Ω —Ä–æ–±—ñ—Ç (–ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∑—É–ø–∏–Ω–æ–∫, —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ö–≤)', 12, 16);
  const left=40,right=W-10,top=24,bottom=H-30;
  gt.strokeStyle='#334155'; gt.beginPath(); gt.moveTo(left,bottom); gt.lineTo(right,bottom); gt.stroke();
  const total = STOPS.reduce((sum,s)=>sum+(Number.isFinite(s.durMin)?s.durMin:0),0);
  const span = Math.max(1,total||1);
  // –º–∞—Å—à—Ç–∞–± –ø–æ X = –Ω–∞–∫–æ–ø–∏—á–µ–Ω–∏–π —á–∞—Å, –ø–æ Y ‚Äî —Ä—ñ–≤–Ω—ñ (—Ä—è–¥–æ–∫)
  let acc=0; let y=bottom-10;
  STOPS.forEach((s,i)=>{
    const w = ((s.durMin||0)/span)*(right-left);
    const x = left + (acc/span)*(right-left);
    gt.fillStyle='#38bdf8'; gt.fillRect(x, y-12, Math.max(4,w), 12);
    gt.fillStyle='#e5e7eb'; gt.fillText(String(i+1), x+2, y-2);
    acc += (s.durMin||0);
    y -= 16; if(y<top+16) y=bottom-10; // –ø—Ä–æ—Å—Ç–∏–π –ø–µ—Ä–µ–Ω–æ—Å —Ä—è–¥–∫–∞
  });
  // –º—ñ—Ç–∫–∏ –Ω–∏–∑—É: 0, 25%, 50%, 75%, 100%
  gt.fillStyle='#94a3b8';
  ['0%','25%','50%','75%','100%'].forEach((t,k)=>gt.fillText(t, left + k*(right-left)/4 -8, H-8));
}

function updateMetrics(){
  const photos = STOPS.reduce((a,s)=>[a[0]+(s.beforeImg?1:0), a[1]+(s.afterImg?1:0)], [0,0]);
  const aud = STOPS.reduce((a,s)=>a+(s.audioUrl?1:0), 0);
  const dur = STOPS.reduce((a,s)=>a+(Number.isFinite(s.durMin)?s.durMin:0), 0);
  $('#mStops').textContent = STOPS.length;
  $('#mPhotos').textContent = `${photos[0]} / ${photos[1]}`;
  $('#mAud').textContent = String(aud);
  $('#mDur').textContent = String(dur);
  // —Å—Ç–∞—Ç—É—Å-–æ—Ü—ñ–Ω–∫–∞
  const hasRoute = !!ROUTE_ID;
  const manyStops = STOPS.length>=3 && STOPS.every(s=>s.addr && s.job);
  const allAssets = STOPS.length>0 && STOPS.every(s=> (s.asset && s.asset.trim().length>0) );
  const imgOK = STOPS.filter(s=>s.beforeImg && s.afterImg).length>=2;
  const audOK = aud>=1;
  const tlOK = dur>0;
  let score=0; if(hasRoute)score+=2; if(manyStops)score+=2; if(allAssets)score+=2; if(imgOK)score+=2; if(audOK)score+=1; if(tlOK)score+=1;
  const state = score>=9? `<b class="ok">–ì–æ—Ç–æ–≤–æ (‚âà${score}/10)</b>`:
                score>=6? `<b class="warn">–ë—ñ–ª—å—à—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–æ (‚âà${score}/10)</b>`:
                          `<b class="bad">–ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ—Ä–æ–±–∏—Ç–∏ (‚âà${score}/10)</b>`;
  $('#mState').innerHTML = state;
  drawTimeline();
}

// ===== –ï–∫—Å–ø–æ—Ä—Ç / —á–µ–∫ / QR =====
function routeHeader(){
  return {
    route: ROUTE_ID||'‚Äî',
    day: $('#day').value||'‚Äî',
    crew: $('#crew').value||'‚Äî',
    dispatcher: $('#disp').value||'‚Äî',
    stops: STOPS.length
  };
}
$('#saveCsv').addEventListener('click',()=>{
  const h=routeHeader();
  let csv='field,value\n';
  Object.entries(h).forEach(([k,v])=>{ csv+=`${k},${String(v).replace(/,/g,';')}\n`; });
  csv+='\n# stops\nidx,id,address,job,contact,asset,dur_min,photo_before,photo_after,audio\n';
  STOPS.forEach((s,i)=>{
    csv+=`${i+1},${s.id},"${(s.addr||'').replace(/"/g,'""')}",${s.job},${s.contact||''},${s.asset||''},${s.durMin||0},${s.beforeImg?'yes':'no'},${s.afterImg?'yes':'no'},${s.audioUrl?'yes':'no'}\n`;
  });
  download('gas_para02_route_'+stamp()+'.csv', csv, 'text/csv');
  log('–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ CSV');
});
$('#saveTxt').addEventListener('click',()=>{
  const h=routeHeader();
  const lines=[
    '–ü–∞—Ä–∞ 2 ‚Äî –ú–∞—Ä—à—Ä—É—Ç –±—Ä–∏–≥–∞–¥–∏: –ø—ñ–¥—Å—É–º–æ–∫',
    `–ú–∞—Ä—à—Ä—É—Ç: ${h.route}`,
    `–î–∞—Ç–∞: ${h.day}`,
    `–ë—Ä–∏–≥–∞–¥–∞: ${h.crew}`,
    `–î–∏—Å–ø–µ—Ç—á–µ—Ä: ${h.dispatcher}`,
    `–ó—É–ø–∏–Ω–æ–∫: ${h.stops}`,
    '--- –î–µ—Ç–∞–ª—ñ –∑—É–ø–∏–Ω–æ–∫ ---'
  ];
  STOPS.forEach((s,i)=>{
    lines.push(`#${i+1} ${s.addr} ‚Äî ${s.job}`);
    lines.push(`  –ö–æ–Ω—Ç–∞–∫—Ç: ${s.contact||'‚Äî'}`);
    lines.push(`  –û–±‚Äô—î–∫—Ç: ${s.asset||'‚Äî'}`);
    lines.push(`  –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: ${s.durMin||0} —Ö–≤`);
    lines.push(`  –§–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è: ${(s.beforeImg?'1':'0')} / ${(s.afterImg?'1':'0')}; –ê—É–¥—ñ–æ: ${s.audioUrl?'—î':'–Ω–µ–º–∞—î'}`);
  });
  download('gas_para02_route_'+stamp()+'.txt', lines.join('\n'));
  log('–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ TXT');
});
$('#print58').addEventListener('click',()=>{
  const rc=$('#rc'); rc.hidden=false;
  const h=routeHeader();
  const lines=[
'=== GAS ROUTE (58–º–º) ===',
'Route: '+h.route,
'Date:  '+h.day,
'Crew:  '+h.crew,
'Disp:  '+h.dispatcher,
'Stops: '+h.stops,
'--------------------------'
  ];
  STOPS.forEach((s,i)=>{
    lines.push(String(i+1).padStart(2,'0')+' '+(s.addr||'‚Äî'));
    lines.push('  '+(s.job||'-')+' | '+(s.asset||'-')+' | '+(s.durMin||0)+' —Ö–≤');
  });
  lines.push('--------------------------');
  $('#rc').textContent = lines.join('\n');
  download('gas_para02_receipt_'+stamp()+'.txt', $('#rc').textContent);
  log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —á–µ–∫ 58–º–º');
});
$('#qrGen').addEventListener('click',()=>{
  const def = ROUTE_ID||'gas-route';
  const data = prompt('–í—Å—Ç–∞–≤ URL/ID (–ø–∞–ø–∫–∞ –¥–æ–∫–∞–∑—ñ–≤ –∞–±–æ Route ID):', def);
  if(data===null) return;
  const url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=2&data='+encodeURIComponent(data);
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.drawImage(img,0,0,220,220); };
  img.onerror=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.fillStyle='#e5e7eb'; q.font='14px ui-monospace'; q.fillText('QR offline', 62,110); q.fillText((data.length>14?data.slice(0,14)+'‚Ä¶':data), 36,132); };
  img.src=url;
  log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ QR');
});

// ===== –ö–∞–º–µ—Ä–∞ —Ä–µ–Ω–¥–µ—Ä –∞–∫—Ç–∏–≤–Ω–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∑—É–ø–∏–Ω–∫–∏ =====
function syncStopCounters(){
  // –æ–Ω–æ–≤–∏—Ç–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ —Ñ–æ—Ç–æ/–∞—É–¥—ñ–æ –≤ –ø–ª–∏—Ç—Ü—ñ –∑—É–ø–∏–Ω–∫–∏
  STOPS.forEach(s=>{
    const wrap=$(`[data-sid="${s.id}"]`);
    if(wrap){
      const ph=wrap.querySelector('.phc'); if(ph) ph.textContent = (s.beforeImg?1:0)+' / '+(s.afterImg?1:0);
      const au=wrap.querySelector('.audc'); if(au) au.textContent = s.audioUrl?'—î':'–Ω–µ–º–∞—î';
    }
  });
}
setInterval(syncStopCounters, 1500);

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
(function init(){
  // –≤–∏—Å—Ç–∞–≤–∏—Ç–∏ —Å—å–æ–≥–æ–¥–Ω—ñ
  const d=new Date(); const iso=d.toISOString().slice(0,10); $('#day').value=iso;
  // –º—ñ–Ω—ñ–º—É–º –æ–¥–Ω–∞ –∑—É–ø–∏–Ω–∫–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç—É UX
  addStop({});
})();
</script>


</body></html>