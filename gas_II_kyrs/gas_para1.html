<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 1 (–≥–∞–∑–æ–≤–∏–∫–∏) ‚Äî –í–≤—ñ–¥–Ω–∞: —Ü–∏—Ñ—Ä–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä—ñ–π –≥–∞–∑–æ–≤–∏–∫–∞</title>
<meta name="description" content="–í–≤—ñ–¥–Ω–µ –∑–∞–Ω—è—Ç—Ç—è: —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—ñ–Ω—ñ-–Ω–∞—Ä—è–¥—É, —Ñ–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è, –≥–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞, –µ–º—É–ª—å–æ–≤–∞–Ω–∏–π –¥–∞—Ç—á–∏–∫ —Ç–∏—Å–∫—É, NFC-—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –æ–±‚Äô—î–∫—Ç–∞, QR, —á–µ–∫ 58 –º–º, –µ–∫—Å–ø–æ—Ä—Ç CSV/TXT.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1280px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.grid{display:grid;gap:14px;grid-template-columns:1.2fr 1fr}
@media(max-width:1140px){.grid{grid-template-columns:1fr}}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
textarea{min-height:110px}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
small.mono,.mono{font-family:ui-monospace,monospace}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
canvas.chart{display:block;width:100%;height:220px;background:#0b1220;border:1px solid var(--line);border-radius:12px}
.canvasWrap{overflow:hidden;border-radius:12px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace;white-space:pre;min-height:140px}
.ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
.small{font-size:.9rem}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.photo{width:100%;max-width:280px;border:1px solid var(--line);border-radius:12px;display:block}
.gallery{display:flex;gap:8px;flex-wrap:wrap}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:0 8px;color:var(--muted);margin-right:6px;margin-top:6px}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
</style>
<link rel="canonical" href="https://edlab.pp.ua/gas_II_kyrs/gas_para1.html"><meta property="og:type" content="article"><meta property="og:title" content="–ì–∞–∑–æ–≤–∏–∫–∏ ‚Äî –ü–∞—Ä–∞ 1"><meta property="og:description" content="–¢–∏ –≤ —Ä–æ–ª—ñ —Å–ª—é—Å–∞—Ä—è/–º–∞–π—Å—Ç—Ä–∞ –¥—ñ–ª—å–Ω–∏—Ü—ñ. –°—å–æ–≥–æ–¥–Ω—ñ –≤—ñ–¥–ø—Ä–∞—Ü—é—î–º–æ ¬´—Ü–∏—Ñ—Ä–æ–≤—É —Ä—É—Ç–∏–Ω—É¬ª: —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–Ω—ñ-–Ω–∞—Ä—è–¥, –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –æ–±‚Äô—î–∫—Ç (—á–µ—Ä–µ–∑ NFC –∞–±–æ –∫–æ–¥), –∑—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ –¥–æ/–ø—ñ—Å"><meta property="og:url" content="https://edlab.pp.ua/gas_II_kyrs/gas_para1.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ì–∞–∑–æ–≤–∏–∫–∏ ‚Äî –ü–∞—Ä–∞ 1","description":"–¢–∏ –≤ —Ä–æ–ª—ñ —Å–ª—é—Å–∞—Ä—è/–º–∞–π—Å—Ç—Ä–∞ –¥—ñ–ª—å–Ω–∏—Ü—ñ. –°—å–æ–≥–æ–¥–Ω—ñ –≤—ñ–¥–ø—Ä–∞—Ü—é—î–º–æ ¬´—Ü–∏—Ñ—Ä–æ–≤—É —Ä—É—Ç–∏–Ω—É¬ª: —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–Ω—ñ-–Ω–∞—Ä—è–¥, –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –æ–±‚Äô—î–∫—Ç (—á–µ—Ä–µ–∑ NFC –∞–±–æ –∫–æ–¥), –∑—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ –¥–æ/–ø—ñ—Å","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/gas_II_kyrs/gas_para1.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üõ†Ô∏è</span>
      <div>
        <b>–ü–∞—Ä–∞ 1 ‚Äî –í–≤—ñ–¥–Ω–∞: —Ü–∏—Ñ—Ä–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä—ñ–π –≥–∞–∑–æ–≤–∏–∫–∞</b><br>
        <span class="badge">–ú—ñ–Ω—ñ-–Ω–∞—Ä—è–¥ ‚Üí NFC/–∫–æ–¥ –æ–±‚Äô—î–∫—Ç–∞ ‚Üí —Ñ–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è ‚Üí –≥–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞ ‚Üí –¥–∞—Ç—á–∏–∫ —Ç–∏—Å–∫—É ‚Üí —á–µ–∫ 58 –º–º ‚Üí CSV/QR</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <!-- –í–í–Ü–î–ù–Ü –î–ê–ù–Ü -->
  <div class="card">
    <h2>üìö –ö–æ–Ω—Ç–µ–∫—Å—Ç: —â–æ –º–∏ —Ä–æ–±–∏–º–æ</h2>
    <p>–¢–∏ –≤ —Ä–æ–ª—ñ —Å–ª—é—Å–∞—Ä—è/–º–∞–π—Å—Ç—Ä–∞ –¥—ñ–ª—å–Ω–∏—Ü—ñ. –°—å–æ–≥–æ–¥–Ω—ñ –≤—ñ–¥–ø—Ä–∞—Ü—é—î–º–æ ¬´—Ü–∏—Ñ—Ä–æ–≤—É —Ä—É—Ç–∏–Ω—É¬ª: —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–Ω—ñ-–Ω–∞—Ä—è–¥, –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –æ–±‚Äô—î–∫—Ç (—á–µ—Ä–µ–∑ NFC –∞–±–æ –∫–æ–¥),
      –∑—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ <b>–¥–æ/–ø—ñ—Å–ª—è</b>, –∑–∞–ø–∏—Å–∞—Ç–∏ <b>–≥–æ–ª–æ—Å–æ–≤—É –Ω–æ—Ç–∞—Ç–∫—É</b>, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ ¬´–¥–∞—Ç—á–∏–∫ —Ç–∏—Å–∫—É¬ª (–µ–º—É–ª—è—Ç–æ—Ä), –∑—ñ–±—Ä–∞—Ç–∏ –¥–æ–∫–∞–∑–æ–≤—É –±–∞–∑—É –π –≤–∏–¥–∞—Ç–∏ <b>—á–µ–∫ 58 –º–º</b> + <b>QR</b>.</p>
    <div class="note">
      <b>–ó–∞–≤–¥–∞–Ω–Ω—è –Ω–∞ 10 –±–∞–ª—ñ–≤:</b> –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–∞—Ä—è–¥ (2), —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –æ–±‚Äô—î–∫—Ç–∞ (2), —Ñ–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è (2), –≥–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞ (1), —Å–∏–º—É–ª—è—Ü—ñ—è —Ç–∏—Å–∫—É + –≥—Ä–∞—Ñ—ñ–∫ (2), —á–µ–∫/QR (1).
    </div>
  </div>

  <div class="grid">
    <!-- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê: –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ -->
    <div class="card">
      <h2>üßæ –ú—ñ–Ω—ñ-–Ω–∞—Ä—è–¥</h2>
      <div class="row">
        <label style="flex:1">–ê–¥—Ä–µ—Å–∞/–æ–±‚Äô—î–∫—Ç<input id="addr" class="input" placeholder="–º. –¢–∞–ª—å–Ω–µ, –≤—É–ª. –®–µ–≤—á–µ–Ω–∫–∞, 10, –∫–≤. 12"></label>
        <label style="flex:1">–¢–∏–ø —Ä–æ–±—ñ—Ç
          <select id="job" class="input">
            <option value="–û–≥–ª—è–¥ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞">–û–≥–ª—è–¥ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞</option>
            <option value="–£—Å—É–Ω–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—É">–£—Å—É–Ω–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—É</option>
            <option value="–ó–∞–º—ñ–Ω–∞ –∫—Ä–∞–Ω–∞/—à–ª–∞–Ω–≥–∞">–ó–∞–º—ñ–Ω–∞ –∫—Ä–∞–Ω–∞/—à–ª–∞–Ω–≥–∞</option>
            <option value="–û–ø–ª–æ–º–±—É–≤–∞–Ω–Ω—è">–û–ø–ª–æ–º–±—É–≤–∞–Ω–Ω—è</option>
            <option value="–ü—É—Å–∫ –≥–∞–∑—É –ø—ñ—Å–ª—è —Å–µ—Ä–≤—ñ—Å—É">–ü—É—Å–∫ –≥–∞–∑—É –ø—ñ—Å–ª—è —Å–µ—Ä–≤—ñ—Å—É</option>
          </select>
        </label>
        <label style="flex:1">–ö–æ–Ω—Ç–∞–∫—Ç –∞–±–æ–Ω–µ–Ω—Ç–∞<input id="phone" class="input" placeholder="+380680094244"></label>
      </div>
      <div class="row">
        <button class="btn good" id="mkOrder">üß∞ –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–∞—Ä—è–¥</button>
        <span class="badge" id="oid">–ù–∞—Ä—è–¥: ‚Äî</span>
      </div>

      <h2 style="margin-top:10px">üìç –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –æ–±‚Äô—î–∫—Ç–∞ (NFC/–∫–æ–¥)</h2>
      <div class="row">
        <button class="btn" id="nfcBtn">üì∂ –°–∫–∞–Ω—É–≤–∞—Ç–∏ NFC</button>
        <input id="asset" class="input" placeholder="–í–≤–µ–¥–∏ –∫–æ–¥/ID –æ–±‚Äô—î–∫—Ç–∞, —è–∫—â–æ NFC –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π">
        <button class="btn secondary" id="saveAsset">üíæ –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
        <span class="badge" id="nfcs">–°—Ç–∞—Ç—É—Å: –æ—á—ñ–∫—É—î—Ç—å—Å—è</span>
      </div>

      <h2 style="margin-top:10px">üì∏ –§–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è</h2>
      <div class="row">
        <video id="vid" class="photo" autoplay="" playsinline="" muted=""></video>
        <div>
          <button class="btn" id="camOn">üé• –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</button>
          <button class="btn" id="shotBefore">üì∑ –§–æ—Ç–æ ¬´–¥–æ¬ª</button>
          <button class="btn" id="shotAfter">üì∑ –§–æ—Ç–æ ¬´–ø—ñ—Å–ª—è¬ª</button><br>
          <small class="muted">–ö–∞–º–µ—Ä–∞ –ø—Ä–∞—Ü—é—î –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ; —Ñ–æ—Ç–æ –∑–±–µ—Ä–µ–∂—É—Ç—å—Å—è —É ¬´–ì–∞–ª–µ—Ä–µ—ó –¥–æ–∫–∞–∑—ñ–≤¬ª.</small>
        </div>
      </div>
      <div class="gallery" id="gal"></div>

      <h2 style="margin-top:10px">üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞</h2>
      <div class="row">
        <button class="btn" id="recStart">‚è∫Ô∏è –ó–∞–ø–∏—Å</button>
        <button class="btn secondary" id="recStop" disabled="">‚èπÔ∏è –°—Ç–æ–ø</button>
        <span class="badge" id="rstat">–ù–µ–º–∞—î –∑–∞–ø–∏—Å—É</span>
      </div>
      <audio id="player" controls="" style="margin-top:8px;max-width:100%"></audio>

      <h2 style="margin-top:10px">üß™ ¬´–î–∞—Ç—á–∏–∫ —Ç–∏—Å–∫—É¬ª (–µ–º—É–ª—è—Ç–æ—Ä)</h2>
      <div class="row">
        <input type="range" id="pVal" min="0" max="6" step="0.1" value="2.5" style="width:260px">
        <span class="badge">–¢–∏—Å–∫: <b id="pNum">2.5</b> –∫–ü–∞</span>
        <button class="btn" id="pMark">üìç –ü–æ–∑–Ω–∞—á–∏—Ç–∏ —Ç–æ—á–∫—É</button>
        <button class="btn secondary" id="pClear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫</button>
      </div>
      <div class="canvasWrap"><canvas id="pChart" class="chart" width="520" height="220"></canvas></div>

      <h2 style="margin-top:10px">üíæ –ï–∫—Å–ø–æ—Ä—Ç / –¥—Ä—É–∫</h2>
      <div class="row">
        <button class="btn" id="saveCsv">üìÑ CSV (–∂—É—Ä–Ω–∞–ª)</button>
        <button class="btn" id="saveTxt">üíæ TXT (–ø—ñ–¥—Å—É–º–æ–∫)</button>
        <button class="btn" id="print58">üñ®Ô∏è –ß–µ–∫ 58 –º–º</button>
        <button class="btn secondary" id="qrGen">üîó QR (–ø–æ—Å–∏–ª–∞–Ω–Ω—è/ID)</button>
      </div>
      <div id="rc" class="receipt" hidden=""></div>
      <div class="canvasWrap" style="margin-top:8px"><canvas id="qr" width="220" height="220"></canvas></div>
      <small class="muted">QR –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ <span class="mono">api.qrserver.com</span>; —è–∫—â–æ –æ—Ñ–ª–∞–π–Ω ‚Äî –∑‚Äô—è–≤–∏—Ç—å—Å—è —Ç–µ–∫—Å—Ç.</small>
    </div>

    <!-- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê: –ú–µ—Ç—Ä–∏–∫–∏/–û—Ü—ñ–Ω–∫–∞/–õ–æ–≥–∏ -->
    <div class="card">
      <h2>üìä –ú–µ—Ç—Ä–∏–∫–∏ –π –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="tbl">
        <tbody>
          <tr><th>–ù–∞—Ä—è–¥</th><td id="mOrder">‚Äî</td></tr>
          <tr><th>ID –æ–±‚Äô—î–∫—Ç–∞</th><td id="mAsset">‚Äî</td></tr>
          <tr><th>–§–æ—Ç–æ ¬´–¥–æ/–ø—ñ—Å–ª—è¬ª</th><td id="mPhotos">0 / 0</td></tr>
          <tr><th>–ì–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞</th><td id="mAudio">‚Äî</td></tr>
          <tr><th>–ü–æ–∑–Ω–∞—á–æ–∫ —Ç–∏—Å–∫—É</th><td id="mPMarks">0</td></tr>
          <tr><th>–°—Ç–∞—Ç—É—Å</th><td id="mState"><b class="warn">–ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫—Ä–æ–∫–∏</b></td></tr>
        </tbody>
      </table>

      <h2 style="margin-top:10px">üß† –ö—Ä–∏—Ç–µ—Ä—ñ—ó</h2>
      <ul>
        <li>–ó–∞–ø–æ–≤–Ω–µ–Ω–æ –Ω–∞—Ä—è–¥ (–∞–¥—Ä–µ—Å–∞/—Ç–∏–ø/–∫–æ–Ω—Ç–∞–∫—Ç) ‚Äî <b>2</b></li>
        <li>NFC/–∫–æ–¥ –æ–±‚Äô—î–∫—Ç–∞ ‚Äî <b>2</b></li>
        <li>–§–æ—Ç–æ ¬´–¥–æ¬ª —ñ ¬´–ø—ñ—Å–ª—è¬ª ‚Äî <b>2</b></li>
        <li>–ì–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞ ‚Äî <b>1</b></li>
        <li>–°–∏–º—É–ª—å–æ–≤–∞–Ω–∏–π —Ç–∏—Å–∫ + ‚â•3 —Ç–æ—á–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫—É ‚Äî <b>2</b></li>
        <li>–ß–µ–∫ 58 –º–º + QR ‚Äî <b>1</b></li>
      </ul>

      <h2 style="margin-top:10px">üõéÔ∏è –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</h2>
      <pre id="alog" class="note" style="max-height:220px;overflow:auto">// –ü–æ–∫–∏ –±–µ–∑ –ø–æ–¥—ñ–π</pre>

      <h2 style="margin-top:10px">üìú –ù–æ—Ç–∞—Ç–∫–∞</h2>
      <p class="muted small">–¶–µ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∞ —Ç–æ—á–∫–∞. –ù–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø–∞—Ä–∞—Ö –¥–æ–¥–∞—î–º–æ –ø–ª–æ–º–±—É–≤–∞–Ω–Ω—è, –∞–≤–∞—Ä—ñ–π–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó, –¥–∞—Ç—á–∏–∫–∏ Arduino —Ç–∞ –ø–æ–≤–Ω—ñ –∞–∫—Ç–∏.</p>
    </div>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time id="upd"></time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function log(msg){const t=new Date().toLocaleTimeString();const box=$('#alog');if(box.textContent.startsWith('//'))box.textContent='';box.textContent+=`[${t}] ${msg}\n`;box.scrollTop=box.scrollHeight;}
function clean(s){return String(s).replace(/\s+/g,' ').trim();}

$('#upd').textContent = new Date().toLocaleDateString('uk-UA');

// ===== –ú—ñ–Ω—ñ-–Ω–∞—Ä—è–¥ =====
let ORDER_ID = null;
$('#mkOrder').addEventListener('click',()=>{
  const addr=clean($('#addr').value||'');
  const job=$('#job').value;
  const phone=clean($('#phone').value||'');
  if(!addr||!job||!phone){ alert('–ó–∞–ø–æ–≤–Ω–∏ –∞–¥—Ä–µ—Å—É, —Ç–∏–ø —Ä–æ–±—ñ—Ç —ñ –∫–æ–Ω—Ç–∞–∫—Ç'); return; }
  ORDER_ID = 'ORD-'+Math.random().toString(36).slice(2,8).toUpperCase();
  $('#oid').textContent = '–ù–∞—Ä—è–¥: '+ORDER_ID;
  $('#mOrder').textContent = `${job} @ ${addr}`;
  log(`–°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–∞—Ä—è–¥ ${ORDER_ID} (${job}, ${addr}, ${phone})`);
  updState();
});

// ===== NFC / –∫–æ–¥ –æ–±'—î–∫—Ç–∞ =====
let ASSET_ID = null;
async function tryNFC(){
  if('NDEFReader' in window){
    const reader = new NDEFReader();
    try{
      await reader.scan();
      $('#nfcs').textContent = '–°—Ç–∞—Ç—É—Å: —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è...';
      reader.addEventListener('reading', ({message, serialNumber})=>{
        let text=''; for(const rec of message.records){ if(rec.recordType==='text'){ const dec=new TextDecoder(rec.encoding||'utf-8'); text = dec.decode(rec.data); } }
        ASSET_ID = (text||serialNumber||'NFC-'+Math.random().toString(36).slice(2,7)).toString();
        $('#asset').value = ASSET_ID;
        $('#nfcs').textContent = '–°—Ç–∞—Ç—É—Å: –∑—á–∏—Ç–∞–Ω–æ NFC';
        $('#mAsset').textContent = ASSET_ID;
        log(`NFC –ø—Ä–æ—á–∏—Ç–∞–Ω–æ: ${ASSET_ID}`);
        updState();
      });
    }catch(e){
      $('#nfcs').textContent = '–°—Ç–∞—Ç—É—Å: –ø–æ–º–∏–ª–∫–∞ NFC';
      alert('NFC –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∞–±–æ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏–π —É —Ü—å–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ/–ø—Ä–∏—Å—Ç—Ä–æ—ó.');
    }
  }else{
    alert('Web NFC –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è. –í–≤–µ–¥–∏ –∫–æ–¥ –≤—Ä—É—á–Ω—É.');
  }
}
$('#nfcBtn').addEventListener('click', tryNFC);
$('#saveAsset').addEventListener('click',()=>{
  const v=clean($('#asset').value||'');
  if(!v){ alert('–í–≤–µ–¥–∏ –∫–æ–¥/ID –æ–±‚Äô—î–∫—Ç–∞'); return; }
  ASSET_ID = v;
  $('#mAsset').textContent = ASSET_ID;
  $('#nfcs').textContent = '–°—Ç–∞—Ç—É—Å: –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –≤—Ä—É—á–Ω—É';
  log(`–û–±‚Äô—î–∫—Ç (—Ä—É—á–Ω–∏–π –≤–≤—ñ–¥): ${ASSET_ID}`);
  updState();
});

// ===== –ö–∞–º–µ—Ä–∞ / —Ñ–æ—Ç–æ =====
let stream=null; let beforeImg=null; let afterImg=null;
async function startCam(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    $('#vid').srcObject = stream;
    log('–ö–∞–º–µ—Ä—É —É–≤—ñ–º–∫–Ω–µ–Ω–æ');
  }catch(e){ alert('–ö–∞–º–µ—Ä—É –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –∞–±–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'); }
}
$('#camOn').addEventListener('click', startCam);

function takeShot(kind){
  const video=$('#vid'); if(!video.srcObject){ alert('–°–ø–µ—Ä—à—É —É–≤—ñ–º–∫–Ω–∏ –∫–∞–º–µ—Ä—É'); return; }
  const c=document.createElement('canvas'); c.width=video.videoWidth||640; c.height=video.videoHeight||480;
  const g=c.getContext('2d'); g.drawImage(video,0,0,c.width,c.height);
  const url=c.toDataURL('image/png');
  const img=document.createElement('img'); img.src=url; img.alt=kind; img.className='photo';
  $('#gal').appendChild(img);
  if(kind==='–¥–æ') beforeImg=url; else afterImg=url;
  const bp = $('#mPhotos'); const parts=bp.textContent.split('/').map(s=>parseInt(s)||0);
  if(kind==='–¥–æ') parts[0]=1; else parts[1]=1;
  bp.textContent = parts[0]+' / '+parts[1];
  log(`–ó—Ä–æ–±–ª–µ–Ω–æ —Ñ–æ—Ç–æ ¬´${kind}¬ª`);
  updState();
}
$('#shotBefore').addEventListener('click',()=>takeShot('–¥–æ'));
$('#shotAfter').addEventListener('click',()=>takeShot('–ø—ñ—Å–ª—è'));

// ===== –ê—É–¥—ñ–æ–∑–∞–ø–∏—Å =====
let mediaRec=null; let chunks=[];
$('#recStart').addEventListener('click', async ()=>{
  try{
    const s = await navigator.mediaDevices.getUserMedia({audio:true, video:false});
    mediaRec = new MediaRecorder(s);
    chunks=[];
    mediaRec.ondataavailable = e=>{ if(e.data.size>0) chunks.push(e.data); };
    mediaRec.onstop = ()=>{
      const blob=new Blob(chunks,{type:'audio/webm'});
      const url=URL.createObjectURL(blob);
      $('#player').src=url;
      $('#rstat').textContent='–ó–∞–ø–∏—Å –≥–æ—Ç–æ–≤–∏–π';
      log('–ì–æ–ª–æ—Å–æ–≤—É –Ω–æ—Ç–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ (webm)');
      // –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
      const a=document.createElement('a'); a.href=url; a.download='voice_'+stamp()+'.webm'; document.body.appendChild(a); a.click(); a.remove();
      updState();
    };
    mediaRec.start();
    $('#recStart').disabled=true; $('#recStop').disabled=false;
    $('#rstat').textContent='–ô–¥–µ –∑–∞–ø–∏—Å...';
    log('–ü–æ—á–∞—Ç–æ –∞—É–¥—ñ–æ–∑–∞–ø–∏—Å');
  }catch(e){ alert('–ú—ñ–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π'); }
});
$('#recStop').addEventListener('click', ()=>{
  if(mediaRec && mediaRec.state!=='inactive'){ mediaRec.stop(); }
  $('#recStart').disabled=false; $('#recStop').disabled=true;
});

// ===== –ï–º—É–ª—è—Ç–æ—Ä —Ç–∏—Å–∫—É + –≥—Ä–∞—Ñ—ñ–∫ =====
const pRange=$('#pVal'), pNum=$('#pNum'), pChart=$('#pChart'), pg=pChart.getContext('2d');
let pMarks=[];
function drawChart(){
  const W=pChart.width,H=pChart.height; pg.clearRect(0,0,W,H);
  pg.strokeStyle='#223049'; pg.strokeRect(0.5,0.5,W-1,H-1);
  pg.fillStyle='#94a3b8'; pg.font='11px ui-monospace';
  pg.fillText('–¢–∏—Å–∫ (–∫–ü–∞), –º—ñ—Ç–∫–∏ –ø–æ —á–∞—Å—É', 12, 16);
  // –æ—Å—ñ
  const left=40,right=W-10,top=24,bottom=H-30;
  pg.strokeStyle='#334155'; pg.beginPath(); pg.moveTo(left,bottom); pg.lineTo(right,bottom); pg.stroke();
  // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó 0..6
  for(let k=0;k<=6;k++){
    const y=bottom - (k/6)*(bottom-top);
    pg.strokeStyle='#1f2a44'; pg.beginPath(); pg.moveTo(left,y); pg.lineTo(right,y); pg.stroke();
    pg.fillStyle='#94a3b8'; pg.fillText(String(k), 10, y+4);
  }
  if(!pMarks.length) return;
  const t0=pMarks[0].t, t1=pMarks[pMarks.length-1].t;
  const span=Math.max(1,(t1-t0));
  function xOf(t){ return left + (t-t0)/span*(right-left); }
  pMarks.forEach(m=>{
    const x=xOf(m.t), y=bottom - (m.p/6)*(bottom-top);
    pg.fillStyle='#38bdf8'; pg.fillRect(x-3,y-3,6,6);
  });
}
pRange.addEventListener('input',()=>{ pNum.textContent=pRange.value; });
$('#pMark').addEventListener('click',()=>{
  const p=parseFloat(pRange.value); pMarks.push({t:Date.now(), p});
  drawChart();
  $('#mPMarks').textContent = String(pMarks.length);
  log(`–ú—ñ—Ç–∫–∞ —Ç–∏—Å–∫—É: ${p.toFixed(1)} –∫–ü–∞`);
  updState();
});
$('#pClear').addEventListener('click',()=>{ pMarks=[]; drawChart(); $('#mPMarks').textContent='0'; log('–û—á–∏—â–µ–Ω–æ –≥—Ä–∞—Ñ—ñ–∫ —Ç–∏—Å–∫—É'); });

// ===== –ï–∫—Å–ø–æ—Ä—Ç / —á–µ–∫ / QR =====
function currentSummary(){
  const photos=$$('#gal img').map(i=>i.alt).reduce((acc,a)=>{ if(a==='–¥–æ')acc[0]=1; if(a==='–ø—ñ—Å–ª—è')acc[1]=1; return acc; },[0,0]);
  const audioStat=$('#rstat').textContent.includes('–≥–æ—Ç–æ–≤–∏–π')?'—î':'–Ω–µ–º–∞—î';
  return {
    order: ORDER_ID||'‚Äî',
    job: $('#job').value,
    addr: $('#addr').value,
    phone: $('#phone').value,
    asset: ASSET_ID||($('#asset').value||'‚Äî'),
    photos: photos[0]+' / '+photos[1],
    audio: audioStat,
    pmarks: pMarks.length
  };
}
$('#saveCsv').addEventListener('click',()=>{
  const s=currentSummary();
  let csv='field,value\n';
  for(const [k,v] of Object.entries(s)){ csv+=`${k},${String(v).replace(/,/g,';')}\n`; }
  csv+='\n# pressure_marks\ntime,value_kpa\n';
  pMarks.forEach(m=>{ csv+=`${new Date(m.t).toISOString()},${m.p}\n`; });
  download('gas_para01_'+stamp()+'.csv', csv, 'text/csv');
  log('–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ CSV');
});
$('#saveTxt').addEventListener('click',()=>{
  const s=currentSummary();
  const lines=[
    '–ü–∞—Ä–∞ 1 ‚Äî –í–≤—ñ–¥–Ω–∞: –ø—ñ–¥—Å—É–º–æ–∫',
    `–ù–∞—Ä—è–¥: ${s.order}`,
    `–†–æ–±–æ—Ç–∞: ${s.job}`,
    `–ê–¥—Ä–µ—Å–∞: ${s.addr}`,
    `–ö–æ–Ω—Ç–∞–∫—Ç: ${s.phone}`,
    `–û–±‚Äô—î–∫—Ç: ${s.asset}`,
    `–§–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è: ${s.photos}`,
    `–ì–æ–ª–æ—Å–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞: ${s.audio}`,
    `–ú—ñ—Ç–æ–∫ —Ç–∏—Å–∫—É: ${s.pmarks}`,
  ];
  download('gas_para01_'+stamp()+'.txt', lines.join('\n'));
  log('–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ TXT');
});
$('#print58').addEventListener('click',()=>{
  const rc=$('#rc'); rc.hidden=false;
  const s=currentSummary();
  const lines=[
'=== GAS SERVICE (58–º–º) ===',
'–ù–∞—Ä—è–¥: '+s.order,
'–†–æ–±–æ—Ç–∞: '+s.job,
'–ê–¥—Ä–µ—Å–∞: '+s.addr,
'–ê–±–æ–Ω–µ–Ω—Ç: '+s.phone,
'–û–±‚Äô—î–∫—Ç: '+s.asset,
'–§–æ—Ç–æ –¥–æ/–ø—ñ—Å–ª—è: '+s.photos,
'–ê—É–¥—ñ–æ: '+s.audio,
'–ú—ñ—Ç–æ–∫ —Ç–∏—Å–∫—É: '+s.pmarks,
'--------------------------'
  ];
  rc.textContent=lines.join('\n');
  download('gas_para01_receipt_'+stamp()+'.txt', rc.textContent);
  log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —á–µ–∫ 58–º–º');
});
$('#qrGen').addEventListener('click',()=>{
  const def = (ASSET_ID||ORDER_ID||'gas-evidence');
  const data = prompt('–í—Å—Ç–∞–≤ URL/ID (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–∞–ø–∫–∞ –¥–æ–∫–∞–∑—ñ–≤ –∞–±–æ ID –æ–±‚Äô—î–∫—Ç–∞):', def);
  if(data===null) return;
  const url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=2&data='+encodeURIComponent(data);
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.drawImage(img,0,0,220,220); };
  img.onerror=()=>{ const q=$('#qr').getContext('2d'); q.clearRect(0,0,220,220); q.fillStyle='#e5e7eb'; q.font='14px ui-monospace'; q.fillText('QR offline', 62,110); q.fillText((data.length>14?data.slice(0,14)+'‚Ä¶':data), 36,132); };
  img.src=url;
  log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ QR');
});

// ===== –ú–µ—Ç—Ä–∏–∫–∏ / —Å—Ç–∞–Ω =====
function updState(){
  const orderOk = !!ORDER_ID;
  const assetOk = !!ASSET_ID || !!clean($('#asset').value||'');
  const photosOk = $('#mPhotos').textContent.trim()==='1 / 1';
  const audioOk  = $('#rstat').textContent.includes('–≥–æ—Ç–æ–≤–∏–π');
  const pOK = (pMarks.length>=3);
  let score=0; if(orderOk)score+=2;if(assetOk)score+=2;if(photosOk)score+=2;if(audioOk)score+=1;if(pOK)score+=2;
  const text = score>=9? `<b class="ok">–ì–æ—Ç–æ–≤–æ (‚âà${score}/10) ‚Äî —Å—É–ø–µ—Ä!</b>`:
               score>=6? `<b class="warn">–ë—ñ–ª—å—à—ñ—Å—Ç—å –∫—Ä–æ–∫—ñ–≤ –≤–∏–∫–æ–Ω–∞–Ω–æ (‚âà${score}/10)</b>`:
                         `<b class="bad">–ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ—Ä–æ–±–∏—Ç–∏ (‚âà${score}/10)</b>`;
  $('#mState').innerHTML = text;
}
drawChart();

// –í–±—É–¥–æ–≤–∞–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
(function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();
</script>


</body></html>