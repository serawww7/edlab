<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 23 ‚Äî –®–Ü-—á–µ–∫–µ—Ä –µ—Ç–∏–∫–µ—Ç–æ–∫ —ñ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –±–∞–∫–æ–≤–∏—Ö —Å—É–º—ñ—à–µ–π</title>
<meta name="description" content="–Ü–º–ø–æ—Ä—Ç –µ—Ç–∏–∫–µ—Ç–æ–∫ –ó–ó–† ‚Üí –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∞–∫–æ–≤–æ—ó —Å—É–º—ñ—à—ñ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ (FRAC/HRAC, pH, –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å, –∑–∞–±–æ—Ä–æ–Ω–∏), –º–∞—Ç—Ä–∏—Ü—è —Ä–∏–∑–∏–∫—ñ–≤, –∂—É—Ä–Ω–∞–ª —Å—É–ø–µ—Ä–µ—á–Ω–æ—Å—Ç–µ–π, —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –ø—ñ–¥ –±–∞–∫ —ñ –≥–µ–∫—Ç–∞—Ä, 58–º–º —á–µ–∫, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LLM."/>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial,sans-serif}
.wrap{max-width:1060px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
small.mono,.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Courier New",monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.35fr 1fr}
@media(max-width:1060px){.grid{grid-template-columns:1fr}}
hr.sep{border:none;border-top:1px solid var(--line);margin:16px 0}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
svg{max-width:100%;height:auto;display:block}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;white-space:pre-wrap}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
.badge{display:inline-block;border:1px solid #334155;border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.risk-ok{color:var(--ok)}.risk-warn{color:var(--warn)}.risk-bad{color:var(--bad)}
.log{max-height:170px;overflow:auto;border:1px solid var(--line);border-radius:10px;padding:8px;background:#0b1220;font-family:ui-monospace,monospace;font-size:13px;white-space:pre-wrap}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.receipt{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:10px;font-family:ui-monospace,monospace}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üßØ</span>
      <div>
        <b>–ü–∞—Ä–∞ 23 ‚Äî –®–Ü-—á–µ–∫–µ—Ä –µ—Ç–∏–∫–µ—Ç–æ–∫ —ñ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –±–∞–∫–æ–≤–∏—Ö —Å—É–º—ñ—à–µ–π</b><br/>
        <span class="badge">–ï—Ç–∏–∫–µ—Ç–∫–∏ ‚Üí –ø–ª–∞–Ω —Å—É–º—ñ—à—ñ ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ FRAC/HRAC/pH/–ø–æ—Ä—è–¥–æ–∫ ‚Üí –º–∞—Ç—Ä–∏—Ü—è —Ä–∏–∑–∏–∫—ñ–≤ ‚Üí –∂—É—Ä–Ω–∞–ª ‚Üí –ø—Ä–æ–º–ø—Ç LLM</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">
    –ú–µ—Ç–∞: –∑—ñ–±—Ä–∞—Ç–∏ –∑ –µ—Ç–∏–∫–µ—Ç–æ–∫ –¥–∞–Ω—ñ –ø–æ –ó–ó–†, —Å–∫–æ–Ω—Å—Ç—Ä—É—é–≤–∞—Ç–∏ –±–∞–∫–æ–≤—É —Å—É–º—ñ—à, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ <b>—Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å</b> (–ú–æ–ê FRAC/HRAC, <b>pH</b>, <b>–ø–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è</b>, –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è), –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ <b>—Å—É–ø–µ—Ä–µ—á–Ω–æ—Å—Ç—ñ</b>, —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ω–æ—Ä–º–∏ –Ω–∞ –±–∞–∫/–≥–∞ –π —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ <b>–ø—Ä–æ–º–ø—Ç –¥–æ –®–Ü</b> –¥–ª—è –æ—Å—Ç–∞—Ç–æ—á–Ω–æ—ó –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–ª–∞–Ω—É IPM.
  </p>

  <div class="grid">
    <!-- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê -->
    <div class="card">
      <h2>üóÇÔ∏è –ï—Ç–∏–∫–µ—Ç–∫–∏ (CSV)</h2>
      <p class="small muted">–§–æ—Ä–º–∞—Ç —Å—Ç–æ–≤–ø—Ü—ñ–≤: <span class="mono">product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes</span></p>
      <textarea id="csv" class="input" rows="7" placeholder="product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes"></textarea>
      <div class="row">
        <button class="btn good" id="load">üì• –Ü–º–ø–æ—Ä—Ç</button>
        <button class="btn secondary" id="demo">üé≤ –ï—Ç–∞–ª–æ–Ω–Ω—ñ –µ—Ç–∏–∫–µ—Ç–∫–∏</button>
        <button class="btn secondary" id="clearLabels">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
        <span id="badgeN" class="badge">–ü—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤: 0</span>
      </div>

      <h2 style="margin-top:12px">üß© –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∞–∫–æ–≤–æ—ó —Å—É–º—ñ—à—ñ</h2>
      <div class="row">
        <div style="flex:1">
          <label for="crop">–ö—É–ª—å—Ç—É—Ä–∞</label>
          <input id="crop" class="input" placeholder="–ü—à–µ–Ω–∏—Ü—è –æ–∑–∏–º–∞"/>
        </div>
        <div style="flex:1">
          <label for="target">–¶—ñ–ª—å (—à–∫—ñ–¥–Ω–∏–∫/—Ö–≤–æ—Ä–æ–±–∞/–±—É—Ä‚Äô—è–Ω)</label>
          <input id="target" class="input" placeholder="—Å–µ–ø—Ç–æ—Ä—ñ–æ–∑, –±–æ—Ä–æ—à–Ω–∏—Å—Ç–∞ —Ä–æ—Å–∞"/>
        </div>
      </div>
      <div class="row">
        <div style="flex:2">
          <label for="productSel">–î–æ–¥–∞—Ç–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç</label>
          <select id="productSel" class="input"></select>
        </div>
        <div style="flex:1">
          <label for="dose">–ù–æ—Ä–º–∞ –Ω–∞ –≥–∞</label>
          <input id="dose" class="input" type="number" step="0.01" value="0.5"/>
        </div>
        <div style="flex:1">
          <label for="unit">–û–¥–∏–Ω–∏—Ü—è</label>
          <select id="unit" class="input">
            <option>–ª/–≥–∞</option><option>–∫–≥/–≥–∞</option>
          </select>
        </div>
        <button class="btn" id="add">‚ûï –î–æ–¥–∞—Ç–∏</button>
      </div>

      <table class="tbl" id="mixTbl" style="margin-top:8px">
        <thead><tr><th>#</th><th>–ü—Ä–µ–ø–∞—Ä–∞—Ç</th><th>–ú–æ–ê (FRAC/HRAC)</th><th>–§–æ—Ä–º–∞</th><th>–î–æ–∑–∞</th><th>–î—ñ—è</th></tr></thead>
        <tbody></tbody>
      </table>

      <div class="row">
        <div style="flex:1">
          <label for="water">–í–æ–¥–∞, –ª/–≥–∞</label>
          <input id="water" class="input" type="number" step="10" value="200"/>
        </div>
        <div style="flex:1">
          <label for="tank">–û–±‚Äô—î–º –±–∞–∫–∞, –ª</label>
          <input id="tank" class="input" type="number" step="10" value="2000"/>
        </div>
        <div style="flex:1">
          <label for="area">–ü–ª–æ—â–∞ –æ–±—Ä–æ–±–∫–∏, –≥–∞</label>
          <input id="area" class="input" type="number" step="0.1" value="10"/>
        </div>
      </div>

      <div class="row" style="margin-top:6px">
        <button class="btn good" id="check">üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å</button>
        <button class="btn secondary" id="receiptBtn">üñ®Ô∏è 58–º–º —á–µ–∫</button>
        <span id="badgeRisk" class="badge">–°—Ç–∞—Ç—É—Å: ‚Äî</span>
      </div>

      <div class="receipt" id="receipt" hidden></div>

      <h3 style="margin-top:12px">üß≠ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è (tank order)</h3>
      <pre class="code" id="order">// –ù–∞—Ç–∏—Å–Ω–∏ ¬´üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å¬ª</pre>
    </div>

    <!-- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê -->
    <div class="card">
      <h2>üßØ –ú–∞—Ç—Ä–∏—Ü—è —Ä–∏–∑–∏–∫—ñ–≤ —ñ –∂—É—Ä–Ω–∞–ª</h2>
      <table class="tbl" id="riskTbl">
        <thead><tr><th>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</th><th>–î–µ—Ç–∞–ª—ñ</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="exportLog">üìÑ –ï–∫—Å–ø–æ—Ä—Ç –∂—É—Ä–Ω–∞–ª—É</button>
        <button class="btn secondary" id="resetLog">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –∂—É—Ä–Ω–∞–ª</button>
      </div>
      <div id="log" class="log" aria-live="polite"></div>

      <h2 style="margin-top:12px">ü§ñ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LLM</h2>
      <div class="row">
        <button class="btn good" id="genPrompt">‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
        <button class="btn secondary" id="copyPrompt">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        <button class="btn secondary" id="savePrompt">‚¨áÔ∏è TXT</button>
      </div>
      <pre class="code" id="prompt">// –°–ø–æ—á–∞—Ç–∫—É —ñ–º–ø–æ—Ä—Ç –µ—Ç–∏–∫–µ—Ç–æ–∫ —ñ ¬´üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å¬ª</pre>

      <h2 style="margin-top:12px">üîå –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—É (SVG)</h2>
      <svg viewBox="0 0 760 420" role="img" aria-label="–ü–∞–π–ø–ª–∞–π–Ω —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ">
        <rect x="40" y="40" width="220" height="80" rx="12" fill="#0e2a47" stroke="#3b82f6"/>
        <text x="150" y="70" fill="#e5e7eb" font-size="14" text-anchor="middle">–ï—Ç–∏–∫–µ—Ç–∫–∏ –ó–ó–† (CSV)</text>
        <text x="150" y="88" fill="#93c5fd" font-size="12" text-anchor="middle">ai/FRAC/pH/REI/PHI</text>

        <rect x="300" y="40" width="200" height="80" rx="12" fill="#14532d" stroke="#22c55e"/>
        <text x="400" y="70" fill="#dcfce7" font-size="14" text-anchor="middle">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å—É–º—ñ—à—ñ</text>
        <text x="400" y="88" fill="#a7f3d0" font-size="12" text-anchor="middle">–¥–æ–∑–∏/–≤–æ–¥–∞/–ø–ª–æ—â–∞</text>

        <rect x="540" y="40" width="180" height="80" rx="12" fill="#7c2d12" stroke="#fb923c"/>
        <text x="630" y="70" fill="#fed7aa" font-size="14" text-anchor="middle">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∏</text>
        <text x="630" y="88" fill="#fed7aa" font-size="12" text-anchor="middle">FRAC/pH/order</text>

        <line x1="260" y1="80" x2="300" y2="80" stroke="#93c5fd" stroke-width="3"/>
        <line x1="500" y1="80" x2="540" y2="80" stroke="#93c5fd" stroke-width="3"/>

        <rect x="40" y="170" width="280" height="90" rx="12" fill="#0b3f5a" stroke="#22d3ee"/>
        <text x="180" y="200" fill="#a5f3fc" font-size="14" text-anchor="middle">–†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏</text>
        <text x="180" y="220" fill="#a5f3fc" font-size="12" text-anchor="middle">–Ω–∞ –±–∞–∫ —ñ –Ω–∞ –≥–µ–∫—Ç–∞—Ä</text>

        <rect x="360" y="170" width="170" height="90" rx="12" fill="#1f2937" stroke="#9ca3af"/>
        <text x="445" y="200" fill="#e5e7eb" font-size="14" text-anchor="middle">58–º–º —á–µ–∫</text>
        <text x="445" y="220" fill="#9ca3af" font-size="12" text-anchor="middle">–¥–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–∞</text>

        <rect x="560" y="170" width="160" height="90" rx="12" fill="#111827" stroke="#4b5563"/>
        <text x="640" y="200" fill="#e5e7eb" font-size="14" text-anchor="middle">–ü—Ä–æ–º–ø—Ç –¥–æ –®–Ü</text>
        <text x="640" y="220" fill="#9ca3af" font-size="12" text-anchor="middle">–≤–∞–ª—ñ–¥–∞—Ü—ñ—è IPM</text>
      </svg>

      <div class="card" style="margin-top:12px">
        <h3>üìú –ù–æ—Ç–∞—Ç–∫–∞ –∑ —ñ—Å—Ç–æ—Ä—ñ—ó</h3>
        <p class="muted small">
          –ü–µ—Ä—à—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏ <b>–ø–æ—Ä—è–¥–∫—É –∑–º—ñ—à—É–≤–∞–Ω–Ω—è</b> (WP‚ÜíWG‚ÜíSC‚ÜíEC‚ÜíSL‚Üí–∞–¥‚Äô—é–≤–∞–Ω—Ç–∏) —Å—Ñ–æ—Ä–º—É–≤–∞–ª–∏—Å—å —É –•–• —Å—Ç. –∑–∞ –ø—ñ–¥—Å—É–º–∫–∞–º–∏ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤ –æ—Å–∞–¥–∂–µ–Ω–Ω—è/–ø—ñ–Ω–∏.
          –°—É—á–∞—Å–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ –ø–æ—î–¥–Ω—É—é—Ç—å –µ—Ç–∏–∫–µ—Ç–∫–∏, <b>FRAC/HRAC</b>-—Ä–æ—Ç–∞—Ü—ñ—é —Ç–∞ <b>pH</b>-–≤—ñ–∫–Ω–∞ –∑ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –π –ø—ñ–¥–∫–∞–∑–∫–∞–º–∏ –®–Ü.
        </p>
      </div>

      <h3 style="margin-top:12px">üß∑ –¢–µ–≥–∏</h3>
      <div>
        <span class="tag">#labels</span>
        <span class="tag">#compatibility</span>
        <span class="tag">#FRAC_HRAC</span>
        <span class="tag">#tank_mix</span>
        <span class="tag">#IPM</span>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>–°–∫—Ä—ñ–Ω –º–∞—Ç—Ä–∏—Ü—ñ —Ä–∏–∑–∏–∫—ñ–≤ —ñ –∂—É—Ä–Ω–∞–ª—É.</li>
      <li>58-–º–º —á–µ–∫ —Ç–∞ CSV –∑ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞–º–∏ –Ω–∞ –±–∞–∫/–≥–∞.</li>
      <li>–ü—Ä–æ–º–ø—Ç –¥–æ LLM —ñ –∫–æ—Ä–æ—Ç–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å-–º–µ–º–æ –∑ —Ä—ñ—à–µ–Ω–Ω—è–º.</li>
    </ul>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function log(msg){const t=new Date().toLocaleTimeString(); LOG.textContent+=`[${t}] ${msg}\n`; LOG.scrollTop=LOG.scrollHeight;}

// ===== –î–∞–Ω—ñ –µ—Ç–∏–∫–µ—Ç–æ–∫ =====
let labels=[]; // {product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes}
const PRODSEL = $('#productSel'), MIXTBL = $('#mixTbl tbody'), RISK = $('#riskTbl tbody'), LOG = $('#log');

function parseCSV(txt){
  labels.length=0;
  const lines=(txt||'').trim().split(/\r?\n/).filter(Boolean);
  const head=lines.shift();
  const cols=head.split(',').map(s=>s.trim());
  const idx = (name)=>cols.indexOf(name);
  const need=['product','ai','group','form','dose_per_ha','unit','crops','targets','water_l_ha','rei_h','phi_d','ph_min','ph_max','incompat','notes'];
  for(const n of need){ if(idx(n)===-1) throw new Error('–í—ñ–¥—Å—É—Ç–Ω—ñ–π —Å—Ç–æ–≤–ø–µ—Ü—å: '+n); }
  for(const line of lines){
    const parts=line.split(','); // –ø—Ä–æ—Å—Ç–æ, –±–µ–∑ quoted CSV
    const r={};
    need.forEach((n,i)=>r[n]= (parts[idx(n)]||'').trim());
    // —á–∏—Å–ª–æ–≤—ñ
    r.dose_per_ha=parseFloat(r.dose_per_ha)||0;
    r.water_l_ha=parseFloat(r.water_l_ha)||0;
    r.rei_h=parseFloat(r.rei_h)||0;
    r.phi_d=parseFloat(r.phi_d)||0;
    r.ph_min=parseFloat(r.ph_min); r.ph_max=parseFloat(r.ph_max);
    labels.push(r);
  }
  labels.sort((a,b)=>a.product.localeCompare(b.product));
}

function refreshProductList(){
  PRODSEL.innerHTML='';
  labels.forEach(l=>{
    const opt=document.createElement('option');
    opt.value=l.product; opt.textContent=`${l.product} ‚Äî ${l.ai} (${l.group})`;
    PRODSEL.appendChild(opt);
  });
  $('#badgeN').textContent='–ü—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤: '+labels.length;
}

// ===== –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å—É–º—ñ—à—ñ =====
let mix=[]; // [{product, dose, unit}]

function addToMix(){
  const product=PRODSEL.value; if(!product) return;
  const dose=parseFloat($('#dose').value)||0;
  const unit=$('#unit').value;
  const lab=labels.find(l=>l.product===product);
  mix.push({product, dose, unit, group:lab?.group||'', form:lab?.form||''});
  renderMix();
}
function removeFromMix(idx){ mix.splice(idx,1); renderMix(); }

function renderMix(){
  MIXTBL.innerHTML='';
  mix.forEach((m,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${m.product}</td><td>${m.group}</td><td>${m.form}</td><td>${m.dose} ${m.unit}/–≥–∞</td><td><button class="btn secondary" data-i="${i}">‚úñ</button></td>`;
    MIXTBL.appendChild(tr);
  });
  MIXTBL.querySelectorAll('button[data-i]').forEach(b=>b.onclick=()=>removeFromMix(parseInt(b.dataset.i)));
  $('#badgeRisk').textContent='–°—Ç–∞—Ç—É—Å: ‚Äî';
  $('#order').textContent='// –ù–∞—Ç–∏—Å–Ω–∏ ¬´üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å¬ª';
  $('#receipt').hidden=true;
}

// ===== –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ =====
// –ë–∞–∑–æ–≤—ñ –ø—Ä–∞–≤–∏–ª–∞ (–¥–µ–º–æ-–Ω–∞–±—ñ—Ä): –ø–æ—Ä—è–¥–æ–∫, pH, FRAC/HRAC –¥—É–±–ª—é–≤–∞–Ω–Ω—è, –Ω–µ—Å—É–º—ñ—Å–Ω—ñ –ø–∞—Ä–∏ (–∑ –µ—Ç–∏–∫–µ—Ç–æ–∫)
const FORM_ORDER = ['WP','WG','WDG','DF','SG','SC','SE','EC','EW','SL','SP','OD','UL','CS','ADJ']; // —Å–ø—Ä–æ—â–µ–Ω–∏–π
function orderAdvice(list){
  const groups=list.map(x=>({name:x.product, form:(x.form||'').toUpperCase()}));
  groups.sort((a,b)=>(FORM_ORDER.indexOf(a.form) - FORM_ORDER.indexOf(b.form)));
  const seq = groups.map(g=>`${g.form||'‚Äî'}: ${g.name}`).join('\n');
  return `–ó–∞–ø–æ–≤–Ω–∏ –±–∞–∫ –≤–æ–¥–æ—é –Ω–∞ 1/3‚Äì1/2.\n–î–∞–ª—ñ –ø–æ –æ–¥–Ω–æ–º—É:\n${seq}\n–ù–∞–æ—Å—Ç–∞–Ω–æ–∫ ‚Äî –∞–¥‚Äô—é–≤–∞–Ω—Ç–∏/–ü–ê–† (—è–∫—â–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –µ—Ç–∏–∫–µ—Ç–∫–æ—é).`;
}

function checkFRAC(mix, labels){
  const seen=new Map(); const dup=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    const g=(lab?.group||'').toUpperCase();
    if(!g) return;
    if(!seen.has(g)) seen.set(g,[]);
    seen.get(g).push(m.product);
  });
  for(const [g,arr] of seen.entries()){ if(arr.length>1) dup.push(`${g}: ${arr.join(' + ')}`); }
  return {ok: dup.length===0, msg: dup.length?('–ü–æ–≤—Ç–æ—Ä–Ω–∏–π –ú–æ–ê/FRAC –≤ –æ–¥–Ω—ñ–π —Å—É–º—ñ—à—ñ:\n'+dup.join('\n')):'–û–∫: —Ä—ñ–∑–Ω—ñ –∞–±–æ –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω—ñ –≥—Ä—É–ø–∏.'};
}

function checkPH(mix, labels){
  let globalMin=-Infinity, globalMax=Infinity;
  const details=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    const mn=isNaN(lab.ph_min)?null:lab.ph_min;
    const mx=isNaN(lab.ph_max)?null:lab.ph_max;
    details.push(`${lab.product}: pH ${mn??'‚Äî'}..${mx??'‚Äî'}`);
    if(mn!=null) globalMin=Math.max(globalMin,mn);
    if(mx!=null) globalMax=Math.min(globalMax,mx);
  });
  const ok = globalMin<=globalMax;
  const msg = ok ? `–°–ø—ñ–ª—å–Ω–µ –≤—ñ–∫–Ω–æ pH: ${isFinite(globalMin)?globalMin:'-‚àû'}..${isFinite(globalMax)?globalMax:'‚àû'}` : '–ù–µ–º–∞—î –ø–µ—Ä–µ—Ç–∏–Ω—É pH-–≤—ñ–∫–æ–Ω –ø—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤ ‚Üí —Ä–∏–∑–∏–∫ –æ—Å–∞–¥—É/—ñ–Ω–∞–∫—Ç–∏–≤.';
  return {ok, msg, details:details.join('; ')};
}

function checkLabelIncompat(mix, labels){
  const warns=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    const inc=(lab.incompat||'').toLowerCase();
    mix.forEach(n=>{
      if(n.product===m.product) return;
      if(inc && inc.split(/[;|]/).some(w=>w && n.product.toLowerCase().includes(w.trim()))) {
        warns.push(`${m.product} ‚ö† –Ω–µ —Å—É–º—ñ—Å–Ω–∏–π –∑ ${n.product} (–∑–∞ –µ—Ç–∏–∫–µ—Ç–∫–æ—é)`);
      }
    });
  });
  return {ok: warns.length===0, msg: warns.join('\n')||'–ï—Ç–∏–∫–µ—Ç–∫–æ–≤–∏—Ö –∑–∞–±–æ—Ä–æ–Ω –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ.'};
}

function checkDoseAgainstLabel(mix, labels){
  const probs=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    const unitOk = (lab.unit||'').toLowerCase() === (m.unit||'').toLowerCase();
    const doseOk = unitOk && m.dose>0 && m.dose<=lab.dose_per_ha*1.1 && m.dose>=lab.dose_per_ha*0.5; // 50‚Äì110% –≤—ñ–¥ –¥–æ–≤—ñ–¥–∫–æ–≤–æ—ó —è–∫ –±–∞–∑–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å
    if(!unitOk) probs.push(`${m.product}: –æ–¥–∏–Ω–∏—Ü—ñ –≤ –µ—Ç–∏–∫–µ—Ç—Ü—ñ ${lab.unit}, —É —Å—É–º—ñ—à—ñ ${m.unit}`);
    if(!doseOk) probs.push(`${m.product}: –¥–æ–∑–∞ ${m.dose} ${m.unit}/–≥–∞ –ø–æ–∑–∞ –¥–æ–≤—ñ–¥–∫–æ–≤–∏–º –∫–æ—Ä–∏–¥–æ—Ä–æ–º ~${lab.dose_per_ha} ${lab.unit}/–≥–∞`);
  });
  return {ok: probs.length===0, msg: probs.join('\n')||'–î–æ–∑–∏ –∫–æ—Ä–µ–∫—Ç–Ω—ñ –≤—ñ–¥–Ω–æ—Å–Ω–æ –µ—Ç–∏–∫–µ—Ç–∫–æ–≤–∏—Ö.'};
}

function checkREI_PHI(mix, labels){
  let maxREI=0, maxPHI=0;
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    maxREI=Math.max(maxREI, lab.rei_h||0);
    maxPHI=Math.max(maxPHI, lab.phi_d||0);
  });
  const msg=`REI (–≥–æ–¥): ‚â§${maxREI}. PHI (–¥–Ω—ñ–≤): ‚â•${maxPHI}.`;
  return {ok:true, msg};
}

function runChecks(){
  RISK.innerHTML=''; LOG.textContent='';
  if(mix.length===0){ log('–°—É–º—ñ—à –ø–æ—Ä–æ–∂–Ω—è'); $('#badgeRisk').textContent='–°—Ç–∞—Ç—É—Å: —Å—É–º—ñ—à –ø–æ—Ä–æ–∂–Ω—è'; return; }

  const rows=[];
  function push(name, res, level='ok'){
    const tr=document.createElement('tr');
    const cls = res.ok ? 'risk-ok' : (level==='warn'?'risk-warn':'risk-bad');
    tr.innerHTML = `<td>${name}</td><td class="small">${(res.msg||'‚Äî').replace(/\n/g,'<br/>')}</td><td class="${cls}">${res.ok?'OK':(level==='warn'?'WARN':'BAD')}</td>`;
    RISK.appendChild(tr);
    log(`${name}: ${res.ok?'OK':(level==='warn'?'WARN':'BAD')} ‚Äî ${res.msg.replace(/\n/g,'; ')}`);
    rows.push({name,ok:res.ok,level,msg:res.msg});
  }

  const r1=checkFRAC(mix,labels);           push('FRAC/HRAC —Ä–æ—Ç–∞—Ü—ñ—è', r1, r1.ok?'ok':'warn');
  const r2=checkPH(mix,labels);             push('–í—ñ–∫–Ω–∞ pH (–ø–µ—Ä–µ—Ç–∏–Ω)', r2, r2.ok?'ok':'bad');
  const r3=checkLabelIncompat(mix,labels);  push('–ï—Ç–∏–∫–µ—Ç–∫–æ–≤—ñ –∑–∞–±–æ—Ä–æ–Ω–∏', r3, r3.ok?'ok':'bad');
  const r4=checkDoseAgainstLabel(mix,labels);push('–î–æ–∑–∏ –ø—Ä–æ—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫–∏', r4, r4.ok?'ok':'warn');
  const r5=checkREI_PHI(mix,labels);        push('REI/PHI –∑–≤–µ–¥–µ–Ω–Ω—è', r5, 'ok');

  const allOk = [...RISK.querySelectorAll('td.risk-bad')].length===0;
  $('#badgeRisk').textContent = '–°—Ç–∞—Ç—É—Å: ' + (allOk?'—É–º–æ–≤–Ω–æ —Å—É–º—ñ—Å–Ω–∞':'—î –∫—Ä–∏—Ç–∏—á–Ω—ñ —Å—É–ø–µ—Ä–µ—á–Ω–æ—Å—Ç—ñ');

  // –ü–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è
  const detailed = mix.map(m=>{
    const lab=labels.find(l=>l.product===m.product)||{};
    return {product:m.product, form:(lab.form||'').toUpperCase()};
  });
  $('#order').textContent = orderAdvice(detailed);
}

// ===== –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ —Ç–∞ —á–µ–∫ =====
function buildReceipt(){
  const area=parseFloat($('#area').value)||0;
  const water=parseFloat($('#water').value)||0; // –ª/–≥–∞
  const tank =parseFloat($('#tank').value)||0; // –ª
  const perTankArea = tank / water; // –≥–∞ –Ω–∞ –±–∞–∫
  const lines=[];
  lines.push('=== –¢–ï–•–ö–ê–†–¢–ê ‚Äî –ë–ê–ö–û–í–ê –°–£–ú–Ü–® ===');
  lines.push(`–î–∞—Ç–∞: ${new Date().toLocaleString()}`);
  lines.push(`–ö—É–ª—å—Ç—É—Ä–∞: ${$('#crop').value||'-'}`);
  lines.push(`–¶—ñ–ª—å: ${$('#target').value||'-'}`);
  lines.push(`–í–æ–¥–∞: ${water} –ª/–≥–∞ | –ë–∞–∫: ${tank} –ª ‚Üí ${perTankArea.toFixed(2)} –≥–∞/–±–∞–∫`);
  lines.push('--- –°–ö–õ–ê–î –ù–ê 1 –ì–ê ---');
  mix.forEach(m=>{ lines.push(`${m.product.padEnd(16,' ')} ${m.dose} ${m.unit}/–≥–∞`); });
  lines.push('--- –ù–ê 1 –ë–ê–ö ---');
  mix.forEach(m=>{
    const q = (m.dose * perTankArea).toFixed(2);
    lines.push(`${m.product.padEnd(16,' ')} ${q} ${m.unit}/–±–∞–∫`);
  });
  lines.push('--- –ù–ê –í–°–Æ –ü–õ–û–©–£ ---');
  mix.forEach(m=>{
    const q = (m.dose * area).toFixed(2);
    lines.push(`${m.product.padEnd(16,' ')} ${q} ${m.unit}/–≤—Å–µ`);
  });
  lines.push('REI/PHI: –¥–∏–≤. –º–∞—Ç—Ä–∏—Ü—é —Ä–∏–∑–∏–∫—ñ–≤.');
  lines.push('–ü–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è: –¥–∏–≤. —Å–µ–∫—Ü—ñ—é –Ω–∏–∂—á–µ.');
  lines.push('=== –£–î–ê–ß–Ü! –î–æ—Ç—Ä–∏–º—É–π—Å—è –ó–Ü–ó —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π ===');
  return lines.join('\n');
}

// ===== –ü—Ä–æ–º–ø—Ç –¥–æ LLM =====
function buildPrompt(){
  const riskRows=[...RISK.querySelectorAll('tr')].slice(0).map(tr=>{
    const tds=tr.querySelectorAll('td');
    return {check:tds[0]?.textContent||'', details:tds[1]?.textContent||'', status:tds[2]?.textContent||''};
  });
  const mixJson = mix.map(m=>{
    const lab=labels.find(l=>l.product===m.product)||{};
    return {
      product:m.product, ai:lab.ai||'', group:lab.group||'',
      form:lab.form||'', dose_per_ha:m.dose, unit:m.unit,
      ph_min:lab.ph_min||null, ph_max:lab.ph_max||null,
      rei_h:lab.rei_h||null, phi_d:lab.phi_d||null
    };
  });

  return `–¢–∏ ‚Äî –∞–≥—Ä–æ–Ω–æ–º-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (IPM). –ü–µ—Ä–µ–≤—ñ—Ä —Ç–∞ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ —Å–∫–æ—Ä–∏–≥—É–π –±–∞–∫–æ–≤—É —Å—É–º—ñ—à.
–ü–æ–ª–µ: –∫—É–ª—å—Ç—É—Ä–∞="${$('#crop').value||'-'}", —Ü—ñ–ª—å="${$('#target').value||'-'}".
–ü–∞—Ä–∞–º–µ—Ç—Ä–∏: –≤–æ–¥–∞=${$('#water').value} –ª/–≥–∞, –±–∞–∫=${$('#tank').value} –ª, –ø–ª–æ—â–∞=${$('#area').value} –≥–∞.
–°—É–º—ñ—à (JSON):
${JSON.stringify(mixJson, null, 2)}
–ú–∞—Ç—Ä–∏—Ü—è –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫:
${riskRows.map(r=>`- ${r.check}: [${r.status}] ${r.details}`).join('\n')}

–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:
1) –ü—ñ–¥—Ç–≤–µ—Ä–¥—å/–∑–º—ñ–Ω–∏ –¥–æ–∑–∏ –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ –µ—Ç–∏–∫–µ—Ç–∫–∏ –∞–±–æ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ –¥–æ–≤—ñ–¥–Ω–∏–∫–∏.
2) –û—Ü—ñ–Ω–∏ FRAC/HRAC-—Ä–æ—Ç–∞—Ü—ñ—é —Ç–∞ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –¥–ª—è –∞–Ω—Ç–∏—Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—ó —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó.
3) –ü–µ—Ä–µ–≤—ñ—Ä pH-–≤—ñ–∫–Ω–æ, –ø–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è (WP‚ÜíWG‚ÜíSC‚ÜíEC‚ÜíSL‚Üí–∞–¥‚Äô—é–≤–∞–Ω—Ç–∏), –ø–æ—Ç—Ä–µ–±—É —É –ü–ê–†.
4) –í–∫–∞–∂–∏ REI/PHI –¥–ª—è –≤—Å—ñ—î—ó —Å—É–º—ñ—à—ñ, –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è —Ç–∞ –ó–Ü–ó.
5) –î–∞–π 2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Å–ø—Ä–æ—â–µ–Ω–Ω—è —Å—É–º—ñ—à—ñ –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.
–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –ø–ª–∞–Ω —ñ–∑ –ø—ñ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —Å–ø–∏—Å–∫–∞–º–∏ —Ç–∞ –¥–∂–µ—Ä–µ–ª–∞–º–∏.`;
}

// ===== –ü–æ–¥—ñ—ó UI =====
$('#demo').addEventListener('click', ()=>{
  $('#csv').value =
`product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes
–¢–µ–±—É–∫–æ–Ω–∞–∑–æ–ª 250,—Ç–µ–±—É–∫–æ–Ω–∞–∑–æ–ª,DMI G3,EC,0.5,–ª/–≥–∞,–ø—à–µ–Ω–∏—Ü—è,—Å–µ–ø—Ç–æ—Ä—ñ–æ–∑|—ñ—Ä–∂–∞,200,24,35,5,7,,–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ç—Ä–∏–∞–∑–æ–ª
–ê–∑–æ–∫—Å–∏—Å—Ç—Ä–æ–±—ñ–Ω 250,–∞–∑–æ–∫—Å–∏—Å—Ç—Ä–æ–±—ñ–Ω,QoI C3,SC,0.5,–ª/–≥–∞,–ø—à–µ–Ω–∏—Ü—è,—Å–µ–ø—Ç–æ—Ä—ñ–æ–∑|—Å–∞–∂–∞,200,12,35,5.5,7.5,–º—ñ–¥—å,–ù–µ –∑–º—ñ—à—É–≤–∞—Ç–∏ –∑ –ª—É–∂–Ω–∏–º–∏ —Ä–æ–∑—á–∏–Ω–∞–º–∏
–•–ª–æ—Ä—Ç–∞–ª–æ–Ω—ñ–ª 720,—Ö–ª–æ—Ä—Ç–∞–ª–æ–Ω—ñ–ª,–ú—É–ª—å—Ç–∏—Å–∞–π—Ç M5,SC,1.0,–ª/–≥–∞,–∫–∞—Ä—Ç–æ–ø–ª—è,—Ñ—ñ—Ç–æ—Ñ—Ç–æ—Ä–æ–∑,200,48,7,6,7.5,,–ó–∞—Ö–∏—Å–Ω–∞ –¥—ñ—è
–ì–ª—ñ—Ñ–æ—Å–∞—Ç 480,–≥–ª—ñ—Ñ–æ—Å–∞—Ç,EPSPS G,SL,3.0,–ª/–≥–∞,–ø–∞—Ä–∏,–±—É—Ä‚Äô—è–Ω–∏,200,12,0,4,6,–∞–º–æ–Ω—ñ–π–Ω—ñ —Å—É–ª—å—Ñ–∞—Ç–∏,–ü—ñ—Å–ª—è–∂–Ω–∏–≤–Ω–µ –≤–Ω–µ—Å–µ–Ω–Ω—è
–ú—ñ–¥–Ω–∏–π –∫—É–ø–æ—Ä–æ—Å,–º—ñ–¥—å,M1,WP,3.0,–∫–≥/–≥–∞,—Å–∞–¥,–±–∞–∫—Ç–µ—Ä—ñ–æ–∑–∏,800,24,30,6.5,8,—Å—Ç—Ä–æ–±—ñ–ª—É—Ä–∏–Ω–∏,–£–Ω–∏–∫–∞–π –∑–º—ñ—à—É–≤–∞–Ω–Ω—è –∑—ñ —Å—Ç—Ä–æ–±—ñ–ª—É—Ä–∏–Ω–∞–º–∏`;
  log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –µ—Ç–∞–ª–æ–Ω–Ω—ñ –µ—Ç–∏–∫–µ—Ç–∫–∏');
});

$('#load').addEventListener('click', ()=>{
  try{ parseCSV($('#csv').value); refreshProductList(); log('–ï—Ç–∏–∫–µ—Ç–∫–∏ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ'); }
  catch(e){ alert('–ü–æ–º–∏–ª–∫–∞ CSV: '+e.message); }
});
$('#clearLabels').addEventListener('click', ()=>{ labels.length=0; refreshProductList(); log('–ï—Ç–∏–∫–µ—Ç–∫–∏ –æ—á–∏—â–µ–Ω–æ'); });

$('#add').addEventListener('click', addToMix);
$('#check').addEventListener('click', runChecks);

$('#receiptBtn').addEventListener('click', ()=>{
  const txt=buildReceipt();
  const el=$('#receipt'); el.hidden=false; el.textContent=txt;
  download('para23_receipt_'+stamp()+'.txt',txt);
});

$('#genPrompt').addEventListener('click', ()=>{ $('#prompt').textContent=buildPrompt(); log('–ü—Ä–æ–º–ø—Ç –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ'); });
$('#copyPrompt').addEventListener('click', ()=>{
  const ta=document.createElement('textarea'); ta.value=$('#prompt').textContent; document.body.appendChild(ta);
  ta.select(); document.execCommand('copy'); ta.remove(); log('–ü—Ä–æ–º–ø—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
});
$('#savePrompt').addEventListener('click', ()=>{ const txt=$('#prompt').textContent||buildPrompt(); download('para23_prompt_'+stamp()+'.txt',txt); });

$('#exportLog').addEventListener('click', ()=>{
  const lines = $('#log').textContent.trim()||'–ñ—É—Ä–Ω–∞–ª –ø–æ—Ä–æ–∂–Ω—ñ–π';
  download('para23_log_'+stamp()+'.txt', lines);
});
$('#resetLog').addEventListener('click', ()=>{ LOG.textContent=''; });

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
refreshProductList();
if (window.self !== window.top) document.documentElement.classList.add('embedded'); // Moodle-friendly
</script>
</body>
</html>
