<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 23 ‚Äî –®–Ü-—á–µ–∫–µ—Ä –µ—Ç–∏–∫–µ—Ç–æ–∫ —ñ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –±–∞–∫–æ–≤–∏—Ö —Å—É–º—ñ—à–µ–π</title>
<meta name="description" content="–ï—Ç–∏–∫–µ—Ç–∫–∏ –ó–ó–† ‚Üí –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∞–∫–æ–≤–æ—ó —Å—É–º—ñ—à—ñ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (FRAC/HRAC, pH, –ø–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è, –∑–∞–±–æ—Ä–æ–Ω–∏), –º–∞—Ç—Ä–∏—Ü—è —Ä–∏–∑–∏–∫—ñ–≤, –∂—É—Ä–Ω–∞–ª, –ø—Ä–æ–º–ø—Ç –¥–æ LLM, –∫–µ–π—Å-–∫–≤—ñ–∑ —ñ –º—ñ—Å—ñ—ó –∑ –ø—Ä–æ–≥—Ä–µ—Å–æ–º."/>
<meta name="color-scheme" content="light dark"/>
<style>
:root{
  --bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;
  --brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);
  font-family:system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial,sans-serif}
.wrap{max-width:1060px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px;flex-wrap:wrap}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
small.mono,.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Courier New",monospace}
.badge{display:inline-block;border:1px solid #334155;border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.risk-ok{color:var(--ok)}.risk-warn{color:var(--warn)}.risk-bad{color:var(--bad)}
.log{max-height:170px;overflow:auto;border:1px solid var(--line);border-radius:10px;padding:8px;background:#0b1220;
  font-family:ui-monospace,monospace;font-size:13px;white-space:pre-wrap}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;white-space:pre-wrap}
hr.sep{border:none;border-top:1px solid var(--line);margin:16px 0}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
.progress{height:10px;border-radius:999px;background:#0b1324;overflow:hidden;border:1px solid #223049}
.progress > div{height:100%;background:linear-gradient(90deg,#60a5fa,#22c55e)}
.badgeNum{display:inline-grid;place-items:center;min-width:34px;height:26px;border-radius:8px;background:#0e1a2e;color:#a5b4fc;font-weight:700}
.kpi{display:flex;align-items:center;gap:10px;padding:8px 10px;border:1px dashed var(--line);border-radius:12px}
.kpi b{font-size:14px}
.score{font-weight:700}
svg{max-width:100%;height:auto;display:block}
@media (max-width:700px){ header a.btn{width:100%} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üßØ</span>
      <div>
        <b>–ü–∞—Ä–∞ 23 ‚Äî –®–Ü-—á–µ–∫–µ—Ä –µ—Ç–∏–∫–µ—Ç–æ–∫ —ñ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –±–∞–∫–æ–≤–∏—Ö —Å—É–º—ñ—à–µ–π</b><br/>
        <span class="badge">–ï—Ç–∏–∫–µ—Ç–∫–∏ ‚Üí —Å—É–º—ñ—à ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ FRAC/pH/–ø–æ—Ä—è–¥–æ–∫/–∑–∞–±–æ—Ä–æ–Ω–∏ ‚Üí –º–∞—Ç—Ä–∏—Ü—è —Ä–∏–∑–∏–∫—ñ–≤ ‚Üí –∂—É—Ä–Ω–∞–ª ‚Üí –ø—Ä–æ–º–ø—Ç LLM</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <div class="card">
    <h2>üéØ –©–æ –≤–∏ —Ä–æ–±–∏—Ç–µ —ñ –Ω–∞–≤—ñ—â–æ —Ü–µ –∞–≥—Ä–æ–Ω–æ–º—É</h2>
    <p><b>–ú–µ—Ç–∞ –ø–∞—Ä–∏</b> ‚Äî –Ω–∞–≤—á–∏—Ç–∏—Å—è –∑ –µ—Ç–∏–∫–µ—Ç–æ–∫ —à–≤–∏–¥–∫–æ –∑–±–∏—Ä–∞—Ç–∏ –∫–ª—é—á–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ó–ó–†, –∫–æ–Ω—Å—Ç—Ä—É—é–≤–∞—Ç–∏ –±–∞–∫–æ–≤—É —Å—É–º—ñ—à —ñ <b>–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</b>
      –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏: –¥—É–±–ª—é–≤–∞–Ω–Ω—è FRAC/HRAC (—Ä–∏–∑–∏–∫ —Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ), –Ω–µ—Å—É–º—ñ—Å–Ω—ñ –ø–∞—Ä–∏ –∑ –µ—Ç–∏–∫–µ—Ç–æ–∫, <b>–≤—ñ–∫–Ω–∞ pH</b> —Ç–∞ <b>–ø–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è</b>.
      –î–∞–ª—ñ ‚Äî –∑–∞ —Ö–≤–∏–ª–∏–Ω—É –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ <b>–ø—Ä–æ–º–ø—Ç</b> –¥–ª—è –º–æ–¥–µ–ª—ñ –®–Ü, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–µ–±–µ –π –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –¥–æ IPM-–ø–ª–∞–Ω—É.</p>
    <div class="row" style="margin-top:6px">
      <div class="kpi"><span class="badgeNum" id="k_labels">0</span><div><b>–ï—Ç–∏–∫–µ—Ç–æ–∫ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ</b></div></div>
      <div class="kpi"><span class="badgeNum" id="k_mix">0</span><div><b>–ü—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤ —É —Å—É–º—ñ—à—ñ</b></div></div>
      <div class="kpi"><span class="badgeNum" id="riskScore">0</span><div><b>–†–∏—Å–∫-–±–∞–ª</b> <span class="muted">(0 ‚Äî —ñ–¥–µ–∞–ª—å–Ω–æ)</span></div></div>
    </div>
    <div class="note" style="margin-top:8px">
      <b>–ü—Ä–∞–∫—Ç–∏—á–Ω–∞ –∫–æ—Ä–∏—Å—Ç—å:</b> –≤–∏ —Ç—Ä–µ–Ω—É—î—Ç–µ —Ç–æ–π —Å–∞–º–∏–π —á–µ–∫-–ª–∏—Å—Ç, —â–æ –∑–Ω—ñ–º–∞—î 70‚Äì80% ¬´–ø–æ–ª—å–æ–≤–∏—Ö¬ª –∑–∞–ª–∏–ø–∞–Ω—å (–æ—Å–∞–¥, –ø—ñ–Ω–∞, –≤—Ç—Ä–∞—Ç–∞ –¥—ñ—ó, –ø–æ–¥–≤—ñ–π–Ω–∏–π FRAC).
      –ê–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è 1:1 —É —Å–µ–∑–æ–Ω –Ω–∞ –≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤—ñ.
    </div>
  </div>

  <!-- –ú–Ü–°–Ü–á -->
  <div class="card">
    <h2>üéÆ –ú—ñ—Å—ñ—ó –ø–∞—Ä–∏</h2>
    <label><input type="checkbox" class="mission" data-id="m1"> –Ü–º–ø–æ—Ä—Ç—É–π —Ö–æ—á–∞ –± 4 –µ—Ç–∏–∫–µ—Ç–∫–∏ (CSV –∞–±–æ ¬´–ï—Ç–∞–ª–æ–Ω–Ω—ñ¬ª)</label><br/>
    <label><input type="checkbox" class="mission" data-id="m2"> –ó–±–µ—Ä–∏ —Å—É–º—ñ—à —ñ–∑ 2‚Äì4 –ø—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤ —ñ –∑–∞–¥–∞–π –≤–æ–¥—É/–±–∞–∫/–ø–ª–æ—â—É</label><br/>
    <label><input type="checkbox" class="mission" data-id="m3"> –ü—Ä–æ–π–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, –¥–æ–±–∏–π—Å—è <b>—Ä–∏–∑–∏–∫-–±–∞–ª ‚â§ 2</b></label><br/>
    <label><input type="checkbox" class="mission" data-id="m4"> –ó–≥–µ–Ω–µ—Ä—É–π –ø—Ä–æ–º–ø—Ç –¥–æ LLM —ñ –≤–∏–ø–∏—à–∏ 2 –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è</label>
    <div class="progress" style="margin-top:10px"><div id="progressBar" style="width:0%"></div></div>
  </div>

  <!-- –ï–¢–ò–ö–ï–¢–ö–ò + –ú–Ü–ö–°–ï–† -->
  <div class="card">
    <h2>üóÇÔ∏è –ï—Ç–∏–∫–µ—Ç–∫–∏ (CSV)</h2>
    <p class="small muted">–°—Ç–æ–≤–ø—Ü—ñ: <span class="mono">product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes</span></p>
    <textarea id="csv" class="input" rows="7" placeholder="product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes"></textarea>
    <div class="row">
      <button class="btn good" id="load">üì• –Ü–º–ø–æ—Ä—Ç</button>
      <button class="btn secondary" id="demo">üé≤ –ï—Ç–∞–ª–æ–Ω–Ω—ñ –µ—Ç–∏–∫–µ—Ç–∫–∏</button>
      <button class="btn secondary" id="clearLabels">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      <span id="badgeN" class="badge">–ü—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤: 0</span>
    </div>

    <hr class="sep"/>

    <h2>üß© –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∞–∫–æ–≤–æ—ó —Å—É–º—ñ—à—ñ</h2>
    <div class="row">
      <div style="flex:1">
        <label for="crop">–ö—É–ª—å—Ç—É—Ä–∞</label>
        <input id="crop" class="input" placeholder="–ü—à–µ–Ω–∏—Ü—è –æ–∑–∏–º–∞"/>
      </div>
      <div style="flex:1">
        <label for="target">–¶—ñ–ª—å (—à–∫—ñ–¥–Ω–∏–∫/—Ö–≤–æ—Ä–æ–±–∞/–±—É—Ä‚Äô—è–Ω)</label>
        <input id="target" class="input" placeholder="—Å–µ–ø—Ç–æ—Ä—ñ–æ–∑, –±–æ—Ä–æ—à–Ω–∏—Å—Ç–∞ —Ä–æ—Å–∞"/>
      </div>
    </div>
    <div class="row">
      <div style="flex:2">
        <label for="productSel">–î–æ–¥–∞—Ç–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç</label>
        <select id="productSel" class="input"></select>
      </div>
      <div style="flex:1">
        <label for="dose">–ù–æ—Ä–º–∞ –Ω–∞ –≥–∞</label>
        <input id="dose" class="input" type="number" step="0.01" value="0.5"/>
      </div>
      <div style="flex:1">
        <label for="unit">–û–¥–∏–Ω–∏—Ü—è</label>
        <select id="unit" class="input"><option>–ª/–≥–∞</option><option>–∫–≥/–≥–∞</option></select>
      </div>
      <button class="btn" id="add">‚ûï –î–æ–¥–∞—Ç–∏</button>
    </div>

    <table class="tbl" id="mixTbl" style="margin-top:8px">
      <thead><tr><th>#</th><th>–ü—Ä–µ–ø–∞—Ä–∞—Ç</th><th>–ú–æ–ê (FRAC/HRAC)</th><th>–§–æ—Ä–º–∞</th><th>–î–æ–∑–∞</th><th>–î—ñ—è</th></tr></thead>
      <tbody></tbody>
    </table>

    <div class="row" style="margin-top:8px">
      <div style="flex:1">
        <label for="water">–í–æ–¥–∞, –ª/–≥–∞</label>
        <input id="water" class="input" type="number" step="10" value="200"/>
      </div>
      <div style="flex:1">
        <label for="tank">–û–±‚Äô—î–º –±–∞–∫–∞, –ª</label>
        <input id="tank" class="input" type="number" step="10" value="2000"/>
      </div>
      <div style="flex:1">
        <label for="area">–ü–ª–æ—â–∞ –æ–±—Ä–æ–±–∫–∏, –≥–∞</label>
        <input id="area" class="input" type="number" step="0.1" value="10"/>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn good" id="check">üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å</button>
      <span id="badgeRisk" class="badge">–°—Ç–∞—Ç—É—Å: ‚Äî</span>
      <span id="mixAdvice" class="muted"></span>
    </div>

    <h3 style="margin-top:12px">üß≠ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è (tank order)</h3>
    <pre class="code" id="order">// –ù–∞—Ç–∏—Å–Ω–∏ ¬´üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å¬ª</pre>
  </div>

  <!-- –ú–ê–¢–†–ò–¶–Ø –†–ò–ó–ò–ö–Ü–í + –ñ–£–†–ù–ê–õ (–ü–ï–†–ï–ù–ï–°–ï–ù–û –£–ù–ò–ó) -->
  <div class="card">
    <h2>üßØ –ú–∞—Ç—Ä–∏—Ü—è —Ä–∏–∑–∏–∫—ñ–≤ —ñ –∂—É—Ä–Ω–∞–ª</h2>
    <table class="tbl" id="riskTbl">
      <thead><tr><th>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</th><th>–î–µ—Ç–∞–ª—ñ</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
      <tbody></tbody>
    </table>
    <div class="row" style="margin-top:8px">
      <button class="btn" id="exportLog">üìÑ –ï–∫—Å–ø–æ—Ä—Ç –∂—É—Ä–Ω–∞–ª—É</button>
      <button class="btn secondary" id="resetLog">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –∂—É—Ä–Ω–∞–ª</button>
    </div>
    <div id="log" class="log" aria-live="polite"></div>
  </div>

  <!-- –ü–†–û–ú–ü–¢ -->
  <div class="card">
    <h2>ü§ñ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LLM</h2>
    <p class="muted">–ó–≥–µ–Ω–µ—Ä—É–π —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –¥–ª—è –º–æ–¥–µ–ª—ñ –®–Ü (ChatGPT, Claude —Ç–æ—â–æ), —â–æ–± –≤–æ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏–ª–∞ —Ç–≤–æ—é —Å—É–º—ñ—à —ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞–ª–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è IPM.</p>
    <div class="row">
      <button class="btn good" id="genPrompt">‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
      <button class="btn secondary" id="copyPrompt">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      <button class="btn secondary" id="savePrompt">‚¨áÔ∏è TXT</button>
    </div>
    <pre class="code" id="prompt">// –°–ø–æ—á–∞—Ç–∫—É —ñ–º–ø–æ—Ä—Ç –µ—Ç–∏–∫–µ—Ç–æ–∫ —ñ ¬´üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å¬ª</pre>
  </div>

  <!-- –ö–ï–ô–°-–ö–í–Ü–ó -->
  <div class="card">
    <h2>üé≤ –ö–µ–π—Å-–∫–≤—ñ–∑: —â–æ —Ä–æ–±–∏—Ç–∏ –∑ —Ü–∏–º –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–æ–º?</h2>
    <p class="muted">–û—Ç—Ä–∏–º–∞–π –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –∫–æ–Ω—Ñ–ª—ñ–∫—Ç —Å—É–º—ñ—à—ñ —Ç–∞ –æ–±–µ—Ä–∏ –¥—ñ—é. –¢—Ä–∏–º–∞–π —Å–µ—Ä—ñ—é –≤–¥–∞–ª–∏—Ö —Ä—ñ—à–µ–Ω—å!</p>
    <div class="row">
      <button class="btn" onclick="newCase()">üéØ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç</button>
      <select id="caseAction" class="input" style="max-width:340px">
        <option value="">‚Äî –û–±–µ—Ä–∏ –¥—ñ—é ‚Äî</option>
        <option value="–∑–∞–º—ñ–Ω–∞_FRAC">–ó–∞–º—ñ–Ω–∏—Ç–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç –Ω–∞ —ñ–Ω—à—É FRAC-–≥—Ä—É–ø—É</option>
        <option value="—Å–∫–æ—Ä–∏–≥—É–≤–∞—Ç–∏_pH">–î–æ–¥–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–æ—Ä pH/–≤–æ–¥—É –≤ —ñ–Ω—à–µ –¥–∂–µ—Ä–µ–ª–æ</option>
        <option value="–∑–º—ñ–Ω–∏—Ç–∏_–ø–æ—Ä—è–¥–æ–∫">–ó–º—ñ–Ω–∏—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è</option>
        <option value="–≤–∏–ª—É—á–∏—Ç–∏_–∑–∞–±–æ—Ä–æ–Ω–µ–Ω—É_–ø–∞—Ä—É">–í–∏–ª—É—á–∏—Ç–∏ –Ω–µ—Å—É–º—ñ—Å–Ω—É –ø–∞—Ä—É</option>
        <option value="–Ω—ñ—á–æ–≥–æ_–Ω–µ_—Ä–æ–±–∏—Ç–∏">–ù—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç–∏</option>
      </select>
      <button class="btn" onclick="checkCase()">‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
    </div>
    <div id="caseText" class="note" style="margin-top:8px">–ù–∞—Ç–∏—Å–Ω–∏ ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç¬ª</div>
    <div class="row" style="margin-top:8px">
      <div class="kpi"><span class="badgeNum" id="streak">0</span><div>–°–µ—Ä—ñ—è –≤–¥–∞–ª–∏—Ö —Ä—ñ—à–µ–Ω—å</div></div>
      <div id="caseFeedback" class="muted"></div>
    </div>
  </div>

  <!-- –°–•–ï–ú–ê -->
  <div class="card">
    <h2>üîå –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—É (SVG)</h2>
    <svg viewBox="0 0 760 300" role="img" aria-label="–ü–∞–π–ø–ª–∞–π–Ω —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ">
      <rect x="40" y="40" width="220" height="80" rx="12" fill="#0e2a47" stroke="#3b82f6"/>
      <text x="150" y="70" fill="#e5e7eb" font-size="14" text-anchor="middle">–ï—Ç–∏–∫–µ—Ç–∫–∏ –ó–ó–† (CSV)</text>
      <text x="150" y="88" fill="#93c5fd" font-size="12" text-anchor="middle">ai/FRAC/pH/REI/PHI</text>

      <rect x="300" y="40" width="200" height="80" rx="12" fill="#14532d" stroke="#22c55e"/>
      <text x="400" y="70" fill="#dcfce7" font-size="14" text-anchor="middle">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å—É–º—ñ—à—ñ</text>
      <text x="400" y="88" fill="#a7f3d0" font-size="12" text-anchor="middle">–¥–æ–∑–∏/–≤–æ–¥–∞/–ø–ª–æ—â–∞</text>

      <rect x="540" y="40" width="180" height="80" rx="12" fill="#7c2d12" stroke="#fb923c"/>
      <text x="630" y="70" fill="#fed7aa" font-size="14" text-anchor="middle">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∏</text>
      <text x="630" y="88" fill="#fed7aa" font-size="12" text-anchor="middle">FRAC/pH/order</text>

      <line x1="260" y1="80" x2="300" y2="80" stroke="#93c5fd" stroke-width="3"/>
      <line x1="500" y1="80" x2="540" y2="80" stroke="#93c5fd" stroke-width="3"/>

      <rect x="180" y="160" width="190" height="80" rx="12" fill="#111827" stroke="#4b5563"/>
      <text x="275" y="192" fill="#e5e7eb" font-size="14" text-anchor="middle">–ü—Ä–æ–º–ø—Ç –¥–æ –®–Ü</text>
      <text x="275" y="210" fill="#9ca3af" font-size="12" text-anchor="middle">–≤–∞–ª—ñ–¥–∞—Ü—ñ—è IPM</text>

      <rect x="420" y="160" width="220" height="80" rx="12" fill="#0b3f5a" stroke="#22d3ee"/>
      <text x="530" y="192" fill="#a5f3fc" font-size="14" text-anchor="middle">–ú–∞—Ç—Ä–∏—Ü—è —Ä–∏–∑–∏–∫—ñ–≤ —ñ –∂—É—Ä–Ω–∞–ª</text>
      <text x="530" y="210" fill="#a5f3fc" font-size="12" text-anchor="middle">—Ä—ñ—à–µ–Ω–Ω—è –π –ø–æ—è—Å–Ω–µ–Ω–Ω—è</text>
    </svg>
  </div>

  <!-- –ü–Ü–î–°–£–ú–û–ö -->
  <div class="card">
    <h2>üìã –©–æ –∑–¥–∞—Ç–∏ –≤ –∫—ñ–Ω—Ü—ñ –ø–∞—Ä–∏</h2>
    <ul>
      <li>–°–∫—Ä—ñ–Ω –º–∞—Ç—Ä–∏—Ü—ñ —Ä–∏–∑–∏–∫—ñ–≤ —Ç–∞ –∂—É—Ä–Ω–∞–ª—É (–ø—ñ—Å–ª—è ¬´üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏¬ª).</li>
      <li>TXT –∑ –ø—Ä–æ–º–ø—Ç–æ–º –¥–æ LLM + 2 –∫–æ—Ä–æ—Ç–∫—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó, —è–∫—ñ –≤–∏ –ø—Ä–∏–π–Ω—è–ª–∏.</li>
      <li>–°–∫—Ä—ñ–Ω –∫–≤—ñ–∑—É –∑ –≤–∞—à–æ—é —Å–µ—Ä—ñ—î—é (–Ω–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –º–∞–∫—Å–∏–º—É–º, –≤–∞–∂–ª–∏–≤–µ –æ–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è).</li>
    </ul>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-21">21.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function log(msg){const t=new Date().toLocaleTimeString(); LOG.textContent+=`[${t}] ${msg}\n`; LOG.scrollTop=LOG.scrollHeight;}
const byId = (id)=>document.getElementById(id);

// ===== –î–∞–Ω—ñ –µ—Ç–∏–∫–µ—Ç–æ–∫ =====
let labels=[]; // {product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes}
const PRODSEL = $('#productSel'), MIXTBL = $('#mixTbl tbody'), RISK = $('#riskTbl tbody'), LOG = $('#log');

function parseCSV(txt){
  labels.length=0;
  const lines=(txt||'').trim().split(/\r?\n/).filter(Boolean);
  const head=lines.shift();
  const cols=head.split(',').map(s=>s.trim());
  const idx = (name)=>cols.indexOf(name);
  const need=['product','ai','group','form','dose_per_ha','unit','crops','targets','water_l_ha','rei_h','phi_d','ph_min','ph_max','incompat','notes'];
  for(const n of need){ if(idx(n)===-1) throw new Error('–í—ñ–¥—Å—É—Ç–Ω—ñ–π —Å—Ç–æ–≤–ø–µ—Ü—å: '+n); }
  for(const line of lines){
    const parts=line.split(','); // –ø—Ä–æ—Å—Ç–∞ —Ä–æ–∑–±–∏–≤–∫–∞ (–¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Å–µ—Ç—ñ–≤ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ)
    const r={};
    need.forEach((n,i)=>r[n]= (parts[idx(n)]||'').trim());
    r.dose_per_ha=parseFloat(r.dose_per_ha)||0;
    r.water_l_ha=parseFloat(r.water_l_ha)||0;
    r.rei_h=parseFloat(r.rei_h)||0;
    r.phi_d=parseFloat(r.phi_d)||0;
    r.ph_min=parseFloat(r.ph_min); r.ph_max=parseFloat(r.ph_max);
    labels.push(r);
  }
  labels.sort((a,b)=>a.product.localeCompare(b.product));
}

function refreshProductList(){
  PRODSEL.innerHTML='';
  labels.forEach(l=>{
    const opt=document.createElement('option');
    opt.value=l.product; opt.textContent=`${l.product} ‚Äî ${l.ai} (${l.group})`;
    PRODSEL.appendChild(opt);
  });
  $('#badgeN').textContent='–ü—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤: '+labels.length;
  byId('k_labels').textContent = labels.length;
  updateProgress();
}

// ===== –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å—É–º—ñ—à—ñ =====
let mix=[]; // [{product, dose, unit, group, form}]

function addToMix(){
  const product=PRODSEL.value; if(!product) return;
  const dose=parseFloat($('#dose').value)||0;
  const unit=$('#unit').value;
  const lab=labels.find(l=>l.product===product);
  mix.push({product, dose, unit, group:lab?.group||'', form:lab?.form||''});
  renderMix();
  updateProgress();
}
function removeFromMix(idx){ mix.splice(idx,1); renderMix(); }

function renderMix(){
  MIXTBL.innerHTML='';
  mix.forEach((m,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${m.product}</td><td>${m.group}</td><td>${m.form}</td><td>${m.dose} ${m.unit}/–≥–∞</td><td><button class="btn secondary" data-i="${i}">‚úñ</button></td>`;
    MIXTBL.appendChild(tr);
  });
  MIXTBL.querySelectorAll('button[data-i]').forEach(b=>b.onclick=()=>removeFromMix(parseInt(b.dataset.i)));
  $('#badgeRisk').textContent='–°—Ç–∞—Ç—É—Å: ‚Äî';
  $('#order').textContent='// –ù–∞—Ç–∏—Å–Ω–∏ ¬´üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å¬ª';
  $('#mixAdvice').textContent='';
  byId('k_mix').textContent = mix.length;
  calcRiskScore(); // –æ–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∫–∞–∑–Ω–∏–∫
}

// ===== –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ =====
const FORM_ORDER = ['WP','WG','WDG','DF','SG','SC','SE','EC','EW','SL','SP','OD','UL','CS','ADJ']; // —Å–ø—Ä–æ—â–µ–Ω–∏–π

function orderAdvice(list){
  const groups=list.map(x=>({name:x.product, form:(x.form||'').toUpperCase()}));
  groups.sort((a,b)=>(FORM_ORDER.indexOf(a.form) - FORM_ORDER.indexOf(b.form)));
  const seq = groups.map(g=>`${g.form||'‚Äî'}: ${g.name}`).join('\n');
  return `–ó–∞–ø–æ–≤–Ω–∏ –±–∞–∫ –≤–æ–¥–æ—é –Ω–∞ 1/3‚Äì1/2.\n–î–∞–ª—ñ –ø–æ –æ–¥–Ω–æ–º—É:\n${seq}\n–ù–∞–æ—Å—Ç–∞–Ω–æ–∫ ‚Äî –∞–¥‚Äô—é–≤–∞–Ω—Ç–∏/–ü–ê–† (—è–∫—â–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –µ—Ç–∏–∫–µ—Ç–∫–æ—é).`;
}

function checkFRAC(mix, labels){
  const seen=new Map(); const dup=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    const g=(lab?.group||'').toUpperCase();
    if(!g) return;
    if(!seen.has(g)) seen.set(g,[]);
    seen.get(g).push(m.product);
  });
  for(const [g,arr] of seen.entries()){ if(arr.length>1) dup.push(`${g}: ${arr.join(' + ')}`); }
  return {ok: dup.length===0, msg: dup.length?('–ü–æ–≤—Ç–æ—Ä–Ω–∏–π –ú–æ–ê/FRAC –≤ –æ–¥–Ω—ñ–π —Å—É–º—ñ—à—ñ:\n'+dup.join('\n')):'–û–∫: —Ä—ñ–∑–Ω—ñ –∞–±–æ –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω—ñ –≥—Ä—É–ø–∏.'};
}

function checkPH(mix, labels){
  let globalMin=-Infinity, globalMax=Infinity;
  const details=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    const mn=isNaN(lab.ph_min)?null:lab.ph_min;
    const mx=isNaN(lab.ph_max)?null:lab.ph_max;
    details.push(`${lab.product}: pH ${mn??'‚Äî'}..${mx??'‚Äî'}`);
    if(mn!=null) globalMin=Math.max(globalMin,mn);
    if(mx!=null) globalMax=Math.min(globalMax,mx);
  });
  const ok = globalMin<=globalMax;
  const msg = ok ? `–°–ø—ñ–ª—å–Ω–µ –≤—ñ–∫–Ω–æ pH: ${isFinite(globalMin)?globalMin:'-‚àû'}..${isFinite(globalMax)?globalMax:'‚àû'}` : '–ù–µ–º–∞—î –ø–µ—Ä–µ—Ç–∏–Ω—É pH-–≤—ñ–∫–æ–Ω –ø—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤ ‚Üí —Ä–∏–∑–∏–∫ –æ—Å–∞–¥—É/—ñ–Ω–∞–∫—Ç–∏–≤.';
  return {ok, msg, details:details.join('; ')};
}

function checkLabelIncompat(mix, labels){
  const warns=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    const inc=(lab.incompat||'').toLowerCase();
    mix.forEach(n=>{
      if(n.product===m.product) return;
      if(inc && inc.split(/[;|]/).some(w=>w && n.product.toLowerCase().includes(w.trim()))) {
        warns.push(`${m.product} ‚ö† –Ω–µ —Å—É–º—ñ—Å–Ω–∏–π –∑ ${n.product} (–∑–∞ –µ—Ç–∏–∫–µ—Ç–∫–æ—é)`);
      }
    });
  });
  return {ok: warns.length===0, msg: warns.join('\n')||'–ï—Ç–∏–∫–µ—Ç–∫–æ–≤–∏—Ö –∑–∞–±–æ—Ä–æ–Ω –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ.'};
}

function checkDoseAgainstLabel(mix, labels){
  const probs=[];
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    const unitOk = (lab.unit||'').toLowerCase() === (m.unit||'').toLowerCase();
    const doseOk = unitOk && m.dose>0 && m.dose<=lab.dose_per_ha*1.1 && m.dose>=lab.dose_per_ha*0.5; // 50‚Äì110% —è–∫ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ—Ä–∏–¥–æ—Ä
    if(!unitOk) probs.push(`${m.product}: –æ–¥–∏–Ω–∏—Ü—ñ –≤ –µ—Ç–∏–∫–µ—Ç—Ü—ñ ${lab.unit}, —É —Å—É–º—ñ—à—ñ ${m.unit}`);
    if(!doseOk) probs.push(`${m.product}: –¥–æ–∑–∞ ${m.dose} ${m.unit}/–≥–∞ –ø–æ–∑–∞ –¥–æ–≤—ñ–¥–∫–æ–≤–∏–º –∫–æ—Ä–∏–¥–æ—Ä–æ–º ~${lab.dose_per_ha} ${lab.unit}/–≥–∞`);
  });
  return {ok: probs.length===0, msg: probs.join('\n')||'–î–æ–∑–∏ –∫–æ—Ä–µ–∫—Ç–Ω—ñ –≤—ñ–¥–Ω–æ—Å–Ω–æ –µ—Ç–∏–∫–µ—Ç–∫–æ–≤–∏—Ö.'};
}

function checkREI_PHI(mix, labels){
  let maxREI=0, maxPHI=0;
  mix.forEach(m=>{
    const lab=labels.find(l=>l.product===m.product);
    if(!lab) return;
    maxREI=Math.max(maxREI, lab.rei_h||0);
    maxPHI=Math.max(maxPHI, lab.phi_d||0);
  });
  const msg=`REI (–≥–æ–¥): ‚â§${maxREI}. PHI (–¥–Ω—ñ–≤): ‚â•${maxPHI}.`;
  return {ok:true, msg};
}

function calcRiskScore(){
  // –ù–µ–≤–µ–ª–∏–∫–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∏–∑–∏–∫—É: BAD=2, WARN=1, OK=0
  const rows=$$('#riskTbl tbody tr');
  let score=0;
  rows.forEach(tr=>{
    const status=tr.querySelector('td:last-child')?.textContent||'';
    if(status.includes('BAD')) score+=2;
    else if(status.includes('WARN')) score+=1;
  });
  byId('riskScore').textContent = score;
  return score;
}

function runChecks(){
  RISK.innerHTML=''; LOG.textContent='';
  if(mix.length===0){ log('–°—É–º—ñ—à –ø–æ—Ä–æ–∂–Ω—è'); $('#badgeRisk').textContent='–°—Ç–∞—Ç—É—Å: —Å—É–º—ñ—à –ø–æ—Ä–æ–∂–Ω—è'; return; }

  const rows=[];
  function push(name, res, level='ok'){
    const tr=document.createElement('tr');
    const cls = res.ok ? 'risk-ok' : (level==='warn'?'risk-warn':'risk-bad');
    tr.innerHTML = `<td>${name}</td><td class="small">${(res.msg||'‚Äî').replace(/\n/g,'<br/>')}</td><td class="${cls}">${res.ok?'OK':(level==='warn'?'WARN':'BAD')}</td>`;
    RISK.appendChild(tr);
    log(`${name}: ${res.ok?'OK':(level==='warn'?'WARN':'BAD')} ‚Äî ${res.msg.replace(/\n/g,'; ')}`);
    rows.push({name,ok:res.ok,level,msg:res.msg});
  }

  const r1=checkFRAC(mix,labels);            push('FRAC/HRAC —Ä–æ—Ç–∞—Ü—ñ—è', r1, r1.ok?'ok':'warn');
  const r2=checkPH(mix,labels);              push('–í—ñ–∫–Ω–∞ pH (–ø–µ—Ä–µ—Ç–∏–Ω)', r2, r2.ok?'ok':'bad');
  const r3=checkLabelIncompat(mix,labels);   push('–ï—Ç–∏–∫–µ—Ç–∫–æ–≤—ñ –∑–∞–±–æ—Ä–æ–Ω–∏', r3, r3.ok?'ok':'bad');
  const r4=checkDoseAgainstLabel(mix,labels);push('–î–æ–∑–∏ –ø—Ä–æ—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫–∏', r4, r4.ok?'ok':'warn');
  const r5=checkREI_PHI(mix,labels);         push('REI/PHI –∑–≤–µ–¥–µ–Ω–Ω—è', r5, 'ok');

  const score = calcRiskScore();
  const allOk = score===0;
  $('#badgeRisk').textContent = '–°—Ç–∞—Ç—É—Å: ' + (allOk?'—É–º–æ–≤–Ω–æ —Å—É–º—ñ—Å–Ω–∞':'—î —Å—É–ø–µ—Ä–µ—á–Ω–æ—Å—Ç—ñ');
  $('#mixAdvice').textContent = allOk ? '‚úÖ –ß—ñ—Ç–∫–æ: –º–æ–∂–µ—à –≤—ñ–¥–¥–∞—Ç–∏ –Ω–∞ —Ñ—ñ–Ω–∞–ª—å–Ω—É –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—é' : '‚ÑπÔ∏è –ü—ñ–¥–∫–∞–∑–∫–∞: –∑–º–µ–Ω—à —Ä–∏–∑–∏–∫-–±–∞–ª –¥–æ ‚â§2: —É–Ω–∏–∫–∞–π –¥—É–±–ª—é–≤–∞–Ω—å FRAC, –∑–≤—ñ—Ä pH —Ç–∞ –ø–æ—Ä—è–¥–æ–∫.';
  updateProgress();
  // –ü–æ—Ä—è–¥–æ–∫ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è
  const detailed = mix.map(m=>{
    const lab=labels.find(l=>l.product===m.product)||{};
    return {product:m.product, form:(lab.form||'').toUpperCase()};
  });
  $('#order').textContent = orderAdvice(detailed);
}

// ===== –ü—Ä–æ–º–ø—Ç –¥–æ LLM =====
function buildPrompt(){
  const riskRows=[...RISK.querySelectorAll('tr')].map(tr=>{
    const tds=tr.querySelectorAll('td');
    return {check:tds[0]?.textContent||'', details:tds[1]?.textContent||'', status:tds[2]?.textContent||''};
  });
  const mixJson = mix.map(m=>{
    const lab=labels.find(l=>l.product===m.product)||{};
    return {
      product:m.product, ai:lab.ai||'', group:lab.group||'',
      form:lab.form||'', dose_per_ha:m.dose, unit:m.unit,
      ph_min:lab.ph_min||null, ph_max:lab.ph_max||null,
      rei_h:lab.rei_h||null, phi_d:lab.phi_d||null
    };
  });

  return `–¢–∏ ‚Äî –∞–≥—Ä–æ–Ω–æ–º-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (IPM). –ü–µ—Ä–µ–≤—ñ—Ä —Ç–∞, –∑–∞ –ø–æ—Ç—Ä–µ–±–∏, —Å–∫–æ—Ä–∏–≥—É–π –±–∞–∫–æ–≤—É —Å—É–º—ñ—à.
–ü–æ–ª–µ: –∫—É–ª—å—Ç—É—Ä–∞="${$('#crop').value||'-'}", —Ü—ñ–ª—å="${$('#target').value||'-'}".
–ü–∞—Ä–∞–º–µ—Ç—Ä–∏: –≤–æ–¥–∞=${$('#water').value} –ª/–≥–∞, –±–∞–∫=${$('#tank').value} –ª, –ø–ª–æ—â–∞=${$('#area').value} –≥–∞.
–°—É–º—ñ—à (JSON):
${JSON.stringify(mixJson, null, 2)}
–ú–∞—Ç—Ä–∏—Ü—è –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫:
${riskRows.map(r=>`- ${r.check}: [${r.status}] ${r.details}`).join('\n')}

–ó–∞–≤–¥–∞–Ω–Ω—è:
1) –ü—ñ–¥—Ç–≤–µ—Ä–¥—å/–∑–º—ñ–Ω–∏ –¥–æ–∑–∏ –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ –µ—Ç–∏–∫–µ—Ç–∫–∏/–¥–æ–≤—ñ–¥–Ω–∏–∫–∏.
2) –û—Ü—ñ–Ω–∏ FRAC/HRAC-—Ä–æ—Ç–∞—Ü—ñ—é —ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É (–∞–Ω—Ç–∏-—Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å).
3) –ü–µ—Ä–µ–≤—ñ—Ä pH-–≤—ñ–∫–Ω–æ, –ø–æ—Ä—è–¥–æ–∫ (WP‚ÜíWG‚ÜíSC‚ÜíEC‚ÜíSL‚Üí–∞–¥‚Äô—é–≤–∞–Ω—Ç–∏) —Ç–∞ –ø–æ—Ç—Ä–µ–±—É –≤ –ü–ê–†.
4) –í–∫–∞–∂–∏ REI/PHI –¥–ª—è –≤—Å—ñ—î—ó —Å—É–º—ñ—à—ñ, –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –π –ó–Ü–ó.
5) –ó–∞–ø—Ä–æ–ø–æ–Ω—É–π 2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Å–ø—Ä–æ—â–µ–Ω–Ω—è –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.
–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –ø–ª–∞–Ω —ñ–∑ –ø—ñ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —Å–ø–∏—Å–∫–∞–º–∏ —Ç–∞ –¥–∂–µ—Ä–µ–ª–∞–º–∏.`;
}

// ===== –ú—ñ—Å—ñ—ó + –ø—Ä–æ–≥—Ä–µ—Å =====
const LS_MISS='para23_missions';
function loadMissions(){ try{ return JSON.parse(localStorage.getItem(LS_MISS)||'{}'); }catch(_){ return {}; } }
function saveMissions(obj){ try{ localStorage.setItem(LS_MISS, JSON.stringify(obj)); }catch(_){} }
function markMissionAuto(id){
  const miss=loadMissions(); miss[id]=true; saveMissions(miss); updateProgress();
}
function updateProgress(){
  const miss=loadMissions();
  const all=['m1','m2','m3','m4'];
  // –ê–≤—Ç–æ-–æ—Ü—ñ–Ω–∫–∞ –¥–µ—è–∫–∏—Ö
  if(labels.length>=4) miss.m1=true;
  if(mix.length>=2) miss.m2=true;
  const score=parseInt(byId('riskScore').textContent||'0',10);
  if(score<=2 && mix.length>0) miss.m3=true;

  saveMissions(miss);
  const done=all.filter(k=>miss[k]).length;
  const pct=Math.round(done/all.length*100);
  byId('progressBar').style.width=pct+'%';
  $$('.mission').forEach(ch=>ch.checked=!!miss[ch.dataset.id]);
}
$$('.mission').forEach(ch=>{
  ch.addEventListener('change',()=>{
    const miss=loadMissions();
    miss[ch.dataset.id]=ch.checked; saveMissions(miss); updateProgress();
  });
});

// ===== –ö–µ–π—Å-–∫–≤—ñ–∑ =====
const CASES = [
  {t:'–£ —Å—É–º—ñ—à—ñ –¥–≤—ñ –¥—ñ—é—á—ñ –æ–¥–Ω—ñ—î—ó FRAC-–≥—Ä—É–ø–∏ (QoI C3).', best:['–∑–∞–º—ñ–Ω–∞_FRAC'], ok:['–Ω—ñ—á–æ–≥–æ_–Ω–µ_—Ä–æ–±–∏—Ç–∏'], bad:[]},
  {t:'–í—ñ–∫–Ω–∞ pH –ø—Ä–µ–ø–∞—Ä–∞—Ç—ñ–≤ –Ω–µ –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å—Å—è.', best:['—Å–∫–æ—Ä–∏–≥—É–≤–∞—Ç–∏_pH'], ok:[], bad:['–Ω—ñ—á–æ–≥–æ_–Ω–µ_—Ä–æ–±–∏—Ç–∏']},
  {t:'–ï—Ç–∏–∫–µ—Ç–∫–∞ –ê –∫–∞–∂–µ ¬´–Ω–µ –∑–º—ñ—à—É–≤–∞—Ç–∏ –∑ –º—ñ–¥–¥—é¬ª, –∞ –≤ —Å—É–º—ñ—à—ñ —î –º—ñ–¥—å.', best:['–≤–∏–ª—É—á–∏—Ç–∏_–∑–∞–±–æ—Ä–æ–Ω–µ–Ω—É_–ø–∞—Ä—É'], ok:[], bad:['–Ω—ñ—á–æ–≥–æ_–Ω–µ_—Ä–æ–±–∏—Ç–∏']},
  {t:'–£ –±–∞–∫ —Å–ø–µ—Ä—à—É –Ω–∞–ª–∏–ª–∏ EC, –ø–æ—Ç—ñ–º WG ‚Üí –ø—ñ—à–ª–∞ –ø—ñ–Ω–∞/–ø–ª–∞—Å—Ç—ñ–≤—Ü—ñ.', best:['–∑–º—ñ–Ω–∏—Ç–∏_–ø–æ—Ä—è–¥–æ–∫'], ok:[], bad:['–Ω—ñ—á–æ–≥–æ_–Ω–µ_—Ä–æ–±–∏—Ç–∏']},
];
let CASE_IDX=-1, STREAK=0;
function newCase(){
  CASE_IDX=Math.floor(Math.random()*CASES.length);
  byId('caseText').textContent=CASES[CASE_IDX].t;
  byId('caseFeedback').textContent='';
  byId('caseAction').value='';
}
function checkCase(){
  if(CASE_IDX<0){ alert('–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π –∫–æ–Ω—Ñ–ª—ñ–∫—Ç'); return; }
  const act=byId('caseAction').value;
  if(!act){ alert('–û–±–µ—Ä–∏ –¥—ñ—é'); return; }
  const c=CASES[CASE_IDX];
  if(c.best.includes(act)){
    STREAK++; byId('caseFeedback').textContent='‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è';
    byId('caseFeedback').style.color='var(--ok)';
  }else if(c.ok.includes(act)){
    STREAK=Math.max(0,STREAK-1); byId('caseFeedback').textContent='‚ÑπÔ∏è –ü—Ä–∏–π–Ω—è—Ç–Ω–æ, –∞–ª–µ –º–æ–∂–Ω–∞ –∫—Ä–∞—â–µ';
    byId('caseFeedback').style.color='';
  }else{
    STREAK=0; byId('caseFeedback').textContent='‚ùå –ù–µ–≤–¥–∞–ª–∞ –¥—ñ—è ‚Äî –≤–∏—Å–æ–∫–∏–π —Ä–∏–∑–∏–∫';
    byId('caseFeedback').style.color='var(--bad)';
  }
  byId('streak').textContent=STREAK;
}

// ===== –ü–æ–¥—ñ—ó UI =====
$('#demo').addEventListener('click', ()=>{
  $('#csv').value =
`product,ai,group,form,dose_per_ha,unit,crops,targets,water_l_ha,rei_h,phi_d,ph_min,ph_max,incompat,notes
–¢–µ–±—É–∫–æ–Ω–∞–∑–æ–ª 250,—Ç–µ–±—É–∫–æ–Ω–∞–∑–æ–ª,DMI G3,EC,0.5,–ª/–≥–∞,–ø—à–µ–Ω–∏—Ü—è,—Å–µ–ø—Ç–æ—Ä—ñ–æ–∑|—ñ—Ä–∂–∞,200,24,35,5,7,,–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ç—Ä–∏–∞–∑–æ–ª
–ê–∑–æ–∫—Å–∏—Å—Ç—Ä–æ–±—ñ–Ω 250,–∞–∑–æ–∫—Å–∏—Å—Ç—Ä–æ–±—ñ–Ω,QoI C3,SC,0.5,–ª/–≥–∞,–ø—à–µ–Ω–∏—Ü—è,—Å–µ–ø—Ç–æ—Ä—ñ–æ–∑|—Å–∞–∂–∞,200,12,35,5.5,7.5,–º—ñ–¥—å,–ù–µ –∑–º—ñ—à—É–≤–∞—Ç–∏ –∑ –ª—É–∂–Ω–∏–º–∏ —Ä–æ–∑—á–∏–Ω–∞–º–∏
–•–ª–æ—Ä—Ç–∞–ª–æ–Ω—ñ–ª 720,—Ö–ª–æ—Ä—Ç–∞–ª–æ–Ω—ñ–ª,–ú—É–ª—å—Ç–∏—Å–∞–π—Ç M5,SC,1.0,–ª/–≥–∞,–∫–∞—Ä—Ç–æ–ø–ª—è,—Ñ—ñ—Ç–æ—Ñ—Ç–æ—Ä–æ–∑,200,48,7,6,7.5,,–ó–∞—Ö–∏—Å–Ω–∞ –¥—ñ—è
–ì–ª—ñ—Ñ–æ—Å–∞—Ç 480,–≥–ª—ñ—Ñ–æ—Å–∞—Ç,EPSPS G,SL,3.0,–ª/–≥–∞,–ø–∞—Ä–∏,–±—É—Ä‚Äô—è–Ω–∏,200,12,0,4,6,–∞–º–æ–Ω—ñ–π–Ω—ñ —Å—É–ª—å—Ñ–∞—Ç–∏,–ü—ñ—Å–ª—è–∂–Ω–∏–≤–Ω–µ –≤–Ω–µ—Å–µ–Ω–Ω—è
–ú—ñ–¥–Ω–∏–π –∫—É–ø–æ—Ä–æ—Å,–º—ñ–¥—å,M1,WP,3.0,–∫–≥/–≥–∞,—Å–∞–¥,–±–∞–∫—Ç–µ—Ä—ñ–æ–∑–∏,800,24,30,6.5,8,—Å—Ç—Ä–æ–±—ñ–ª—É—Ä–∏–Ω–∏,–£–Ω–∏–∫–∞–π –∑–º—ñ—à—É–≤–∞–Ω–Ω—è –∑—ñ —Å—Ç—Ä–æ–±—ñ–ª—É—Ä–∏–Ω–∞–º–∏`;
  log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –µ—Ç–∞–ª–æ–Ω–Ω—ñ –µ—Ç–∏–∫–µ—Ç–∫–∏');
});

$('#load').addEventListener('click', ()=>{
  try{ parseCSV($('#csv').value); refreshProductList(); log('–ï—Ç–∏–∫–µ—Ç–∫–∏ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ'); markMissionAuto('m1'); }
  catch(e){ alert('–ü–æ–º–∏–ª–∫–∞ CSV: '+e.message); }
});
$('#clearLabels').addEventListener('click', ()=>{ labels.length=0; refreshProductList(); log('–ï—Ç–∏–∫–µ—Ç–∫–∏ –æ—á–∏—â–µ–Ω–æ'); });

$('#add').addEventListener('click', ()=>{ addToMix(); markMissionAuto('m2'); });
$('#check').addEventListener('click', ()=>{ runChecks(); });

$('#genPrompt').addEventListener('click', ()=>{ $('#prompt').textContent=buildPrompt(); log('–ü—Ä–æ–º–ø—Ç –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ'); markMissionAuto('m4'); });
$('#copyPrompt').addEventListener('click', ()=>{
  const ta=document.createElement('textarea'); ta.value=$('#prompt').textContent; document.body.appendChild(ta);
  ta.select(); document.execCommand('copy'); ta.remove(); log('–ü—Ä–æ–º–ø—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
});
$('#savePrompt').addEventListener('click', ()=>{ const txt=$('#prompt').textContent||buildPrompt(); download('para23_prompt_'+stamp()+'.txt',txt); });

$('#exportLog').addEventListener('click', ()=>{
  const lines = $('#log').textContent.trim()||'–ñ—É—Ä–Ω–∞–ª –ø–æ—Ä–æ–∂–Ω—ñ–π';
  download('para23_log_'+stamp()+'.txt', lines);
});
$('#resetLog').addEventListener('click', ()=>{ LOG.textContent=''; });

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
refreshProductList();
if (window.self !== window.top) document.documentElement.classList.add('embedded'); // Moodle-friendly
updateProgress();
</script>
</body>
</html>
