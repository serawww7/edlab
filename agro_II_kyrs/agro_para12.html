<!-- agro_para12.html
     –ü–ê–†–ê 12 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –∞–≥—Ä–æ–Ω–æ–º—ñ–≤
     –¢–µ–º–∞: GPS-–ö–ê–†–¢–£–í–ê–ù–ù–Ø –ü–û–õ–Ø ‚Äî —Ç—Ä–µ–∫ –º–µ–∂—ñ, –ø–ª–æ—â–∞/–ø–µ—Ä–∏–º–µ—Ç—Ä, –±—É—Ñ–µ—Ä–Ω—ñ —Å–º—É–≥–∏, “ë—Ä—ñ–¥ —Ç–æ—á–æ–∫ –≤—ñ–¥–±–æ—Ä—É, GeoJSON/CSV
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫; –ø—Ä–∞—Ü—é—î –Ω–∞ HTTPS (GitHub Pages) —ñ–∑ Geolocation API.
     –ö–æ–Ω—Ç—Ä–∞—Å—Ç: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ ‚Äî –∑—ñ —Å–≤—ñ—Ç–ª–∏–º —Ç–µ–∫—Å—Ç–æ–º.

     –©–æ –≤–º—ñ—î:
     ‚Ä¢ –°—Ç–∞—Ä—Ç/—Å—Ç–æ–ø —Ç—Ä–µ–∫—É –º–µ–∂—ñ –ø–æ–ª—è (GPS) –∞–±–æ —Ä—É—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ—á–∫–∏.
     ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ (–º), –ø–ª–æ—â—ñ (–≥–∞) –∑ –≥–µ–æ–¥–µ–∑–∏—á–Ω–æ—é –∫–æ—Ä–µ–∫—Ü—ñ—î—é (–µ–∫–≤—ñ–¥–∏—Å—Ç–∞–Ω—Ç–Ω–∞ –ø—Ä–æ—î–∫—Ü—ñ—è –ø–æ —Å–µ—Ä–µ–¥–Ω—ñ–π —à–∏—Ä–æ—Ç—ñ).
     ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –±—É—Ñ–µ—Ä–Ω–æ—ó —Å–º—É–≥–∏ (–∑–∞—Ö–∏—Å–Ω–∏–π –ø–æ—è—Å) –Ω–∞ X –º–µ—Ç—Ä—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—É/–Ω–∞–∑–æ–≤–Ω—ñ (—Å–ø—Ä–æ—â–µ–Ω–∏–π –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –æ—Ñ—Å–µ—Ç).
     ‚Ä¢ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ “ë—Ä—ñ–¥–∞ —Ç–æ—á–æ–∫ (–∫—Ä–æ–∫, –º) —ñ –≤—ñ–¥–±—ñ—Ä –ª–∏—à–µ —Ç–∏—Ö, —â–æ –ª–µ–∂–∞—Ç—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ–ª—ñ–≥–æ–Ω–∞.
     ‚Ä¢ –ï–∫—Å–ø–æ—Ä—Ç GeoJSON (–ø–æ–ª—ñ–≥–æ–Ω, –±—É—Ñ–µ—Ä, —Ç–æ—á–∫–∏) —Ç–∞ CSV (—Ç–æ—á–∫–∏ “ë—Ä—ñ–¥–∞).
     ‚Ä¢ –î–µ–º–æ–¥–∞–Ω—ñ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä—ñ—ó –±–µ–∑ GPS.

     –ì–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages / iFrame —É Moodle.
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 12 ‚Äî GPS-–∫–∞—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—è: –º–µ–∂–∞, –ø–ª–æ—â–∞, –±—É—Ñ–µ—Ä, “ë—Ä—ñ–¥, –µ–∫—Å–ø–æ—Ä—Ç</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted); letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  .small{font-size:12px; color:#9fb0c8}
  .muted{color:#93a3b5}
  .pill{display:inline-block; padding:4px 10px; border:1px solid #223049; border-radius:999px; font-size:12px; color:#a5b4fc; background:#0d1a2e; margin-right:6px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:var(--darkcell); color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  input[type="text"], input[type="number"]{
    width:100%; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e6eef9
  }

  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:8px 10px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left; position:sticky; top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell); color:var(--darkink2)}
  .table td.dark, .table th.dark{background:var(--darkcell) !important; color:var(--darkink2) !important}
  .out{background:var(--darkcell); color:var(--darkink2); border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}

  /* –ú—ñ–Ω—ñ-¬´–∫–∞—Ä—Ç–∞¬ª –±–µ–∑ —Ç–∞–π–ª—ñ–≤: –∫–∞–Ω–≤–∞ –∑ –ª–æ–∫–∞–ª—å–Ω–∏–º –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è–º */
  #canvas{width:100%; height:420px; background:#0b1324; border:1px solid #223049; border-radius:12px}
  .legend{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
  .dot{display:inline-block; width:10px; height:10px; border-radius:50%}
  .c-border{background:#60a5fa}
  .c-buffer{background:#22c55e}
  .c-grid{background:#f59e0b}
  .c-me{background:#ef4444}

  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iFrame) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}
  html.embedded .box{background:#f8fafc; color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6; color:#111}

  @media print{
    @page{ margin:12mm }
    .no-print{ display:none !important }
  }
</style>
<meta name="description" content="–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –∑–∞–ø–∏—Å—É—é—Ç—å —Ç—Ä–µ–∫ –º–µ–∂—ñ –ø–æ–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –æ—Ç—Ä–∏–º—É—é—Ç—å –ø–µ—Ä–∏–º–µ—Ç—Ä (–º) —ñ –ø–ª–æ—â—É (–≥–∞), –±—É–¥—É—é—Ç—å –±—É—Ñ–µ—Ä–Ω—É —Å–º—É–≥—É (–∑–∞—Ö–∏—Å–Ω–∏–π –ø–æ—è—Å) —ñ –≥–µ–Ω–µ—Ä—É—é—Ç—å “ë—Ä—ñ–¥ —Ç–æ—á–æ–∫ –≤—ñ–¥–±"><link rel="canonical" href="https://edlab.pp.ua/agro_II_kyrs/agro_para12.html"><meta property="og:type" content="article"><meta property="og:title" content="üìç GPS-–∫–∞—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—è: –º–µ–∂–∞ ‚Üí –ø–ª–æ—â–∞/–ø–µ—Ä–∏–º–µ—Ç—Ä ‚Üí –±—É—Ñ–µ—Ä ‚Üí “ë—Ä—ñ–¥ ‚Üí GeoJSON/CSV"><meta property="og:description" content="–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –∑–∞–ø–∏—Å—É—é—Ç—å —Ç—Ä–µ–∫ –º–µ–∂—ñ –ø–æ–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –æ—Ç—Ä–∏–º—É—é—Ç—å –ø–µ—Ä–∏–º–µ—Ç—Ä (–º) —ñ –ø–ª–æ—â—É (–≥–∞), –±—É–¥—É—é—Ç—å –±—É—Ñ–µ—Ä–Ω—É —Å–º—É–≥—É (–∑–∞—Ö–∏—Å–Ω–∏–π –ø–æ—è—Å) —ñ –≥–µ–Ω–µ—Ä—É—é—Ç—å “ë—Ä—ñ–¥ —Ç–æ—á–æ–∫ –≤—ñ–¥–±"><meta property="og:url" content="https://edlab.pp.ua/agro_II_kyrs/agro_para12.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üìç GPS-–∫–∞—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—è: –º–µ–∂–∞ ‚Üí –ø–ª–æ—â–∞/–ø–µ—Ä–∏–º–µ—Ç—Ä ‚Üí –±—É—Ñ–µ—Ä ‚Üí “ë—Ä—ñ–¥ ‚Üí GeoJSON/CSV","description":"–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –∑–∞–ø–∏—Å—É—é—Ç—å —Ç—Ä–µ–∫ –º–µ–∂—ñ –ø–æ–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –æ—Ç—Ä–∏–º—É—é—Ç—å –ø–µ—Ä–∏–º–µ—Ç—Ä (–º) —ñ –ø–ª–æ—â—É (–≥–∞), –±—É–¥—É—é—Ç—å –±—É—Ñ–µ—Ä–Ω—É —Å–º—É–≥—É (–∑–∞—Ö–∏—Å–Ω–∏–π –ø–æ—è—Å) —ñ –≥–µ–Ω–µ—Ä—É—é—Ç—å “ë—Ä—ñ–¥ —Ç–æ—á–æ–∫ –≤—ñ–¥–±","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/agro_II_kyrs/agro_para12.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 12 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –∞–≥—Ä–æ–Ω–æ–º–∏</span>
    <h1>üìç GPS-–∫–∞—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—è: –º–µ–∂–∞ ‚Üí –ø–ª–æ—â–∞/–ø–µ—Ä–∏–º–µ—Ç—Ä ‚Üí –±—É—Ñ–µ—Ä ‚Üí “ë—Ä—ñ–¥ ‚Üí GeoJSON/CSV</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>
        –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ <b>–∑–∞–ø–∏—Å—É—é—Ç—å —Ç—Ä–µ–∫ –º–µ–∂—ñ –ø–æ–ª—è</b> —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –æ—Ç—Ä–∏–º—É—é—Ç—å <b>–ø–µ—Ä–∏–º–µ—Ç—Ä (–º)</b> —ñ <b>–ø–ª–æ—â—É (–≥–∞)</b>,
        –±—É–¥—É—é—Ç—å <b>–±—É—Ñ–µ—Ä–Ω—É —Å–º—É–≥—É</b> (–∑–∞—Ö–∏—Å–Ω–∏–π –ø–æ—è—Å) —ñ –≥–µ–Ω–µ—Ä—É—é—Ç—å <b>“ë—Ä—ñ–¥ —Ç–æ—á–æ–∫ –≤—ñ–¥–±–æ—Ä—É –ø—Ä–æ–±</b> –∑ –∫—Ä–æ–∫–æ–º (–º).
        –î–∞–ª—ñ ‚Äî <b>–µ–∫—Å–ø–æ—Ä—Ç</b> —É GeoJSON/CSV –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó —Ä–æ–±–æ—Ç–∏ —É QGIS/Google Earth/Sheets.
      </p>
      <p class="small">–û–±—á–∏—Å–ª–µ–Ω–Ω—è: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ WGS84 ‚Üí –ª–æ–∫–∞–ª—å–Ω–∞ –ø—Ä–æ—î–∫—Ü—ñ—è (–µ–∫–≤—ñ–¥–∏—Å—Ç–∞–Ω—Ç–Ω–∞ –∑–∞ —Å–µ—Ä–µ–¥–Ω—å–æ—é —à–∏—Ä–æ—Ç–æ—é) ‚Üí <span class="mono">–ø–µ—Ä–∏–º–µ—Ç—Ä=haversine</span>, <span class="mono">–ø–ª–æ—â–∞=—à–Ω—É—Ä–æ–∫</span>.</p>
    </div>

    <!-- –ö–ï–†–£–í–ê–ù–ù–Ø / –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø -->
    <div class="card">
      <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–ü–æ–ª–µ</h3>
          <div class="row">
            <div style="flex:1"><label>–ö–æ–¥ –ø–æ–ª—è</label><input id="fieldCode" type="text" value="F-01"></div>
            <div style="flex:1"><label>–ù–∞–∑–≤–∞</label><input id="fieldName" type="text" value="–ù–∞–≤—á–∞–ª—å–Ω–µ –ø–æ–ª–µ"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="startTrack()">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç —Ç—Ä–µ–∫—É</button>
            <button class="btn" onclick="stopTrack()">‚è∏Ô∏è –°—Ç–æ–ø</button>
            <button class="btn" onclick="addCurrent()">‚ûï –¢–æ—á–∫–∞ (GPS)</button>
            <button class="btn" onclick="addManual()">‚úçÔ∏è –¢–æ—á–∫–∞ (—Ä—É—á–Ω.)</button>
          </div>
          <p class="small">–ü—Ä–∞—Ü—é—î –Ω–∞ HTTPS; –¥–æ–∑–≤–æ–ª—å –¥–æ—Å—Ç—É–ø –¥–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó.</p>
        </div>

        <div class="box">
          <h3>–ë—É—Ñ–µ—Ä / “ê—Ä—ñ–¥</h3>
          <div class="row">
            <div style="flex:1"><label>–ë—É—Ñ–µ—Ä, –º (–≤—Å–µ—Ä–µ–¥–∏–Ω—É ‚àí, –Ω–∞–∑–æ–≤–Ω—ñ +)</label><input id="bufferM" type="number" step="1" value="0"></div>
            <div style="flex:1"><label>–ö—Ä–æ–∫ “ë—Ä—ñ–¥–∞, –º</label><input id="gridStep" type="number" step="1" value="100"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="makeBuffer()">üü¢ –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –±—É—Ñ–µ—Ä</button>
            <button class="btn" onclick="makeGrid()">üü† –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ “ë—Ä—ñ–¥</button>
          </div>
        </div>

        <div class="box">
          <h3>–ï–∫—Å–ø–æ—Ä—Ç / –î–µ–º–æ</h3>
          <div class="row">
            <button class="btn" onclick="exportGeoJSON()">‚¨áÔ∏è GeoJSON</button>
            <button class="btn" onclick="copyCSV()">üìã CSV (“ë—Ä—ñ–¥)</button>
            <button class="btn" onclick="demo()">üß™ –î–µ–º–æ –º–µ–∂–∞</button>
            <button class="btn" onclick="resetAll()">‚ôªÔ∏è –°–∫–∏–Ω—É—Ç–∏</button>
          </div>
          <div class="legend" style="margin-top:8px">
            <span class="dot c-border"></span><span class="small">–º–µ–∂–∞</span>
            <span class="dot c-buffer"></span><span class="small">–±—É—Ñ–µ—Ä</span>
            <span class="dot c-grid"></span><span class="small">“ë—Ä—ñ–¥</span>
            <span class="dot c-me"></span><span class="small">–º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ¬´–ö–ê–†–¢–ê¬ª (–∫–∞–Ω–≤–∞) + –ü–Ü–î–°–£–ú–ö–ò -->
    <div class="card">
      <h2>üó∫Ô∏è –û–≥–ª—è–¥</h2>
      <canvas id="canvas"></canvas>
      <div class="grid g3" style="margin-top:12px">
        <div class="box">
          <h3>–ü—ñ–¥—Å—É–º–∫–∏</h3>
          <p>–¢–æ—á–æ–∫ —É –º–µ–∂—ñ: <b><span id="nPts">0</span></b></p>
          <p>–ü–µ—Ä–∏–º–µ—Ç—Ä: <b><span id="perim">‚Äî</span> –º</b></p>
          <p>–ü–ª–æ—â–∞: <b><span id="areaHa">‚Äî</span> –≥–∞</b></p>
        </div>
        <div class="box">
          <h3>“ê—Ä—ñ–¥</h3>
          <p>–¢–æ—á–æ–∫ —É “ë—Ä—ñ–¥—ñ: <b><span id="nGrid">0</span></b></p>
          <div id="csv" class="out">‚Äî</div>
        </div>
        <div class="box">
          <h3>GeoJSON</h3>
          <div id="gj" class="out">‚Äî</div>
        </div>
      </div>
      <p class="small muted">–ö–æ–Ω—Ç—Ä–∞—Å—Ç –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–æ: —Ç–µ–º–Ω—ñ –∫–æ–º—ñ—Ä–∫–∏/—Ä—è–¥–∫–∏ ‚Äî —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç.</p>
    </div>

    <!-- –•–Ü–î –†–û–ë–û–¢–ò, –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
      <ol>
        <li>–ù–∞—Ç–∏—Å–Ω–∏ <b>–°—Ç–∞—Ä—Ç —Ç—Ä–µ–∫—É</b> —ñ –æ–±—ñ–π–¥–∏ –º–µ–∂—É –ø–æ–ª—è ‚Üí <b>–°—Ç–æ–ø</b>. –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –¥–æ–¥–∞–≤–∞–π —Ç–æ—á–∫–∏ –≤—Ä—É—á–Ω—É.</li>
        <li>–ü–µ—Ä–µ–≤—ñ—Ä <b>–ø–µ—Ä–∏–º–µ—Ç—Ä</b> —ñ <b>–ø–ª–æ—â—É</b>. –ó–∞–æ–∫—Ä—É–≥–ª–∏ –¥–æ 0.01 –≥–∞ –¥–ª—è –∑–≤—ñ—Ç—É.</li>
        <li>–ó–∞–¥–∞–π <b>–±—É—Ñ–µ—Ä</b> (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, +10 –º –Ω–∞–∑–æ–≤–Ω—ñ –¥–ª—è –∑–∞—Ö–∏—Å–Ω–æ—ó —Å–º—É–≥–∏ –∞–±–æ ‚àí5 –º –≤—Å–µ—Ä–µ–¥–∏–Ω—É –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó –∑–æ–Ω–∏ –æ–±—Ä–æ–±—ñ—Ç–∫—É) ‚Üí <b>–ü–æ–±—É–¥—É–≤–∞—Ç–∏ –±—É—Ñ–µ—Ä</b>.</li>
        <li>–í–∫–∞–∂–∏ <b>–∫—Ä–æ–∫ “ë—Ä—ñ–¥–∞</b> (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 100 –º) ‚Üí <b>–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ “ë—Ä—ñ–¥</b> ‚Üí –°–∫–æ–ø—ñ—é–π CSV —É Sheets (–∞—Ä–∫—É—à <span class="mono">FieldGrid</span>).</li>
        <li>–ï–∫—Å–ø–æ—Ä—Ç—É–π GeoJSON —ñ –ø–µ—Ä–µ–≥–ª—è–Ω—å —É QGIS/Google Earth.</li>
      </ol>
    </div>

    <div class="card">
      <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="table">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–æ –∑—ñ–±—Ä–∞–Ω–∞ –º–µ–∂–∞ (‚â• 10 —Ç–æ—á–æ–∫) —ñ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞ –ø–ª–æ—â–∞/–ø–µ—Ä–∏–º–µ—Ç—Ä</td><td>4</td></tr>
          <tr><td>–ü–æ–±—É–¥–æ–≤–∞–Ω–∞ –±—É—Ñ–µ—Ä–Ω–∞ —Å–º—É–≥–∞ —ñ –ø–æ—è—Å–Ω–µ–Ω–æ —ó—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</td><td>2</td></tr>
          <tr><td>–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π “ë—Ä—ñ–¥ —Ç–æ—á–æ–∫, CSV –∑–±–µ—Ä–µ–∂–µ–Ω–æ</td><td>3</td></tr>
          <tr><td>–ö–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏ (3 —Ä–µ—á–µ–Ω–Ω—è)</td><td>1</td></tr>
        </tbody>
      </table>
      <p class="pill">üìç GPS</p><p class="pill">üìè –ü–µ—Ä–∏–º–µ—Ç—Ä/–ø–ª–æ—â–∞</p><p class="pill">üü© –ë—É—Ñ–µ—Ä</p><p class="pill">üî¢ “ê—Ä—ñ–¥</p>
    </div>
  </div>

<script>
  // –†–µ–∂–∏–º –≤–±—É–¥—É–≤–∞–Ω–Ω—è
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // –î–∞–Ω—ñ
  let border = [];      // [{lat,lon}]
  let bufferPoly = [];  // –æ—Ñ—Å–µ—Ç–æ–≤–∞–Ω–∏–π –ø–æ–ª—ñ–≥–æ–Ω —É –ø—Ä–æ—î–∫—Ü—ñ—ó ‚Üí –ø–æ—Ç—ñ–º –Ω–∞–∑–∞–¥ —É lat/lon
  let gridPts = [];     // [{lat,lon}]
  let watchId = null;

  // –£—Ç–∏–ª—ñ—Ç–∏
  const byId = id => document.getElementById(id);
  const rnd = (n,d=2) => Number((+n).toFixed(d));
  const toRad = d => d*Math.PI/180;
  const toDeg = r => r*180/Math.PI;
  const EARTH_R = 6371008.8;

  // Haversine (–º)
  function havDist(a,b){
    const lat1=toRad(a.lat), lon1=toRad(a.lon), lat2=toRad(b.lat), lon2=toRad(b.lon);
    const dlat=lat2-lat1, dlon=lon2-lon1;
    const h = Math.sin(dlat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dlon/2)**2;
    return 2*EARTH_R*Math.asin(Math.sqrt(h));
  }

  // –õ–æ–∫–∞–ª—å–Ω–∞ –ø—Ä–æ—î–∫—Ü—ñ—è (–µ–∫–≤—ñ–¥–∏—Å—Ç–∞–Ω—Ç–Ω–∞ –∑–∞ —Å–µ—Ä–µ–¥–Ω—å–æ—é —à–∏—Ä–æ—Ç–æ—é)
  function projector(points){
    const lat0 = points.length ? points.reduce((s,p)=>s+p.lat,0)/points.length : 50.0;
    const lon0 = points.length ? points.reduce((s,p)=>s+p.lon,0)/points.length : 30.0;
    const cos0 = Math.cos(toRad(lat0));
    return {
      fwd: (p)=>({ x: toRad(p.lon - lon0)*EARTH_R*cos0, y: toRad(p.lat - lat0)*EARTH_R }),
      inv: (xy)=>({ lat: lat0 + toDeg(xy.y/EARTH_R), lon: lon0 + toDeg(xy.x/(EARTH_R*cos0)) })
    };
  }

  // –ü–ª–æ—â–∞ —à–Ω—É—Ä–∫–æ–º (–º¬≤) —É –ø—Ä–æ—î–∫—Ü—ñ—ó
  function polygonAreaM2(polyXY){
    if(polyXY.length<3) return 0;
    let s=0;
    for(let i=0;i<polyXY.length;i++){
      const a=polyXY[i], b=polyXY[(i+1)%polyXY.length];
      s += a.x*b.y - b.x*a.y;
    }
    return Math.abs(s)/2;
  }

  // –ü–µ—Ä–∏–º–µ—Ç—Ä (–º) –Ω–∞ —Å—Ñ–µ—Ä—ñ
  function polygonPerimeterM(polyLL){
    if(polyLL.length<2) return 0;
    let s=0;
    for(let i=0;i<polyLL.length;i++){
      const a=polyLL[i], b=polyLL[(i+1)%polyLL.length];
      s += havDist(a,b);
    }
    return s;
  }

  // –ü–æ–π–Ω—Ç-—ñ–Ω-–ø–æ–ª—ñ–≥–æ–Ω (ray casting) —É –ø—Ä–æ—î–∫—Ü—ñ—ó
  function pip(pt, polyXY){
    let inside=false;
    for(let i=0,j=polyXY.length-1;i<polyXY.length;j=i++){
      const xi=polyXY[i].x, yi=polyXY[i].y, xj=polyXY[j].x, yj=polyXY[j].y;
      const intersect = ((yi>pt.y)!=(yj>pt.y)) && (pt.x < (xj-xi)*(pt.y-yi)/(yj-yi)+xi);
      if(intersect) inside=!inside;
    }
    return inside;
  }

  // –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –æ—Ñ—Å–µ—Ç –ø–æ–ª—ñ–≥–æ–Ω–∞ (–±—É—Ñ–µ—Ä) —É –ø—Ä–æ—î–∫—Ü—ñ—ó: –∑—Å—É–≤ —Ä–µ–±–µ—Ä –Ω–∞–∑–æ–≤–Ω—ñ –Ω–∞ d —ñ –ø–µ—Ä–µ—Ç–∏–Ω
  // (—Å–ø—Ä–æ—â–µ–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è: –∑—Å—É–≤–∞—î–º–æ –≤–µ—Ä—à–∏–Ω–∏ –æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–æ –¥–æ –Ω–æ—Ä–º–∞–ª–µ–π —Ä–µ–±–µ—Ä, –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è ¬´–ø–ª–∞–≤–Ω–∏—Ö¬ª –ø–æ–ª—ñ–≤)
  function offsetPolygon(polyXY, d){
    if(polyXY.length<3) return [];
    const n=polyXY.length, out=[];
    for(let i=0;i<n;i++){
      const p=polyXY[i], p0=polyXY[(i-1+n)%n], p1=polyXY[(i+1)%n];
      // –Ω–æ—Ä–º–∞–ª—ñ –¥–æ —Ä–µ–±–µ—Ä
      const e0 = {x: p.x-p0.x, y: p.y-p0.y}, e1 = {x: p1.x-p.x, y: p1.y-p.y};
      const n0 = {x: -e0.y, y: e0.x}, n1 = {x: -e1.y, y: e1.x};
      const len0 = Math.hypot(n0.x,n0.y)||1, len1=Math.hypot(n1.x,n1.y)||1;
      const u0 = {x:n0.x/len0, y:n0.y/len0}, u1={x:n1.x/len1, y:n1.y/len1};
      // –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–∞ –Ω–æ—Ä–º–∞–ª–µ–π
      const bis = {x: u0.x+u1.x, y: u0.y+u1.y};
      const lenb = Math.hypot(bis.x,bis.y)||1;
      const scale = d / Math.max(0.3, Math.abs((u0.x*u1.x+u0.y*u1.y)) + 0.3); // –≥—Ä—É–±–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è
      out.push({ x: p.x + (bis.x/lenb)*scale, y: p.y + (bis.y/lenb)*scale });
    }
    return out;
  }

  // –ú–∞–ª—é–≤–∞–Ω–Ω—è
  const canvas = byId('canvas'), ctx = canvas.getContext('2d');
  function resizeCanvas(){
    const r = canvas.getBoundingClientRect();
    canvas.width = Math.floor(r.width); canvas.height = Math.floor(r.height);
    draw();
  }
  window.addEventListener('resize', resizeCanvas);

  function computeView(pointsLL, bufferXY, gridLL){
    // –º–µ–∂—ñ –¥–ª—è –≤ º—é–±–æ–∫—Å—É
    let xs=[], ys=[];
    const proj = projector(pointsLL.length?pointsLL:(gridLL.length?gridLL:[{lat:50,lon:30}]));
    const borderXY = pointsLL.map(proj.fwd);
    borderXY.forEach(p=>{xs.push(p.x); ys.push(p.y);});
    bufferXY.forEach(p=>{xs.push(p.x); ys.push(p.y);});
    gridLL.map(proj.fwd).forEach(p=>{xs.push(p.x); ys.push(p.y);});
    if(xs.length===0){ xs=[-10,10]; ys=[-10,10]; }
    const minX=Math.min(...xs), maxX=Math.max(...xs), minY=Math.min(...ys), maxY=Math.max(...ys);
    const pad=20, W=canvas.width, H=canvas.height;
    const scale = 0.9*Math.min(W/(maxX-minX||1), H/(maxY-minY||1));
    const offX = (W - (maxX-minX)*scale)/2 - minX*scale;
    const offY = (H - (maxY-minY)*scale)/2 - minY*scale;
    return { proj, scale, offX, offY, borderXY };
  }

  function draw(){
    const { proj, scale, offX, offY, borderXY } = computeView(border, bufferPoly, gridPts);
    // —Ñ–æ–Ω
    ctx.fillStyle = '#0b1324'; ctx.fillRect(0,0,canvas.width,canvas.height);

    // –±—É—Ñ–µ—Ä
    if(bufferPoly.length>=3){
      ctx.strokeStyle = '#22c55e'; ctx.lineWidth = 2; ctx.fillStyle='rgba(34,197,94,0.08)';
      ctx.beginPath();
      bufferPoly.forEach((p,i)=>{ const x=p.x*scale+offX, y=p.y*scale+offY; i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
      ctx.closePath(); ctx.fill(); ctx.stroke();
    }

    // –º–µ–∂–∞
    if(borderXY.length>=2){
      ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 2; ctx.fillStyle='rgba(96,165,250,0.08)';
      ctx.beginPath();
      borderXY.forEach((p,i)=>{ const x=p.x*scale+offX, y=p.y*scale+offY; i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
      if(borderXY.length>=3){ ctx.closePath(); ctx.fill(); }
      ctx.stroke();
      // –≤–µ—Ä—à–∏–Ω–∏
      ctx.fillStyle='#60a5fa';
      borderXY.forEach(p=>{ ctx.beginPath(); ctx.arc(p.x*scale+offX, p.y*scale+offY, 3, 0, Math.PI*2); ctx.fill(); });
    }

    // “ë—Ä—ñ–¥
    if(gridPts.length){
      ctx.fillStyle='#f59e0b';
      gridPts.forEach(g=>{
        const xy = proj.fwd(g);
        ctx.beginPath(); ctx.arc(xy.x*scale+offX, xy.y*scale+offY, 2.5, 0, Math.PI*2); ctx.fill();
      });
    }

    // –ø–æ—Ç–æ—á–Ω–µ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è (—è–∫—â–æ —î)
    if(lastPos){
      ctx.fillStyle='#ef4444';
      const xy = proj.fwd(lastPos);
      ctx.beginPath(); ctx.arc(xy.x*scale+offX, xy.y*scale+offY, 4, 0, Math.PI*2); ctx.fill();
    }
  }

  // –ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è
  let lastPos=null;
  function onPos(pos){
    const {latitude:lat, longitude:lon, accuracy} = pos.coords;
    lastPos = {lat,lon};
    draw();
  }
  function onErr(e){ console.warn('Geo error', e); }

  function startTrack(){
    if(!navigator.geolocation){ alert('–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è'); return; }
    if(watchId!==null){ alert('–¢—Ä–µ–∫ –≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∏–π'); return; }
    watchId = navigator.geolocation.watchPosition(p=>{
      onPos(p);
      // –¥–æ–¥–∞—î–º–æ —Ç–æ—á–∫—É –∫–æ–∂–Ω—ñ ~5 –º –∞–±–æ –ø—Ä–∏ –ø–µ—Ä—à—ñ–π —Ñ—ñ–∫—Å–∞—Ü—ñ—ó
      const pt = {lat:p.coords.latitude, lon:p.coords.longitude};
      if(border.length===0 || havDist(border[border.length-1], pt) > 5){
        border.push(pt);
        updateStats(); draw();
      }
    }, onErr, {enableHighAccuracy:true, maximumAge:1000, timeout:10000});
  }
  function stopTrack(){ if(watchId!==null){ navigator.geolocation.clearWatch(watchId); watchId=null; } }

  function addCurrent(){
    if(!lastPos){ alert('–ù–µ–º–∞—î —Ñ—ñ–∫—Å–∞—Ü—ñ—ó GPS. –°–∫–æ—Ä–∏—Å—Ç–∞–π—Å—è –¥–µ–º–æ –∞–±–æ –¥–æ–¥–∞–π –≤—Ä—É—á–Ω—É.'); return; }
    border.push({...lastPos});
    updateStats(); draw();
  }
  function addManual(){
    const s = prompt('–í–≤–µ–¥–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ "lat, lon" (–¥–µ—Å—è—Ç–∫–æ–≤—ñ –≥—Ä–∞–¥—É—Å–∏):', '50.0000, 30.0000');
    if(!s) return;
    const m = s.split(',').map(x=>parseFloat(x.trim()));
    if(m.length===2 && isFinite(m[0]) && isFinite(m[1])){
      border.push({lat:m[0], lon:m[1]});
      updateStats(); draw();
    } else alert('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç.');
  }

  function updateStats(){
    byId('nPts').textContent = border.length;
    const per = polygonPerimeterM(border);
    const proj = projector(border);
    const xy = border.map(proj.fwd);
    const areaM2 = polygonAreaM2(xy);
    byId('perim').textContent = border.length>=2 ? rnd(per,1) : '‚Äî';
    byId('areaHa').textContent = border.length>=3 ? rnd(areaM2/10000,4) : '‚Äî';
  }

  function makeBuffer(){
    if(border.length<3){ alert('–°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ñ—ñ–∫—Å—É–π –º–µ–∂—É (‚â•3 —Ç–æ—á–∫–∏).'); return; }
    const d = parseFloat(byId('bufferM').value||'0'); // –º (+ –Ω–∞–∑–æ–≤–Ω—ñ, ‚àí –≤—Å–µ—Ä–µ–¥–∏–Ω—É)
    const proj = projector(border);
    const xy = border.map(proj.fwd);
    const off = offsetPolygon(xy, d);
    bufferPoly = off;
    // –∑–±–µ—Ä–µ–∂–µ–º–æ GeoJSON –±—É—Ñ–µ—Ä–∞
    const gj = { type:'FeatureCollection', features:[] };
    gj.features.push({
      type:'Feature',
      properties:{name: byId('fieldName').value+' ‚Äî buffer', buffer_m:d},
      geometry:{ type:'Polygon', coordinates:[ off.map(p=>{const ll=proj.inv(p); return [ll.lon, ll.lat];}) ] }
    });
    byId('gj').textContent = JSON.stringify(gj, null, 2);
    draw();
  }

  function makeGrid(){
    if(border.length<3){ alert('–°–ø–æ—á–∞—Ç–∫—É –º–µ–∂–∞.'); return; }
    const step = Math.max(5, parseFloat(byId('gridStep').value||'100')); // –º
    const proj = projector(border);
    const xy = border.map(proj.fwd);
    // bbox
    const xs = xy.map(p=>p.x), ys=xy.map(p=>p.y);
    const minX=Math.min(...xs), maxX=Math.max(...xs), minY=Math.min(...ys), maxY=Math.max(...ys);
    const pts=[];
    for(let y=minY; y<=maxY; y+=step){
      for(let x=minX; x<=maxX; x+=step){
        const p={x:x+step/2, y:y+step/2};
        if(pip(p, xy)){
          const ll = proj.inv(p);
          pts.push({lat:ll.lat, lon:ll.lon});
        }
      }
    }
    gridPts = pts;
    byId('nGrid').textContent = pts.length;
    // CSV
    const lines = pts.map((p,i)=>[i+1, byId('fieldCode').value, rnd(p.lat,6), rnd(p.lon,6)].join(' | '));
    byId('csv').textContent = (lines.length? ['# | –ü–æ–ª–µ | Lat | Lon'].join(' | ')+'\n' : '') + (lines.join('\n') || '‚Äî');
    draw();
  }

  function exportGeoJSON(){
    if(border.length<3){ alert('–ú–µ–∂–∞ –ø–æ—Ä–æ–∂–Ω—è.'); return; }
    const gj = { type:'FeatureCollection', features:[] };
    // border
    gj.features.push({
      type:'Feature',
      properties:{ code: byId('fieldCode').value, name: byId('fieldName').value, kind:'border' },
      geometry:{ type:'Polygon', coordinates:[ border.map(p=>[p.lon, p.lat]) ] }
    });
    // buffer (—è–∫—â–æ —î)
    if(bufferPoly.length>=3){
      const proj = projector(border);
      gj.features.push({
        type:'Feature',
        properties:{ code: byId('fieldCode').value, name: byId('fieldName').value, kind:'buffer', buffer_m: parseFloat(byId('bufferM').value||'0') },
        geometry:{ type:'Polygon', coordinates:[ bufferPoly.map(p=>{const ll=proj.inv(p); return [ll.lon,ll.lat];}) ] }
      });
    }
    // grid (—è–∫ MultiPoint)
    if(gridPts.length){
      gj.features.push({
        type:'Feature',
        properties:{ code: byId('fieldCode').value, name: byId('fieldName').value, kind:'grid', step_m: parseFloat(byId('gridStep').value||'100') },
        geometry:{ type:'MultiPoint', coordinates: gridPts.map(p=>[p.lon,p.lat]) }
      });
    }
    const txt = JSON.stringify(gj, null, 2);
    byId('gj').textContent = txt;
    // –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    const blob = new Blob([txt], {type:'application/geo+json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = (byId('fieldCode').value || 'field') + '_export.geojson';
    document.body.appendChild(a); a.click(); a.remove();
  }

  function copyCSV(){
    const t = byId('csv').textContent.trim();
    if(!t || t==='‚Äî'){ alert('–ù–µ–º–∞—î “ë—Ä—ñ–¥–∞/–¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }

  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  function resetAll(){ border=[]; bufferPoly=[]; gridPts=[]; byId('gj').textContent='‚Äî'; byId('csv').textContent='‚Äî'; updateStats(); byId('nGrid').textContent='0'; draw(); }

  function demo(){
    // –ù–µ–≤–µ–ª–∏–∫–∏–π –±–∞–≥–∞—Ç–æ–∫—É—Ç–Ω–∏–∫ –ø–æ–±–ª–∏–∑—É —à–∏—Ä–æ—Ç–∏ 50¬∞
    border = [
      {lat:50.0010, lon:30.0000},
      {lat:50.0014, lon:30.0065},
      {lat:49.9989, lon:30.0078},
      {lat:49.9983, lon:30.0012}
    ];
    updateStats(); draw();
  }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  resizeCanvas(); updateStats(); draw();
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(onPos, onErr, {enableHighAccuracy:true, timeout:8000});
  }
</script>


</body></html>