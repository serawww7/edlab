<!-- agro_para10.html
     –ü–ê–†–ê 10 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –∞–≥—Ä–æ–Ω–æ–º—ñ–≤
     –¢–µ–º–∞: –ó–†–û–®–ï–ù–ù–Ø –¢–ê –í–û–î–ù–ò–ô –ë–ê–õ–ê–ù–° –ö–û–†–ï–ù–ï–í–û–á –ó–û–ù–ò ‚Äî ET0 –∑ —Ç–µ–ª–µ—Ñ–æ–Ω—É, Kc, TAW/RAW, –≥—Ä–∞—Ñ—ñ–∫ –ø–æ–ª–∏–≤—ñ–≤
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö; —Å—Ç—É–¥–µ–Ω—Ç–∏ –≤–Ω–æ—Å—è—Ç—å ET0/–æ–ø–∞–¥–∏ –≤—Ä—É—á–Ω—É –∑ –±—É–¥—å-—è–∫–æ–≥–æ –ø–æ–≥–æ–¥–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.
     –†–µ–∑—É–ª—å—Ç–∞—Ç: –¥–æ–±–æ–≤–∏–π –≤–æ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å, –ø—ñ–¥–∫–∞–∑–∫–∏ ¬´–ø–æ–ª–∏–≤–∞—Ç–∏/–ø–æ—á–µ–∫–∞—Ç–∏¬ª, —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≥–ª–∏–±–∏–Ω–∏ –ø–æ–ª–∏–≤—É, CSV.
     –ö–æ–Ω—Ç—Ä–∞—Å—Ç: —Ç–µ–º–Ω—ñ –∫–æ–º—ñ—Ä–∫–∏ –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç.

     –ü—Ä–∏–º—ñ—Ç–∫–∞: –º–æ–¥–µ–ª—å –Ω–∞–≤—á–∞–ª—å–Ω–∞ (—Å–ø—Ä–æ—â–µ–Ω–∞). –î–ª—è –≤–∏—Ä–æ–±–Ω–∏—á–∏—Ö —Ä—ñ—à–µ–Ω—å ‚Äî —ñ–Ω–∂–µ–Ω–µ—Ä–Ω—ñ –∫–∞—Ä—Ç–∏ –ø–æ–ª–∏–≤—ñ–≤ —Ç–∞ –ª–æ–∫–∞–ª—å–Ω—ñ –Ω–æ—Ä–º–∏.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ü–∞—Ä–∞ 10 ‚Äî –ó—Ä–æ—à–µ–Ω–Ω—è: –≤–æ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å, ET‚ÇÄ¬∑Kc, TAW/RAW, –ø–ª–∞–Ω –ø–æ–ª–∏–≤—ñ–≤</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted); letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  .small{font-size:12px; color:#9fb0c8}
  .muted{color:#93a3b5}
  .pill{display:inline-block; padding:4px 10px; border:1px solid #223049; border-radius:999px; font-size:12px; color:#a5b4fc; background:#0d1a2e; margin-right:6px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:var(--darkcell); color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:8px 10px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left; position:sticky; top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell); color:var(--darkink2)}
  .table td.dark, .table th.dark{background:var(--darkcell) !important; color:var(--darkink2) !important}
  .table td .tag{display:inline-block; padding:3px 8px; border-radius:999px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; font-size:12px}
  input[type="text"], input[type="number"], input[type="date"], select{
    width:100%; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e6eef9
  }
  .out{background:var(--darkcell); color:var(--darkink2); border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}

  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}
  html.embedded .box{background:#f8fafc; color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6; color:#111}

  @media print{
    @page{ margin:12mm }
    .no-print{ display:none !important }
  }
</style>
</head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 10 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –∞–≥—Ä–æ–Ω–æ–º–∏</span>
    <h1>üíß –ó—Ä–æ—à–µ–Ω–Ω—è —Ç–∞ –≤–æ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å: ET‚ÇÄ¬∑Kc ‚Üí ETc, TAW/RAW ‚Üí —Å–∫—ñ–ª—å–∫–∏ —ñ –∫–æ–ª–∏ –ø–æ–ª–∏–≤–∞—Ç–∏</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>
        –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤—É—é—Ç—å <b>–º–æ–¥–µ–ª—å –∫–æ—Ä–µ–Ω–µ–≤–æ—ó –∑–æ–Ω–∏</b>, –≤–Ω–æ—Å—è—Ç—å <b>ET‚ÇÄ —Ç–∞ –æ–ø–∞–¥–∏</b> –Ω–∞ 10 –¥–Ω—ñ–≤ —ñ–∑ –±—É–¥—å-—è–∫–æ–≥–æ
        –ø–æ–≥–æ–¥–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É, –æ–±–∏—Ä–∞—é—Ç—å <b>Kc</b> (–∫–æ–µ—Ñ. –∫—É–ª—å—Ç—É—Ä–∏) —Ç–∞ –æ—Ç—Ä–∏–º—É—é—Ç—å –ø—ñ–¥–∫–∞–∑–∫–∏ <b>–∫–æ–ª–∏ –ø–æ–ª–∏–≤–∞—Ç–∏</b> —ñ
        <b>—è–∫—É –≥–ª–∏–±–∏–Ω—É –ø–æ–ª–∏–≤—É</b> –∑–∞–¥–∞—Ç–∏ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî <b>CSV</b> –¥–ª—è Sheets.
      </p>
      <p class="small">–ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è: TAW ‚Äî –∑–∞–≥–∞–ª—å–Ω–∏–π –∑–∞–ø–∞—Å –≤–æ–¥–∏ –≤ –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –∑–æ–Ω—ñ; RAW ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–µ –≤–∏—Å—É—à—É–≤–∞–Ω–Ω—è (p√óTAW).
        –ë–∞–ª–∞–Ω—Å (—â–æ–¥–µ–Ω–Ω–æ): <span class="mono">S‚Çú = clamp[0..TAW](S‚Çú‚Çã‚ÇÅ + P_eff + I_eff ‚àí ETc)</span>, –¥–µ <span class="mono">ETc = ET‚ÇÄ√óKc</span>.
      </p>
    </div>

    <!-- –ü–ê–†–ê–ú–ï–¢–†–ò –ü–û–õ–Ø –¢–ê “ê–†–£–ù–¢–£ -->
    <div class="card">
      <h2>üß∞ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–æ–ª—è, “ë—Ä—É–Ω—Ç—É —Ç–∞ —Å–∏—Å—Ç–µ–º–∏ –∑—Ä–æ—à–µ–Ω–Ω—è</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–ü–æ–ª–µ</h3>
          <div class="row">
            <div style="flex:1"><label>–ö–æ–¥ –ø–æ–ª—è</label><input id="fieldCode" type="text" value="F-01"></div>
            <div style="flex:1"><label>–ö—É–ª—å—Ç—É—Ä–∞</label><input id="crop" type="text" value="–ö—É–∫—É—Ä—É–¥–∑–∞"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–ü–ª–æ—â–∞, –≥–∞</label><input id="area" type="number" step="0.01" value="25"></div>
            <div style="flex:1"><label>–ì–ª–∏–±–∏–Ω–∞ –∫–æ—Ä–µ–Ω—ñ–≤ Zr, –º</label><input id="Zr" type="number" step="0.1" value="0.6"></div>
          </div>
        </div>

        <div class="box">
          <h3>“ê—Ä—É–Ω—Ç (–æ–± º—î–º–Ω—ñ %)</h3>
          <div class="row">
            <div style="flex:1"><label>FC (–ü–ü–í), %</label><input id="FC" type="number" step="0.1" value="30"></div>
            <div style="flex:1"><label>PWP (–í–†–ö), %</label><input id="PWP" type="number" step="0.1" value="15"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∑–∞–ø–∞—Å, % –≤—ñ–¥ TAW</label><input id="S0p" type="number" step="1" value="80"></div>
            <div style="flex:1"><label>p (–¥–æ–ø—É—Å—Ç–∏–º–µ –≤–∏—Å—É—à—É–≤–∞–Ω–Ω—è)</label><input id="p" type="number" step="0.05" value="0.5"></div>
          </div>
          <p class="small">TAW = (FC ‚àí PWP) √ó 1000 √ó Zr (–º–º). RAW = p √ó TAW.</p>
        </div>

        <div class="box">
          <h3>–ó—Ä–æ—à–µ–Ω–Ω—è</h3>
          <div class="row">
            <div style="flex:1"><label>–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, Œ∑ (0..1)</label><input id="eta" type="number" step="0.05" value="0.8"></div>
            <div style="flex:1"><label>–ú–∞–∫—Å. –ø–æ–ª–∏–≤ –∑–∞ —Ä–∞–∑, –º–º</label><input id="Imax" type="number" step="1" value="35"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–í—Ç—Ä–∞—Ç–∏ –¥–æ—â—ñ–≤ (–∫–æ–µ—Ñ.)</label><input id="rainEff" type="number" step="0.05" value="0.9"></div>
            <div style="flex:1"><label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç—É</label><input id="startDate" type="date"></div>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
            <button class="btn" onclick="preset()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
          </div>
        </div>
      </div>
    </div>

    <!-- –ö–£–õ–¨–¢–£–†–ê / Kc -->
    <div class="card">
      <h2>üåæ –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –∫—É–ª—å—Ç—É—Ä–∏ Kc</h2>
      <div class="grid g2">
        <div class="box">
          <h3>–û–±—Ä–∞—Ç–∏ —Å—Ç–∞–¥—ñ—é (–ø—ñ–¥—Å—Ç–∞–≤–∏—Ç—å Kc)</h3>
          <select id="kcStage" onchange="setStageKc()">
            <option value="0.35">–ü–æ—á–∞—Ç–∫–æ–≤–∞ (Kc‚âà0.35)</option>
            <option value="0.85">–†—ñ—Å—Ç (Kc‚âà0.85)</option>
            <option value="1.15" selected>–°–µ—Ä–µ–¥–∏–Ω–∞ —Å–µ–∑–æ–Ω—É (Kc‚âà1.15)</option>
            <option value="0.8">–ö—ñ–Ω–µ—Ü—å —Å–µ–∑–æ–Ω—É (Kc‚âà0.80)</option>
          </select>
          <p style="margin-top:8px"><label>–ê–±–æ –≤—Ä—É—á–Ω—É Kc</label><input id="Kc" type="number" step="0.01" value="1.15"></p>
          <p class="small">Kc –º–Ω–æ–∂–∏—Ç—å—Å—è –Ω–∞ ET‚ÇÄ –∑ –ø–æ–≥–æ–¥–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.</p>
        </div>
        <div class="box">
          <h3>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ TAW/RAW</h3>
          <div>TAW (–º–º): <b><span id="TAW">‚Äî</span></b></div>
          <div>RAW (–º–º): <b><span id="RAW">‚Äî</span></b></div>
          <div>–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∑–∞–ø–∞—Å S‚ÇÄ (–º–º): <b><span id="S0mm">‚Äî</span></b></div>
        </div>
      </div>
    </div>

    <!-- –¢–ê–ë–õ–ò–¶–Ø 10 –î–ù–Ü–í -->
    <div class="card">
      <h2>üìÖ 10-–¥–µ–Ω–Ω–∏–π –ø–ª–∞–Ω (ET‚ÇÄ –∑ —Ç–µ–ª–µ—Ñ–æ–Ω—É, –æ–ø–∞–¥–∏, –ø–æ–ª–∏–≤)</h2>
      <div class="row">
        <button class="btn" onclick="autoIrrigate()">üí¶ –ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –ø–æ–ª–∏–≤–∏</button>
        <button class="btn" onclick="copyCSV()">üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ CSV</button>
      </div>
      <div style="overflow:auto; margin-top:8px">
        <table class="table" id="tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>–î–∞—Ç–∞</th>
              <th>ET‚ÇÄ, –º–º</th>
              <th>Kc</th>
              <th class="dark">ETc, –º–º</th>
              <th>–î–æ—â, –º–º</th>
              <th>–ü–æ–ª–∏–≤, –º–º (–∑–∞–¥–∞–Ω–æ)</th>
              <th class="dark">–ü–æ–ª–∏–≤ –µ—Ñ., –º–º</th>
              <th class="dark">–ë–∞–ª–∞–Ω—Å S, –º–º</th>
              <th class="dark">–î–µ—Ñ—ñ—Ü–∏—Ç D, –º–º</th>
              <th class="dark">–°—Ç–∞—Ç—É—Å</th>
              <th>–ù–æ—Ç–∞—Ç–∫–∞</th>
            </tr>
          </thead>
          <tbody id="body"></tbody>
          <tfoot>
            <tr>
              <th class="dark" colspan="8">–°—É–º–∞—Ä–Ω–æ</th>
              <th class="dark" id="sumS">‚Äî</th>
              <th class="dark" id="sumD">‚Äî</th>
              <th class="dark" id="sumStatus">‚Äî</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>
      <div id="csv" class="out" style="margin-top:8px">‚Äî</div>
      <p class="small">CSV: <span class="mono"># | –î–∞—Ç–∞ | ET0 | Kc | ETc | –î–æ—â | –ü–æ–ª–∏–≤_–∑–∞–¥–∞–Ω–æ | –ü–æ–ª–∏–≤_–µ—Ñ | S | D | –°—Ç–∞—Ç—É—Å | –ù–æ—Ç–∞—Ç–∫–∞</span></p>
      <p class="small muted">–ö–æ–Ω—Ç—Ä–∞—Å—Ç –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–æ: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ (<span class="mono">.dark</span>) –∑—ñ —Å–≤—ñ—Ç–ª–∏–º —Ç–µ–∫—Å—Ç–æ–º.</p>
    </div>

    <!-- –•–Ü–î –†–û–ë–û–¢–ò, –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
      <ol>
        <li>–í–Ω–µ—Å–∏ FC/PWP, Zr, p, –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø–æ–ª–∏–≤—É Œ∑, –¥–æ—â–æ–≤–∏–π –∫–æ–µ—Ñ. —Ç–∞ –¥–∞—Ç—É —Å—Ç–∞—Ä—Ç—É ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ <b>–ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</b>.</li>
        <li>–ó–Ω—ñ–º–∏ –∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ET‚ÇÄ –Ω–∞ 10 –¥–Ω—ñ–≤ —Ç–∞ –æ–ø–∞–¥–∏ ‚Üí –≤–Ω–µ—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—é (Kc –≤–∂–µ –∑–∞–¥–∞–Ω–æ, –∞–ª–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ –¥–Ω—è—Ö).</li>
        <li>–ù–∞—Ç–∏—Å–Ω–∏ <b>–ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –ø–æ–ª–∏–≤–∏</b> ‚Üí –æ—Ç—Ä–∏–º–∞–π –≥–ª–∏–±–∏–Ω–∏ –ø–æ–ª–∏–≤—ñ–≤ —É –¥–Ω—ñ, –¥–µ <b>D &gt; RAW</b>.</li>
        <li>–°–∫–æ–ø—ñ—é–π CSV —É Google Sheets (–∞—Ä–∫—É—à <span class="mono">Irrigation10</span>) —ñ –ø–æ–±—É–¥—É–π –≥—Ä–∞—Ñ—ñ–∫ S —Ç–∞ D.</li>
      </ol>
    </div>

    <div class="card">
      <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="table">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>TAW/RAW —ñ S‚ÇÄ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –∫–æ—Ä–µ–∫—Ç–Ω–æ (–≤–∏—Ö–æ–¥—è—á–∏ –∑ FC, PWP, Zr)</td><td>3</td></tr>
          <tr><td>–ó–∞–ø–æ–≤–Ω–µ–Ω—ñ 10 –¥–Ω—ñ–≤ ET‚ÇÄ/–æ–ø–∞–¥–∏, –∞–¥–µ–∫–≤–∞—Ç–Ω—ñ Kc</td><td>3</td></tr>
          <tr><td>–ü–ª–∞–Ω –ø–æ–ª–∏–≤—ñ–≤ –ª–æ–≥—ñ—á–Ω–∏–π (D‚ÜíRAW) —Ç–∞ –≤ –º–µ–∂–∞—Ö Imax —ñ Œ∑</td><td>3</td></tr>
          <tr><td>CSV —É Sheets + –∫–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏</td><td>1</td></tr>
        </tbody>
      </table>
      <p class="pill">üíß TAW/RAW</p><p class="pill">üå°Ô∏è ET‚ÇÄ√óKc</p><p class="pill">üìÖ –ü–ª–∞–Ω –ø–æ–ª–∏–≤—ñ–≤</p><p class="pill">üìä CSV ‚Üí Sheets</p>
    </div>
  </div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º –¥–ª—è Moodle iFrame
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const bodyEl = document.getElementById('body');
  const csvEl  = document.getElementById('csv');

  // –£—Ç–∏–ª—ñ—Ç–∏
  const byId = id => document.getElementById(id);
  const num = id => parseFloat((byId(id).value||'').replace(',','.'))||0;
  const val = id => (byId(id).value||'').trim();
  const rnd = (n,d=2) => Number((+n).toFixed(d));
  const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));

  function setStageKc(){ byId('Kc').value = byId('kcStage').value; recalc(); }

  function computeTAW_RAW(){
    const FC = num('FC'), PWP = num('PWP'), Zr = num('Zr'), p = num('p');
    const TAW = (FC - PWP) * 10 * Zr * 100; // –ü–æ—è—Å–Ω–µ–Ω–Ω—è: (FC-PWP)% √ó 10 –º–º –Ω–∞ 1% —É 1 —Å–º √ó Zr –º √ó 100 —Å–º/–º
    // –°–ø—Ä–æ—â–µ–Ω–Ω—è: (FC-PWP) [–æ–±.%] √ó 1000 –º–º/–º √ó Zr –º = (FC-PWP)*10*Zr*100 (–µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ 1000*Zr*(FC-PWP)/100)
    const RAW = p * TAW;
    const S0 = (num('S0p')/100) * TAW;
    byId('TAW').textContent = rnd(TAW,0);
    byId('RAW').textContent = rnd(RAW,0);
    byId('S0mm').textContent = rnd(S0,0);
    return {TAW, RAW, S0};
  }

  function buildRows(){
    bodyEl.innerHTML='';
    const start = byId('startDate').value ? new Date(byId('startDate').value) : new Date();
    for(let i=0;i<10;i++){
      const d = new Date(start); d.setDate(d.getDate()+i);
      const ds = d.toISOString().slice(0,10);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="idx">1</td>
        <td><input type="date" value="${ds}"></td>
        <td><input type="number" step="0.1" value="5.0"></td>
        <td><input type="number" step="0.01" value="${num('Kc')||1.0}"></td>
        <td class="dark etc">‚Äî</td>
        <td><input type="number" step="0.1" value="0.0"></td>
        <td><input type="number" step="0.1" value="0.0"></td>
        <td class="dark ieff">‚Äî</td>
        <td class="dark S">‚Äî</td>
        <td class="dark D">‚Äî</td>
        <td class="dark status">‚Äî</td>
        <td><input type="text" value=""></td>
      `;
      bodyEl.appendChild(tr);
    }
    reindex();
  }

  function reindex(){ [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  function recalc(){
    const {TAW, RAW, S0} = computeTAW_RAW();
    reindex();
    let S = S0;
    let sumD=0;
    const eta = num('eta'), rainEff = num('rainEff');

    [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>{
      const ET0 = parseFloat(tr.children[2].querySelector('input').value||'0');
      const Kc  = parseFloat(tr.children[3].querySelector('input').value||'1');
      const rain= parseFloat(tr.children[5].querySelector('input').value||'0');
      const I   = parseFloat(tr.children[6].querySelector('input').value||'0');

      const ETc = ET0 * Kc;
      const Ieff = I * eta;
      const Peff = rain * num('rainEff');

      S = clamp(S + Peff + Ieff - ETc, 0, TAW);
      const D = TAW - S;

      tr.querySelector('.etc').textContent = rnd(ETc,1);
      tr.querySelector('.ieff').textContent = rnd(Ieff,1);
      tr.querySelector('.S').textContent = rnd(S,0);
      tr.querySelector('.D').textContent = rnd(D,0);

      let status='OK';
      if(D > RAW){ status='üí¶ –ü–æ–ª–∏–≤–∞—Ç–∏'; tr.querySelector('.status').style.color = '#10b981'; }
      else if(D > RAW*0.8){ status='‚ö†Ô∏è –ù–∞–±–ª–∏–∂–∞—î—Ç—å—Å—è'; tr.querySelector('.status').style.color = '#f59e0b'; }
      else { status='–°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏'; tr.querySelector('.status').style.color = ''; }
      tr.querySelector('.status').textContent = status;

      sumD += D;
    });

    byId('sumD').textContent = rnd(sumD,0);
    byId('sumS').textContent = [...bodyEl.querySelectorAll('.S')].slice(-1)[0]?.textContent || '‚Äî';
    byId('sumStatus').textContent = '–û–Ω–æ–≤–ª–µ–Ω–æ';
    buildCSV();
  }

  function autoIrrigate(){
    const {TAW, RAW} = computeTAW_RAW();
    const Imax = num('Imax'), eta = num('eta');

    let S_prev = parseFloat(byId('S0mm').textContent)||0;

    [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>{
      const ET0 = parseFloat(tr.children[2].querySelector('input').value||'0');
      const Kc  = parseFloat(tr.children[3].querySelector('input').value||'1');
      const rain= parseFloat(tr.children[5].querySelector('input').value||'0');

      const ETc = ET0*Kc;
      const Peff= rain * num('rainEff');

      // –ø—Ä–æ–≥–Ω–æ–∑ –±–µ–∑ –ø–æ–ª–∏–≤—É
      let S = clamp(S_prev + Peff - ETc, 0, TAW);
      let D = TAW - S;

      let Iset = 0;
      if(D > RAW){
        // –¶—ñ–ª—å ‚Äî –¥–æ–≤–µ—Å—Ç–∏ –¥–æ 90% TAW, –∞–ª–µ –Ω–µ –±—ñ–ª—å—à–µ Imax*Œ∑
        const target = 0.9 * TAW;
        const need = Math.max(0, target - S); // –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
        const Ieff = Math.min(need, Imax);    // –æ–±–º–µ–∂–µ–Ω–Ω—è –ø–æ Imax (–º–º –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏—Ö)
        Iset = rnd(Ieff / eta, 1);            // –∑–∞–¥–∞—Ç–∏ ¬´–Ω–∞ –ø–æ–ª—ñ¬ª, –≤—Ä–∞—Ö—É–≤–∞–≤—à–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
      }

      tr.children[6].querySelector('input').value = Iset.toString();

      // –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ ¬´–∑ –ø–æ–ª–∏–≤–æ–º¬ª
      const Ieff2 = Iset*eta;
      S = clamp(S_prev + Peff + Ieff2 - ETc, 0, TAW);
      S_prev = S;
    });

    recalc();
  }

  function buildCSV(){
    const lines = [...bodyEl.querySelectorAll('tr')].map(tr=>{
      const idx = tr.querySelector('.idx').textContent.trim();
      const d   = tr.children[1].querySelector('input').value.trim();
      const et0 = tr.children[2].querySelector('input').value.trim();
      const kc  = tr.children[3].querySelector('input').value.trim();
      const etc = tr.querySelector('.etc').textContent.trim();
      const rain= tr.children[5].querySelector('input').value.trim();
      const I   = tr.children[6].querySelector('input').value.trim();
      const ie  = tr.querySelector('.ieff').textContent.trim();
      const S   = tr.querySelector('.S').textContent.trim();
      const D   = tr.querySelector('.D').textContent.trim();
      const st  = tr.querySelector('.status').textContent.trim();
      const note= tr.children[11].querySelector('input').value.trim();
      return [idx,d,et0,kc,etc,rain,I,ie,S,D,st,note].join(' | ');
    });
    csvEl.textContent = lines.join('\n') || '‚Äî';
  }

  function copyCSV(){
    const t = csvEl.textContent.trim();
    if(!t || t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ CSV —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏'));
  }

  function preset(){
    // –ü—Ä–∏–∫–ª–∞–¥: –∫—É–∫—É—Ä—É–¥–∑–∞, ET0 —Ç–∞ –¥–æ—â—ñ —É–º–æ–≤–Ω—ñ
    const today = new Date(); byId('startDate').value = today.toISOString().slice(0,10);
    byId('FC').value = 30; byId('PWP').value = 15; byId('Zr').value = 0.6; byId('p').value=0.5;
    byId('Kc').value = 1.15; byId('kcStage').value='1.15';
    byId('eta').value=0.8; byId('rainEff').value=0.9; byId('Imax').value=35; byId('S0p').value=80;
    buildRows();
    // ET0/–¥–æ—â—ñ (–º–º)
    const et0 = [4.8,5.2,5.5,5.1,5.0,4.6,4.9,5.3,5.4,5.2];
    const rain= [0.0,0.0,2.0,0.0,5.0,0.0,0.0,0.0,8.0,0.0];
    [...bodyEl.querySelectorAll('tr')].forEach((tr,i)=>{
      tr.children[2].querySelector('input').value = et0[i];
      tr.children[5].querySelector('input').value = rain[i];
    });
    recalc();
  }

  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  (function init(){
    const today = new Date(); byId('startDate').value = today.toISOString().slice(0,10);
    buildRows(); computeTAW_RAW(); recalc();
  })();
</script>
</body>
</html>
