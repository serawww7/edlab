<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–∞—Ä–∞ 20 ‚Äî CO‚ÇÇ-–∑–±–∞–≥–∞—á–µ–Ω–Ω—è + –±–µ–∑–ø–µ–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—É (—Å–∏—Ä–µ–Ω–∞, RGB-—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä, –∂—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥)</title>
<meta name="description" content="MH-Z19B (UART): –∫–µ—Ä—É—î–º–æ –∑–±–∞–≥–∞—á–µ–Ω–Ω—è–º CO‚ÇÇ (–∫–ª–∞–ø–∞–Ω/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä) —ñ –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—î—é –∑ –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å–æ–º —Ç–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º —á–∞—Å–æ–º —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è. –ë–µ–∑–ø–µ–∫–∞: —Å–∏—Ä–µ–Ω–∞/–±—É–∑–∑–µ—Ä, RGB-—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–æ–Ω (–∑–µ–ª–µ–Ω–∞/–∂–æ–≤—Ç–∞/—á–µ—Ä–≤–æ–Ω–∞), –∂—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥. –ï–º—É–ª—è—Ç–æ—Ä CO‚ÇÇ, –≥—Ä–∞—Ñ—ñ–∫, –µ–∫—Å–ø–æ—Ä—Ç CSV/TXT, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏."/>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
small.mono,.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Courier New",monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.2fr 1fr}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
hr.sep{border:none;border-top:1px solid var(--line);margin:16px 0}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
svg{max-width:100%;height:auto;display:block}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:260px}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.badge{display:inline-block;border:1px solid #334155;border-radius:999px;padding:2px 8px}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.log{max-height:160px;overflow:auto;border:1px solid var(--line);border-radius:10px;padding:8px;background:#0b1220;font-family:ui-monospace,monospace;font-size:13px;white-space:pre-wrap}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üß™</span>
      <div>
        <b>–ü–∞—Ä–∞ 20 ‚Äî CO‚ÇÇ-–∑–±–∞–≥–∞—á–µ–Ω–Ω—è + –±–µ–∑–ø–µ–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</b><br/>
        <span class="badge">MH-Z19B ‚Üí –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∑–±–∞–≥–∞—á–µ–Ω–Ω—è–º/–≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—î—é ¬∑ —Å–∏—Ä–µ–Ω–∞ ¬∑ RGB-—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä ¬∑ –∂—É—Ä–Ω–∞–ª</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">
    –ú–µ—Ç–∞: —Ç—Ä–∏–º–∞—Ç–∏ CO‚ÇÇ —É —Ü—ñ–ª—å–æ–≤–æ–º—É –∫–æ—Ä–∏–¥–æ—Ä—ñ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑—É (–Ω–∞–ø—Ä., <b>800‚Äì1000 ppm</b>), 
    –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–º–∏–∫–∞—Ç–∏ <b>–∑–±–∞–≥–∞—á–µ–Ω–Ω—è</b> (–∫–ª–∞–ø–∞–Ω/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä CO‚ÇÇ) —ñ <b>–≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—é</b> –ø—Ä–∏ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—ñ, 
    –∞ —Ç–∞–∫–æ–∂ <b>—Å–ø–æ–≤—ñ—â–∞—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª</b> —Å–∏—Ä–µ–Ω–æ—é —Ç–∞ <b>RGB-—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∑–æ–Ω</b> (–∑–µ–ª–µ–Ω–∞/–∂–æ–≤—Ç–∞/—á–µ—Ä–≤–æ–Ω–∞). –Ñ <b>–µ–º—É–ª—è—Ç–æ—Ä</b>, –∂–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫, –∂—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥ —ñ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–≤–Ω–æ—ó –ø—Ä–æ—à–∏–≤–∫–∏.
  </p>

  <div class="grid">
    <!-- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê -->
    <div class="card">
      <h2>üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—é</h2>
      <div class="row">
        <div style="flex:1">
          <label for="period">–ü–µ—Ä—ñ–æ–¥ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è, –º—Å</label>
          <input id="period" class="input" type="number" min="1000" step="500" value="2000"/>
        </div>
        <div style="flex:1">
          <label for="alpha">EMA –∑–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è Œ±</label>
          <input id="alpha" class="input" type="number" min="0" max="1" step="0.05" value="0.2"/>
        </div>
      </div>

      <h3 style="margin-top:12px">üåø –¶—ñ–ª—å–æ–≤–∏–π –∫–æ—Ä–∏–¥–æ—Ä CO‚ÇÇ (ppm)</h3>
      <div class="row">
        <div style="flex:1">
          <label for="setLow">–ù–∏–∂–Ω—è –º–µ–∂–∞ (–≤–º–∏–∫–∞—î –∑–±–∞–≥–∞—á–µ–Ω–Ω—è)</label>
          <input id="setLow" class="input" type="number" step="25" value="800"/>
        </div>
        <div style="flex:1">
          <label for="setHigh">–í–µ—Ä—Ö–Ω—è –º–µ–∂–∞ (–≤–º–∏–∫–∞—î –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—é)</label>
          <input id="setHigh" class="input" type="number" step="25" value="1000"/>
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label for="hyst">–ì—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å, ppm</label>
          <input id="hyst" class="input" type="number" step="10" value="60"/>
        </div>
        <div style="flex:1">
          <label for="minOn">–ú—ñ–Ω. —á–∞—Å —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ä–µ–ª–µ, —Å</label>
          <input id="minOn" class="input" type="number" step="5" value="20"/>
        </div>
      </div>

      <h3 style="margin-top:12px">üö® –ü–æ—Ä–æ–≥–∏ –±–µ–∑–ø–µ–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h3>
      <div class="row">
        <div style="flex:1">
          <label for="warn">–£–≤–∞–≥–∞ (–∂–æ–≤—Ç–∞ –∑–æ–Ω–∞), ppm</label>
          <input id="warn" class="input" type="number" step="50" value="1200"/>
        </div>
        <div style="flex:1">
          <label for="alarm">–¢—Ä–∏–≤–æ–≥–∞ (—á–µ—Ä–≤–æ–Ω–∞), ppm</label>
          <input id="alarm" class="input" type="number" step="50" value="2000"/>
        </div>
      </div>
      <div class="row">
        <span id="badgeCO2" class="badge">CO‚ÇÇ(EMA)=‚Äî ppm</span>
        <span id="badgeState" class="badge">–°—Ç–∞–Ω: ‚Äî</span>
      </div>

      <h3 style="margin-top:12px">üß™ –ï–º—É–ª—è—Ç–æ—Ä CO‚ÇÇ</h3>
      <div class="row">
        <input id="emu" type="checkbox"/><label for="emu">–£–≤—ñ–º–∫–Ω—É—Ç–∏ –µ–º—É–ª—è—Ç–æ—Ä</label>
      </div>
      <div class="row" style="width:100%">
        <label style="flex:1">CO‚ÇÇ, ppm
          <input id="emuCO2" class="input" type="range" min="400" max="4000" step="10" value="750" disabled/>
        </label>
        <label style="flex:1">–ó–±–∞–≥–∞—á–µ–Ω–Ω—è (—ñ–º—ñ—Ç–∞—Ü—ñ—è)
          <select id="emuEnr" class="input" disabled>
            <option value="0" selected>OFF</option>
            <option value="1">ON</option>
          </select>
        </label>
        <label style="flex:1">–í–µ–Ω—Ç–∏–ª—è—Ü—ñ—è (—ñ–º—ñ—Ç–∞—Ü—ñ—è)
          <select id="emuVent" class="input" disabled>
            <option value="0" selected>OFF</option>
            <option value="1">ON</option>
          </select>
        </label>
      </div>

      <h3 style="margin-top:12px">üìà –ñ–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫</h3>
      <div class="canvasWrap"><canvas id="chart" width="900" height="260"></canvas></div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="tick">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ—á–∫—É</button>
        <button class="btn secondary" id="clear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
        <span class="muted mono" id="lastVal">CO‚ÇÇ=‚Äî, EMA=‚Äî, enr=0, vent=0</span>
      </div>

      <h3 style="margin-top:12px">üß© –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏ (Arduino .ino)</h3>
      <div class="row">
        <div style="flex:1">
          <label for="rxPin">RX (Arduino —á–∏—Ç–∞—î)</label>
          <select id="rxPin" class="input">
            <option value="10">D10</option><option value="11" selected>D11</option>
            <option value="12">D12</option><option value="13">D13</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="txPin">TX (Arduino –ø–µ—Ä–µ–¥–∞—î)</label>
          <select id="txPin" class="input">
            <option value="9">D9</option><option value="8" selected>D8</option>
            <option value="7">D7</option><option value="6">D6</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label for="pinEnr">–ü—ñ–Ω —Ä–µ–ª–µ –∑–±–∞–≥–∞—á–µ–Ω–Ω—è</label>
          <select id="pinEnr" class="input">
            <option value="5">D5</option><option value="6" selected>D6</option><option value="7">D7</option><option value="8">D8</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="pinVent">–ü—ñ–Ω —Ä–µ–ª–µ –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—ó</label>
          <select id="pinVent" class="input">
            <option value="3">D3</option><option value="4" selected>D4</option><option value="9">D9</option><option value="10">D10</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label for="pinBuz">–ü—ñ–Ω –±—É–∑–∑–µ—Ä–∞ (—Å–∏—Ä–µ–Ω–∞)</label>
          <select id="pinBuz" class="input">
            <option value="2" selected>D2</option><option value="3">D3</option><option value="9">D9</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="pinRGB">–ü—ñ–Ω–∏ RGB (R,G,B)</label>
          <input id="pinRGB" class="input" type="text" value="A0,A1,3" />
          <small class="muted">–ß–µ—Ä–µ–∑ —Ä–µ–∑–∏—Å—Ç–æ—Ä–∏ 220‚Äì330Œ©, —Å–ø—ñ–ª—å–Ω–∏–π –∫–∞—Ç–æ–¥/–∞–Ω–æ–¥ ‚Äî –ø—ñ–¥–ª–∞—à—Ç—É—î—à —É –∫–æ–¥—ñ.</small>
        </div>
      </div>
      <div class="row">
        <button class="btn good" id="gen">‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É</button>
        <button class="btn secondary" id="copy">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        <button class="btn secondary" id="dl">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .ino</button>
      </div>
      <pre class="code"><code id="code">// –ù–∞—Ç–∏—Å–Ω–∏ ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É¬ª ‚Üë</code></pre>

      <h3 style="margin-top:12px">üíæ –ü—Ä–æ—Ç–æ–∫–æ–ª —ñ –∂—É—Ä–Ω–∞–ª</h3>
      <div class="row">
        <input id="fio" class="input" placeholder="–ü–Ü–ë —Å—Ç—É–¥–µ–Ω—Ç–∞"/>
        <button class="btn" id="saveTxt">üíæ TXT</button>
        <button class="btn" id="saveCsv">üìÑ CSV</button>
        <button class="btn secondary" id="saveLog">üß∑ –ï–∫—Å–ø–æ—Ä—Ç –∂—É—Ä–Ω–∞–ª—É</button>
      </div>
      <div id="log" class="log" aria-live="polite"></div>
    </div>

    <!-- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê -->
    <div class="card">
      <h2>üîå –°—Ö–µ–º–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (SVG)</h2>
      <svg viewBox="0 0 780 520" role="img" aria-label="Arduino + MH-Z19B + 2 —Ä–µ–ª–µ + –±—É–∑–∑–µ—Ä + RGB LED">
        <!-- Arduino -->
        <rect x="40" y="40" width="250" height="180" rx="12" fill="#0e2a47" stroke="#3b82f6"/>
        <text x="165" y="65" fill="#e5e7eb" font-size="16" text-anchor="middle">Arduino UNO/Nano</text>
        <text x="55" y="95" fill="#93c5fd" font-size="12">5V</text>
        <text x="55" y="115" fill="#93c5fd" font-size="12">GND</text>
        <text x="55" y="135" fill="#93c5fd" font-size="12">D11 (RX)</text>
        <text x="55" y="155" fill="#93c5fd" font-size="12">D8  (TX)</text>
        <text x="220" y="185" fill="#93c5fd" font-size="12">D6 ‚Üí RELAY_CO‚ÇÇ</text>
        <text x="220" y="205" fill="#93c5fd" font-size="12">D4 ‚Üí RELAY_VENT</text>

        <!-- MH-Z19B -->
        <rect x="340" y="40" width="210" height="120" rx="12" fill="#14532d" stroke="#22c55e"/>
        <text x="445" y="64" fill="#dcfce7" font-size="16" text-anchor="middle">MH-Z19B (UART)</text>
        <text x="445" y="84" fill="#a7f3d0" font-size="12" text-anchor="middle">VCC ‚Äî GND ‚Äî TX ‚Äî RX</text>

        <!-- Relays -->
        <rect x="340" y="180" width="210" height="90" rx="12" fill="#7c2d12" stroke="#fb923c"/>
        <text x="445" y="204" fill="#fed7aa" font-size="16" text-anchor="middle">2√ó –†–µ–ª–µ</text>
        <text x="445" y="224" fill="#fed7aa" font-size="12" text-anchor="middle">IN_CO‚ÇÇ ‚Äî IN_VENT ‚Äî VCC ‚Äî GND</text>

        <!-- Buzzer -->
        <rect x="340" y="290" width="210" height="70" rx="12" fill="#3b0764" stroke="#a78bfa"/>
        <text x="445" y="315" fill="#ddd6fe" font-size="16" text-anchor="middle">–ë—É–∑–∑–µ—Ä</text>
        <text x="445" y="333" fill="#ddd6fe" font-size="12" text-anchor="middle">D2 ‚Äî VCC ‚Äî GND</text>

        <!-- RGB LED -->
        <rect x="340" y="380" width="210" height="90" rx="12" fill="#0b3f5a" stroke="#22d3ee"/>
        <text x="445" y="405" fill="#a5f3fc" font-size="16" text-anchor="middle">RGB LED</text>
        <text x="445" y="425" fill="#a5f3fc" font-size="12" text-anchor="middle">R=A0 ¬∑ G=A1 ¬∑ B=D3 (—á–µ—Ä–µ–∑ —Ä–µ–∑–∏—Å—Ç–æ—Ä–∏)</text>

        <!-- Lines -->
        <line x1="290" y1="90"  x2="340" y2="60"  stroke="#93c5fd" stroke-width="3"/><text x="305" y="78" fill="#93c5fd" font-size="12">5V ‚Üí VCC</text>
        <line x1="290" y1="110" x2="340" y2="80"  stroke="#64748b" stroke-width="3"/><text x="305" y="96" fill="#94a3b8" font-size="12">GND ‚Üí GND</text>
        <line x1="290" y1="130" x2="340" y2="90"  stroke="#22c55e" stroke-width="3"/><text x="305" y="116" fill="#86efac" font-size="12">D11(RX) ‚Üê TX</text>
        <line x1="290" y1="150" x2="340" y2="100" stroke="#22c55e" stroke-width="3" opacity=".5"/><text x="305" y="136" fill="#86efac" font-size="12" opacity=".8">D8(TX) ‚Üí RX</text>

        <line x1="290" y1="190" x2="340" y2="205" stroke="#fb923c" stroke-width="3"/><text x="305" y="195" fill="#fdba74" font-size="12">D6 ‚Üí IN_CO‚ÇÇ</text>
        <line x1="290" y1="210" x2="340" y2="215" stroke="#fb923c" stroke-width="3"/><text x="305" y="215" fill="#fdba74" font-size="12">D4 ‚Üí IN_VENT</text>

        <line x1="290" y1="300" x2="340" y2="320" stroke="#a78bfa" stroke-width="3"/><text x="305" y="310" fill="#ddd6fe" font-size="12">D2 ‚Üí BUZZER</text>

        <line x1="290" y1="410" x2="340" y2="410" stroke="#22d3ee" stroke-width="3"/><text x="305" y="402" fill="#67e8f9" font-size="12">A0 ‚Üí R</text>
        <line x1="290" y1="430" x2="340" y2="430" stroke="#22d3ee" stroke-width="3"/><text x="305" y="422" fill="#67e8f9" font-size="12">A1 ‚Üí G</text>
        <line x1="290" y1="450" x2="340" y2="450" stroke="#22d3ee" stroke-width="3"/><text x="305" y="442" fill="#67e8f9" font-size="12">D3 ‚Üí B</text>
      </svg>

      <div class="note" style="margin-top:10px">
        <b>–ë–µ–∑–ø–µ–∫–∞:</b> CO‚ÇÇ –≤–∞–∂—á–∏–π –∑–∞ –ø–æ–≤—ñ—Ç—Ä—è ‚Äî –¥–∞—Ç—á–∏–∫ —Ä–æ–∑–º—ñ—â—É–π –Ω–∞ –≤–∏—Å–æ—Ç—ñ 1‚Äì1,5 –º. 
        –ó–±–∞–≥–∞—á–µ–Ω–Ω—è (–∫–ª–∞–ø–∞–Ω/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä) –∂–∏–≤–∏ —á–µ—Ä–µ–∑ <b>–æ–∫—Ä–µ–º–∏–π –±–ª–æ–∫ –∂–∏–≤–ª–µ–Ω–Ω—è —Ç–∞ —Ä–µ–ª–µ</b> –∑ –≥–∞–ª—å–≤–∞–Ω—ñ—á–Ω–æ—é —Ä–æ–∑–≤‚Äô—è–∑–∫–æ—é.
        –í—Å—Ç–∞–Ω–æ–≤–∏ <b>–ø–æ–ø–µ—Ä–µ–¥–∂—É–≤–∞–ª—å–Ω—ñ —Ç–∞–±–ª–∏—á–∫–∏</b> –π —ñ–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –ø–µ—Ä—Å–æ–Ω–∞–ª—É: –ø—Ä–∏ —á–µ—Ä–≤–æ–Ω—ñ–π –∑–æ–Ω—ñ ‚Äî –Ω–µ–≥–∞–π–Ω–æ –ø—Ä–æ–≤—ñ—Ç—Ä–∏—Ç–∏ —Ç–∞ –ø–æ–∫–∏–Ω—É—Ç–∏ —Ç–µ–ø–ª–∏—Ü—é.
      </div>

      <h3 style="margin-top:12px">üß∑ –ö–æ—Ä–∏—Å–Ω—ñ —Ç–µ–≥–∏</h3>
      <div>
        <span class="tag">#CO2_enrichment</span>
        <span class="tag">#–±–µ–∑–ø–µ–∫–∞</span>
        <span class="tag">#—Å–∏—Ä–µ–Ω–∞</span>
        <span class="tag">#RGB_indicator</span>
        <span class="tag">#–≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å</span>
      </div>

      <div class="card" style="margin-top:14px">
        <h3>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞ –¥–ª—è –¥–∏—Å–∫—É—Å—ñ—ó</h3>
        <p class="muted">
          –£ 1960‚Äì70-—Ö –ø—Ä–æ–º–∏—Å–ª–æ–≤–µ –∑–±–∞–≥–∞—á–µ–Ω–Ω—è CO‚ÇÇ –¥–∞–ª–æ —Ç–µ–ø–ª–∏—á–Ω–∏–∫–∞–º +10‚Äì30% –≤—Ä–æ–∂–∞–π–Ω–æ—Å—Ç—ñ. 
          –ê–ª–µ –∑—Ä–æ—Å–ª–∏ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∏ –∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º ‚Äî —Ç–∞–∫ –Ω–∞—Ä–æ–¥–∏–ª–∏—Å—è <b>–¥–≤–æ—Ö–∫–æ–Ω—Ç—É—Ä–Ω—ñ —Å–∏—Å—Ç–µ–º–∏</b>: –æ–¥–∏–Ω –∫–æ–Ω—Ç—É—Ä –ø—ñ–¥–≤–∏—â—É—î CO‚ÇÇ –¥–ª—è —Ä–æ—Å–ª–∏–Ω, –∞ –¥—Ä—É–≥–∏–π 
          —Å—É–≤–æ—Ä–æ –∫–æ–Ω—Ç—Ä–æ–ª—é—î –ø–æ—Ä–æ–≥–∏ –±–µ–∑–ø–µ–∫–∏ –¥–ª—è –ª—é–¥–µ–π (—Å–∏—Ä–µ–Ω–∏, —Å–≤—ñ—Ç–ª–æ–≤–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è, –∂—É—Ä–Ω–∞–ª–∏). –°—å–æ–≥–æ–¥–Ω—ñ —Ç–∞–∫—É —Å–∏—Å—Ç–µ–º—É –º–æ–∂–Ω–∞ –∑—ñ–±—Ä–∞—Ç–∏ –Ω–∞ Arduino.
        </p>
      </div>
    </div>
  </div>

  <hr class="sep"/>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>–§–æ—Ç–æ –º–∞–∫–µ—Ç–∞ Arduino + MH-Z19B + 2 —Ä–µ–ª–µ + –±—É–∑–∑–µ—Ä + RGB LED.</li>
      <li>CSV-–ª–æ–≥ (5‚Äì10 —Ö–≤): <span class="mono">millis,CO2_raw,CO2_EMA,enrich,vent,buzzer,zone</span>.</li>
      <li>–ï–∫—Å–ø–æ—Ä—Ç ¬´–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥¬ª: –ø–æ–¥—ñ—ó –≤—Ö–æ–¥—É/–≤–∏—Ö–æ–¥—É —ñ–∑ –∂–æ–≤—Ç–æ—ó/—á–µ—Ä–≤–æ–Ω–æ—ó –∑–æ–Ω —Ç–∞ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è —Å–∏—Ä–µ–Ω–∏.</li>
      <li>–ü–æ—è—Å–Ω–∏ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏–¥–æ—Ä—É CO‚ÇÇ, –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å—É –π –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è.</li>
    </ul>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// –£—Ç–∏–ª—ñ—Ç–∏
const $=(s)=>document.querySelector(s);
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
const LogEl = $('#log');
function log(msg){const t=new Date().toLocaleTimeString(); LogEl.textContent += `[${t}] ${msg}\n`; LogEl.scrollTop = LogEl.scrollHeight;}

// –ï–º—É–ª—è—Ç–æ—Ä
const emu=$('#emu'), emuCO2=$('#emuCO2'), emuEnr=$('#emuEnr'), emuVent=$('#emuVent');
emu.addEventListener('change',()=>{emuCO2.disabled=emuEnr.disabled=emuVent.disabled=!emu.checked;});

// –ì—Ä–∞—Ñ—ñ–∫
const cvs=$('#chart'), ctx=cvs.getContext('2d');
const series=[]; // {t,co2,ema,enr,vent,buzz,zone}
let emaVal=NaN, lastTs=null, enr=0, vent=0, buzz=0, zone='green';
let enrOnAt=0, ventOnAt=0;

function draw(){
  const W=cvs.width,H=cvs.height;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#223049';ctx.strokeRect(0.5,0.5,W-1,H-1);
  if(series.length<2) return;
  const maxN=160, s=series.slice(-maxN), xs=s.map((_,i)=> i*(W/(maxN-1)));

  // CO‚ÇÇ raw
  ctx.beginPath();ctx.strokeStyle='#38bdf8';ctx.lineWidth=2;
  xs.forEach((x,i)=>{const y=H-10-(Math.min(3500,s[i].co2)/3500)*(H-20);i?ctx.lineTo(x,y):ctx.moveTo(x,y);});ctx.stroke();

  // EMA
  ctx.beginPath();ctx.strokeStyle='#22c55e';ctx.lineWidth=2;
  xs.forEach((x,i)=>{const y=H-10-(Math.min(3500,s[i].ema)/3500)*(H-20);i?ctx.lineTo(x,y):ctx.moveTo(x,y);});ctx.stroke();

  // –ú–∞—Ä–∫–µ—Ä–∏ —Ä–µ–ª–µ/—Å–∏—Ä–µ–Ω–∏
  s.forEach((p,i)=>{ if(p.enr){ctx.fillStyle='#60a5fa';ctx.fillRect(xs[i]-1,H-26,2,8);} if(p.vent){ctx.fillStyle='#fbbf24';ctx.fillRect(xs[i]-1,H-16,2,8);} if(p.buzz){ctx.fillStyle='#f87171';ctx.fillRect(xs[i]-1,H-36,2,8);} });
}

function zoneOf(v,warn,alarm){
  if(v>=alarm) return 'red';
  if(v>=warn)  return 'yellow';
  return 'green';
}

function addPoint(){
  const a=Math.min(1,Math.max(0,parseFloat($('#alpha').value)));
  const setLow=parseFloat($('#setLow').value), setHigh=parseFloat($('#setHigh').value);
  const hyst=parseFloat($('#hyst').value), minOn=parseFloat($('#minOn').value);
  const warn=parseFloat($('#warn').value), alarm=parseFloat($('#alarm').value);

  let co2;
  if(emu.checked){ co2=parseFloat(emuCO2.value); } else {
    const v=prompt('–í–≤–µ–¥–∏ CO‚ÇÇ ppm (—ñ–∑ Serial Monitor –ø—Ä–æ—à–∏–≤–∫–∏):','820');
    if(v===null) return; co2=parseFloat(v);
    if(Number.isNaN(co2)) return alert('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ —á–∏—Å–ª–æ');
  }

  const now=Date.now();
  if(lastTs==null) lastTs=now;
  const dt=(now-lastTs)/1000; lastTs=now;

  if(Number.isNaN(emaVal)) emaVal=co2; else emaVal=a*co2+(1-a)*emaVal;

  // –ö–æ–Ω—Ç—É—Ä –∫–µ—Ä—É–≤–∞–Ω–Ω—è
  // –ó–±–∞–≥–∞—á–µ–Ω–Ω—è
  if(!enr && emaVal <= (setLow - hyst)){ enr=1; enrOnAt=now; log(`CO‚ÇÇ –Ω–∏–∑—å–∫–∏–π ‚Üí –ó–±–∞–≥–∞—á–µ–Ω–Ω—è ON (${Math.round(emaVal)} ppm)`); }
  if(enr){
    const onSecs=(now-enrOnAt)/1000;
    if(emaVal >= (setLow + hyst) && onSecs>=minOn){ enr=0; log(`–î–æ—Å—è–≥–Ω—É—Ç–æ –∫–æ—Ä–∏–¥–æ—Ä—É ‚Üí –ó–±–∞–≥–∞—á–µ–Ω–Ω—è OFF (${Math.round(emaVal)} ppm)`); }
  }
  // –í–µ–Ω—Ç–∏–ª—è—Ü—ñ—è
  if(!vent && emaVal >= (setHigh + hyst)){ vent=1; ventOnAt=now; log(`CO‚ÇÇ –≤–∏—Å–æ–∫–∏–π ‚Üí –í–µ–Ω—Ç–∏–ª—è—Ü—ñ—è ON (${Math.round(emaVal)} ppm)`); }
  if(vent){
    const onSecs=(now-ventOnAt)/1000;
    if(emaVal <= (setHigh - hyst) && onSecs>=minOn){ vent=0; log(`–û–ø—É—Å—Ç–∏–ª–∏—Å—è –Ω–∏–∂—á–µ –≤–µ—Ä—Ö–Ω—å–æ—ó –º–µ–∂—ñ ‚Üí –í–µ–Ω—Ç–∏–ª—è—Ü—ñ—è OFF (${Math.round(emaVal)} ppm)`); }
  }

  // –ë–µ–∑–ø–µ–∫–∞/—Å–∏—Ä–µ–Ω–∞
  const z = zoneOf(emaVal,warn,alarm);
  let buz = 0;
  if(z==='red'){ buz=1; if(zone!=='red') log(`üö® –ß–µ—Ä–≤–æ–Ω–∞ –∑–æ–Ω–∞! –°–∏—Ä–µ–Ω–∞ ON (${Math.round(emaVal)} ppm)`); }
  else if(z==='yellow'){ buz=0; if(zone!=='yellow') log(`‚ö†Ô∏è –ñ–æ–≤—Ç–∞ –∑–æ–Ω–∞ (${Math.round(emaVal)} ppm)`); }
  else { if(zone!=='green') log(`‚úÖ –ó–µ–ª–µ–Ω–∞ –∑–æ–Ω–∞ (${Math.round(emaVal)} ppm)`); }
  zone=z;

  if(emu.checked){ enr=parseInt(emuEnr.value,10); vent=parseInt(emuVent.value,10); } // —Ä—É—á–Ω–∞ —ñ–º—ñ—Ç–∞—Ü—ñ—è
  buzz=buz;

  series.push({t:now, co2, ema:emaVal, enr, vent, buzz, zone});
  $('#lastVal').textContent=`CO‚ÇÇ=${Math.round(co2)}, EMA=${Math.round(emaVal)}, enr=${enr}, vent=${vent}, buzz=${buzz}, zone=${zone}`;
  $('#badgeCO2').textContent=`CO‚ÇÇ(EMA)=${Math.round(emaVal)} ppm`;
  $('#badgeState').textContent=`–°—Ç–∞–Ω: enr=${enr} vent=${vent} zone=${zone}`;
  draw();
}
$('#tick').addEventListener('click', addPoint);
$('#clear').addEventListener('click', ()=>{ series.length=0; emaVal=NaN; lastTs=null; enr=vent=buzz=0; zone='green'; LogEl.textContent=''; $('#lastVal').textContent='CO‚ÇÇ=‚Äî, EMA=‚Äî, enr=0, vent=0'; $('#badgeCO2').textContent='CO‚ÇÇ(EMA)=‚Äî ppm'; $('#badgeState').textContent='–°—Ç–∞–Ω: ‚Äî'; draw(); });

// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏
function makeSketch(){
  const period = Math.max(1000, parseInt($('#period').value,10));
  const alpha  = Math.min(1,Math.max(0,parseFloat($('#alpha').value)));
  const setLow = parseInt($('#setLow').value,10);
  const setHigh= parseInt($('#setHigh').value,10);
  const hyst   = parseInt($('#hyst').value,10);
  const minOnS = Math.max(0, parseInt($('#minOn').value,10));
  const warn   = parseInt($('#warn').value,10);
  const alarm  = parseInt($('#alarm').value,10);
  const rxPin  = parseInt($('#rxPin').value,10);
  const txPin  = parseInt($('#txPin').value,10);
  const pinEnr = parseInt($('#pinEnr').value,10);
  const pinVent= parseInt($('#pinVent').value,10);
  const pinBuz = parseInt($('#pinBuz').value,10);
  let [pinR,pinG,pinB] = $('#pinRGB').value.split(',').map(s=>s.trim());

  const code = `/*
  –ü–∞—Ä–∞ 20 ‚Äî CO‚ÇÇ-–∑–±–∞–≥–∞—á–µ–Ω–Ω—è + –±–µ–∑–ø–µ–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—É
  –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä: Arduino UNO/Nano + MH-Z19B (UART)
  –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:
    ‚Ä¢ –¶—ñ–ª—å–æ–≤–∏–π –∫–æ—Ä–∏–¥–æ—Ä: ${setLow}..${setHigh} ppm, –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å ${hyst} ppm, –º—ñ–Ω. —á–∞—Å —Ä–µ–ª–µ ${minOnS}s
    ‚Ä¢ –ö–µ—Ä—É–≤–∞–Ω–Ω—è: —Ä–µ–ª–µ –∑–±–∞–≥–∞—á–µ–Ω–Ω—è (CO‚ÇÇ) –Ω–∞ D${pinEnr}, —Ä–µ–ª–µ –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—ó –Ω–∞ D${pinVent}
    ‚Ä¢ –ë–µ–∑–ø–µ–∫–∞: –±—É–∑–∑–µ—Ä D${pinBuz}, RGB-—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä (R=${pinR}, G=${pinG}, B=${pinB})
    ‚Ä¢ –ü–æ—Ä–æ–≥–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—É: ‚ö†Ô∏è ${warn} ppm, üö® ${alarm} ppm
    ‚Ä¢ EMA Œ±=${alpha.toFixed(2)}, –ª–æ–≥ CSV —ñ —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É Serial
*/
#include <SoftwareSerial.h>

const int RX_PIN = ${rxPin}; // ‚Üê TX –¥–∞—Ç—á–∏–∫–∞
const int TX_PIN = ${txPin}; // ‚Üí RX –¥–∞—Ç—á–∏–∫–∞
SoftwareSerial mhz(RX_PIN, TX_PIN);

const unsigned long PERIOD_MS = ${period};
const float ALPHA = ${alpha.toFixed(3)};
const int SET_LOW  = ${setLow};
const int SET_HIGH = ${setHigh};
const int HYST     = ${hyst};
const unsigned long MIN_ON_MS = ${minOnS}UL * 1000UL;
const int WARN_PPM  = ${warn};
const int ALARM_PPM = ${alarm};

const int RELAY_ENR = ${pinEnr};
const int RELAY_VENT= ${pinVent};
const int BUZZER    = ${pinBuz};
// RGB ‚Äî –≤–∫–∞–∂–∏ —Ç–∏–ø —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥–∞ (true=—Å–ø—ñ–ª—å–Ω–∏–π –∞–Ω–æ–¥, false=—Å–ø—ñ–ª—å–Ω–∏–π –∫–∞—Ç–æ–¥)
const bool RGB_COMMON_ANODE = false;
const int RGB_R = ${pinR};
const int RGB_G = ${pinG};
const int RGB_B = ${pinB};

unsigned long tPrev=0;
float ema = NAN;
bool enr=false, vent=false, buzz=false;
unsigned long enrOnAt=0, ventOnAt=0;

uint8_t cmdRead[9] = {0xFF,0x01,0x86,0,0,0,0,0,0};
uint8_t checksum(uint8_t *b){ uint16_t s=0; for(int i=1;i<8;i++) s+=b[i]; return 0xFF - (s % 256) + 1; }

int readCO2(){
  cmdRead[8]=checksum(cmdRead);
  mhz.write(cmdRead,9); mhz.flush();
  unsigned long t0=millis();
  while(millis()-t0<50){
    if(mhz.available()>=9){
      uint8_t r[9]; mhz.readBytes(r,9);
      if(r[0]==0xFF && r[1]==0x86 && checksum(r)==r[8]){
        return (int)r[2]*256 + (int)r[3];
      }
    }
  }
  return -1;
}

void rgbWrite(uint8_t rr,uint8_t gg,uint8_t bb){
  if(RGB_COMMON_ANODE){ rr=255-rr; gg=255-gg; bb=255-bb; }
  analogWrite(RGB_R, rr); analogWrite(RGB_G, gg); analogWrite(RGB_B, bb);
}

void setZone(int ppm){
  if(ppm>=ALARM_PPM){ rgbWrite(255,0,0); buzz=true; }
  else if(ppm>=WARN_PPM){ rgbWrite(255,140,0); buzz=false; }
  else { rgbWrite(0,220,0); buzz=false; }
}

void setup(){
  pinMode(RELAY_ENR, OUTPUT); digitalWrite(RELAY_ENR, LOW);
  pinMode(RELAY_VENT,OUTPUT); digitalWrite(RELAY_VENT,LOW);
  pinMode(BUZZER, OUTPUT); digitalWrite(BUZZER, LOW);
  pinMode(RGB_R, OUTPUT); pinMode(RGB_G, OUTPUT); pinMode(RGB_B, OUTPUT);
  rgbWrite(0,0,0);

  mhz.begin(9600);
  Serial.begin(115200);
  delay(500);
  Serial.println(F("millis,CO2_raw,CO2_EMA,enrich,vent,buzzer,zone"));
}

void loop(){
  if(millis()-tPrev >= PERIOD_MS){
    unsigned long now = millis();
    int co2 = readCO2();

    if(co2<0){
      Serial.print(now); Serial.println(",NaN,NaN,0,0,0,err");
      tPrev=now; return;
    }

    if(isnan(ema)) ema = co2; else ema = ALPHA*co2 + (1.0-ALPHA)*ema;

    // –ó–æ–Ω–∞ –±–µ–∑–ø–µ–∫–∏ + —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä
    setZone((int)ema);

    // –ö–æ–Ω—Ç—É—Ä –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏–¥–æ—Ä–æ–º CO2
    // –ó–±–∞–≥–∞—á–µ–Ω–Ω—è
    if(!enr && ema <= (SET_LOW - HYST)){ enr=true; enrOnAt=now; Serial.println(F("#event: enrich_on")); }
    if(enr){
      unsigned long onFor = now - enrOnAt;
      if(ema >= (SET_LOW + HYST) && onFor >= MIN_ON_MS){ enr=false; Serial.println(F("#event: enrich_off")); }
    }
    // –í–µ–Ω—Ç–∏–ª—è—Ü—ñ—è
    if(!vent && ema >= (SET_HIGH + HYST)){ vent=true; ventOnAt=now; Serial.println(F("#event: vent_on")); }
    if(vent){
      unsigned long onFor = now - ventOnAt;
      if(ema <= (SET_HIGH - HYST) && onFor >= MIN_ON_MS){ vent=false; Serial.println(F("#event: vent_off")); }
    }

    // –í–∏—Ö–æ–¥–∏
    digitalWrite(RELAY_ENR, enr ? HIGH : LOW);
    digitalWrite(RELAY_VENT,vent? HIGH : LOW);
    digitalWrite(BUZZER,    buzz? HIGH : LOW);

    // CSV
    Serial.print(now); Serial.print(',');
    Serial.print(co2); Serial.print(',');
    Serial.print(ema,0); Serial.print(',');
    Serial.print(enr?1:0); Serial.print(',');
    Serial.print(vent?1:0); Serial.print(',');
    Serial.print(buzz?1:0); Serial.print(',');
    if(ema>=ALARM_PPM) Serial.println(F("red"));
    else if(ema>=WARN_PPM) Serial.println(F("yellow"));
    else Serial.println(F("green"));

    tPrev=now;
  }
}
`;
  return code;
}

$('#gen').addEventListener('click', ()=>{ const txt=makeSketch(); $('#code').textContent=txt; window.scrollTo({top: $('#code').parentElement.getBoundingClientRect().top + window.scrollY - 20, behavior:'smooth'}); });
$('#copy').addEventListener('click', ()=>{ const ta=document.createElement('textarea'); ta.value=$('#code').textContent; document.body.appendChild(ta); ta.select(); ta.setSelectionRange(0, ta.value.length); document.execCommand('copy'); ta.remove(); const old=document.title; document.title='‚úÖ –ö–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'; setTimeout(()=>document.title=old,900); });
$('#dl').addEventListener('click', ()=>{ const txt=$('#code').textContent||makeSketch(); download('agro_para20_co2_enrichment_safety.ino',txt,'text/x-arduino'); });

// –ü—ñ–¥—Å—É–º–∫–æ–≤—ñ —Ñ–∞–π–ª–∏
$('#saveTxt').addEventListener('click', ()=>{
  const fio=($('#fio').value||'').trim();
  const lines=[
    '–ü–∞—Ä–∞ 20 ‚Äî CO‚ÇÇ-–∑–±–∞–≥–∞—á–µ–Ω–Ω—è + –±–µ–∑–ø–µ–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—É',
    '–°—Ç—É–¥–µ–Ω—Ç: '+fio,
    `–ü–µ—Ä—ñ–æ–¥: ${$('#period').value} –º—Å, EMA Œ±=${$('#alpha').value}`,
    `–ö–æ—Ä–∏–¥–æ—Ä: ${$('#setLow').value}..${$('#setHigh').value} ppm, –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å ${$('#hyst').value} ppm, minOn=${$('#minOn').value}s`,
    `–ü–æ—Ä–æ–≥–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—É: warn=${$('#warn').value} ppm, alarm=${$('#alarm').value} ppm`,
    '–ñ—É—Ä–Ω–∞–ª: –¥–∏–≤. —Å–µ–∫—Ü—ñ—é –Ω–∏–∂—á–µ.',
    '–ö–æ–º–µ–Ω—Ç–∞—Ä: ...'
  ].join('\n');
  download('agro_para20_'+stamp()+'.txt',lines);
});
$('#saveCsv').addEventListener('click', ()=>{
  const fio=($('#fio').value||'').replace(/"/g,'""');
  const csv='"–ü–∞—Ä–∞","–°—Ç—É–¥–µ–Ω—Ç","Period_ms","Alpha","Low","High","Hyst","MinOn_s","Warn","Alarm"\n'
          + `"20","${fio}",${$('#period').value},${$('#alpha').value},${$('#setLow').value},${$('#setHigh').value},${$('#hyst').value},${$('#minOn').value},${$('#warn').value},${$('#alarm').value}\n`;
  download('agro_para20_'+stamp()+'.csv',csv,'text/csv');
});
$('#saveLog').addEventListener('click', ()=>{
  const txt = ($('#log').textContent||'').trim()||'–õ–æ–≥ –ø–æ–¥—ñ–π –ø–æ—Ä–æ–∂–Ω—ñ–π.';
  download('agro_para20_log_'+stamp()+'.txt', txt);
});

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
log('UI —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ. –î–æ–¥–∞–π—Ç–µ —Ç–æ—á–∫–∏ –∞–±–æ –ø—Ä–æ—à–∏–π—Ç–µ –π –∑–Ω—ñ–º–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ.');
function init(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); draw(); }
init();
</script>
</body>
</html>
