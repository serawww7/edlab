<!-- –ü–ê–†–ê 3 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –∞–≥—Ä–æ–Ω–æ–º—ñ–≤
     –¢–µ–º–∞: –ü–æ–ª—å–æ–≤—ñ —Ç—Ä–µ–∫–∏ –∑—ñ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞ ‚Äî GPX ‚Üí –∞–Ω–∞–ª—ñ–∑ ‚Üí –ø–ª–∞–Ω/—Ñ–∞–∫—Ç —É —Ç–∞–±–ª–∏—Ü—ñ
     –§–æ–∫—É—Å: –º–∞–∫—Å–∏–º—É–º —Ç–µ–ª–µ—Ñ–æ–Ω—É. –Ñ –ª–æ–∫–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä GPX (–±–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É), –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –¥–æ–≤–∂–∏–Ω–∏, —á–∞—Å—É, —à–≤–∏–¥–∫–æ—Å—Ç—ñ, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ä—è–¥–∫–∞ –¥–ª—è Sheets.
     –ì–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages –∞–±–æ –≤—Å—Ç–∞–≤–∫–∏ –≤ Moodle —á–µ—Ä–µ–∑ iFrame. –ë–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ü–∞—Ä–∞ 3 ‚Äî –ü–æ–ª—å–æ–≤—ñ —Ç—Ä–µ–∫–∏: GPX ‚Üí –∞–Ω–∞–ª—ñ–∑ ‚Üí –ø–ª–∞–Ω/—Ñ–∞–∫—Ç</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --good:#10b981; --line:#1f2937;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:980px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted); letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  ul,ol{margin:8px 0 12px 22px}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .grid{display:grid; gap:12px}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:900px){.g3{grid-template-columns:1fr}}
  .kpi{display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px dashed #263042; border-radius:12px}
  .kpi b{font-size:14px}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:10px 12px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left}
  .table tbody tr:nth-child(even){background:#0b1324}
  .step{display:flex; gap:12px; align-items:flex-start; padding:10px 12px; border:1px solid #1f2937; border-radius:12px; background:#0b1324; margin:8px 0}
  .step .n{min-width:30px; height:30px; border-radius:8px; background:#0e1a2e; display:grid; place-items:center; color:#a5b4fc; font-weight:700}
  .pill{display:inline-block; padding:4px 10px; border:1px solid #223049; border-radius:999px; font-size:12px; color:#a5b4fc; background:#0d1a2e; margin-right:6px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .muted{color:#93a3b5}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:#ef4444}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .field{display:flex; gap:8px; margin:6px 0; align-items:center}
  .field label{min-width:160px; color:#cbd5e1}
  .field input, .field select{
    flex:1; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e5e7eb
  }
  .out{background:#0b1324; border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:#0b1324}
  .small{font-size:12px; color:#9fb0c8}
  .success{border-color:#1f5135; background:#0f2a1c}
  .danger{border-color:#5b2020; background:#2a0f0f}

  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å—Ç—Ä–∏–º–∞–Ω–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}

  @media print{
    @page{ margin:12mm }
    .no-print{ display:none !important }
  }
</style>
</head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 3 ¬∑ –õ–ü–ó ¬∑ –∞–≥—Ä–æ–Ω–æ–º–∏</span>
    <h1>üó∫Ô∏è –ü–æ–ª—å–æ–≤—ñ —Ç—Ä–µ–∫–∏: –∑–∞–ø–∏—Å GPX –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ ‚Üí –∞–Ω–∞–ª—ñ–∑ ‚Üí –ø–ª–∞–Ω/—Ñ–∞–∫—Ç</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>
        –ù–∞–≤—á–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Ç—Ä–µ–∫ <b>GPX</b> –∑—ñ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞, –ª–æ–∫–∞–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ —Ñ–∞–π–ª (–¥–æ–≤–∂–∏–Ω–∞, —á–∞—Å, —à–≤–∏–¥–∫—ñ—Å—Ç—å),
        —Ç–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–∏ –ø—ñ–¥—Å—É–º–æ–∫ —É —Ç–∞–±–ª–∏—Ü—é <b>Tracks</b> –∑ –ø–æ–ª–µ–º <i>–ü–ª–∞–Ω/–§–∞–∫—Ç</i>.
      </p>
      <div class="grid g3">
        <div class="kpi"><span>üìç</span><div><b>GPX</b><br/><span class="mono">&lt;trkpt lat lon time&gt;</span></div></div>
        <div class="kpi"><span>‚è±Ô∏è</span><div><b>–ß–∞—Å —ñ –≤—ñ–¥—Å—Ç–∞–Ω—å</b><br/>Haversine + ISO time</div></div>
        <div class="kpi"><span>üìä</span><div><b>–ü–ª–∞–Ω/–§–∞–∫—Ç</b><br/>–¥–æ–≤–∂–∏–Ω–∞, —à–≤–∏–¥–∫—ñ—Å—Ç—å, –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</div></div>
      </div>
    </div>

    <div class="card">
      <h2>üß∞ –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è —Ç–∞ –ü–ó</h2>
      <ul>
        <li>–°–º–∞—Ä—Ç—Ñ–æ–Ω (Android/iOS) –∑ –±—É–¥—å-—è–∫–∏–º GPX-—Ç—Ä–µ–∫–µ—Ä–æ–º <i>(Google Maps ¬´–ú–∞—Ä—à—Ä—É—Ç¬ª, Health/Fitness, –∞–±–æ –æ–∫—Ä–µ–º–∏–π —Ç—Ä–µ–∫–µ—Ä)</i>.</li>
        <li>–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä GPX) + Google Sheets/Excel –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ <span class="mono">Tracks</span>.</li>
      </ul>
      <p class="muted">üí° –Ø–∫—â–æ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –Ω–µ –≤–º—ñ—î –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ GPX ‚Äî –∑—Ä–æ–±–∏ —Å–∫—Ä—ñ–Ω –º–∞—Ä—à—Ä—É—Ç—É —ñ –≤–Ω–µ—Å–∏ –¥–æ–≤–∂–∏–Ω—É/—á–∞—Å –≤—Ä—É—á–Ω—É –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–∏–∂—á–µ.</p>
    </div>

    <!-- –ê–ù–ê–õ–Ü–ó–ê–¢–û–† GPX -->
    <div class="card">
      <h2>üß™ –õ–æ–∫–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä GPX (–ø—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω —É –±—Ä–∞—É–∑–µ—Ä—ñ)</h2>
      <div class="field">
        <label for="gpxFile">–ó–∞–≤–∞–Ω—Ç–∞–∂ GPX-—Ñ–∞–π–ª</label>
        <input id="gpxFile" type="file" accept=".gpx,.xml" />
      </div>
      <div class="row">
        <button class="btn" type="button" onclick="parseGPX()">üì• –û–±—Ä–æ–±–∏—Ç–∏ GPX</button>
        <button class="btn" type="button" onclick="resetAll()">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      </div>

      <div id="gpxSummary" class="box" style="margin-top:10px; display:none">
        <h3>–ü—ñ–¥—Å—É–º–æ–∫ —Ç—Ä–µ–∫—É</h3>
        <p><b>–¢–æ—á–æ–∫:</b> <span id="ptCount">0</span></p>
        <p><b>–î–æ–≤–∂–∏–Ω–∞:</b> <span id="distM">0</span> –º (<span id="distKM">0</span> –∫–º)</p>
        <p><b>–ß–∞—Å —Ä—É—Ö—É:</b> <span id="durMin">0</span> —Ö–≤ (<span id="durHHMM">00:00</span>)</p>
        <p><b>–°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å:</b> <span id="avgKmh">0</span> –∫–º/–≥–æ–¥</p>
        <p class="small">–û–±—á–∏—Å–ª–µ–Ω–æ –∑–∞ —Ç—Ä–µ–∫–ø–æ—ñ–Ω—Ç–∞–º–∏ <span class="mono">trkpt(lat, lon, time)</span> –º–µ—Ç–æ–¥–æ–º Haversine.</p>
      </div>

      <details class="box" style="margin-top:10px">
        <summary>üîé –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–µ—Ä—à—ñ 5 —Ç–æ—á–æ–∫ (lat, lon, time)</summary>
        <pre id="firstPts" style="white-space:pre-wrap; margin:6px 0 0 0">‚Äî</pre>
      </details>
    </div>

    <!-- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –ø–ª–∞–Ω/—Ñ–∞–∫—Ç -->
    <div class="card">
      <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ¬´–ü–ª–∞–Ω/–§–∞–∫—Ç¬ª —ñ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ –¥–ª—è Sheets</h2>

      <div class="grid g3">
        <div class="box">
          <h3>–í—Ö—ñ–¥–Ω—ñ (–∑ —Ç—Ä–µ–∫—É –∞–±–æ –≤—Ä—É—á–Ω—É)</h3>
          <div class="field"><label for="date">–î–∞—Ç–∞</label><input id="date" type="date" /></div>
          <div class="field"><label for="fieldCode">–ö–æ–¥ –ø–æ–ª—è</label><input id="fieldCode" type="text" value="F-01" /></div>
          <div class="field"><label for="crop">–ö—É–ª—å—Ç—É—Ä–∞</label><input id="crop" type="text" value="–ü—à–µ–Ω–∏—Ü—è –æ–∑." /></div>
          <div class="field"><label for="op">–û–ø–µ—Ä–∞—Ü—ñ—è</label><input id="op" type="text" value="–û–≥–ª—è–¥" /></div>
          <div class="field"><label for="lenM">–î–æ–≤–∂–∏–Ω–∞, –º (—Ñ–∞–∫—Ç)</label><input id="lenM" type="number" step="1" value="0" /></div>
          <div class="field"><label for="timeMin">–ß–∞—Å, —Ö–≤ (—Ñ–∞–∫—Ç)</label><input id="timeMin" type="number" step="1" value="0" /></div>
          <div class="row">
            <button class="btn" type="button" onclick="takeFromGPX()">‚¨ÖÔ∏è –í–∑—è—Ç–∏ –∑ GPX-–ø—ñ–¥—Å—É–º–∫—É</button>
          </div>
        </div>

        <div class="box">
          <h3>–ü–ª–∞–Ω</h3>
          <div class="field"><label for="planM">–ü–ª–∞–Ω–æ–≤–∞ –¥–æ–≤–∂–∏–Ω–∞, –º</label><input id="planM" type="number" step="1" value="1200" /></div>
          <div class="field"><label for="comment">–ö–æ–º–µ–Ω—Ç–∞—Ä</label><input id="comment" type="text" value="–ú–∞—Ä—à—Ä—É—Ç –ø–æ –º–µ–∂—ñ –ø–æ–ª—è" /></div>
          <div class="box success" id="calcBox" style="margin-top:8px">
            <div><b>–°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å:</b> <span id="calcSpeed">0.0</span> –∫–º/–≥–æ–¥</div>
            <div><b>–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ –ø–ª–∞–Ω—É:</b> <span id="calcDev">0</span> –º</div>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn" type="button" onclick="recalc()">üîÅ –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
          </div>
        </div>

        <div class="box">
          <h3>–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫ –¥–ª—è <span class="mono">Tracks</span></h3>
          <p class="small">–ü–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫: –î–∞—Ç–∞ | –ü–æ–ª–µ | –ö—É–ª—å—Ç—É—Ä–∞ | –û–ø–µ—Ä–∞—Ü—ñ—è | –î–æ–≤–∂–∏–Ω–∞, –º | –ß–∞—Å, —Ö–≤ | –°–µ—Ä. —à–≤–∏–¥–∫., –∫–º/–≥–æ–¥ | –ü–ª–∞–Ω, –º | –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, –º | –ö–æ–º–µ–Ω—Ç–∞—Ä</p>
          <div id="csvOut" class="out">‚Äî</div>
          <div class="row" style="margin-top:8px">
            <button class="btn" type="button" onclick="genCSV()">üìÑ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
            <button class="btn" type="button" onclick="copyCSV()">üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
        </div>
      </div>
    </div>

    <!-- –°–¢–†–£–ö–¢–£–†–ê –¢–ê–ë–õ–ò–¶–Ü -->
    <div class="card">
      <h2>üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞—Ä–∫—É—à–∞ <span class="mono">Tracks</span> (—É Google Sheets/Excel)</h2>
      <table class="table">
        <thead>
          <tr>
            <th>–î–∞—Ç–∞</th><th>–ü–æ–ª–µ</th><th>–ö—É–ª—å—Ç—É—Ä–∞</th><th>–û–ø–µ—Ä–∞—Ü—ñ—è</th><th>–î–æ–≤–∂–∏–Ω–∞, –º</th><th>–ß–∞—Å, —Ö–≤</th><th>–°–µ—Ä. —à–≤–∏–¥–∫., –∫–º/–≥–æ–¥</th><th>–ü–ª–∞–Ω, –º</th><th>–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, –º</th><th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
          </tr>
        </thead>
        <tbody>
          <tr class="hl">
            <td>2025-10-16</td><td>F-01</td><td>–ü—à–µ–Ω–∏—Ü—è –æ–∑.</td><td>–û–≥–ª—è–¥</td><td>1280</td><td>16</td><td>4.8</td><td>1200</td><td>+80</td><td>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –æ–±—Ö–æ–¥–∏ –º–µ–∂—ñ</td>
          </tr>
        </tbody>
      </table>
      <p class="muted">–§–æ—Ä–º—É–ª–∏: <span class="mono">–°–µ—Ä. —à–≤–∏–¥–∫. (–∫–º/–≥–æ–¥) = (–î–æ–≤–∂–∏–Ω–∞, –º / 1000) / (–ß–∞—Å, —Ö–≤ / 60)</span>; <span class="mono">–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è = –§–∞–∫—Ç ‚àí –ü–ª–∞–Ω</span>.</p>
    </div>

    <!-- –•–Ü–î –†–û–ë–û–¢–ò -->
    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>

      <div class="step"><div class="n">1</div><div>
        <b>–ó–∞–ø–∏—Å —Ç—Ä–µ–∫—É –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ (10‚Äì15 —Ö–≤).</b> –ó–∞–ø—É—Å—Ç–∏ —Ç—Ä–µ–∫–µ—Ä, –ø—Ä–æ–π–¥–∏/–ø—Ä–æ—ó–¥—å <b>‚â• 300 –º</b> —Ä—ñ–≤–Ω–∏–º –º–∞—Ä—à—Ä—É—Ç–æ–º (—ñ–º—ñ—Ç–∞—Ü—ñ—è –ø—Ä–æ—Ö–æ–¥—É –∞–≥—Ä–µ–≥–∞—Ç—É), –∑—É–ø–∏–Ω–∏ –∑–∞–ø–∏—Å, <b>–µ–∫—Å–ø–æ—Ä—Ç—É–π GPX</b>.
      </div></div>

      <div class="step"><div class="n">2</div><div>
        <b>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GPX —ñ –∞–Ω–∞–ª—ñ–∑ (5‚Äì8 —Ö–≤).</b> –ó–∞–≤–∞–Ω—Ç–∞–∂ —Ñ–∞–π–ª —É –±–ª–æ–∫ ¬´–õ–æ–∫–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä¬ª ‚Üí –æ—Ç—Ä–∏–º–∞—î—à –¥–æ–≤–∂–∏–Ω—É, —á–∞—Å, —à–≤–∏–¥–∫—ñ—Å—Ç—å.
        –ü–µ—Ä–µ–≤—ñ—Ä –ø–µ—Ä—à—ñ 5 —Ç–æ—á–æ–∫ (lat, lon, time).
      </div></div>

      <div class="step"><div class="n">3</div><div>
        <b>–ö–∞–ª—å–∫—É–ª—è—Ü—ñ—è –ü–ª–∞–Ω/–§–∞–∫—Ç (5 —Ö–≤).</b> –£ –±–ª–æ—Ü—ñ ¬´–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä¬ª –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–í–∑—è—Ç–∏ –∑ GPX-–ø—ñ–¥—Å—É–º–∫—É¬ª, –∑–∞–¥–∞–π –ø–ª–∞–Ω–æ–≤—É –¥–æ–≤–∂–∏–Ω—É, –æ–±—á–∏—Å–ª–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è.
      </div></div>

      <div class="step"><div class="n">4</div><div>
        <b>–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ä—è–¥–∫–∞ –¥–ª—è Sheets (2 —Ö–≤).</b> –ö–Ω–æ–ø–∫–∞ ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏¬ª ‚Üí ¬´–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏¬ª ‚Üí –≤—Å—Ç–∞–≤ —É —Ä—è–¥–æ–∫ –∞—Ä–∫—É—à–∞ <span class="mono">Tracks</span>.
      </div></div>

      <div class="step"><div class="n">5</div><div>
        <b>–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è (5 —Ö–≤).</b> –ü–æ–±—É–¥—É–π 2 –¥—ñ–∞–≥—Ä–∞–º–∏: ¬´–ü–ª–∞–Ω/–§–∞–∫—Ç –¥–æ–≤–∂–∏–Ω–∏¬ª (—Å—Ç–æ–≤–ø—á–∏–∫–æ–≤–∞) —ñ ¬´–°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å¬ª (–ª—ñ–Ω—ñ–π–Ω–∞).
      </div></div>

      <div class="step"><div class="n">6</div><div>
        <b>–ö–æ—Ä–æ—Ç–∫–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫ (2‚Äì3 —Ä–µ—á–µ–Ω–Ω—è).</b> –ü—Ä–∏—á–∏–Ω–∏ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è/–Ω–µ—Å—Ç–∞—á—ñ –¥–æ–≤–∂–∏–Ω–∏; —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó (–∫–æ—Ä–µ–∫—Ü—ñ—è –º–∞—Ä—à—Ä—É—Ç—É, —à–≤–∏–¥–∫–æ—Å—Ç—ñ —Ç–æ—â–æ).
      </div></div>
    </div>

    <!-- –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
    <div class="card">
      <h2>‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ —Ç–∞ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="table">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–∏–π GPX (—î —Ç–æ—á–∫–∏ –∑ —á–∞—Å–æ–º) —Ç–∞ —É—Å–ø—ñ—à–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</td><td>3</td></tr>
          <tr><td>–ö–∞–ª—å–∫—É–ª—è—Ü—ñ—è –ü–ª–∞–Ω/–§–∞–∫—Ç (—à–≤–∏–¥–∫—ñ—Å—Ç—å, –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è) –±–µ–∑ –ø–æ–º–∏–ª–æ–∫</td><td>3</td></tr>
          <tr><td>–ó–∞–ø–∏—Å —É <span class="mono">Tracks</span> + –¥–≤—ñ –¥—ñ–∞–≥—Ä–∞–º–∏</td><td>3</td></tr>
          <tr><td>–ö–æ—Ä–æ—Ç–∫–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫ –ø–æ —Å—É—Ç—ñ</td><td>1</td></tr>
        </tbody>
      </table>
      <p class="pill">üì± –ú–∞–∫—Å–∏–º—É–º —Ç–µ–ª–µ—Ñ–æ–Ω—É</p>
      <p class="pill">üó∫Ô∏è GPX-–∞–Ω–∞–ª—ñ–∑</p>
      <p class="pill">üìä –ü–ª–∞–Ω/—Ñ–∞–∫—Ç</p>
    </div>

    <div class="card">
      <h2>üÜò –ü–æ—Ä–∞–¥–∏ —Ç–∞ —Ç–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏</h2>
      <ul>
        <li><b>–ù—É–ª—å–æ–≤–∞ –¥–æ–≤–∂–∏–Ω–∞?</b> –ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ —É GPX —î <span class="mono">trk/trkseg/trkpt</span> –∑ <span class="mono">lat</span>, <span class="mono">lon</span> —ñ <span class="mono">time</span>.</li>
        <li><b>–î—Ä—ñ–±–Ω—ñ ¬´—Å—Ç—Ä–∏–±–∫–∏¬ª –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:</b> —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. Haversine –∑–≥–ª–∞–¥–∂—É—î –Ω–∞ –≤—ñ–¥—Ä—ñ–∑–∫–∞—Ö; —É–Ω–∏–∫–∞–π —Å—Ç–æ—è–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ü—ñ –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º –∑–∞–ø–∏—Å–æ–º.</li>
        <li><b>–®–≤–∏–¥–∫—ñ—Å—Ç—å ¬´–∫–æ—Å–º—ñ—á–Ω–∞¬ª:</b> –ø–µ—Ä–µ–≤—ñ—Ä –æ–¥–∏–Ω–∏—Ü—ñ (–º‚Üî–∫–º, —Ö–≤‚Üî–≥–æ–¥) —Ç–∞ –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å —á–∞—Å—É –≤ GPX.</li>
      </ul>
    </div>
  </div>

<script>
  // –°—Ç—Ä–∏–º–∞–Ω–∏–π –≤–∏–≥–ª—è–¥ —É –≤–±—É–¥—É–≤–∞–Ω–Ω—ñ
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // Haversine distance –º—ñ–∂ –¥–≤–æ–º–∞ —Ç–æ—á–∫–∞–º–∏ (–≤ –º–µ—Ç—Ä–∞—Ö)
  function haversine(lat1, lon1, lat2, lon2){
    const R = 6371000; // –º
    const toRad = d => d * Math.PI/180;
    const dLat = toRad(lat2-lat1);
    const dLon = toRad(lon2-lon1);
    const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }

  function parseGPX(){
    const file = document.getElementById('gpxFile').files[0];
    if(!file){ alert('–°–ø–æ—á–∞—Ç–∫—É –≤–∏–±–µ—Ä–∏ GPX-—Ñ–∞–π–ª.'); return; }
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const xml = new DOMParser().parseFromString(reader.result, 'application/xml');
        const pts = Array.from(xml.getElementsByTagName('trkpt'));
        if(!pts.length){ alert('–£ —Ñ–∞–π–ª—ñ –Ω–µ–º–∞—î —Ç—Ä–µ–∫–ø–æ—ñ–Ω—Ç—ñ–≤ <trkpt>.'); return; }

        let dist = 0;
        let firstTime = null, lastTime = null;
        const first5 = [];

        for(let i=0;i<pts.length;i++){
          const lat = parseFloat(pts[i].getAttribute('lat'));
          const lon = parseFloat(pts[i].getAttribute('lon'));
          const timeEl = pts[i].getElementsByTagName('time')[0];
          const t = timeEl ? new Date(timeEl.textContent.trim()) : null;

          if(i===0){ if(t) firstTime = t; first5.push({lat,lon,time: t? t.toISOString(): '-' }); }
          if(i>0){
            const prev = pts[i-1];
            const lat2 = parseFloat(prev.getAttribute('lat'));
            const lon2 = parseFloat(prev.getAttribute('lon'));
            dist += haversine(lat, lon, lat2, lon2);
          }
          if(i<5 && i>0){
            const timeEl2 = pts[i].getElementsByTagName('time')[0];
            const t2 = timeEl2 ? new Date(timeEl2.textContent.trim()) : null;
            first5.push({lat,lon,time: t2? t2.toISOString(): '-'});
          }
          if(i===pts.length-1){ if(t) lastTime = t; }
        }

        const durationSec = (firstTime && lastTime) ? Math.max(0, (lastTime - firstTime)/1000) : 0;
        const durationMin = Math.round(durationSec/60);
        const avgKmh = durationSec>0 ? (dist/1000) / (durationSec/3600) : 0;

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        document.getElementById('ptCount').textContent = pts.length.toString();
        document.getElementById('distM').textContent = Math.round(dist).toString();
        document.getElementById('distKM').textContent = (dist/1000).toFixed(3);
        document.getElementById('durMin').textContent = durationMin.toString();
        document.getElementById('durHHMM').textContent = hhmm(durationSec);
        document.getElementById('avgKmh').textContent = avgKmh.toFixed(2);
        document.getElementById('gpxSummary').style.display = '';

        document.getElementById('firstPts').textContent = first5.map((p,i)=>`${i+1}. ${p.lat.toFixed(6)}, ${p.lon.toFixed(6)}  ${p.time}`).join('\n');

      }catch(e){
        alert('–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–±–æ—Ä—É GPX: ' + e.message);
      }
    };
    reader.readAsText(file);
  }

  function hhmm(sec){
    const h = Math.floor(sec/3600);
    const m = Math.round((sec%3600)/60);
    const pad = n => n.toString().padStart(2,'0');
    return `${pad(h)}:${pad(m)}`;
  }

  function resetAll(){
    document.getElementById('gpxFile').value = '';
    document.getElementById('gpxSummary').style.display = 'none';
    document.getElementById('firstPts').textContent = '‚Äî';
    // –æ—á–∏—â–µ–Ω–Ω—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    document.getElementById('lenM').value = 0;
    document.getElementById('timeMin').value = 0;
    document.getElementById('csvOut').textContent = '‚Äî';
    document.getElementById('calcSpeed').textContent = '0.0';
    document.getElementById('calcDev').textContent = '0';
  }

  function takeFromGPX(){
    const dist = parseFloat(document.getElementById('distM').textContent || '0');
    const dur = parseFloat(document.getElementById('durMin').textContent || '0');
    if(!dist || !dur){ alert('–°–ø–æ—á–∞—Ç–∫—É –æ–±—Ä–æ–±–∏ GPX.'); return; }
    document.getElementById('lenM').value = Math.round(dist);
    document.getElementById('timeMin').value = Math.max(1, Math.round(dur));
    recalc();
  }

  function recalc(){
    const lenM = parseFloat(document.getElementById('lenM').value||'0');
    const timeMin = parseFloat(document.getElementById('timeMin').value||'0');
    const planM = parseFloat(document.getElementById('planM').value||'0');
    const speed = timeMin>0 ? ((lenM/1000)/(timeMin/60)) : 0;
    const dev = Math.round(lenM - planM);
    document.getElementById('calcSpeed').textContent = speed.toFixed(2);
    document.getElementById('calcDev').textContent = (dev>0? '+' : '') + dev;
    const box = document.getElementById('calcBox');
    box.classList.remove('success','danger');
    if(Math.abs(dev) <= planM*0.1){ box.classList.add('success'); } else { box.classList.add('danger'); }
  }

  function genCSV(){
    const date = document.getElementById('date').value || new Date().toISOString().slice(0,10);
    const fieldCode = (document.getElementById('fieldCode').value||'').trim();
    const crop = (document.getElementById('crop').value||'').trim();
    const op = (document.getElementById('op').value||'').trim();
    const lenM = Math.round(parseFloat(document.getElementById('lenM').value||'0'));
    const timeMin = Math.round(parseFloat(document.getElementById('timeMin').value||'0'));
    const speed = parseFloat(document.getElementById('calcSpeed').textContent||'0').toFixed(2);
    const planM = Math.round(parseFloat(document.getElementById('planM').value||'0'));
    const dev = (lenM - planM);
    const comment = (document.getElementById('comment').value||'').trim();

    const fields = [date, fieldCode, crop, op, lenM, timeMin, speed, planM, (dev>0? '+' : '')+dev, comment];
    const line = fields.map(csvEscape).join(' | ');
    document.getElementById('csvOut').textContent = line;
  }

  function csvEscape(v){
    const s = String(v);
    if(/[|",\n]/.test(s)){ return '"' + s.replace(/"/g,'""') + '"'; }
    return s;
  }

  function copyCSV(){
    const t = document.getElementById('csvOut').textContent.trim();
    if(!t || t==='‚Äî'){ alert('–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π —Ä—è–¥–æ–∫.'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'), ()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏'));
  }

  function flash(msg){
    const old = document.title;
    document.title = msg;
    setTimeout(()=>document.title = old, 900);
  }
</script>
</body>
</html>
