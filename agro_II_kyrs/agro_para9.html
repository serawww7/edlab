<!-- agro_para9.html
     –ü–ê–†–ê 9 (–∞—É–¥–∏—Ç–æ—Ä–Ω–æ) –¥–ª—è –∞–≥—Ä–æ–Ω–æ–º—ñ–≤
     –¢–µ–º–∞: –ó–ú–Ü–®–£–í–ê–ù–ù–Ø –î–û–ë–†–ò–í NPK ‚Äî —Ü—ñ–ª—å –ø–æ N‚ÄìP‚ÇÇO‚ÇÖ‚ÄìK‚ÇÇO, –ø—ñ–¥–±—ñ—Ä —Å—É–º—ñ—à—ñ (–¥–æ 3 –ø—Ä–æ–¥—É–∫—Ç—ñ–≤), —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å, –ø–ª–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å, CSV
     –§–æ–∫—É—Å: —Ç–µ–ª–µ—Ñ–æ–Ω–∏/–ü–ö, –ª–æ–∫–∞–ª—å–Ω–æ; –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫. –ö–æ–Ω—Ç—Ä–∞—Å—Ç —Ç–µ–º–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫: —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç.

     –©–æ —î:
     ‚Ä¢ –°–ø–∏—Å–æ–∫ –¥–æ–±—Ä–∏–≤ (—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∏–π): %N, %P‚ÇÇO‚ÇÖ, %K‚ÇÇO, —Ü—ñ–Ω–∞ –≥—Ä–Ω/—Ç.
     ‚Ä¢ –¶—ñ–ª—å kg/ha N‚ÄìP‚ÄìK, –ø–ª–æ—â–∞ –ø–æ–ª—è, –º—ñ—Å—Ç–∫—ñ—Å—Ç—å —Ä–æ–∑–∫–∏–¥–∞—á–∞/—Å—ñ–≤–∞–ª–∫–∏.
     ‚Ä¢ –ü—ñ–¥–±—ñ—Ä —Å—É–º—ñ—à—ñ (–∞–ø—Ä–æ–∫—Å. NNLS): –ø–µ—Ä–µ–±—ñ—Ä x3 —Ç–∞ —Ä–æ–∑–≤‚Äô—è–∑–æ–∫ 2√ó2 –¥–ª—è x1,x2, –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ ‚â•0, maxRate.
     ‚Ä¢ –ü–æ–∫–∞–∑ –≤—ñ–¥—Ö–∏–ª–µ–Ω—å, –≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞, –≤–∞—Ä—Ç—ñ—Å—Ç—å –Ω–∞ –ø–æ–ª–µ, –ø–ª–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å (—Ç–æ–Ω–Ω–∞–∂), CSV-–µ–∫—Å–ø–æ—Ä—Ç.
     ‚Ä¢ –¢–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ (–∫–ª–∞—Å .dark) ‚Äî —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç (—è–∫ –ø—Ä–æ—Å–∏–≤ –≤–∏–∫–ª–∞–¥–∞—á).

     –ì–æ—Ç–æ–≤–æ –¥–ª—è GitHub Pages / –≤—Å—Ç–∞–≤–∫–∏ –≤ Moodle —á–µ—Ä–µ–∑ iFrame.
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 9 ‚Äî –ó–º—ñ—à—É–≤–∞–Ω–Ω—è NPK: —Ü—ñ–ª—å ‚Üí —Å—É–º—ñ—à ‚Üí –≤–∞—Ä—Ç—ñ—Å—Ç—å ‚Üí –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
    --accent:#22c55e; --accent-2:#60a5fa; --warn:#f59e0b; --bad:#ef4444; --good:#10b981; --line:#1f2937;
    --darkcell:#0b1324; --darkink:#e6eef9; --darkink2:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220,#111827 30%,#0b1220);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted); letter-spacing:.3px}
  h1{font-size:34px; margin:6px 0 12px; line-height:1.15;
     background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:28px 0 12px}
  h3{font-size:18px; margin:20px 0 8px; color:#cbd5e1}
  p{margin:10px 0}
  .small{font-size:12px; color:#9fb0c8}
  .muted{color:#93a3b5}
  .pill{display:inline-block; padding:4px 10px; border:1px solid #223049; border-radius:999px; font-size:12px; color:#a5b4fc; background:#0d1a2e; margin-right:6px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:1000px){.g2,.g3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .box{border:1px solid #223049; border-radius:12px; padding:12px; background:var(--darkcell); color:var(--darkink)}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .mono,code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

  .table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto; border-radius:12px; border:1px solid #223049}
  .table th,.table td{padding:8px 10px; border-bottom:1px solid #1f2937; font-size:14px; vertical-align:top}
  .table thead th{background:#0c1629; color:#a5b4fc; text-align:left; position:sticky; top:0}
  .table tbody tr:nth-child(even){background:var(--darkcell); color:var(--darkink2)}
  .table td.dark, .table th.dark{background:var(--darkcell) !important; color:var(--darkink2) !important}
  .table td .tag{display:inline-block; padding:3px 8px; border-radius:999px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; font-size:12px}

  input[type="text"], input[type="number"]{
    width:100%; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e6eef9
  }
  .out{background:var(--darkcell); color:var(--darkink2); border:1px dashed #263042; padding:10px 12px; border-radius:10px; word-break:break-all}

  /* –í–±—É–¥–æ–≤–∞–Ω–æ (iframe) ‚Üí —Å–≤—ñ—Ç–ª–∏–π –≤–∏–≥–ª—è–¥ */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  html.embedded .btn{background:#111827; color:#fff; border-color:#111827}
  html.embedded .box{background:#f8fafc; color:#111}
  html.embedded .table tbody tr:nth-child(even){background:#f3f4f6; color:#111}

  @media print{
    @page{ margin:12mm }
    .no-print{ display:none !important }
  }
</style>
<meta name="description" content="–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –ø—ñ–¥–±–∏—Ä–∞—é—Ç—å —Å—É–º—ñ—à –¥–æ 3 –¥–æ–±—Ä–∏–≤ –ø—ñ–¥ –∑–∞–¥–∞–Ω—É –Ω–æ—Ä–º—É N‚ÄìP‚ÇÇO‚ÇÖ‚ÄìK‚ÇÇO, –∫–≥/–≥–∞ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ü—ñ–Ω–∏ —ñ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å. –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ä–µ—Ü–µ–ø—Ç, –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, —Å–æ"><link rel="canonical" href="https://edlab.pp.ua/agro_II_kyrs/agro_para9.html"><meta property="og:type" content="article"><meta property="og:title" content="üßÆ –ó–º—ñ—à—É–≤–∞–Ω–Ω—è –¥–æ–±—Ä–∏–≤ NPK: —Ü—ñ–ª—å ‚Üí —Å—É–º—ñ—à ‚Üí –≤–∞—Ä—Ç—ñ—Å—Ç—å ‚Üí –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è"><meta property="og:description" content="–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –ø—ñ–¥–±–∏—Ä–∞—é—Ç—å —Å—É–º—ñ—à –¥–æ 3 –¥–æ–±—Ä–∏–≤ –ø—ñ–¥ –∑–∞–¥–∞–Ω—É –Ω–æ—Ä–º—É N‚ÄìP‚ÇÇO‚ÇÖ‚ÄìK‚ÇÇO, –∫–≥/–≥–∞ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ü—ñ–Ω–∏ —ñ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å. –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ä–µ—Ü–µ–ø—Ç, –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, —Å–æ"><meta property="og:url" content="https://edlab.pp.ua/agro_II_kyrs/agro_para9.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üßÆ –ó–º—ñ—à—É–≤–∞–Ω–Ω—è –¥–æ–±—Ä–∏–≤ NPK: —Ü—ñ–ª—å ‚Üí —Å—É–º—ñ—à ‚Üí –≤–∞—Ä—Ç—ñ—Å—Ç—å ‚Üí –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è","description":"–ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –ø—ñ–¥–±–∏—Ä–∞—é—Ç—å —Å—É–º—ñ—à –¥–æ 3 –¥–æ–±—Ä–∏–≤ –ø—ñ–¥ –∑–∞–¥–∞–Ω—É –Ω–æ—Ä–º—É N‚ÄìP‚ÇÇO‚ÇÖ‚ÄìK‚ÇÇO, –∫–≥/–≥–∞ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ü—ñ–Ω–∏ —ñ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å. –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ä–µ—Ü–µ–ø—Ç, –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, —Å–æ","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/agro_II_kyrs/agro_para9.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
  <div class="wrap">
    <span class="badge">–ü–∞—Ä–∞ 9 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ ¬∑ –∞–≥—Ä–æ–Ω–æ–º–∏</span>
    <h1>üßÆ –ó–º—ñ—à—É–≤–∞–Ω–Ω—è –¥–æ–±—Ä–∏–≤ NPK: —Ü—ñ–ª—å ‚Üí —Å—É–º—ñ—à ‚Üí –≤–∞—Ä—Ç—ñ—Å—Ç—å ‚Üí –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>
        –ó–∞ –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–∏ –ø—ñ–¥–±–∏—Ä–∞—é—Ç—å <b>—Å—É–º—ñ—à –¥–æ 3 –¥–æ–±—Ä–∏–≤</b> –ø—ñ–¥ –∑–∞–¥–∞–Ω—É –Ω–æ—Ä–º—É <b>N‚ÄìP‚ÇÇO‚ÇÖ‚ÄìK‚ÇÇO, –∫–≥/–≥–∞</b> –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ü—ñ–Ω–∏ —ñ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å.
        –†–µ–∑—É–ª—å—Ç–∞—Ç: <b>—Ä–µ—Ü–µ–ø—Ç, –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞</b>, –ø–ª–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å –¥–ª—è —É—Å—å–æ–≥–æ –ø–æ–ª—è —Ç–∞ <b>CSV</b> –¥–ª—è Sheets.
      </p>
      <p class="small">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: –ø—Ä–æ—Å—Ç–∏–π –ø–æ—à—É–∫ –ø—Ä–∏–π–Ω—è—Ç–Ω–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è (x‚â•0) —ñ–∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é —Å—É–º–æ—é –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∏—Ö –≤—ñ–¥—Ö–∏–ª–µ–Ω—å –ø–æ N,P,K –∑ –∫—Ä–æ–∫–æ–º –¥–ª—è —Ç—Ä–µ—Ç—å–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É.</p>
    </div>

    <!-- –¶–Ü–õ–Ü + –ü–ê–†–ê–ú–ï–¢–†–ò –ü–û–õ–Ø -->
    <div class="card">
      <h2>üéØ –¶—ñ–ª—ñ –≤–Ω–µ—Å–µ–Ω–Ω—è —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–æ–ª—è</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–¶—ñ–ª—å (–∫–≥ –¥—ñ—é—á–æ—ó —Ä–µ—á–æ–≤–∏–Ω–∏ / –≥–∞)</h3>
          <div class="row">
            <div style="flex:1"><label>N</label><input id="tN" type="number" step="1" value="90"></div>
            <div style="flex:1"><label>P‚ÇÇO‚ÇÖ</label><input id="tP" type="number" step="1" value="60"></div>
            <div style="flex:1"><label>K‚ÇÇO</label><input id="tK" type="number" step="1" value="60"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–î–æ–ø—É—Å—Ç–∏–º–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è, %</label><input id="tol" type="number" step="1" value="7"></div>
            <div style="flex:1"><label>–ú–∞–∫—Å —Å—É–º—ñ—à, –∫–≥/–≥–∞</label><input id="maxRate" type="number" step="1" value="500"></div>
          </div>
        </div>

        <div class="box">
          <h3>–ü–æ–ª–µ —Ç–∞ –ª–æ–≥—ñ—Å—Ç–∏–∫–∞</h3>
          <div class="row">
            <div style="flex:1"><label>–ö–æ–¥ –ø–æ–ª—è</label><input id="fieldCode" type="text" value="F-01"></div>
            <div style="flex:1"><label>–ü–ª–æ—â–∞, –≥–∞</label><input id="area" type="number" step="0.01" value="25"></div>
          </div>
          <div class="row" style="margin-top:6px">
            <div style="flex:1"><label>–ú—ñ—Å—Ç–∫—ñ—Å—Ç—å –±—É–Ω–∫–µ—Ä–∞/—Ä–æ–∑–∫–∏–¥–∞—á–∞, –∫–≥</label><input id="hopper" type="number" step="10" value="3000"></div>
            <div style="flex:1"><label>–ö—Ä–æ–∫ x‚ÇÉ (–∫–≥/–≥–∞) –¥–ª—è –ø–æ—à—É–∫—É</label><input id="step3" type="number" step="1" value="5"></div>
          </div>
        </div>

        <div class="box">
          <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
          <div class="row">
            <button class="btn" onclick="solve()">üîÅ –ü—ñ–¥—ñ–±—Ä–∞—Ç–∏ —Å—É–º—ñ—à</button>
            <button class="btn" onclick="addFert()">‚ûï –î–æ–¥–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç</button>
            <button class="btn" onclick="preset()">üß™ –ü—Ä–∏–∫–ª–∞–¥</button>
          </div>
          <p class="small">–ü–æ—Ä–∞–¥–∞: –¥–ª—è —Å—Ç–∞—Ä—Ç—É —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Å—è ¬´–ü—Ä–∏–∫–ª–∞–¥¬ª (—Å–µ—á–æ–≤–∏–Ω–∞ + DAP + MOP).</p>
        </div>
      </div>
    </div>

    <!-- –¢–ê–ë–õ–ò–¶–Ø –î–û–ë–†–ò–í -->
    <div class="card">
      <h2>üß± –ü–µ—Ä–µ–ª—ñ–∫ –¥–æ–±—Ä–∏–≤ (—Ä–µ–¥–∞–≥—É–π –∑–∞ –ø–æ—Ç—Ä–µ–±–∏)</h2>
      <div class="small muted">–§–æ—Ä–º–∞—Ç: –ù–∞–∑–≤–∞ | %N | %P‚ÇÇO‚ÇÖ | %K‚ÇÇO | –¶—ñ–Ω–∞, –≥—Ä–Ω/—Ç</div>
      <div style="overflow:auto; margin-top:8px">
        <table class="table" id="fertTbl">
          <thead>
            <tr>
              <th>#</th><th>–ù–∞–∑–≤–∞</th><th>%N</th><th>%P‚ÇÇO‚ÇÖ</th><th>%K‚ÇÇO</th><th>–¶—ñ–Ω–∞, –≥—Ä–Ω/—Ç</th><th>–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏?</th>
            </tr>
          </thead>
          <tbody id="fertBody">
            <!-- –Ω–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–ò -->
    <div class="card">
      <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—ñ–¥–±–æ—Ä—É</h2>
      <div class="grid g3">
        <div class="box">
          <h3>–†–µ—Ü–µ–ø—Ç (–∫–≥/–≥–∞)</h3>
          <div id="recipe" class="out">‚Äî</div>
          <p class="small">–°—É–º—ñ—à: <span id="sumMix" class="mono">‚Äî</span> –∫–≥/–≥–∞</p>
          <p class="small">–ü–æ–∂–∏–≤–Ω—ñ –∑ —Å—É–º—ñ—à—ñ: <span id="achieved" class="mono">‚Äî</span> (N | P‚ÇÇO‚ÇÖ | K‚ÇÇO)</p>
          <p class="small">–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è: <span id="devi" class="mono">‚Äî</span> %</p>
        </div>
        <div class="box">
          <h3>–ï–∫–æ–Ω–æ–º—ñ–∫–∞</h3>
          <p><b>–í–∞—Ä—Ç—ñ—Å—Ç—å —Å—É–º—ñ—à—ñ</b>: <span id="costHa" class="mono">‚Äî</span> –≥—Ä–Ω/–≥–∞</p>
          <p><b>–ù–∞ –ø–æ–ª–µ (<span id="areaShow">‚Äî</span> –≥–∞)</b>: <span id="costField" class="mono">‚Äî</span> –≥—Ä–Ω</p>
          <p><b>–¶—ñ–Ω–∞ 1 –∫–≥ N/P‚ÇÇO‚ÇÖ/K‚ÇÇO</b> (–∑ —Å—É–º—ñ—à—ñ): <span id="cpu" class="mono">‚Äî</span> –≥—Ä–Ω/–∫–≥ N | P | K</p>
        </div>
        <div class="box">
          <h3>–ü–ª–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å</h3>
          <p>–†–∞–∑–æ–º –º–∞—Å–∞ —Å—É–º—ñ—à—ñ –Ω–∞ –ø–æ–ª–µ: <b><span id="massField">‚Äî</span> –∫–≥</b></p>
          <p>–ú—ñ—Å—Ç–∫—ñ—Å—Ç—å –±—É–Ω–∫–µ—Ä–∞: <span id="hopShow">‚Äî</span> –∫–≥ ‚Üí <b><span id="loads">‚Äî</span> –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å</b></p>
          <div id="loadsPlan" class="out" style="margin-top:6px">‚Äî</div>
        </div>
      </div>

      <div class="grid g2" style="margin-top:12px">
        <div class="box">
          <h3>üìÑ CSV ‚Äî —Ä–µ—Ü–µ–ø—Ç (–∫–≥/–≥–∞, —Ü—ñ–Ω–∞)</h3>
          <div id="csv1" class="out">‚Äî</div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="copyEl('csv1')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
        </div>
        <div class="box">
          <h3>üìÑ CSV ‚Äî —Ç–æ–Ω–Ω–∞–∂ –Ω–∞ –ø–æ–ª–µ</h3>
          <div id="csv2" class="out">‚Äî</div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="copyEl('csv2')">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
        </div>
      </div>
      <p class="small muted">–ö–æ–Ω—Ç—Ä–∞—Å—Ç: —Ç–µ–º–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ (–∫–ª–∞—Å <span class="mono">.dark</span>) —Ç–∞ –ø–∞—Ä–Ω—ñ —Ä—è–¥–∫–∏ —Ç–∞–±–ª–∏—Ü—å –º–∞—é—Ç—å —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç.</p>
    </div>

    <!-- –•–Ü–î –†–û–ë–û–¢–ò, –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø -->
    <div class="card">
      <h2>ü™ú –•—ñ–¥ —Ä–æ–±–æ—Ç–∏ (45‚Äì70 —Ö–≤)</h2>
      <ol>
        <li>–ó–∞–ø–æ–≤–Ω–∏ —Ü—ñ–ª—ñ N‚ÄìP‚ÄìK, –ø–ª–æ—â—É, –º—ñ—Å—Ç–∫—ñ—Å—Ç—å –±—É–Ω–∫–µ—Ä–∞ —Ç–∞ —Ç–∞–±–ª–∏—Ü—é –¥–æ–±—Ä–∏–≤ (–∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–∏–∫–ª–∞–¥¬ª).</li>
        <li>–í—ñ–¥–º—ñ—Ç—å –≥–∞–ª–æ—á–∫–æ—é 2‚Äì3 –ø—Ä–æ–¥—É–∫—Ç–∏, —è–∫–∏–º–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—å, —Ç–∞ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ü—ñ–¥—ñ–±—Ä–∞—Ç–∏ —Å—É–º—ñ—à¬ª.</li>
        <li>–ü–µ—Ä–µ–≤—ñ—Ä –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ —Ü—ñ–ª—ñ —Ç–∞ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å. –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –∑–º—ñ–Ω—é–π –Ω–∞–±—ñ—Ä –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∞–±–æ —Ü—ñ–ª—å/–¥–æ–ø—É—Å–∫.</li>
        <li>–°–∫–æ–ø—ñ—é–π CSV —É Google Sheets: ¬´Recipe¬ª —Ç–∞ ¬´FieldLoads¬ª, –ø–æ–±—É–¥—É–π –¥—ñ–∞–≥—Ä–∞–º—É —Ü—ñ–Ω–∏/–≥–∞ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ä–µ—Ü–µ–ø—Ç—ñ–≤.</li>
      </ol>
    </div>

    <div class="card">
      <h2>‚úÖ –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è (10 –±–∞–ª—ñ–≤)</h2>
      <table class="table">
        <thead><tr><th>–ö—Ä–∏—Ç–µ—Ä—ñ–π</th><th>–ë–∞–ª–∏</th></tr></thead>
        <tbody>
          <tr><td>–ö–æ—Ä–µ–∫—Ç–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç (–≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –¥–æ–ø—É—Å–∫—É) —Ç–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–∞—Å</td><td>4</td></tr>
          <tr><td>–ï–∫–æ–Ω–æ–º—ñ–∫–∞: –≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞, –≤–∞—Ä—Ç—ñ—Å—Ç—å –Ω–∞ –ø–æ–ª–µ, —Ü—ñ–Ω–∞ 1 –∫–≥ N/P/K</td><td>3</td></tr>
          <tr><td>–ü–ª–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ, CSV –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É Sheets</td><td>2</td></tr>
          <tr><td>–ö–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏ (—â–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Ü—ñ–Ω—É —Ç–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è)</td><td>1</td></tr>
        </tbody>
      </table>
      <p class="pill">üßÆ –õ—ñ–Ω—ñ–π–Ω—ñ —Å—É–º—ñ—à—ñ</p><p class="pill">üí∏ –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞</p><p class="pill">üöö –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</p><p class="pill">üìä CSV ‚Üí Sheets</p>
    </div>
  </div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle iFrame)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  const fertBody = document.getElementById('fertBody');

  function addFertRow(f){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="idx">1</td>
      <td><input type="text" value="${f.name}"></td>
      <td><input type="number" step="0.1" value="${f.N}"></td>
      <td><input type="number" step="0.1" value="${f.P}"></td>
      <td><input type="number" step="0.1" value="${f.K}"></td>
      <td><input type="number" step="1" value="${f.price}"></td>
      <td style="text-align:center"><input type="checkbox" ${f.use?'checked':''}></td>
    `;
    fertBody.appendChild(tr);
    reindexF();
  }
  function reindexF(){ [...fertBody.querySelectorAll('tr')].forEach((tr,i)=>tr.querySelector('.idx').textContent=i+1); }

  function readFerts(){
    const rows = [...fertBody.querySelectorAll('tr')];
    return rows.map(tr=>{
      return {
        name: tr.children[1].querySelector('input').value.trim(),
        N: parseFloat(tr.children[2].querySelector('input').value||'0'),
        P: parseFloat(tr.children[3].querySelector('input').value||'0'),
        K: parseFloat(tr.children[4].querySelector('input').value||'0'),
        price: parseFloat(tr.children[5].querySelector('input').value||'0'),
        use: tr.children[6].querySelector('input').checked,
        _tr: tr
      };
    });
  }

  function addFert(){
    addFertRow({name:'NPK 16-16-16',N:16,P:16,K:16,price:19000,use:true});
  }

  function preset(){
    fertBody.innerHTML='';
    addFertRow({name:'–°–µ—á–æ–≤–∏–Ω–∞ (46-0-0)',N:46,P:0,K:0,price:22000,use:true});
    addFertRow({name:'–î–ê–§ (18-46-0)',N:18,P:46,K:0,price:26000,use=true});
    addFertRow({name:'MOP –ö–∞–ª—ñ–π —Ö–ª–æ—Ä–∏—Å—Ç–∏–π (0-0-60)',N:0,P:0,K:60,price:18000,use=true});
    addFertRow({name:'–ê–º—ñ–∞—á–Ω–∞ —Å–µ–ª—ñ—Ç—Ä–∞ (34-0-0)',N:34,P:0,K:0,price:21000,use:false});
    addFertRow({name:'MAP (11-52-0)',N:11,P:52,K:0,price:27000,use:false});
  }

  function solve(){
    const tN = num('tN'), tP = num('tP'), tK = num('tK');
    const tol = num('tol'); // %
    const maxRate = num('maxRate'); // –∫–≥/–≥–∞
    const step3 = Math.max(1, num('step3'));

    const ferts = readFerts().filter(f=>f.use);
    if(ferts.length<2){ alert('–í—ñ–¥–º—ñ—Ç—å —â–æ–Ω–∞–π–º–µ–Ω—à–µ –î–í–ê –ø—Ä–æ–¥—É–∫—Ç–∏ –¥–ª—è –ø—ñ–¥–±–æ—Ä—É.'); return; }
    if(ferts.length>3){ alert('–î–ª—è —Ü—ñ—î—ó –ø–∞—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π –¥–æ 3 –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (–≤—ñ–¥–º—ñ—Ç—å –º–∞–∫—Å–∏–º—É–º —Ç—Ä–∏).'); return; }

    // –Ø–∫—â–æ —Ä—ñ–≤–Ω–æ 2 –ø—Ä–æ–¥—É–∫—Ç–∏ ‚Äî —Ä–æ–∑–≤ º—è–∑—É—î–º–æ –ø–æ –¥–≤–æ—Ö –Ω—É—Ç—Ä—ñ—î–Ω—Ç–∞—Ö (N —ñ P), K –∫–æ–Ω—Ç—Ä–æ–ª—é—î–º–æ —è–∫ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è.
    // –Ø–∫—â–æ 3 –ø—Ä–æ–¥—É–∫—Ç–∏ ‚Äî –ø–µ—Ä–µ–±–∏—Ä–∞—î–º–æ x3 –∑ –∫—Ä–æ–∫–æ–º —ñ —Ä–æ–∑–≤ º—è–∑—É—î–º–æ 2√ó2 –¥–ª—è x1,x2.
    let best=null;

    if(ferts.length===2){
      const [A,B] = ferts;
      // –≤–∏–±–µ—Ä–µ–º–æ –¥–≤—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è: N —Ç–∞ P (—è–∫—â–æ P –æ–±–æ—Ö 0, –±–µ—Ä–µ–º–æ K)
      let M=[[A.N/100, B.N/100],[A.P/100, B.P/100]], b=[tN, tP], useK=false;
      if(A.P===0 && B.P===0){ M=[[A.N/100,B.N/100],[A.K/100,B.K/100]]; b=[tN,tK]; useK=true; }

      const sol = solve2(M,b);
      if(sol){
        const [x1,x2] = sol;
        if(x1>=0 && x2>=0 && x1+x2<=maxRate){
          const n = x1*A.N/100 + x2*B.N/100;
          const p = x1*A.P/100 + x2*B.P/100;
          const k = x1*A.K/100 + x2*B.K/100;
          const devN = pctDev(n,tN), devP=pctDev(p,tP), devK=pctDev(k,tK);
          const ok = Math.abs(devN)<=tol && Math.abs(devP)<=tol && Math.abs(devK)<=tol;
          const score = devN*devN + devP*devP + devK*devK + (ok?0:1000);
          best = {x:[x1,x2,0], ferts:[A,B], n,p,k, dev:[devN,devP,devK], score};
        }
      }
    } else {
      const [A,B,C] = ferts;
      for(let x3=0; x3<=maxRate; x3+=step3){
        // –†—ñ–≤–Ω—è–Ω–Ω—è: [N,P] –¥–ª—è x1,x2 –∑ –ø–æ–ø—Ä–∞–≤–∫–æ—é –Ω–∞ –≤–Ω–µ—Å–æ–∫ x3
        const bN = tN - x3*C.N/100;
        const bP = tP - x3*C.P/100;
        const M=[[A.N/100, B.N/100],[A.P/100, B.P/100]], b=[bN,bP];

        const sol = solve2(M,b);
        if(!sol) continue;
        const [x1,x2]=sol;
        if(x1<0||x2<0) continue;
        if(x1+x2+x3>maxRate) continue;

        const n = x1*A.N/100 + x2*B.N/100 + x3*C.N/100;
        const p = x1*A.P/100 + x2*B.P/100 + x3*C.P/100;
        const k = x1*A.K/100 + x2*B.K/100 + x3*C.K/100;

        const devN = pctDev(n,tN), devP=pctDev(p,tP), devK=pctDev(k,tK);
        const ok = Math.abs(devN)<=tol && Math.abs(devP)<=tol && Math.abs(devK)<=tol;
        const score = devN*devN + devP*devP + devK*devK + (ok?0:1000) + (x1+x2+x3)/10000; // –ª–µ–≥–∫–∏–π –ø—Ä—ñ–æ—Ä. –º–µ–Ω—à–∏—Ö —Å—É–º—ñ—à–µ–π
        if(!best || score<best.score){
          best = {x:[x1,x2,x3], ferts:[A,B,C], n,p,k, dev:[devN,devP,devK], score};
        }
      }
    }

    if(!best){
      show('recipe','‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø—Ä–∏–π–Ω—è—Ç–Ω–æ—ó —Å—É–º—ñ—à—ñ. –°–ø—Ä–æ–±—É–π ‚Üë –¥–æ–ø—É—Å–∫, ‚Üë maxRate –∞–±–æ —ñ–Ω—à—ñ –ø—Ä–æ–¥—É–∫—Ç–∏.');
      document.getElementById('achieved').textContent='‚Äî';
      document.getElementById('devi').textContent='‚Äî';
      document.getElementById('sumMix').textContent='‚Äî';
      document.getElementById('costHa').textContent='‚Äî';
      document.getElementById('costField').textContent='‚Äî';
      document.getElementById('cpu').textContent='‚Äî';
      document.getElementById('massField').textContent='‚Äî';
      document.getElementById('loads').textContent='‚Äî';
      document.getElementById('loadsPlan').textContent='‚Äî';
      document.getElementById('csv1').textContent='‚Äî';
      document.getElementById('csv2').textContent='‚Äî';
      return;
    }

    const x = best.x.map(v=>round(v,1));
    const names = best.ferts.map(f=>f.name);
    const recipeLines = x.map((v,i)=>`${names[i]||('Dob—Ä–∏–≤–æ '+(i+1))}: ${v} –∫–≥/–≥–∞`);
    show('recipe', recipeLines.join('\n'));
    const sumMix = x.reduce((a,b)=>a+b,0);
    byId('sumMix').textContent = round(sumMix,1);

    byId('achieved').textContent = `${round(best.n,1)} | ${round(best.p,1)} | ${round(best.k,1)} –∫–≥/–≥–∞`;
    const devs = best.dev.map(d=>round(d,1));
    byId('devi').textContent = `${fmtDev(devs[0])} | ${fmtDev(devs[1])} | ${fmtDev(devs[2])}`;

    // –ï–∫–æ–Ω–æ–º—ñ–∫–∞
    const prices = best.ferts.map(f=>f.price);
    const costPerHa = x.reduce((s,v,i)=>s + (v/1000)*prices[i], 0);
    byId('costHa').textContent = round(costPerHa,0).toLocaleString('uk-UA');

    const area = num('area'); byId('areaShow').textContent = area;
    const costField = costPerHa * area;
    byId('costField').textContent = round(costField,0).toLocaleString('uk-UA');

    // –¶—ñ–Ω–∞ –∑–∞ –∫–≥ –¥—ñ—é—á–æ—ó —Ä–µ—á–æ–≤–∏–Ω–∏ —É —Å—É–º—ñ—à—ñ (–æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–æ; —è–∫—â–æ –Ω—É–ª—å ‚Äî ¬´‚Äî¬ª)
    const cN = best.n>0 ? costPerHa/best.n : 0;
    const cP = best.p>0 ? costPerHa/best.p : 0;
    const cK = best.k>0 ? costPerHa/best.k : 0;
    byId('cpu').textContent = `${cN?round(cN,1):'‚Äî'} | ${cP?round(cP,1):'‚Äî'} | ${cK?round(cK,1):'‚Äî'}`;

    // –ü–ª–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å
    const massField = sumMix * area; byId('massField').textContent = round(massField,0).toLocaleString('uk-UA');
    const hopper = num('hopper'); byId('hopShow').textContent = hopper.toLocaleString('uk-UA');
    const loads = Math.max(1, Math.ceil(massField / hopper));
    byId('loads').textContent = loads;

    const tonsPerFert = x.map(v=>v*area/1000); // —Ç –Ω–∞ –ø–æ–ª–µ
    const loadsPlan = tonsPerFert.map((t,i)=>`${names[i]}: ${round(t,2)} —Ç`).join('\n');
    byId('loadsPlan').textContent = loadsPlan;

    // CSV
    const csv1 = [
      ['–ü–æ–ª–µ', '–ü–ª–æ—â–∞,–≥–∞', '–ü—Ä–æ–¥—É–∫—Ç', '–∫–≥/–≥–∞', '–¶—ñ–Ω–∞,–≥—Ä–Ω/—Ç', '–í–∞—Ä—Ç—ñ—Å—Ç—å/–≥–∞,–≥—Ä–Ω'].join(' | ')
    ].concat(
      x.map((v,i)=>[val('fieldCode'), area, names[i], round(v,1), prices[i], round((v/1000)*prices[i],0)].join(' | '))
    ).concat([
      ['–†–∞–∑–æ–º, –∫–≥/–≥–∞', round(sumMix,1)].join(' | '),
      ['–î–æ—Å—è–≥–Ω—É—Ç–æ N | P‚ÇÇO‚ÇÖ | K‚ÇÇO', `${round(best.n,1)} | ${round(best.p,1)} | ${round(best.k,1)}`].join(' | '),
      ['–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è N | P‚ÇÇO‚ÇÖ | K‚ÇÇO, %', `${fmtDev(devs[0])} | ${fmtDev(devs[1])} | ${fmtDev(devs[2])}`].join(' | '),
      ['–í–∞—Ä—Ç—ñ—Å—Ç—å —Å—É–º—ñ—à—ñ, –≥—Ä–Ω/–≥–∞', round(costPerHa,0)].join(' | ')
    ]).join('\n');
    byId('csv1').textContent = csv1;

    const csv2 = [
      ['–ü–æ–ª–µ', '–ü–ª–æ—â–∞,–≥–∞', '–ü—Ä–æ–¥—É–∫—Ç', '–¢–æ–Ω–Ω–∞–∂,—Ç'].join(' | ')
    ].concat(
      tonsPerFert.map((t,i)=>[val('fieldCode'), area, names[i], round(t,2)].join(' | '))
    ).concat([
      ['–†–∞–∑–æ–º —Å—É–º—ñ—à, —Ç', round(massField/1000,2)].join(' | '),
      ['–ú—ñ—Å—Ç–∫—ñ—Å—Ç—å –±—É–Ω–∫–µ—Ä–∞, –∫–≥', hopper].join(' | '),
      ['–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å (‚âà)', loads].join(' | ')
    ]).join('\n');
    byId('csv2').textContent = csv2;
  }

  // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
  function solve2(M,b){
    // M 2x2, b 2x1 ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î [x1,x2] –∞–±–æ null
    const a=M[0][0], c=M[0][1], d=M[1][0], e=M[1][1];
    const det = a*e - c*d;
    if(Math.abs(det)<1e-9) return null;
    const x1 = ( b[0]*e - c*b[1] )/det;
    const x2 = ( a*b[1] - b[0]*d )/det;
    return [x1,x2];
  }
  function pctDev(val,target){ if(target===0) return 0; return (val-target)/target*100; }
  function round(n,d=1){ return Number((+n).toFixed(d)); }
  function num(id){ return parseFloat((document.getElementById(id).value||'').replace(',','.'))||0; }
  function val(id){ return (document.getElementById(id).value||'').trim(); }
  function byId(id){ return document.getElementById(id); }
  function show(id,txt){ byId(id).textContent = txt; }
  function fmtDev(d){ const s= (d>=0?'+':'')+d.toFixed(1); return s; }
  function copyEl(id){
    const t = byId(id).textContent.trim(); if(!t||t==='‚Äî'){ alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'); return; }
    navigator.clipboard.writeText(t).then(()=>flash('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),()=>flash('–ù–µ –≤–¥–∞–ª–æ—Å—è'));
  }
  function flash(msg){ const o=document.title; document.title=msg; setTimeout(()=>document.title=o,900); }

  // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ
  preset();
  solve();
</script>


</body></html>