<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 19 ‚Äî Arduino: CO‚ÇÇ —É —Ç–µ–ø–ª–∏—Ü—ñ (MH-Z19B UART) + –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—è</title>
<meta name="description" content="–ó–Ω—ñ–º–∞—î–º–æ CO‚ÇÇ —ñ–∑ MH-Z19B –ø–æ UART (–±–µ–∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫), –∑–≥–ª–∞–¥–∂—É—î–º–æ, –∑–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å, –∫–µ—Ä—É—î–º–æ —Ä–µ–ª–µ –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—ó/—Ñ—Ä–∞–º—É–≥–∏ –∑–∞ –ø–æ—Ä–æ–≥–∞–º–∏, –±—É–¥—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫, –µ–∫—Å–ø–æ—Ä—Ç—É—î–º–æ CSV/TXT. –Ñ –µ–º—É–ª—å CO‚ÇÇ —ñ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏ –ø—ñ–¥ —Ç–≤–æ—ó –ø—ñ–Ω–∏ —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
small.mono,.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Courier New",monospace}
.grid{display:grid;gap:14px;grid-template-columns:1.2fr 1fr}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
hr.sep{border:none;border-top:1px solid var(--line);margin:16px 0}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
svg{max-width:100%;height:auto;display:block}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:260px}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
.badgeCO2{display:inline-block;border:1px solid #334155;border-radius:999px;padding:2px 8px}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
</style>
<link rel="canonical" href="https://edlab.pp.ua/agro_II_kyrs/agro_para19.html"><meta property="og:type" content="article"><meta property="og:title" content="–ê–≥—Ä–æ–Ω–æ–º—ñ—è ‚Äî –ü–∞—Ä–∞ 19"><meta property="og:description" content="–ú–µ—Ç–∞: –ø—ñ–¥‚Äô—î–¥–Ω–∞—Ç–∏ MH-Z19B –¥–æ Arduino —á–µ—Ä–µ–∑ UART, –∑—á–∏—Ç—É–≤–∞—Ç–∏ CO‚ÇÇ (ppm), –∑–≥–ª–∞–¥–∂—É–≤–∞—Ç–∏ EMA, –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—î—é/—Ñ—Ä–∞–º—É–≥–æ—é –∑–∞ –ø–æ—Ä–æ–≥–∞–º–∏ –∑ –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å–æ–º —ñ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏"><meta property="og:url" content="https://edlab.pp.ua/agro_II_kyrs/agro_para19.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ê–≥—Ä–æ–Ω–æ–º—ñ—è ‚Äî –ü–∞—Ä–∞ 19","description":"–ú–µ—Ç–∞: –ø—ñ–¥‚Äô—î–¥–Ω–∞—Ç–∏ MH-Z19B –¥–æ Arduino —á–µ—Ä–µ–∑ UART, –∑—á–∏—Ç—É–≤–∞—Ç–∏ CO‚ÇÇ (ppm), –∑–≥–ª–∞–¥–∂—É–≤–∞—Ç–∏ EMA, –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—î—é/—Ñ—Ä–∞–º—É–≥–æ—é –∑–∞ –ø–æ—Ä–æ–≥–∞–º–∏ –∑ –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å–æ–º —ñ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/agro_II_kyrs/agro_para19.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">ü´Å</span>
      <div>
        <b>–ü–∞—Ä–∞ 19 ‚Äî CO‚ÇÇ —É —Ç–µ–ø–ª–∏—Ü—ñ: MH-Z19B (UART) + –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—è</b><br>
        <span class="badge">–ü–æ—Ä–æ–≥–æ–≤–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∑ –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å–æ–º ¬∑ EMA-–∑–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è ¬∑ –ª–æ–≥/–µ–∫—Å–ø–æ—Ä—Ç</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">
    –ú–µ—Ç–∞: –ø—ñ–¥‚Äô—î–¥–Ω–∞—Ç–∏ <b>MH-Z19B</b> –¥–æ Arduino —á–µ—Ä–µ–∑ UART, –∑—á–∏—Ç—É–≤–∞—Ç–∏ <b>CO‚ÇÇ (ppm)</b>, –∑–≥–ª–∞–¥–∂—É–≤–∞—Ç–∏ <b>EMA</b>, –∫–µ—Ä—É–≤–∞—Ç–∏ <b>–≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—î—é/—Ñ—Ä–∞–º—É–≥–æ—é</b> –∑–∞ –ø–æ—Ä–æ–≥–∞–º–∏ –∑ –≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å–æ–º —ñ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º —á–∞—Å–æ–º —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è, –±—É–¥—É–≤–∞—Ç–∏ –∂–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫ —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ. –Ñ <b>–µ–º—É–ª—è—Ç–æ—Ä CO‚ÇÇ</b> —ñ <b>–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏</b> –ø—ñ–¥ –≤–∏–±—Ä–∞–Ω—ñ –ø—ñ–Ω–∏ —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.
  </p>

  <div class="grid">
    <!-- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê: –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è/–≥—Ä–∞—Ñ—ñ–∫/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä -->
    <div class="card">
      <h2>üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å</h2>
      <div class="row">
        <div style="flex:1">
          <label for="period">–ü–µ—Ä—ñ–æ–¥ –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è, –º—Å</label>
          <input id="period" class="input" type="number" min="1000" step="500" value="2000">
        </div>
        <div style="flex:1">
          <label for="alpha">EMA –∑–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è Œ± (0..1)</label>
          <input id="alpha" class="input" type="number" min="0" max="1" step="0.05" value="0.2">
        </div>
      </div>

      <h3 style="margin-top:12px">üå™Ô∏è –ö–µ—Ä—É–≤–∞–Ω–Ω—è –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—î—é</h3>
      <div class="row">
        <div style="flex:1">
          <label for="relayPin">–ü—ñ–Ω —Ä–µ–ª–µ</label>
          <select id="relayPin" class="input">
            <option value="8" selected="">D8</option><option value="7">D7</option>
            <option value="6">D6</option><option value="5">D5</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="thrOn">–ü–æ—Ä—ñ–≥ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è (ppm)</label>
          <input id="thrOn" class="input" type="number" step="50" value="900">
        </div>
        <div style="flex:1">
          <label for="thrOff">–ü–æ—Ä—ñ–≥ –≤–∏–º–∫–Ω–µ–Ω–Ω—è (ppm)</label>
          <input id="thrOff" class="input" type="number" step="50" value="700">
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label for="minOn">–ú—ñ–Ω. —á–∞—Å —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è, —Å</label>
          <input id="minOn" class="input" type="number" step="5" value="30">
        </div>
        <div style="flex:1">
          <label for="safeMax">–ê–≤–∞—Ä—ñ–π–Ω–∏–π –º–∞–∫—Å–∏–º—É–º, ppm</label>
          <input id="safeMax" class="input" type="number" step="50" value="2000">
        </div>
      </div>
      <div class="row" style="gap:14px">
        <span id="co2Badge" class="badgeCO2">CO‚ÇÇ(EMA) = ‚Äî ppm</span>
        <span class="muted">–ì—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å: <span class="mono">ON ‚â• thrOn</span>, <span class="mono">OFF ‚â§ thrOff</span>, <span class="mono">minOn</span> ‚Äî –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ ¬´–¥—å–æ—Ä–≥–∞–Ω–Ω—è¬ª.</span>
      </div>

      <h3 style="margin-top:12px">üß™ –ï–º—É–ª—è—Ç–æ—Ä CO‚ÇÇ</h3>
      <div class="row">
        <input id="emu" type="checkbox"><label for="emu">–£–≤—ñ–º–∫–Ω—É—Ç–∏ –µ–º—É–ª—è—Ç–æ—Ä</label>
      </div>
      <div class="row" style="width:100%">
        <label style="flex:1">CO‚ÇÇ, ppm
          <input id="emuCO2" class="input" type="range" min="400" max="3000" step="10" value="850" disabled="">
        </label>
        <label style="flex:1">–°—Ç–∞–Ω —Ä–µ–ª–µ (—ñ–º—ñ—Ç–∞—Ü—ñ—è)
          <select id="emuRelay" class="input" disabled="">
            <option value="0" selected="">–í–∏–º–∫–Ω–µ–Ω–æ</option>
            <option value="1">–£–≤—ñ–º–∫–Ω–µ–Ω–æ</option>
          </select>
        </label>
      </div>

      <h3 style="margin-top:12px">üìà –ñ–∏–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫</h3>
      <div class="canvasWrap"><canvas id="chart" width="900" height="260"></canvas></div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="tick">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ—á–∫—É</button>
        <button class="btn secondary" id="clear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
        <span class="muted mono" id="lastVal">CO‚ÇÇ=‚Äî ppm, EMA=‚Äî ppm, Relay=0</span>
      </div>

      <h3 style="margin-top:12px">üß© –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥ (Arduino .ino)</h3>
      <div class="row">
        <div style="flex:1">
          <label for="rxPin">RX (Arduino —á–∏—Ç–∞—î)</label>
          <select id="rxPin" class="input">
            <option value="10">D10</option><option value="11" selected="">D11</option>
            <option value="12">D12</option><option value="13">D13</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="txPin">TX (Arduino –ø–µ—Ä–µ–¥–∞—î)</label>
          <select id="txPin" class="input">
            <option value="9">D9</option><option value="8" selected="">D8</option>
            <option value="7">D7</option><option value="6">D6</option>
          </select>
        </div>
      </div>
      <div class="row">
        <button class="btn good" id="gen">‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É</button>
        <button class="btn secondary" id="copy">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        <button class="btn secondary" id="dl">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .ino</button>
      </div>
      <pre class="code"><code id="code">// –ù–∞—Ç–∏—Å–Ω–∏ ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É¬ª ‚Üë</code></pre>

      <h3 style="margin-top:12px">üíæ –ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –∑–≤—ñ—Ç—É</h3>
      <div class="row">
        <input id="fio" class="input" placeholder="–ü–Ü–ë —Å—Ç—É–¥–µ–Ω—Ç–∞">
        <button class="btn" id="saveTxt">üíæ TXT</button>
        <button class="btn" id="saveCsv">üìÑ CSV</button>
      </div>
    </div>

    <!-- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê: —Å—Ö–µ–º–∞ + –Ω–æ—Ç–∞—Ç–∫–∏ -->
    <div class="card">
      <h2>üîå –°—Ö–µ–º–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (SVG)</h2>
      <svg viewBox="0 0 760 420" role="img" aria-label="Arduino + MH-Z19B + —Ä–µ–ª–µ">
        <!-- Arduino -->
        <rect x="40" y="40" width="240" height="160" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
        <text x="160" y="65" fill="#e5e7eb" font-size="16" text-anchor="middle">Arduino UNO/Nano</text>
        <text x="55" y="95" fill="#93c5fd" font-size="12">5V</text>
        <text x="55" y="115" fill="#93c5fd" font-size="12">GND</text>
        <text x="55" y="135" fill="#93c5fd" font-size="12">D11 (RX)</text>
        <text x="55" y="155" fill="#93c5fd" font-size="12">D8  (TX)</text>
        <text x="220" y="185" fill="#93c5fd" font-size="12">D8/D5..D8 ‚Üí RELAY</text>

        <!-- MH-Z19B -->
        <rect x="340" y="40" width="200" height="120" rx="12" fill="#14532d" stroke="#22c55e"></rect>
        <text x="440" y="65" fill="#dcfce7" font-size="16" text-anchor="middle">MH-Z19B (UART)</text>
        <text x="440" y="85" fill="#a7f3d0" font-size="12" text-anchor="middle">VCC(5V) ‚Äî GND ‚Äî TX ‚Äî RX</text>

        <!-- Relay -->
        <rect x="340" y="180" width="200" height="100" rx="12" fill="#7c2d12" stroke="#fb923c"></rect>
        <text x="440" y="205" fill="#fed7aa" font-size="16" text-anchor="middle">–†–µ–ª–µ (–º–æ–¥—É–ª—å)</text>
        <text x="440" y="225" fill="#fed7aa" font-size="12" text-anchor="middle">IN ‚Äî VCC ‚Äî GND</text>

        <!-- Lines -->
        <line x1="280" y1="90" x2="340" y2="60" stroke="#93c5fd" stroke-width="3"></line>
        <text x="295" y="78" fill="#93c5fd" font-size="12">5V ‚Üí VCC</text>
        <line x1="280" y1="110" x2="340" y2="80" stroke="#64748b" stroke-width="3"></line>
        <text x="295" y="96" fill="#94a3b8" font-size="12">GND ‚Üí GND</text>

        <line x1="280" y1="130" x2="340" y2="90" stroke="#22c55e" stroke-width="3"></line>
        <text x="295" y="116" fill="#86efac" font-size="12">D11(RX) ‚Üê TX —Å–µ–Ω—Å–æ—Ä–∞</text>
        <line x1="280" y1="150" x2="340" y2="100" stroke="#22c55e" stroke-width="3" opacity=".5"></line>
        <text x="295" y="140" fill="#86efac" font-size="12" opacity=".7">D8(TX) ‚Üí RX —Å–µ–Ω—Å–æ—Ä–∞</text>

        <line x1="280" y1="170" x2="340" y2="210" stroke="#fb923c" stroke-width="3"></line>
        <text x="295" y="192" fill="#fdba74" font-size="12">D8..D5 ‚Üí IN —Ä–µ–ª–µ</text>
      </svg>

      <div class="note" style="margin-top:10px">
        <b>–ü–æ—Ä–∞–¥–∏ –±–µ–∑–ø–µ–∫–∏:</b> MH-Z19B –º–∞—î –ø—ñ–¥—ñ–≥—Ä—ñ–≤ ‚Äî –ø–æ—Ç—Ä–µ–±—É—î <b>—Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ 5V</b> (–∫—Ä–∞—â–µ –æ–∫—Ä–µ–º–∏–π –ë–ñ). –†–µ–ª–µ –∫–µ—Ä—É—î <i>–∂–∏–≤–ª–µ–Ω–Ω—è–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞/–∞–∫—Ç—É–∞—Ç–æ—Ä–∞</i>, –Ω–µ –ø—ñ–¥–∫–ª—é—á–∞–π –≤–∏—Å–æ–∫–æ–≤–æ–ª—å—Ç–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞–ø—Ä—è–º—É –±–µ–∑ —ñ–∑–æ–ª—è—Ü—ñ—ó. –î–ª—è —Ç–æ—á–Ω–æ—Å—Ç—ñ —Ä–æ–±–∏ <b>zero-point calibration</b> –Ω–∞ –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –ø–æ–≤—ñ—Ç—Ä—ñ (~400 ppm).
      </div>

      <h3 style="margin-top:12px">üß∑ –ö–æ—Ä–∏—Å–Ω—ñ —Ç–µ–≥–∏</h3>
      <div>
        <span class="tag">#MHZ19B</span>
        <span class="tag">#CO2</span>
        <span class="tag">#–≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—è</span>
        <span class="tag">#—Ç–µ–ø–ª–∏—Ü—è</span>
        <span class="tag">#EMA</span>
        <span class="tag">#–≥—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å</span>
      </div>

      <div class="card" style="margin-top:14px">
        <h3>üìú –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –Ω–æ—Ç–∞—Ç–∫–∞ –¥–ª—è –¥–∏—Å–∫—É—Å—ñ—ó</h3>
        <p class="muted">
          –©–µ –≤ 1860-—Ö —Ä–æ—Å–ª–∏–Ω–∏ –≤ —Ç–µ–ø–ª–∏—Ü—è—Ö <b>–õ—ñ—î–π–±–µ—Ä–∞</b> —ñ <b>–°–∞–∫—Å–∞</b> –≤–∏—Ä–æ—â—É–≤–∞–ª–∏ –≤ —É–º–æ–≤–∞—Ö –∑–º—ñ–Ω–µ–Ω–æ–≥–æ –≥–∞–∑–æ–≤–æ–≥–æ —Å–∫–ª–∞–¥—É –ø–æ–≤—ñ—Ç—Ä—è. 
          –£ XX —Å—Ç. –∑‚Äô—è–≤–∏–ª–æ—Å—è –ø—Ä–æ–º–∏—Å–ª–æ–≤–µ <b>CO‚ÇÇ-–∑–±–∞–≥–∞—á–µ–Ω–Ω—è</b>: –ø—ñ–¥–π–æ–º –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—ó –¥–æ 800‚Äì1200 ppm –∑–±—ñ–ª—å—à—É—î —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ —ñ –≤—Ä–æ–∂–∞–π–Ω—ñ—Å—Ç—å, 
          –∞–ª–µ –ø–æ–Ω–∞–¥ 1500‚Äì2000 ppm –µ—Ñ–µ–∫—Ç –ø–∞–¥–∞—î —ñ —Å—Ç–∞—î –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ –¥–ª—è –ª—é–¥–µ–π. –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ —Ç—Ä–∏–º–∞—î–º–æ CO‚ÇÇ ¬´—É –∫–æ—Ä–∏–¥–æ—Ä—ñ¬ª –≤–∂–µ –Ω–∞ –º—ñ–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ.
        </p>
      </div>
    </div>
  </div>

  <hr class="sep">

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>–§–æ—Ç–æ –º–∞–∫–µ—Ç–∞ Arduino + MH-Z19B + —Ä–µ–ª–µ.</li>
      <li>CSV-–ª–æ–≥ (5‚Äì10 —Ö–≤): <span class="mono">millis, CO2_raw, CO2_EMA, relay</span>; —Å–∫—Ä—ñ–Ω –∑ –≥—Ä–∞—Ñ—ñ–∫–æ–º.</li>
      <li>–ü–æ—è—Å–Ω–∏ –≤–∏–±—ñ—Ä <span class="mono">thrOn/thrOff</span>, <span class="mono">minOn</span> —ñ –≤–ø–ª–∏–≤ <span class="mono">Œ±</span> –Ω–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å.</li>
      <li>–Ü–¥–µ—ó –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è: —Ñ—Ä–∞–º—É–≥–∏, –≤–∫–ª—é—á–µ–Ω–Ω—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ñ–≤, —Å–∏–≥–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ <span class="mono">CO‚ÇÇ &gt; safeMax</span>.</li>
    </ul>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// –£—Ç–∏–ª—ñ—Ç–∏
const $=(s)=>document.querySelector(s);
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}

// –ï–º—É–ª—è—Ç–æ—Ä
const emu=$('#emu'), emuCO2=$('#emuCO2'), emuRelay=$('#emuRelay');
emu.addEventListener('change',()=>{emuCO2.disabled=emuRelay.disabled=!emu.checked;});

// –ì—Ä–∞—Ñ—ñ–∫
const cvs=$('#chart'), ctx=cvs.getContext('2d');
const series=[]; // {t, co2, ema, relay}
let ema = NaN;
let lastTs = null;
let relayState = 0;
let lastOnAt = 0;

function draw(){
  const W=cvs.width,H=cvs.height;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#223049';ctx.strokeRect(0.5,0.5,W-1,H-1);
  if(series.length<2) return;
  const maxN=150;
  const s=series.slice(-maxN);
  const xs=s.map((_,i)=> i*(W/(maxN-1)));

  // CO‚ÇÇ raw 0..2500
  ctx.beginPath();ctx.strokeStyle='#38bdf8';ctx.lineWidth=2;
  xs.forEach((x,i)=>{const y=H-10-(Math.min(2500,s[i].co2)/2500)*(H-20);i?ctx.lineTo(x,y):ctx.moveTo(x,y);});ctx.stroke();

  // EMA
  ctx.beginPath();ctx.strokeStyle='#22c55e';ctx.lineWidth=2;
  xs.forEach((x,i)=>{const y=H-10-(Math.min(2500,s[i].ema)/2500)*(H-20);i?ctx.lineTo(x,y):ctx.moveTo(x,y);});ctx.stroke();

  // –ú–∞—Ä–∫–µ—Ä–∏ —Ä–µ–ª–µ
  ctx.fillStyle='#fbbf24';ctx.font='12px ui-monospace';
  s.forEach((p,i)=>{ if(p.relay){ ctx.fillRect(xs[i]-1, H-18, 2, 8);} });
  ctx.fillStyle='#94a3b8';ctx.fillText('CO‚ÇÇ',W-28,14);ctx.fillText('EMA',W-4,14);
}

function addPoint(){
  // –ó —á–∏—Ç–∞–Ω–Ω—è–º –∑ –¥–∞—Ç—á–∏–∫–∞ —Ç—É—Ç –ø—Ä–∞—Ü—é—î–º–æ —á–µ—Ä–µ–∑ Serial Monitor —Ä—É–∫–∞–º–∏,
  // —É –Ω–∞–≤—á–∞–ª—å–Ω–æ–º—É –≤–µ–±—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –µ–º—É–ª—å –∑–Ω–∞—á–µ–Ω–Ω—è.
  let co2;
  if(emu.checked){ co2=parseFloat(emuCO2.value); }
  else{
    const v=prompt('–í–≤–µ–¥–∏ –ø–æ—Ç–æ—á–Ω–∏–π CO‚ÇÇ ppm (—ñ–∑ Serial Monitor –ø—Ä–æ—à–∏–≤–∫–∏):','850');
    if(v===null) return; co2=parseFloat(v);
    if(Number.isNaN(co2)) return alert('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ —á–∏—Å–ª–æ');
  }

  const now=Date.now();
  if(lastTs==null) lastTs=now;
  const dt=(now-lastTs)/1000; lastTs=now;

  const a=Math.min(1,Math.max(0,parseFloat($('#alpha').value)));
  if(Number.isNaN(ema)) ema=co2; else ema = a*co2 + (1-a)*ema;

  // –ö–µ—Ä—É–≤–∞–Ω–Ω—è (—ñ–º—ñ—Ç–∞—Ü—ñ—è, —è–∫ —É –ø—Ä–æ—à–∏–≤—Ü—ñ)
  const thrOn=parseFloat($('#thrOn').value);
  const thrOff=parseFloat($('#thrOff').value);
  const minOn=parseFloat($('#minOn').value);
  const safeMax=parseFloat($('#safeMax').value);

  // –∞–≤–∞—Ä—ñ—è -> —Ç–æ—á–Ω–æ ON
  let relay=relayState;
  if(ema>=safeMax){ relay=1; }
  else{
    if(relayState===0 && ema>=thrOn){ relay=1; lastOnAt=now; }
    if(relayState===1){
      const onSecs=(now-lastOnAt)/1000;
      if(ema<=thrOff && onSecs>=minOn){ relay=0; }
      else relay=1;
    }
  }
  if(emu.checked){ relay=parseInt(emuRelay.value,10); }
  relayState=relay;

  series.push({t:now, co2, ema, relay});
  $('#lastVal').textContent=`CO‚ÇÇ=${Math.round(co2)} ppm, EMA=${Math.round(ema)} ppm, Relay=${relay}`;
  $('#co2Badge').textContent='CO‚ÇÇ(EMA) = '+Math.round(ema)+' ppm';
  draw();
}
$('#tick').addEventListener('click', addPoint);
$('#clear').addEventListener('click', ()=>{ series.length=0; ema=NaN; relayState=0; lastTs=null; lastOnAt=0; $('#lastVal').textContent='CO‚ÇÇ=‚Äî ppm, EMA=‚Äî ppm, Relay=0'; $('#co2Badge').textContent='CO‚ÇÇ(EMA) = ‚Äî ppm'; draw(); });

// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—à–∏–≤–∫–∏ (UART –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –¥–ª—è MH-Z19B)
function makeSketch(){
  const period = Math.max(1000, parseInt($('#period').value,10));
  const alpha  = Math.min(1,Math.max(0,parseFloat($('#alpha').value)));
  const thrOn  = parseInt($('#thrOn').value,10);
  const thrOff = parseInt($('#thrOff').value,10);
  const minOn  = Math.max(0, parseInt($('#minOn').value,10));
  const safeMax= parseInt($('#safeMax').value,10);
  const rPin   = parseInt($('#relayPin').value,10);
  const rxPin  = parseInt($('#rxPin').value,10);
  const txPin  = parseInt($('#txPin').value,10);

  const code = `/*
  –ü–∞—Ä–∞ 19 ‚Äî CO‚ÇÇ —É —Ç–µ–ø–ª–∏—Ü—ñ: MH-Z19B (UART) + –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—è
  –ê–≤—Ç–æ—Ä –ª–∞–±–∏: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫ (EDLab)

  –ë–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –¥–∞—Ç—á–∏–∫–∞: –ø—Ä–∞—Ü—é—î–º–æ –∑ MH-Z19B –ø–æ UART –ø—Ä–æ—Ç–æ–∫–æ–ª—É (9-–±–∞–π—Ç–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏/–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ).
  –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏:
    - SoftwareSerial (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –¥–ª—è AVR UNO/Nano)

  –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:
    - –ó–∞–ø–∏—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—ó CO‚ÇÇ –∫–æ–∂–Ω—ñ ${period} –º—Å
    - EMA-–∑–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è Œ±=${alpha.toFixed(2)}
    - –ì—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å: ON‚â•${thrOn} ppm, OFF‚â§${thrOff} ppm, –º—ñ–Ω. —á–∞—Å —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è ${minOn} —Å
    - –ê–≤–∞—Ä—ñ—è: —è–∫—â–æ EMA‚â•${safeMax} ppm ‚Äî —Ä–µ–ª–µ –≤ ON
    - –í–∏–≤—ñ–¥ CSV: millis,CO2_raw,CO2_EMA,relay
*/

#include <SoftwareSerial.h>

const int RX_PIN = ${rxPin}; // Arduino RX (–¥–æ TX –¥–∞—Ç—á–∏–∫–∞)
const int TX_PIN = ${txPin}; // Arduino TX (–¥–æ RX –¥–∞—Ç—á–∏–∫–∞)
SoftwareSerial mhz(RX_PIN, TX_PIN); // RX, TX

const unsigned long PERIOD_MS = ${period};
const float ALPHA = ${alpha.toFixed(3)};
const int THR_ON  = ${thrOn};
const int THR_OFF = ${thrOff};
const unsigned long MIN_ON_MS = ${minOn}UL * 1000UL;
const int SAFE_MAX = ${safeMax};
const int RELAY_PIN = ${rPin};

unsigned long tPrev = 0;
float ema = NAN;
bool relay = false;
unsigned long lastOnAt = 0;

uint8_t cmdRead[9] = {0xFF,0x01,0x86,0,0,0,0,0,0}; // –∑–∞–ø–∏—Ç –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
// —á–µ–∫—Å—É–º–º–∞: 0xFF - ( (sum bytes 1..7) % 256 ) + 1

uint8_t checksum(uint8_t *b){
  uint16_t sum=0;
  for(int i=1;i<8;i++) sum+=b[i];
  uint8_t cs = 0xFF - (sum % 256) + 1;
  return cs;
}

int readCO2(){
  cmdRead[8] = checksum(cmdRead);
  mhz.write(cmdRead,9);
  mhz.flush();

  unsigned long t0 = millis();
  while(millis()-t0 < 50){
    if(mhz.available() >= 9){
      uint8_t resp[9];
      mhz.readBytes(resp,9);
      if(resp[0]==0xFF && resp[1]==0x86){
        if(checksum(resp) == resp[8]){
          int co2 = (int)resp[2]*256 + (int)resp[3];
          return co2;
        }
      }
    }
  }
  return -1; // –ø–æ–º–∏–ª–∫–∞
}

void setup(){
  pinMode(RELAY_PIN, OUTPUT);
  digitalWrite(RELAY_PIN, LOW);
  mhz.begin(9600);
  Serial.begin(115200);
  delay(500);
  Serial.println(F("millis,CO2_raw,CO2_EMA,relay"));
}

void loop(){
  if(millis() - tPrev >= PERIOD_MS){
    unsigned long now = millis();
    int co2 = readCO2(); // ppm –∞–±–æ -1

    if(co2 < 0){
      // –ø–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è
      Serial.print(now); Serial.print(",NaN,");
      if(isnan(ema)) Serial.print("NaN,"); else Serial.print(ema,0), Serial.print(',');
      Serial.println(relay ? 1:0);
      tPrev = now;
      return;
    }

    if(isnan(ema)) ema = co2;
    else ema = ALPHA * co2 + (1.0 - ALPHA) * ema;

    // –ê–≤–∞—Ä—ñ—è
    if(ema >= SAFE_MAX){
      if(!relay){ relay = true; lastOnAt = now; }
    }else{
      if(!relay && ema >= THR_ON){
        relay = true; lastOnAt = now;
      }else if(relay){
        unsigned long onFor = now - lastOnAt;
        if(ema <= THR_OFF && onFor >= MIN_ON_MS){
          relay = false;
        }
      }
    }

    digitalWrite(RELAY_PIN, relay ? HIGH : LOW);

    Serial.print(now); Serial.print(',');
    Serial.print(co2); Serial.print(',');
    Serial.print(ema,0); Serial.print(',');
    Serial.println(relay ? 1:0);

    tPrev = now;
  }
}
`;
  return code;
}

$('#gen').addEventListener('click', ()=>{ const txt=makeSketch(); $('#code').textContent=txt; window.scrollTo({top: $('#code').parentElement.getBoundingClientRect().top + window.scrollY - 20, behavior:'smooth'}); });
$('#copy').addEventListener('click', ()=>{ const ta=document.createElement('textarea'); ta.value=$('#code').textContent; document.body.appendChild(ta); ta.select(); ta.setSelectionRange(0, ta.value.length); document.execCommand('copy'); ta.remove(); const old=document.title; document.title='‚úÖ –ö–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'; setTimeout(()=>document.title=old,900); });
$('#dl').addEventListener('click', ()=>{ const txt=$('#code').textContent||makeSketch(); download('agro_para19_co2_mhz19b.ino',txt,'text/x-arduino'); });

// –ü—Ä–æ—Ç–æ–∫–æ–ª
$('#saveTxt').addEventListener('click', ()=>{
  const fio=($('#fio').value||'').trim();
  const lines=[
    '–ü–∞—Ä–∞ 19 ‚Äî CO‚ÇÇ —É —Ç–µ–ø–ª–∏—Ü—ñ: MH-Z19B (UART) + –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—è',
    '–°—Ç—É–¥–µ–Ω—Ç: '+fio,
    `–ü–µ—Ä—ñ–æ–¥: ${$('#period').value} –º—Å, EMA Œ±=${$('#alpha').value}`,
    `–ü–æ—Ä–æ–≥–∏: ON‚â•${$('#thrOn').value} ppm, OFF‚â§${$('#thrOff').value} ppm, minOn=${$('#minOn').value} —Å`,
    `–ê–≤–∞—Ä—ñ—è: safeMax=${$('#safeMax').value} ppm`,
    '–°–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è: ...'
  ].join('\n');
  download('agro_para19_'+stamp()+'.txt',lines);
});
$('#saveCsv').addEventListener('click', ()=>{
  const fio=($('#fio').value||'').replace(/"/g,'""');
  const csv='"–ü–∞—Ä–∞","–°—Ç—É–¥–µ–Ω—Ç","Period_ms","Alpha","ThrOn","ThrOff","MinOn_s","SafeMax"\n'
          + `"19","${fio}",${$('#period').value},${$('#alpha').value},${$('#thrOn').value},${$('#thrOff').value},${$('#minOn').value},${$('#safeMax').value}\n`;
  download('agro_para19_'+stamp()+'.csv',csv,'text/csv');
});

// –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
$('#tick').addEventListener('click', addPoint);
</script>


</body></html>