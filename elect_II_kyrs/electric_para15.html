<!-- electric_para15.html
     –ü–∞—Ä–∞ 15 (–ï–ª–µ–∫—Ç—Ä–∏–∫–∏, –∞—É–¥–∏—Ç–æ—Ä–Ω–æ): –ö–û–†–û–¢–ö–ï –ó–ê–ú–ò–ö–ê–ù–ù–Ø –¢–ê –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø (ADS)
     –û—Ü—ñ–Ω–∫–∞ –ø–µ—Ç–ª—ñ ¬´—Ñ–∞–∑–∞‚Äì–Ω—É–ª—å/PE¬ª, —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ Ik (1–§/3–§), –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤–∏ ADS (Zs ‚â§ U0/Ia),
     –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–∏—Ç—Ç—î–≤–æ–≥–æ —Ä–æ–∑—á—ñ–ø–ª—é–≤–∞—á–∞ MCB (B/C/D), Icu/Ics, –Ω–∞–∫–ª–µ–π–∫–∏ 58 –º–º, A4-–∑–≤—ñ—Ç, CSV.
     –ü–æ–≤–Ω—ñ—Å—Ç—é –∞–≤—Ç–æ–Ω–æ–º–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è GitHub Pages —ñ –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è –≤ Moodle —á–µ—Ä–µ–∑ <iframe>.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 15 ‚Äî –ö–ó, –ø–µ—Ç–ª—è Zs, ADS, –º–∏—Ç—Ç—î–≤–∏–π —Ä–æ–∑—á—ñ–ø–ª—é–≤–∞—á, Icu/Ics</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{
    --bg:#0b1220; --bg2:#111827; --card:#0f172a; --text:#e2e8f0; --muted:#9aa5b1; --line:#1f2937;
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --info:#60a5fa;
  }
  *{box-sizing:border-box}
  body{margin:0; background:linear-gradient(180deg,var(--bg),var(--bg2) 30%,var(--bg)); color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55}
  .wrap{max-width:1120px; margin:0 auto; padding:24px 16px 96px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:#9aa5b1}
  h1{font-size:32px; margin:6px 0 12px; line-height:1.15; background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:22px 0 12px}
  h3{font-size:18px; margin:12px 0 8px; color:#cbd5e1}
  p{margin:8px 0}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:1050px){.g3{grid-template-columns:1fr}; .g2{grid-template-columns:1fr}}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .small{font-size:12px; color:#93a3b5}
  .chip{display:inline-block; padding:2px 8px; border:1px solid #223049; border-radius:999px; font-size:12px; margin-right:6px; background:#0d1a2e}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)} .muted{color:#9aa5b1}
  input,select,textarea{padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e5e7eb; width:100%}
  textarea{min-height:88px}

  table{width:100%; border-collapse:separate; border-spacing:0; border:1px solid #223049; border-radius:12px; overflow:hidden}
  thead th{background:#0c1629; color:#a5b4fc; text-align:left; padding:10px 12px; font-size:14px}
  tbody td{padding:8px 10px; border-top:1px solid #1f2937; font-size:14px; vertical-align:top}
  tbody tr:nth-child(even){background:#0b1324}

  .tickets{display:flex; gap:12px; flex-wrap:wrap}
  .ticket{
    width:58mm; background:#fff; color:#000; padding:5mm 4mm; border-radius:6px;
    box-shadow:0 0 0 1px #e5e7eb inset; font-family:"Courier New",ui-monospace,monospace
  }
  .ticket h4{margin:0 0 4px; font-size:13px; text-align:center}
  .ticket p{margin:1px 0; font-size:12px}
  .ticket .line{border-top:1px dashed #111; margin:5px 0}
  .ticket small{font-size:10px}
  .ticket .qr{font-size:10px; word-break:break-all}

  #printArea{background:#fff; color:#000; border-radius:12px; border:1px solid #e5e7eb; padding:16px}
  .doc{page-break-after:always; padding:12mm; color:#000; font-family:Georgia,"Times New Roman",serif}
  .doc h2{color:#000; font-size:20px; margin:0 0 6px}
  .doc h3{color:#000; font-size:16px; margin:6px 0}
  .doc p{color:#000; margin:4px 0}
  .doc table{width:100%; border-collapse:collapse; border:1px solid #111}
  .doc th,.doc td{border:1px solid #111; padding:6px 8px; font-size:12px; vertical-align:top}
  .doc .sign{margin-top:10mm; display:flex; gap:10mm; flex-wrap:wrap}
  .doc .sign div{flex:1 1 220px}

  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}

  @media print{
    @page{ size:A4; margin:12mm }
    body{ background:#fff; color:#000 }
    .no-print, .card:not(.printable){ display:none !important }
    #printArea{ border:none; padding:0 }
    .ticket{ box-shadow:none; width:auto; padding:0 }
  }
</style>
</head>
<body>
  <div class="wrap">
    <span class="badge">–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 15 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ</span>
    <h1>‚ö° –ö–æ—Ä–æ—Ç–∫–µ –∑–∞–º–∏–∫–∞–Ω–Ω—è (Ik) ‚Üí –ø–µ—Ç–ª—è Zs ‚Üí ADS (Zs ‚â§ U0/Ia) ‚Üí –º–∏—Ç—Ç—î–≤–∏–π —Ä–æ–∑—á—ñ–ø–ª—é–≤–∞—á B/C/D ‚Üí Icu/Ics</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>–û—Ü—ñ–Ω–∏—Ç–∏ –æ–ø—ñ—Ä –ø–µ—Ç–ª—ñ <b>Zs</b>, —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ <b>Ik</b> –Ω–∞ –∫—ñ–Ω—Ü—ñ –ª—ñ–Ω—ñ—ó (1–§/3–§), –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —É–º–æ–≤—É <b>ADS</b> (<span class="mono">Zs ‚â§ U0/Ia</span>), –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ <b>–º–∏—Ç—Ç—î–≤–∏–π —Ä–æ–∑—á—ñ–ø–ª—é–≤–∞—á</b> –¥–ª—è MCB –∫—Ä–∏–≤–∏—Ö B/C/D —Ç–∞ <b>Icu/Ics</b> –∞–≤—Ç–æ–º–∞—Ç–∞ –≤—ñ–¥–Ω–æ—Å–Ω–æ –æ—á—ñ–∫—É–≤–∞–Ω–æ–≥–æ Ik –Ω–∞ —à–∏–Ω—ñ.</p>
      <p class="small">–°–ø—Ä–æ—â–µ–Ω–æ: <span class="mono">Zs ‚âà Z<sub>–¥–∂</sub> + 2¬∑L¬∑œÅ / S</span> (1–§), <span class="mono">Ik ‚âà U0 / Zs</span> (1–§), <span class="mono">Ik<sub>3–§</sub> ‚âà U<sub>LL</sub> / (‚àö3¬∑Zk)</span>. –î–ª—è –º–∏—Ç—Ç—î–≤–æ–≥–æ —Ä–æ–∑—á—ñ–ø–ª—é–≤–∞—á–∞: B‚Üí3‚Äì5¬∑In, C‚Üí5‚Äì10¬∑In, D‚Üí10‚Äì20¬∑In (–±–µ—Ä–µ–º–æ –Ω–∏–∂–Ω—é –º–µ–∂—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ ¬´–º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ¬ª —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è).</p>
      <div class="row">
        <button class="btn" onclick="seedDemo()">üîÑ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" onclick="exportCSV()">üì§ –ï–∫—Å–ø–æ—Ä—Ç CSV</button>
        <input id="file" type="file" accept=".csv,text/csv" class="btn" />
        <button class="btn" onclick="importCSV()">‚¨ÜÔ∏è –Ü–º–ø–æ—Ä—Ç CSV</button>
      </div>
      <p class="small">CSV: <span class="mono">id,name,phases,curve,In_A,Icu_kA,U0,ULL,source_Zs,material,S_mm2,length_m,pe_same,ambientC,notes,url</span></p>
    </div>

    <div class="card">
      <h2>‚ûï –î–æ–¥–∞—Ç–∏ –ª—ñ–Ω—ñ—é/–∫–æ–ª–æ</h2>
      <div class="grid g3">
        <div>
          <h3>–ó–∞–≥–∞–ª—å–Ω–µ</h3>
          <div class="row"><label class="small" style="min-width:150px">ID</label><input id="id" value="SC-01"></div>
          <div class="row"><label class="small" style="min-width:150px">–ù–∞–∑–≤–∞</label><input id="name" value="–†–æ–∑–µ—Ç–∫–∏ –∞—É–¥–∏—Ç–æ—Ä—ñ—ó"></div>
          <div class="row"><label class="small" style="min-width:150px">–§–∞–∑–∏</label><select id="phases"><option selected>1–§</option><option>3–§</option></select></div>
          <div class="row"><label class="small" style="min-width:150px">U0 (LN), –í</label><input id="U0" type="number" value="230"></div>
          <div class="row"><label class="small" style="min-width:150px">ULL (LL), –í</label><input id="ULL" type="number" value="400"></div>
        </div>
        <div>
          <h3>–ê–≤—Ç–æ–º–∞—Ç</h3>
          <div class="row"><label class="small" style="min-width:150px">–ö—Ä–∏–≤–∞</label><select id="curve"><option>B</option><option selected>C</option><option>D</option></select></div>
          <div class="row"><label class="small" style="min-width:150px">In, –ê</label>
            <select id="InA"><option>6</option><option>10</option><option selected>16</option><option>20</option><option>25</option><option>32</option><option>40</option><option>50</option><option>63</option></select></div>
          <div class="row"><label class="small" style="min-width:150px">Icu (kA)</label><select id="Icu"><option>4.5</option><option selected>6</option><option>10</option></select></div>
        </div>
        <div>
          <h3>–ü–µ—Ç–ª—è / —Ç—Ä–∞—Å–∞</h3>
          <div class="row"><label class="small" style="min-width:150px">–î–∂–µ—Ä–µ–ª–æ Zs, Œ©</label><input id="Zs_src" type="number" step="0.001" value="0.20"></div>
          <div class="row"><label class="small" style="min-width:150px">–ú–∞—Ç–µ—Ä—ñ–∞–ª</label><select id="mat"><option selected>Cu</option><option>Al</option></select></div>
          <div class="row"><label class="small" style="min-width:150px">S (—Ñ–∞–∑–∞), –º–º¬≤</label><select id="S"><option>1.5</option><option selected>2.5</option><option>4</option><option>6</option><option>10</option></select></div>
          <div class="row"><label class="small" style="min-width:150px">–î–æ–≤–∂–∏–Ω–∞ L, –º</label><input id="L" type="number" value="25"></div>
          <div class="row"><label class="small" style="min-width:150px">PE=S —Ñ–∞–∑–∏?</label><select id="peSame"><option selected>–¢–∞–∫</option><option>–ù—ñ</option></select></div>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" onclick="addOrUpdate()">üíæ –î–æ–¥–∞—Ç–∏/–û–Ω–æ–≤–∏—Ç–∏</button>
        <button class="btn" onclick="calcOne()">üßÆ –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="seedOne()">üîÑ –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Å—É</button>
      </div>
      <p class="small">–ú–∏—Ç—Ç—î–≤–∞ —É—Å—Ç–∞–≤–∫–∞ (–º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞): <span class="mono">B‚Üí3¬∑In</span>, <span class="mono">C‚Üí5¬∑In</span>, <span class="mono">D‚Üí10¬∑In</span>. –î–ª—è ADS: <span class="mono">Ia = k¬∑In</span>, <span class="mono">Zs ‚â§ U0/Ia</span>.</p>
    </div>

    <div class="card printable">
      <h2>üìã –†–µ—î—Å—Ç—Ä –ö–ó/ADS</h2>
      <table id="tbl">
        <thead>
          <tr>
            <th>#</th><th>ID</th><th>–ù–∞–∑–≤–∞</th><th>–§–∞–∑–∏</th><th>In, –ê</th><th>–ö—Ä–∏–≤–∞</th><th>Zs, Œ©</th><th>Ik, –∫–ê</th><th>ADS</th><th>Mit Inst</th><th>Icu</th><th>–°—Ç–∞—Ç—É—Å</th><th>URL</th><th>–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p class="small">–°—Ç–∞—Ç—É—Å–∏: <span class="chip ok">PASS</span> ‚Äî –≤—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–æ; <span class="chip warn">WARN</span> ‚Äî –Ω–∞ –º–µ–∂—ñ; <span class="chip bad">FAIL</span> ‚Äî –ø–æ—Ä—É—à–µ–Ω–æ (ADS/–º–∏—Ç—Ç—î–≤–∞/Icu).</p>
    </div>

    <div class="card printable">
      <h2>üßæ –ù–∞–∫–ª–µ–π–∫–∏ 58 –º–º ¬´ADS –ü–ï–†–ï–í–Ü–†–ï–ù–û¬ª</h2>
      <div class="row">
        <button class="btn" onclick="buildTickets()">üß© –ó—ñ–±—Ä–∞—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö</button>
        <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫ 58 –º–º</button>
        <button class="btn" onclick="downloadTXT()">üì• TXT</button>
      </div>
      <div id="tickets" class="tickets"></div>
    </div>

    <div class="card printable">
      <h2>üìÑ A4-–∑–≤—ñ—Ç (–¥–ª—è –¥—Ä—É–∫—É/PDF)</h2>
      <div class="row">
        <button class="btn" onclick="buildReport()">üß© –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ A4</button>
        <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫/PDF</button>
      </div>
      <div id="printArea"></div>
    </div>
  </div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // ======= –°–¢–ê–ù =======
  let regs = []; // –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
  const tbody = document.querySelector('#tbl tbody');
  const ticketsBox = document.getElementById('tickets');

  // ======= –ö–û–ù–°–¢–ê–ù–¢–ò / –£–¢–ò–õ–Ü–¢–ò =======
  const RHO = { Cu: 0.0175, Al: 0.0282 }; // Œ©¬∑–º–º¬≤/–º –ø—Ä–∏ 20¬∞C
  function kTemp(ambientC){
    // –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π –∫–æ–µ—Ñ-—Ç –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è –æ–ø–æ—Ä—É –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫–∞ –≤—ñ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ –¥–æ–≤–∫—ñ–ª–ª—è (–Ω–∞–≤—á–∞–ª—å–Ω–æ)
    if(ambientC<=25) return 1.00;
    if(ambientC<=35) return 1.06;
    if(ambientC<=45) return 1.12;
    return 1.18;
  }
  function esc(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&gt;','>':'&lt;','"':'&quot;',"'":'&#39;' }[m])); }
  function pad(n){ return n.toString().padStart(2,'0'); }
  function nowStamp(){ const d=new Date(); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`; }
  function round3(x){ return Math.round(x*1000)/1000; }

  function instFactor(curve){
    if(curve==='B') return 3;
    if(curve==='C') return 5;
    return 10; // D
  }

  // Zs: –¥–∂–µ—Ä–µ–ª–æ + –ø–µ—Ç–ª—è –ø–æ –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫–∞—Ö (—Ñ–∞–∑–∞ + N/PE)
  function Zs_total(Zs_src, L, S, mat, ambientC, peSame){
    const rho = RHO[mat] || RHO.Cu;
    const kt = kTemp(ambientC);
    const Spe = peSame==='–¢–∞–∫' ? S : Math.max(1.5, S/2); // —è–∫—â–æ PE –º–µ–Ω—à–∏–π ‚Äî –ø—Ä–∏–±–ª–∏–∑–∏–º–æ —è–∫ S/2
    const Zline = kt * ( (rho*L)/S + (rho*L)/Spe ); // —Ç—ñ–ª—å–∫–∏ –∞–∫—Ç–∏–≤–Ω–∞ —Å–∫–ª–∞–¥–æ–≤–∞ (–Ω–∞–≤—á–∞–ª—å–Ω–æ)
    return Zs_src + Zline;
  }

  function Ik_from(Zs, U0){ return U0>0 && Zs>0 ? (U0 / Zs) : 0; }            // –ê (1–§)
  function Ik3_from(Zk, ULL){ return (ULL>0 && Zk>0) ? (ULL / (Math.sqrt(3)*Zk)) : 0; } // –ê (3–§)

  function statusBadge(txt){
    const color = txt==='PASS' ? '#22c55e' : (txt==='WARN' ? '#f59e0b' : '#ef4444');
    return `<span class="mono" style="padding:2px 8px;border:1px solid #223049;border-radius:999px;background:#0d1a2e;color:${color}">${txt}</span>`;
  }

  // ======= –î–û–î–ê–¢–ò/–û–ù–û–í–ò–¢–ò =======
  function addOrUpdate(){
    const rec = {
      id:(document.getElementById('id').value||'').trim(),
      name:(document.getElementById('name').value||'').trim(),
      phases:document.getElementById('phases').value,
      U0:parseFloat(document.getElementById('U0').value||'230'),
      ULL:parseFloat(document.getElementById('ULL').value||'400'),
      curve:document.getElementById('curve').value,
      InA:parseFloat(document.getElementById('InA').value||'16'),
      Icu:parseFloat(document.getElementById('Icu').value||'6'),
      Zs_src:parseFloat(document.getElementById('Zs_src').value||'0.2'),
      mat:document.getElementById('mat').value,
      S:parseFloat(document.getElementById('S').value||'2.5'),
      L:parseFloat(document.getElementById('L').value||'25'),
      peSame:document.getElementById('peSame').value,
      ambientC:30,
      url:'', notes:''
    };
    if(!rec.id){ alert('–£–∫–∞–∂–∏ ID'); return; }
    const i = regs.findIndex(x=>x.id===rec.id);
    if(i>=0) regs[i] = {...regs[i], ...rec};
    else regs.push(rec);
    calcOne(rec.id);
  }

  // ======= –†–û–ó–†–ê–•–£–ù–û–ö =======
  function calcOne(idOpt){
    const id = idOpt || (document.getElementById('id').value||'').trim();
    const r = regs.find(x=>x.id===id);
    if(!r){ alert('–ù–µ–º–∞—î —Ç–∞–∫–æ–≥–æ –∑–∞–ø–∏—Å—É'); return; }
    const Zs = round3( Zs_total(r.Zs_src, r.L, r.S, r.mat, r.ambientC||30, r.peSame) );
    const Ia = instFactor(r.curve) * r.InA; // –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –º–∏—Ç—Ç—î–≤–∞ —É—Å—Ç–∞–≤–∫–∞
    const Ik1 = Ik_from(Zs, r.U0);          // 1–§ –ö–ó
    const Ik3 = Ik3_from(Zs, r.ULL);        // –≥—Ä—É–±–∞ –æ—Ü—ñ–Ω–∫–∞ 3–§ (—Ç–∞ —Å–∞–º–∞ Zs —è–∫ –Ω–∞–±–ª–∏–∂–µ–Ω–∞ Zk)
    const ADS = Zs <= (r.U0 / Ia);          // —É–º–æ–≤–∞ Zs ‚â§ U0/Ia
    const MIT = Ik1 >= Ia;                  // —á–∏ –≤–∏—Å—Ç–∞—á–∞—î Ik –¥–ª—è –º–∏—Ç—Ç—î–≤–æ–≥–æ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Icu: –æ—á—ñ–∫—É–≤–∞–Ω–∏–π Ik –Ω–∞ —à–∏–Ω—ñ (–±–µ–∑ –¥–æ–≤–∂–∏–Ω–∏) ~ U0/Zs_src; –∞–≤—Ç–æ–º–∞—Ç –º—É—Å–∏—Ç—å –º–∞—Ç–∏ Icu ‚â• —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è
    const Ik_board = Ik_from(r.Zs_src, r.U0)/1000; // –∫–ê
    const Icu_ok = r.Icu >= Ik_board;

    // –í–∏—Ä–æ–∫
    let status = 'PASS';
    if(!(ADS && MIT && Icu_ok)) status = 'FAIL';
    // –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è, —è–∫—â–æ –¥—É–∂–µ ¬´–Ω–∞ –º–µ–∂—ñ¬ª
    const marginADS = (r.U0/Ia) - Zs;
    const marginMIT = Ik1 - Ia;
    if(status==='PASS' && (marginADS<0.02 || marginMIT<5 || (r.Icu - Ik_board)<0.5)) status='WARN';

    r.calc = {
      Zs, Ia:Math.round(Ia*100)/100, Ik1:Math.round(Ik1)/1, Ik3:Math.round(Ik3)/1,
      ADS, MIT, Icu_ok, Ik_board:round3(Ik_board), status
    };
    render();
    buildTickets([r]);
  }

  // ======= –†–ï–ù–î–ï–† =======
  function render(){
    tbody.innerHTML='';
    regs.forEach((r,i)=>{
      const c = r.calc || {};
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td class="editable" data-k="id" data-id="${r.id}">${esc(r.id)}</td>
        <td class="editable" data-k="name" data-id="${r.id}">${esc(r.name)}</td>
        <td class="editable" data-k="phases" data-id="${r.id}">${esc(r.phases)}</td>
        <td class="editable" data-k="InA" data-id="${r.id}">${esc(r.InA)}</td>
        <td class="editable" data-k="curve" data-id="${r.id}">${esc(r.curve)}</td>
        <td>${c.Zs??'‚Äî'}</td>
        <td>${c.Ik1? (Math.round(c.Ik1/10)/100) : '‚Äî'}</td>
        <td>${c.ADS===undefined?'‚Äî':(c.ADS?'PASS':'FAIL')}</td>
        <td>${c.MIT===undefined?'‚Äî':(c.MIT?'PASS':'FAIL')}</td>
        <td>${c.Icu_ok===undefined?'‚Äî':(c.Icu_ok?'OK':'LOW')}</td>
        <td>${c.status?statusBadge(c.status):'‚Äî'}</td>
        <td class="editable" data-k="url" data-id="${r.id}">${esc(r.url||'')}</td>
        <td class="mono"><button class="btn" data-act="label" data-id="${r.id}">–ù–∞–∫–ª–µ–π–∫–∞</button> <button class="btn" data-act="del" data-id="${r.id}">‚úñ</button></td>`;
      tbody.appendChild(tr);
    });
  }

  // –Ü–Ω–ª–∞–π–Ω-—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
  tbody.addEventListener('dblclick', (e)=>{
    const td = e.target.closest('.editable'); if(!td) return;
    const id = td.getAttribute('data-id'); const key = td.getAttribute('data-k');
    const idx = regs.findIndex(x=>x.id===id); const r = regs[idx];
    const input = document.createElement('input'); input.value = r[key] || ''; input.style.width='100%'; input.style.padding='6px 8px';
    input.addEventListener('blur', ()=>{ let v=input.value.trim(); if(['InA'].includes(key)) v=parseFloat(v)||r[key]; r[key]=v; calcOne(r.id); });
    td.innerHTML=''; td.appendChild(input); input.focus(); input.select();
  });

  // –ö–Ω–æ–ø–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ
  tbody.addEventListener('click', (e)=>{
    const b = e.target.closest('button'); if(!b) return;
    const id = b.getAttribute('data-id'); const act = b.getAttribute('data-act');
    if(act==='del'){ regs = regs.filter(x=>x.id!==id); render(); return; }
    if(act==='label'){ const r = regs.find(x=>x.id===id); if(!r.calc) calcOne(id); buildTickets([r]); ticketsBox.scrollIntoView({behavior:'smooth'}); }
  });

  // ======= –ù–ê–ö–õ–ï–ô–ö–ò 58 –º–º =======
  function buildTickets(list){
    const L = list || regs;
    ticketsBox.innerHTML='';
    L.forEach(r=>{
      const c = r.calc || {};
      const el = document.createElement('div'); el.className='ticket';
      const urlText = r.url ? r.url : `https://serawww7.github.io/edlab/electric_para15.html#${encodeURIComponent(r.id)}`;
      el.innerHTML = `
        <h4>ADS –ü–ï–†–ï–í–Ü–†–ï–ù–û</h4>
        <p><b>${esc(r.id)} ¬∑ ${esc(r.name)}</b></p>
        <div class="line"></div>
        <p>Zs‚âà ${c.Zs??'‚Äî'} Œ© ¬∑ Ik‚âà ${c.Ik1? (Math.round(c.Ik1/10)/100) : '‚Äî'} –∫–ê (1–§)</p>
        <p>MCB: ${esc(r.curve)}${esc(r.InA)}A ¬∑ Icu ${esc(r.Icu)} kA</p>
        <p>ADS: ${(c.ADS?'PASS':'FAIL')} ¬∑ Inst: ${(c.MIT?'PASS':'FAIL')} ¬∑ Icu: ${(c.Icu_ok?'OK':'LOW')}</p>
        <div class="line"></div>
        <p class="qr"><small>URL/NFC: ${esc(urlText)}</small></p>
        <p><small>${nowStamp()}</small></p>
      `;
      ticketsBox.appendChild(el);
    });
  }
  function downloadTXT(){
    if(!ticketsBox.firstChild){ alert('–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –Ω–∞–∫–ª–µ–π–∫–∏'); return; }
    const lines=['ADS LABELS 58mm','-------------------'];
    Array.from(ticketsBox.children).forEach(t=>{ lines.push(t.innerText.replace(/\n{2,}/g,'\n')); lines.push('-------------------'); });
    const blob=new Blob([lines.join('\n')],{type:'text/plain;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ads_labels_58mm.txt'; a.click(); URL.revokeObjectURL(a.href);
  }

  // ======= A4-–ó–í–Ü–¢ =======
  function buildReport(){
    if(!regs.length){ alert('–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤'); return; }
    const rows = regs.map((r,i)=>{
      const c = r.calc || {};
      return `
        <tr>
          <td>${i+1}</td><td>${esc(r.id)}</td><td>${esc(r.name)}</td><td>${esc(r.phases)}</td>
          <td>${r.InA} A (${esc(r.curve)})</td><td>${c.Zs??'‚Äî'} Œ©</td>
          <td>${c.Ik1? (Math.round(c.Ik1/10)/100) : '‚Äî'} –∫–ê</td>
          <td>${c.ADS===undefined?'‚Äî':(c.ADS?'PASS':'FAIL')}</td>
          <td>${c.MIT===undefined?'‚Äî':(c.MIT?'PASS':'FAIL')}</td>
          <td>${esc(r.Icu)} kA (OK=${c.Icu_ok?'Yes':'No'})</td>
          <td>${esc(r.url||'')}</td><td>${esc(r.notes||'')}</td>
        </tr>`;
    }).join('');
    const html = `
      <section class="doc">
        <h2>–ü–ï–†–ï–í–Ü–†–ö–ê ADS/–ö–ó –ü–û –õ–Ü–ù–Ü–Ø–•</h2>
        <p>–î–∞—Ç–∞: ${nowStamp()}</p>
        <table>
          <thead>
            <tr><th>#</th><th>ID</th><th>–ù–∞–∑–≤–∞</th><th>–§–∞–∑–∏</th><th>–ê–≤—Ç–æ–º–∞—Ç</th><th>Zs, Œ©</th><th>Ik, –∫–ê (1–§)</th><th>ADS</th><th>Inst</th><th>Icu</th><th>URL</th><th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <h3>–í–∏—Å–Ω–æ–≤–æ–∫</h3>
        <p>PASS: ${regs.filter(r=>r.calc?.status==='PASS').length}; WARN: ${regs.filter(r=>r.calc?.status==='WARN').length}; FAIL: ${regs.filter(r=>r.calc?.status==='FAIL').length}.</p>
        <div class="sign"><div>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å: ____________________</div><div>–ü–µ—Ä–µ–≤—ñ—Ä–∏–≤: ____________________</div></div>
        <p class="small">–ó–∞—É–≤–∞–∂–µ–Ω–Ω—è: –Ω–∞–≤—á–∞–ª—å–Ω–∞ —Å–ø—Ä–æ—â–µ–Ω–∞ –º–µ—Ç–æ–¥–∏–∫–∞ (–∞–∫—Ç–∏–≤–Ω–∞ —Å–∫–ª–∞–¥–æ–≤–∞, –Ω–∞–±–ª–∏–∂–µ–Ω–∞ Zk=Zs, –Ω–∏–∂–Ω—ñ –º–µ–∂—ñ –º–∏—Ç—Ç—î–≤–æ–≥–æ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è). –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –ø—Ä–æ—î–∫—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–∞–Ω—ñ –º–µ—Ä–µ–∂—ñ, –∫–∞—Ç–∞–ª–æ–∂–Ω—ñ T‚ÄìI –¥—ñ–∞–≥—Ä–∞–º–∏, –ø–æ–≤–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ö–ó —Ç–∞ –ø–µ—Ç–ª—ñ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º X/R, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤, —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –Ω–æ—Ä–º –ü–£–ï/–î–°–¢–£.</p>
      </section>`;
    document.getElementById('printArea').innerHTML = html;
    document.getElementById('printArea').scrollIntoView({behavior:'smooth'});
  }

  // ======= CSV =======
  function exportCSV(){
    const headers=['id','name','phases','curve','In_A','Icu_kA','U0','ULL','source_Zs','material','S_mm2','length_m','pe_same','ambientC','Zs_calc','Ik1_kA','Ik3_kA','ADS','MIT','Icu_ok','Ik_board_kA','status','url','notes','timestamp'];
    const stamp=nowStamp();
    const csv=[headers.join(','), ...regs.map(r=>{
      const c=r.calc||{};
      const vals=[r.id,r.name,r.phases,r.curve,r.InA,r.Icu,r.U0,r.ULL,r.Zs_src,r.mat,r.S,r.L,r.peSame,r.ambientC||30,c.Zs,(c.Ik1?Math.round(c.Ik1/10)/100:''),(c.Ik3?Math.round(c.Ik3/10)/100:''),c.ADS,c.MIT,c.Icu_ok,c.Ik_board,c.status,r.url||'',r.notes||'',stamp];
      return vals.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',');
    })].join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='short_circuit_ads_registry.csv'; a.click(); URL.revokeObjectURL(a.href);
  }

  async function importCSV(){
    const f=document.getElementById('file').files[0]; if(!f){ alert('–û–±–µ—Ä—ñ—Ç—å CSV'); return; }
    const txt=await f.text();
    const lines=txt.trim().split(/\r?\n/); if(lines.length<2){ alert('CSV –ø–æ—Ä–æ–∂–Ω—ñ–π'); return; }
    const headers=lines[0].split(',').map(h=>h.replace(/^"|"$/g,'').trim());
    const req=['id','name','phases','curve','In_A','Icu_kA','U0','ULL','source_Zs','material','S_mm2','length_m','pe_same','ambientC','url','notes'];
    const miss=req.filter(x=>!headers.includes(x)); if(miss.length){ alert('–í—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è: '+miss.join(', ')); return; }
    const out=[];
    for(let i=1;i<lines.length;i++){
      const cells=splitCSV(lines[i]); if(!cells.length) continue;
      const o={}; headers.forEach((h,j)=> o[h]=(cells[j]||'').replace(/^"|"$/g,''));
      out.push({
        id:o.id,name:o.name,phases:o.phases||'1–§',curve:o.curve||'C',InA:parseFloat(o.In_A||'16'),Icu:parseFloat(o.Icu_kA||'6'),
        U0:parseFloat(o.U0||'230'),ULL:parseFloat(o.ULL||'400'),Zs_src:parseFloat(o.source_Zs||'0.2'),mat:o.material||'Cu',
        S:parseFloat(o.S_mm2||'2.5'),L:parseFloat(o.length_m||'20'),peSame:o.pe_same||'–¢–∞–∫',ambientC:parseFloat(o.ambientC||'30'),
        url:o.url||'',notes:o.notes||''
      });
    }
    regs = out; regs.forEach(r=>calcOne(r.id)); render();
  }
  function splitCSV(line){
    const res=[]; let cur=''; let q=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else q=!q; }
      else if(ch===',' && !q){ res.push(cur); cur=''; }
      else { cur+=ch; }
    }
    res.push(cur); return res;
  }

  // ======= –ü–†–ò–ö–õ–ê–î =======
  function seedOne(){
    document.getElementById('id').value='SC-01';
    document.getElementById('name').value='–†–æ–∑–µ—Ç–∫–∏ –∞—É–¥–∏—Ç–æ—Ä—ñ—ó';
    document.getElementById('phases').value='1–§';
    document.getElementById('U0').value=230;
    document.getElementById('ULL').value=400;
    document.getElementById('curve').value='C';
    document.getElementById('InA').value=16;
    document.getElementById('Icu').value=6;
    document.getElementById('Zs_src').value=0.2;
    document.getElementById('mat').value='Cu';
    document.getElementById('S').value=2.5;
    document.getElementById('L').value=25;
    document.getElementById('peSame').value='–¢–∞–∫';
  }

  function seedDemo(){
    regs = [
      {id:'SC-01',name:'–†–æ–∑–µ—Ç–∫–∏ –∞—É–¥.101',phases:'1–§',U0:230,ULL:400,curve:'C',InA:16,Icu:6,Zs_src:0.20,mat:'Cu',S:2.5,L:25,peSame:'–¢–∞–∫',ambientC:30,url:'',notes:''},
      {id:'SC-02',name:'–î–≤–∏–≥—É–Ω 3–§ –≤–µ–Ω—Ç.',phases:'3–§',U0:230,ULL:400,curve:'D',InA:20,Icu:10,Zs_src:0.15,mat:'Cu',S:4,L:40,peSame:'–ù—ñ',ambientC:35,url:'',notes:'–ú–∏—Ç—Ç—î–≤–∏–π D'}
    ];
    regs.forEach(r=>calcOne(r.id));
  }

  // –ê–≤—Ç–æ-–¥–µ–º–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
  seedDemo();
</script>
</body>
</html>
