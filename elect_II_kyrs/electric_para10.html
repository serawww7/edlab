<!-- electric_para10.html
     –ü–∞—Ä–∞ 10 (–ï–ª–µ–∫—Ç—Ä–∏–∫–∏, –∞—É–¥–∏—Ç–æ—Ä–Ω–æ): –û–°–í–Ü–¢–õ–ï–ù–ù–Ø
     –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è (–ª—é–∫—Å-–º–µ—Ç–æ–¥), –ø—ñ–¥–±—ñ—Ä –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–≤—ñ—Ç–∏–ª—å–Ω–∏–∫—ñ–≤, —Å—Ç—Ä—É–º—ñ–≤ —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç—ñ–≤,
     —Ä–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏, –æ—Ü—ñ–Ω–∫–∞ –ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ ŒîU, –ø–∞–∫–µ—Ç –Ω–∞–∫–ª–µ–π–æ–∫ 58 –º–º, CSV, A4-–∑–≤—ñ—Ç.
     –ü–æ–≤–Ω—ñ—Å—Ç—é –∞–≤—Ç–æ–Ω–æ–º–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è GitHub Pages —ñ –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è –≤ Moodle —á–µ—Ä–µ–∑ <iframe>.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 10 ‚Äî –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è: –ª—é–∫—Å-–º–µ—Ç–æ–¥, –≥—Ä—É–ø–∏, –∞–≤—Ç–æ–º–∞—Ç–∏, ŒîU, –¥—Ä—É–∫ 58 –º–º</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{
    --bg:#0b1220; --bg2:#111827; --card:#0f172a; --text:#e2e8f0; --muted:#9aa5b1; --line:#1f2937;
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --info:#60a5fa;
  }
  *{box-sizing:border-box}
  body{margin:0; background:linear-gradient(180deg,var(--bg),var(--bg2) 30%,var(--bg)); color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55}
  .wrap{max-width:1120px; margin:0 auto; padding:24px 16px 96px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:#9aa5b1}
  h1{font-size:32px; margin:6px 0 12px; line-height:1.15; background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:22px 0 12px}
  h3{font-size:18px; margin:12px 0 8px; color:#cbd5e1}
  p{margin:8px 0}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:1050px){.g3{grid-template-columns:1fr}; .g2{grid-template-columns:1fr}}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid var(--line); background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .small{font-size:12px; color:#93a3b5}
  .chip{display:inline-block; padding:2px 8px; border:1px solid #223049; border-radius:999px; font-size:12px; margin-right:6px; background:#0d1a2e}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  input,select,textarea{padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e5e7eb; width:100%}

  /* –¢–∞–±–ª–∏—Ü—ñ */
  table{width:100%; border-collapse:separate; border-spacing:0; border:1px solid #223049; border-radius:12px; overflow:hidden}
  thead th{background:#0c1629; color:#a5b4fc; text-align:left; padding:10px 12px; font-size:14px}
  tbody td{padding:8px 10px; border-top:1px solid #1f2937; font-size:14px; vertical-align:top}
  tbody tr:nth-child(even){background:#0b1324}

  /* –ö–≤–∏—Ç–∞–Ω—Ü—ñ—ó 58 –º–º */
  .tickets{display:flex; gap:12px; flex-wrap:wrap}
  .ticket{
    width:58mm; background:#fff; color:#000; padding:5mm 4mm; border-radius:6px;
    box-shadow:0 0 0 1px #e5e7eb inset; font-family:"Courier New",ui-monospace,monospace
  }
  .ticket h4{margin:0 0 4px; font-size:13px; text-align:center}
  .ticket p{margin:1px 0; font-size:12px}
  .ticket .line{border-top:1px dashed #111; margin:5px 0}
  .ticket small{font-size:10px}
  .ticket .qr{font-size:10px; word-break:break-all}

  /* A4 */
  #printArea{background:#fff; color:#000; border-radius:12px; border:1px solid #e5e7eb; padding:16px}
  .doc{page-break-after:always; padding:12mm; color:#000; font-family:Georgia,"Times New Roman",serif}
  .doc h2{color:#000; font-size:20px; margin:0 0 6px}
  .doc h3{color:#000; font-size:16px; margin:6px 0}
  .doc p{color:#000; margin:4px 0}
  .doc table{width:100%; border-collapse:collapse; border:1px solid #111}
  .doc th,.doc td{border:1px solid #111; padding:6px 8px; font-size:12px; vertical-align:top}
  .doc .sign{margin-top:10mm; display:flex; gap:10mm; flex-wrap:wrap}
  .doc .sign div{flex:1 1 220px}

  /* –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (iframe/Moodle) */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}

  @media print{
    @page{ size:A4; margin:12mm }
    body{ background:#fff; color:#000 }
    .no-print, .card:not(.printable){ display:none !important }
    #printArea{ border:none; padding:0 }
    .ticket{ box-shadow:none; width:auto; padding:0 }
  }
</style>
</head>
<body>
  <div class="wrap">
    <span class="badge">–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 10 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ</span>
    <h1>üí° –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è: –ª—é–∫—Å-–º–µ—Ç–æ–¥ ‚Üí –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–≤—ñ—Ç–∏–ª—å–Ω–∏–∫—ñ–≤ ‚Üí –≥—Ä—É–ø–∏/–∞–≤—Ç–æ–º–∞—Ç–∏ ‚Üí ŒîU ‚Üí üßæ –Ω–∞–∫–ª–µ–π–∫–∏ 58 –º–º</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è –∑–∞ –ª—é–∫—Å-–º–µ—Ç–æ–¥–æ–º, –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–≤—ñ—Ç–∏–ª—å–Ω–∏–∫—ñ–≤ —Ç–∞ —ó—Ö —Å—Ö–µ–º—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è, —Ä–æ–∑–±–∏—Ç–∏ –Ω–∞ –≥—Ä—É–ø–∏, –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏ –∑–∞—Ö–∏—Å—Ç—É, –æ—Ü—ñ–Ω–∏—Ç–∏ –ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ –π –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –ø–∞–∫–µ—Ç –Ω–∞–∫–ª–µ–π–æ–∫ 58 –º–º —Ç–∞ A4-–∑–≤—ñ—Ç.</p>
      <p class="small">–§–æ—Ä–º—É–ª–∏: <span class="mono">N = ceil( E<sub>–Ω</sub>¬∑S / (Œ¶¬∑UF¬∑MF) )</span>, <span class="mono">I = P<sub>‚àë</sub> / (U¬∑PF)</span>, <span class="mono">ŒîU% ‚âà I ¬∑ 2¬∑L¬∑œÅ / (S<sub>–ø—Ä–æ–≤</sub> ¬∑ U) ¬∑ 100</span> –¥–ª—è 1—Ñ –ª—ñ–Ω—ñ—ó (–Ω–∞–≤—á–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞, Cu œÅ=0.0175 Œ©¬∑–º–º¬≤/–º).</p>
    </div>

    <div class="card">
      <h2>üè¢ –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è</h2>
      <div class="grid g3">
        <div>
          <div class="row"><label class="small" style="min-width:140px">–ù–∞–∑–≤–∞/–∞–¥—Ä–µ—Å–∞</label><input id="room" value="–ú–∞–π—Å—Ç–µ—Ä–Ω—è ¬∑ 101"></div>
          <div class="row"><label class="small" style="min-width:140px">–î–æ–≤–∂–∏–Ω–∞, –º</label><input id="len" type="number" step="0.1" value="12"></div>
          <div class="row"><label class="small" style="min-width:140px">–®–∏—Ä–∏–Ω–∞, –º</label><input id="wid" type="number" step="0.1" value="8"></div>
          <div class="row"><label class="small" style="min-width:140px">–í–∏—Å–æ—Ç–∞, –º</label><input id="h" type="number" step="0.1" value="3.2"></div>
        </div>
        <div>
          <div class="row"><label class="small" style="min-width:140px">–ù–æ—Ä–º–æ–≤–∞–Ω–∏–π –ª—é–∫—Å E–Ω</label><input id="lux" type="number" value="300"></div>
          <div class="row"><label class="small" style="min-width:140px">–°–≤—ñ—Ç–ª–æ–≤–∏–π –ø–æ—Ç—ñ–∫ Œ¶, –ª–º/—Å–≤—ñ—Ç.</label><input id="phi" type="number" value="4000"></div>
          <div class="row"><label class="small" style="min-width:140px">UF (–≤–∏–∫–æ—Ä.—Ñ–∞–∫—Ç–æ—Ä)</label><input id="uf" type="number" step="0.05" value="0.7"></div>
          <div class="row"><label class="small" style="min-width:140px">MF (–∫–æ–µ—Ñ.–∑–∞–ø–∞—Å—É)</label><input id="mf" type="number" step="0.05" value="0.8"></div>
        </div>
        <div>
          <div class="row"><label class="small" style="min-width:140px">P –Ω–∞ —Å–≤—ñ—Ç–∏–ª—å–Ω–∏–∫, –í—Ç</label><input id="pLamp" type="number" value="36"></div>
          <div class="row"><label class="small" style="min-width:140px">PF (cosœÜ)</label><input id="pf" type="number" step="0.05" value="0.95"></div>
          <div class="row"><label class="small" style="min-width:140px">–ù–∞–ø—Ä—É–≥–∞, –í</label><input id="U" type="number" value="230"></div>
          <div class="row"><label class="small" style="min-width:140px">–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π</label><input id="resp" value="–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞"></div>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" onclick="calcLumen()">üß© –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ª—é–º–µ–Ω—ñ–≤/–∫—ñ–ª—å–∫–æ—Å—Ç—ñ</button>
        <button class="btn" onclick="seedDemo()">üîÑ –ü—Ä–∏–∫–ª–∞–¥</button>
      </div>
      <p id="lumenOut" class="small"></p>
    </div>

    <div class="card">
      <h2>üßÆ –†–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏, –¥—Ä–æ—Ç–∏, –∞–≤—Ç–æ–º–∞—Ç–∏, ŒîU</h2>
      <div class="grid g3">
        <div>
          <h3>–ì—Ä—É–ø—É–≤–∞–Ω–Ω—è</h3>
          <div class="row"><label class="small" style="min-width:140px">–°–≤—ñ—Ç–∏–ª—å–Ω–∏–∫—ñ–≤ –≤—Å—å–æ–≥–æ</label><input id="N" type="number" value="0"></div>
          <div class="row"><label class="small" style="min-width:140px">–ú–∞–∫—Å. —É –≥—Ä—É–ø—ñ</label><input id="perGroup" type="number" value="8"></div>
          <div class="row"><label class="small" style="min-width:140px">–ö-—Ç—å –≥—Ä—É–ø (–∞–≤—Ç–æ)</label><input id="groups" type="number" value="0" readonly></div>
          <div class="row"><button class="btn" onclick="makeGroups()">üß© –†–æ–∑–±–∏—Ç–∏ –Ω–∞ –≥—Ä—É–ø–∏</button></div>
          <p class="small">–†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—è—î–º–æ —Å–≤—ñ—Ç–∏–ª—å–Ω–∏–∫–∏ –º—ñ–∂ –≥—Ä—É–ø–∞–º–∏.</p>
        </div>
        <div>
          <h3>–õ—ñ–Ω—ñ—è (1—Ñ, Cu)</h3>
          <div class="row"><label class="small" style="min-width:140px">–î–æ–≤–∂–∏–Ω–∞ –ª—ñ–Ω—ñ—ó L, –º</label><input id="L" type="number" value="35"></div>
          <div class="row"><label class="small" style="min-width:140px">–°–µ–∫—Ü—ñ—è –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫–∞, –º–º¬≤</label>
            <select id="S"><option>1.5</option><option selected>2.5</option><option>4</option><option>6</option></select></div>
          <div class="row"><label class="small" style="min-width:140px">–ì—Ä—É–ø–æ–≤–∏–π PF</label><input id="pfG" type="number" step="0.05" value="0.95"></div>
          <div class="row"><label class="small" style="min-width:140px">–î–æ–ø—É—Å—Ç–∏–º–∞ ŒîU, %</label><input id="dropLimit" type="number" step="0.1" value="3"></div>
        </div>
        <div>
          <h3>–ê–≤—Ç–æ–º–∞—Ç (MCB)</h3>
          <div class="row"><label class="small" style="min-width:140px">–ö—Ä–∏–≤–∞</label>
            <select id="curve"><option>B</option><option selected>C</option><option>D</option></select></div>
          <div class="row"><label class="small" style="min-width:140px">–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏ In, –ê</label>
            <select id="standard">
              <option>6</option><option selected>10</option><option>13</option><option>16</option><option>20</option>
            </select></div>
          <div class="row"><button class="btn" onclick="calcLines()">üßÆ –û–±—á–∏—Å–ª–∏—Ç–∏ —Å—Ç—Ä—É–º–∏/ŒîU/MCB</button></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>üìã –¢–∞–±–ª–∏—Ü—è –≥—Ä—É–ø –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è</h2>
      <table id="tbl">
        <thead>
          <tr>
            <th>#</th><th>–ê–¥—Ä–µ—Å–∞</th><th>–°–≤—ñ—Ç–∏–ª—å–Ω–∏–∫–∏ (—à—Ç)</th><th>P‚àë, –í—Ç</th><th>I, –ê</th><th>MCB, –ê</th><th>–ö—Ä–∏–≤–∞</th><th>–ü—Ä–æ–≤—ñ–¥, –º–º¬≤</th><th>ŒîU, %</th><th>–°—Ç–∞—Ç—É—Å</th><th>URL</th><th>–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p class="small">–ü–æ–¥–≤—ñ–π–Ω–µ –∫–ª–∞—Ü–∞–Ω–Ω—è –ø–æ –∫–ª—ñ—Ç–∏–Ω—Ü—ñ ‚Äî —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è. –°—Ç–∞—Ç—É—Å: <span class="chip ok">PASS</span> ‚Äî ŒîU ‚â§ –ª—ñ–º—ñ—Ç; <span class="chip bad">FAIL</span> ‚Äî –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" onclick="exportCSV()">üì§ –ï–∫—Å–ø–æ—Ä—Ç CSV</button>
        <input id="file" type="file" accept=".csv,text/csv" class="btn" />
        <button class="btn" onclick="importCSV()">‚¨ÜÔ∏è –Ü–º–ø–æ—Ä—Ç CSV</button>
      </div>
    </div>

    <div class="card printable">
      <h2>üßæ –ù–∞–∫–ª–µ–π–∫–∏ 58 –º–º (–≥—Ä—É–ø–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è)</h2>
      <div class="row">
        <button class="btn" onclick="buildTickets()">üß© –ó—ñ–±—Ä–∞—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö</button>
        <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫ 58 –º–º</button>
        <button class="btn" onclick="downloadTXT()">üì• TXT</button>
      </div>
      <div id="tickets" class="tickets"></div>
    </div>

    <div class="card printable">
      <h2>üìÑ A4-–∑–≤—ñ—Ç (–¥–ª—è –¥—Ä—É–∫—É/PDF)</h2>
      <div class="row">
        <button class="btn" onclick="buildReport()">üß© –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ A4</button>
        <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫/PDF</button>
      </div>
      <div id="printArea"></div>
    </div>
  </div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // –°—Ç–∞–Ω
  let groups = []; // {id, addr, n, Psum, I, mcb, curve, S, drop, status, url}
  const tbody = document.querySelector('#tbl tbody');
  const ticketsBox = document.getElementById('tickets');

  function esc(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
  function pad2(n){ return n.toString().padStart(2,'0'); }
  function nowStamp(){ const d=new Date(); const p=n=>n.toString().padStart(2,'0'); return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`; }

  // –õ—é–∫—Å-–º–µ—Ç–æ–¥
  function calcLumen(){
    const L = parseFloat(document.getElementById('len').value||'0');
    const W = parseFloat(document.getElementById('wid').value||'0');
    const E = parseFloat(document.getElementById('lux').value||'0');
    const phi = parseFloat(document.getElementById('phi').value||'0');
    const UF = parseFloat(document.getElementById('uf').value||'0.7');
    const MF = parseFloat(document.getElementById('mf').value||'0.8');
    const S = L*W;
    const N = Math.ceil((E*S)/(phi*UF*MF));
    const pLamp = parseFloat(document.getElementById('pLamp').value||'0');
    const Psum = N * pLamp;
    document.getElementById('N').value = isFinite(N)?N:0;
    document.getElementById('lumenOut').innerHTML = `–ü–ª–æ—â–∞ S = <b>${S.toFixed(2)} –º¬≤</b>; –ü–æ—Ç—Ä—ñ–±–Ω–∏–π —Å–≤—ñ—Ç–ª–æ–≤–∏–π –ø–æ—Ç—ñ–∫: <span class="mono">${(E*S).toFixed(0)} –ª–º</span> ‚Üí –°–≤—ñ—Ç–∏–ª—å–Ω–∏–∫—ñ–≤: <span class="mono">${N}</span>; –°—É–º–∞—Ä–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: <span class="mono">${Psum.toFixed(0)} –í—Ç</span>.`;
  }

  // –†–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏
  function makeGroups(){
    const room = document.getElementById('room').value.trim() || '–ü—Ä–∏–º—ñ—â–µ–Ω–Ω—è';
    const N = parseInt(document.getElementById('N').value||'0',10);
    const per = Math.max(1, parseInt(document.getElementById('perGroup').value||'8',10));
    const gCount = Math.ceil(N/per);
    document.getElementById('groups').value = gCount;
    const pLamp = parseFloat(document.getElementById('pLamp').value||'0');
    const U = parseFloat(document.getElementById('U').value||'230');
    const pf = parseFloat(document.getElementById('pfG').value||document.getElementById('pf').value||'0.95');
    groups = [];
    let rest = N;
    for(let i=1;i<=gCount;i++){
      const nHere = Math.min(per, rest); rest -= nHere;
      const Psum = nHere * pLamp; // –í—Ç
      const I = U>0 ? (Psum/(U*pf)) : 0; // –ê
      const addr = `${room}/–û—Å–≤-${pad2(i)}`;
      groups.push({
        id:'G'+Math.random().toString(36).slice(2,7).toUpperCase(),
        addr, n:nHere, Psum, I, mcb:10, curve:document.getElementById('curve').value,
        S: parseFloat(document.getElementById('S').value||'2.5'),
        drop:0, status:'‚Äî', url:''
      });
    }
    render(); // –ø–µ—Ä–≤–∏–Ω–Ω–∏–π —Ä–µ–Ω–¥–µ—Ä
  }

  // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å—Ç—Ä—É–º—ñ–≤/ŒîU/MCB –ø—ñ–¥–±—ñ—Ä
  function calcLines(){
    const U = parseFloat(document.getElementById('U').value||'230');
    const Lm = parseFloat(document.getElementById('L').value||'30');
    const Smm = parseFloat(document.getElementById('S').value||'2.5');
    const pf = parseFloat(document.getElementById('pfG').value||'0.95');
    const limit = parseFloat(document.getElementById('dropLimit').value||'3');
    const curve = document.getElementById('curve').value;
    const std = parseInt(document.getElementById('standard').value||'10',10);
    const rho = 0.0175; // Œ©¬∑–º–º¬≤/–º, Cu

    groups.forEach(g=>{
      // –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ I –Ω–∞ –±–∞–∑—ñ Psum —Ç–∞ PF (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫ –∑–º—ñ–Ω)
      g.I = U>0 ? (g.Psum/(U*pf)) : 0;
      // ŒîU% = I ¬∑ 2*L*œÅ / (S*U) * 100
      const drop = (g.I * 2 * Lm * rho) / (Smm * U) * 100;
      g.drop = Math.round(drop*100)/100;
      g.S = Smm;
      g.curve = curve;
      // –ü—ñ–¥–±—ñ—Ä –∞–≤—Ç–æ–º–∞—Ç–∞ (–Ω–∞–≤—á–∞–ª—å–Ω–æ): In ‚â• I*1.25, –∑ —Ä—è–¥—É [6,10,13,16,20]
      const need = g.I * 1.25;
      const row = [6,10,13,16,20];
      let pick = row.find(x=>x>=need) || 20;
      // –∞–ª–µ –Ω–µ –º–µ–Ω—à–µ –∑–∞ std, —è–∫—â–æ —Å—Ç—É–¥–µ–Ω—Ç —è–≤–Ω–æ –æ–±—Ä–∞–≤ —ñ–Ω—à–∏–π —Ä—è–¥
      pick = Math.max(pick, std);
      g.mcb = pick;
      g.status = (g.drop <= limit) ? 'PASS' : 'FAIL';
    });
    render();
  }

  function render(){
    tbody.innerHTML='';
    groups.forEach((g,i)=>{
      const tr = document.createElement('tr');
      const badge = `<span class="mono" style="padding:2px 8px;border:1px solid #223049;border-radius:999px;background:#0d1a2e;color:${g.status==='PASS'?'#22c55e':'#ef4444'}">${g.status}</span>`;
      tr.innerHTML = `
        <td>${i+1}</td>
        <td class="editable" data-k="addr" data-id="${g.id}">${esc(g.addr)}</td>
        <td class="editable" data-k="n" data-id="${g.id}">${esc(g.n)}</td>
        <td class="editable" data-k="Psum" data-id="${g.id}">${esc(Math.round(g.Psum))}</td>
        <td class="editable" data-k="I" data-id="${g.id}">${esc((Math.round(g.I*100)/100).toFixed(2))}</td>
        <td class="editable" data-k="mcb" data-id="${g.id}">${esc(g.mcb)}</td>
        <td class="editable" data-k="curve" data-id="${g.id}">${esc(g.curve)}</td>
        <td class="editable" data-k="S" data-id="${g.id}">${esc(g.S)}</td>
        <td class="editable" data-k="drop" data-id="${g.id}">${esc(g.drop)}</td>
        <td>${badge}</td>
        <td class="editable" data-k="url" data-id="${g.id}">${esc(g.url||'')}</td>
        <td class="mono">
          <button class="btn" data-act="label" data-id="${g.id}">–ù–∞–∫–ª–µ–π–∫–∞</button>
          <button class="btn" data-act="del" data-id="${g.id}">‚úñ</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–ª—ñ—Ç–∏–Ω–æ–∫
  tbody.addEventListener('dblclick', (e)=>{
    const td = e.target.closest('.editable'); if(!td) return;
    const id = td.getAttribute('data-id');
    const key = td.getAttribute('data-k');
    const idx = groups.findIndex(x=>x.id===id);
    const g = groups[idx];
    const input = document.createElement('input'); input.value = g[key] || ''; input.style.width='100%'; input.style.padding='6px 8px';
    input.addEventListener('blur', ()=>{
      let v = input.value.trim();
      if(['n','Psum','I','mcb','S','drop'].includes(key)) v = parseFloat(v.replace(',','.')) || 0;
      g[key] = v;
      render();
    });
    td.innerHTML=''; td.appendChild(input); input.focus(); input.select();
  });

  // –î—ñ—ó
  tbody.addEventListener('click', (e)=>{
    const b = e.target.closest('button'); if(!b) return;
    const id = b.getAttribute('data-id'); const act = b.getAttribute('data-act');
    if(act==='del'){ groups = groups.filter(x=>x.id!==id); render(); return; }
    if(act==='label'){ const g = groups.find(x=>x.id===id); buildTickets([g]); ticketsBox.scrollIntoView({behavior:'smooth'}); }
  });

  // –ö–≤–∏—Ç–∞–Ω—Ü—ñ—ó 58 –º–º
  function buildTickets(list){
    const L = list || groups;
    ticketsBox.innerHTML='';
    const room = document.getElementById('room').value.trim() || '–ü—Ä–∏–º—ñ—â–µ–Ω–Ω—è';
    const resp = document.getElementById('resp').value.trim() || '‚Äî';
    L.forEach(g=>{
      const el = document.createElement('div');
      el.className='ticket';
      const urlText = g.url ? g.url : `https://serawww7.github.io/edlab/electric_para10.html#${encodeURIComponent(g.addr)}`;
      el.innerHTML = `
        <h4>–ì–†–£–ü–ê –û–°–í–Ü–¢–õ–ï–ù–ù–Ø</h4>
        <p><b>${esc(room)}</b></p>
        <div class="line"></div>
        <p>–ê–¥—Ä–µ—Å–∞: <b>${esc(g.addr)}</b></p>
        <p>–°–≤—ñ—Ç–∏–ª—å–Ω–∏–∫—ñ–≤: ${esc(g.n)} —à—Ç ¬∑ P‚àë ${Math.round(g.Psum)} –í—Ç</p>
        <p>MCB ${esc(g.curve)}${esc(g.mcb)} ¬∑ –ü—Ä–æ–≤—ñ–¥: ${esc(g.S)} –º–º¬≤</p>
        <p>ŒîU: ${esc(g.drop)}% ¬∑ –°—Ç–∞—Ç—É—Å: ${esc(g.status||'‚Äî')}</p>
        <div class="line"></div>
        <p class="qr"><small>URL/NFC: ${esc(urlText)}</small></p>
        <p><small>${nowStamp()} ¬∑ –í—ñ–¥–ø.: ${esc(resp)}</small></p>
      `;
      ticketsBox.appendChild(el);
    });
  }
  function downloadTXT(){
    if(!ticketsBox.firstChild){ alert('–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –Ω–∞–∫–ª–µ–π–∫–∏'); return; }
    const lines=['LIGHT GROUP LABELS 58mm','----------------------'];
    Array.from(ticketsBox.children).forEach(t=>{ lines.push(t.innerText.replace(/\n{2,}/g,'\n')); lines.push('----------------------'); });
    const blob = new Blob([lines.join('\n')], {type:'text/plain;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='light_groups_58mm.txt'; a.click(); URL.revokeObjectURL(a.href);
  }

  // A4-–∑–≤—ñ—Ç
  function buildReport(){
    if(!groups.length){ alert('–ù–µ–º–∞—î –≥—Ä—É–ø'); return; }
    const L = parseFloat(document.getElementById('len').value||'0');
    const W = parseFloat(document.getElementById('wid').value||'0');
    const H = parseFloat(document.getElementById('h').value||'0');
    const E = parseFloat(document.getElementById('lux').value||'0');
    const phi = parseFloat(document.getElementById('phi').value||'0');
    const UF = parseFloat(document.getElementById('uf').value||'0.7');
    const MF = parseFloat(document.getElementById('mf').value||'0.8');
    const pLamp = parseFloat(document.getElementById('pLamp').value||'0');
    const N = parseInt(document.getElementById('N').value||'0',10);
    const S = L*W;
    const room = esc(document.getElementById('room').value.trim() || '–ü—Ä–∏–º—ñ—â–µ–Ω–Ω—è');
    const resp = esc(document.getElementById('resp').value.trim() || '‚Äî');

    const rowsHTML = groups.map((g,i)=>`
      <tr>
        <td>${i+1}</td><td>${esc(g.addr)}</td><td>${esc(g.n)}</td><td>${Math.round(g.Psum)}</td>
        <td>${(Math.round(g.I*100)/100).toFixed(2)}</td><td>${esc(g.curve)}${esc(g.mcb)}</td>
        <td>${esc(g.S)}</td><td>${esc(g.drop)}%</td><td>${esc(g.status)}</td>
      </tr>
    `).join('');

    const doc = `
      <section class="doc">
        <h2>–†–û–ó–†–ê–•–£–ù–û–ö –û–°–í–Ü–¢–õ–ï–ù–ù–Ø –¢–ê –ì–†–£–ü–û–í–ò–• –õ–Ü–ù–Ü–ô</h2>
        <p>–û–±‚Äô—î–∫—Ç: ${room} ¬∑ –î–∞—Ç–∞: ${nowStamp()}</p>
        <h3>1. –í–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ</h3>
        <table>
          <tbody>
            <tr><td>–ì–µ–æ–º–µ—Ç—Ä—ñ—è</td><td>L=${L} –º; W=${W} –º; H=${H} –º; S=${S.toFixed(2)} –º¬≤</td></tr>
            <tr><td>–ù–æ—Ä–º–æ–≤–∞–Ω–∏–π E–Ω</td><td>${E} –ª–∫</td></tr>
            <tr><td>–°–≤—ñ—Ç–∏–ª—å–Ω–∏–∫</td><td>Œ¶=${phi} –ª–º; P<sub>–æ–¥</sub>=${pLamp} –í—Ç; UF=${UF}; MF=${MF}</td></tr>
            <tr><td>–†–µ–∑—É–ª—å—Ç–∞—Ç –ª—é–∫—Å-–º–µ—Ç–æ–¥—É</td><td>–ü–æ—Ç—Ä—ñ–±–Ω–æ —Å–≤—ñ—Ç–∏–ª—å–Ω–∏–∫—ñ–≤: <b>${N}</b></td></tr>
            <tr><td>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π</td><td>${resp}</td></tr>
          </tbody>
        </table>
        <h3>2. –ì—Ä—É–ø–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è</h3>
        <table>
          <thead><tr><th>#</th><th>–ê–¥—Ä–µ—Å–∞</th><th>–°–≤—ñ—Ç.</th><th>P‚àë, –í—Ç</th><th>I, –ê</th><th>MCB</th><th>–ü—Ä–æ–≤—ñ–¥, –º–º¬≤</th><th>ŒîU, %</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
          <tbody>${rowsHTML}</tbody>
        </table>
        <h3>3. –í–∏—Å–Ω–æ–≤–æ–∫</h3>
        <p>–ì—Ä—É–ø –∑ PASS: ${groups.filter(g=>g.status==='PASS').length}; –∑ FAIL: ${groups.filter(g=>g.status==='FAIL').length}.</p>
        <div class="sign">
          <div>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å: ______________________ / ${resp}</div>
          <div>–ö–µ—Ä—ñ–≤–Ω–∏–∫ —Ä–æ–±—ñ—Ç: ______________________</div>
        </div>
        <p class="small">–ü—Ä–∏–º—ñ—Ç–∫–∞: ŒîU ‚Äî –Ω–∞–≤—á–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –¥–ª—è 1—Ñ –ª—ñ–Ω—ñ—ó; —É —Ä–µ–∞–ª—å–Ω–∏—Ö –ø—Ä–æ—î–∫—Ç–∞—Ö –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Å–ø–æ—Å—ñ–± –ø—Ä–æ–∫–ª–∞–¥–∫–∏, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, –∫–æ—Ä–µ–∫—Ü—ñ—ó –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å, –≥–∞—Ä–º–æ–Ω—ñ–∫–∏ —Ç–æ—â–æ.</p>
      </section>`;
    document.getElementById('printArea').innerHTML = doc;
    document.getElementById('printArea').scrollIntoView({behavior:'smooth'});
  }

  // CSV
  function exportCSV(){
    const headers = ['addr','lamps','Psum_W','I_A','MCB_A','curve','wire_mm2','drop_pct','status','url','room','resp','timestamp'];
    const room = document.getElementById('room').value.trim();
    const resp = document.getElementById('resp').value.trim();
    const stamp = nowStamp();
    const csv = [headers.join(','), ...groups.map(g=>[
      g.addr, g.n, Math.round(g.Psum), (Math.round(g.I*100)/100).toFixed(2), g.mcb, g.curve, g.S, g.drop, g.status, g.url||'', room, resp, stamp
    ].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','))].join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='lighting_groups.csv'; a.click(); URL.revokeObjectURL(a.href);
  }

  async function importCSV(){
    const f=document.getElementById('file').files[0]; if(!f){ alert('–û–±–µ—Ä—ñ—Ç—å CSV'); return; }
    const txt=await f.text();
    const lines=txt.trim().split(/\r?\n/); if(lines.length<2){ alert('CSV –ø–æ—Ä–æ–∂–Ω—ñ–π'); return; }
    const headers=lines[0].split(',').map(h=>h.replace(/^"|"$/g,'').trim());
    const req=['addr','lamps','Psum_W','I_A','MCB_A','curve','wire_mm2','drop_pct','status','url'];
    const miss=req.filter(x=>!headers.includes(x)); if(miss.length){ alert('–í—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è: '+miss.join(', ')); return; }
    const out=[];
    for(let i=1;i<lines.length;i++){
      const cells=splitCSV(lines[i]); if(!cells.length) continue;
      const o={}; headers.forEach((h,j)=>o[h]=(cells[j]||'').replace(/^"|"$/g,''));
      out.push({
        id:'G'+Math.random().toString(36).slice(2,7).toUpperCase(),
        addr:o.addr, n:parseInt(o.lamps,10)||0, Psum:parseFloat(o.Psum_W)||0, I:parseFloat(o.I_A)||0,
        mcb:parseInt(o.MCB_A,10)||10, curve:o.curve||'C', S:parseFloat(o.wire_mm2)||2.5,
        drop:parseFloat(o.drop_pct)||0, status:o.status||'‚Äî', url:o.url||''
      });
    }
    groups = out; render();
  }
  function splitCSV(line){
    const res=[]; let cur=''; let q=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else q=!q; }
      else if(ch===',' && !q){ res.push(cur); cur=''; }
      else { cur+=ch; }
    }
    res.push(cur); return res;
  }

  // –ü—Ä–∏–∫–ª–∞–¥
  function seedDemo(){
    document.getElementById('room').value='–ú–∞–π—Å—Ç–µ—Ä–Ω—è ¬∑ 101';
    document.getElementById('len').value=12;
    document.getElementById('wid').value=8;
    document.getElementById('h').value=3.2;
    document.getElementById('lux').value=300;
    document.getElementById('phi').value=4000;
    document.getElementById('uf').value=0.7;
    document.getElementById('mf').value=0.8;
    document.getElementById('pLamp').value=36;
    document.getElementById('pf').value=0.95;
    document.getElementById('U').value=230;
    document.getElementById('resp').value='–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞';
    calcLumen();
    document.getElementById('perGroup').value=6;
    makeGroups();
    document.getElementById('L').value=35;
    document.getElementById('S').value=2.5;
    document.getElementById('curve').value='C';
    document.getElementById('standard').value=10;
    document.getElementById('dropLimit').value=3;
    calcLines();
    buildTickets();
  }

  // –ê–≤—Ç–æ-–¥–µ–º–æ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ
  seedDemo();
</script>
</body>
</html>
