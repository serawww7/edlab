<!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü–∞—Ä–∞ 22 (–ï–ª–µ–∫—Ç—Ä–∏–∫–∞) ‚Äî –®–Ü: –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å—Ç–∞–Ω—ñ–≤ –º–µ—Ä–µ–∂—ñ + –∞–Ω–æ–º–∞–ª—ñ—ó (k-NN)</title>
<meta name="description" content="–Ü–º–ø–æ—Ä—Ç CSV —ñ–∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏ (Vrms, Irms, PF, THD, Temp), –Ω–∞–≤—á–∞–Ω–Ω—è k-NN, –¥–µ—Ç–µ–∫—Ç–æ—Ä –∞–Ω–æ–º–∞–ª—ñ–π (—Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π–Ω–∞ –ø–æ—Ö–∏–±–∫–∞), –º–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫, –µ–º—É–ª—è—Ç–æ—Ä, –∂—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥, –µ–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª—ñ JSON, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∫–µ—Ç—á–∞ Arduino.">
<meta name="color-scheme" content="light dark">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e6eef9;--line:#223049;--brand:#38bdf8;--ok:#22c55e;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial,sans-serif}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo .emoji{font-size:28px}
.logo .badge{font-size:.9rem;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
h1{margin:.2em 0 .3em 0}
.muted{color:var(--muted)}
.card{border:1px solid var(--line);border-radius:16px;background:var(--panel);padding:14px;margin-top:14px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--text)}
.btn{border:1px solid var(--line);background:#0f1f39;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.secondary{background:transparent}
.btn.good{border-color:#204b2a;background:#12341b}
.badge{display:inline-block;border:1px solid #334155;border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px}
pre.code{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;white-space:pre-wrap}
.small{font-size:.9rem}
.tbl{width:100%;border-collapse:collapse;font-size:.95rem}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px;text-align:left;vertical-align:top}
.tbl th{background:#0b1a2f}
.canvasWrap{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1220}
canvas{display:block;width:100%;height:260px}
.ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
.footer{margin-top:20px;color:var(--muted);font-size:.9rem}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);margin-right:6px;margin-top:6px}
svg{max-width:100%;height:auto;display:block}
.note{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0c182a}
kbd{background:#111827;border:1px solid #334155;border-radius:6px;padding:2px 6px}
</style>
<link rel="canonical" href="https://edlab.pp.ua/elect_II_kyrs/electric_para22.html"><meta property="og:type" content="article"><meta property="og:title" content="–ï–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ ‚Äî –ü–∞—Ä–∞ 22"><meta property="og:description" content="–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏ –º–æ–¥–µ–ª—å —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏ —Å—Ç–∞–Ω–∏ –º–µ—Ä–µ–∂—ñ (–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π, –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –ø–µ—Ä–µ–∫—ñ—Å —Ñ–∞–∑/–Ω–∏–∑—å–∫–∏–π PF, –≤–∏—Å–æ–∫–∏–π THD, –ø–µ—Ä–µ–≥—Ä—ñ–≤) –∑–∞ –æ–∑–Ω–∞–∫–∞–º–∏ Vrms, Irms, PF, THD,"><meta property="og:url" content="https://edlab.pp.ua/elect_II_kyrs/electric_para22.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"–ï–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ ‚Äî –ü–∞—Ä–∞ 22","description":"–ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏ –º–æ–¥–µ–ª—å —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏ —Å—Ç–∞–Ω–∏ –º–µ—Ä–µ–∂—ñ (–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π, –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –ø–µ—Ä–µ–∫—ñ—Å —Ñ–∞–∑/–Ω–∏–∑—å–∫–∏–π PF, –≤–∏—Å–æ–∫–∏–π THD, –ø–µ—Ä–µ–≥—Ä—ñ–≤) –∑–∞ –æ–∑–Ω–∞–∫–∞–º–∏ Vrms, Irms, PF, THD,","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/elect_II_kyrs/electric_para22.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <span class="emoji">üß†</span>
      <div>
        <b>–ü–∞—Ä–∞ 22 ‚Äî –®–Ü: –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å—Ç–∞–Ω—ñ–≤ –º–µ—Ä–µ–∂—ñ + –∞–Ω–æ–º–∞–ª—ñ—ó</b><br>
        <span class="badge">CSV ‚Üí —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è k-NN ‚Üí –º–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫ ‚Üí –∂–∏–≤–∏–π –º–æ–Ω—ñ—Ç–æ—Ä ‚Üí —Ç—Ä–∏–≤–æ–≥–∏ ‚Üí –µ–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª—ñ ‚Üí –ø—Ä–æ–º–ø—Ç LLM</span>
      </div>
    </div>
    <a class="btn" href="../index.html" target="_blank" rel="noopener">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <p class="muted">
    –ú–µ—Ç–∞: –Ω–∞–≤—á–∏—Ç–∏ –º–æ–¥–µ–ª—å <b>—Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏ —Å—Ç–∞–Ω–∏ –º–µ—Ä–µ–∂—ñ</b> (–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π, –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –ø–µ—Ä–µ–∫—ñ—Å —Ñ–∞–∑/–Ω–∏–∑—å–∫–∏–π PF, –≤–∏—Å–æ–∫–∏–π THD, –ø–µ—Ä–µ–≥—Ä—ñ–≤)
    –∑–∞ –æ–∑–Ω–∞–∫–∞–º–∏ <span class="mono">Vrms, Irms, PF, THD, Temp</span>, —Ç–∞ –≤–∏—è–≤–ª—è—Ç–∏ <b>–∞–Ω–æ–º–∞–ª—ñ—ó</b>.
    –Ñ –Ω–∞–≤—á–∞–Ω–Ω—è/—Ç–µ—Å—Ç, <b>–º–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫</b>, <b>–µ–º—É–ª—è—Ç–æ—Ä</b> –¥–ª—è –æ–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, –∂—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥, –µ–∫—Å–ø–æ—Ä—Ç <b>model.json</b> —ñ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä <b>.ino</b>.
  </p>

  <div class="card">
    <h2>üóÇÔ∏è –î–∞–Ω—ñ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è/—Ç–µ—Å—Ç—É (CSV)</h2>
    <p class="small muted">–§–æ—Ä–º–∞—Ç: <span class="mono">Vrms,Irms,PF,THD,Temp,label</span> (label ‚àà {normal, overload, low_pf, high_thd, overtemp}).</p>
    <textarea id="csv" class="input" rows="7" placeholder="Vrms,Irms,PF,THD,Temp,label"></textarea>
    <div class="row">
      <button class="btn good" id="load">üì• –Ü–º–ø–æ—Ä—Ç</button>
      <button class="btn secondary" id="demo">üé≤ –î–µ–º–æ–¥–∞–Ω—ñ</button>
      <button class="btn secondary" id="clear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      <span id="badgeN" class="badge">–ó–∞–ø–∏—Å—ñ–≤: 0</span>
    </div>

    <h2 style="margin-top:12px">üß™ –ù–∞–≤—á–∞–Ω–Ω—è / –¢–µ—Å—Ç</h2>
    <div class="row">
      <div style="flex:1">
        <label for="k">k –¥–ª—è k-NN</label>
        <input id="k" class="input" type="number" min="1" step="1" value="5">
      </div>
      <div style="flex:1">
        <label for="split">Train/Test, % (train)</label>
        <input id="split" class="input" type="number" min="50" max="90" step="1" value="70">
      </div>
      <div style="flex:1">
        <label for="anomThr">–ü–æ—Ä—ñ–≥ –∞–Ω–æ–º–∞–ª—ñ—ó (recon err)</label>
        <input id="anomThr" class="input" type="number" min="0" step="0.01" value="0.25">
      </div>
    </div>
    <div class="row" style="margin-top:6px">
      <button class="btn good" id="train">üèãÔ∏è –¢—Ä–µ–Ω—É–≤–∞—Ç–∏</button>
      <button class="btn secondary" id="test">üß™ –¢–µ—Å—Ç</button>
      <button class="btn secondary" id="exportModel">‚¨áÔ∏è –ï–∫—Å–ø–æ—Ä—Ç model.json</button>
      <span id="badgeRes" class="badge">Acc: ‚Äî | F1: ‚Äî</span>
    </div>

    <h3 style="margin-top:12px">üìä –ú–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫</h3>
    <table class="tbl" id="cmat">
      <thead><tr><th>Pred \\ True</th><th>normal</th><th>overload</th><th>low_pf</th><th>high_thd</th><th>overtemp</th></tr></thead>
      <tbody>
        <tr><th>normal</th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
        <tr><th>overload</th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
        <tr><th>low_pf</th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
        <tr><th>high_thd</th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
        <tr><th>overtemp</th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
      </tbody>
    </table>
  </div>

  <div class="card">
    <h2>‚ö° –ï–º—É–ª—è—Ç–æ—Ä —ñ –∂–∏–≤–∏–π –º–æ–Ω—ñ—Ç–æ—Ä</h2>
    <div class="row">
      <label style="flex:1">Vrms, –í <input id="ev" class="input" type="range" min="180" max="260" step="1" value="230"></label>
      <label style="flex:1">Irms, –ê <input id="ei" class="input" type="range" min="0" max="30" step="0.1" value="3.0"></label>
      <label style="flex:1">PF (cos œÜ) <input id="epf" class="input" type="range" min="0" max="1" step="0.01" value="0.95"></label>
      <label style="flex:1">THD, % <input id="ethd" class="input" type="range" min="0" max="40" step="0.5" value="4.0"></label>
      <label style="flex:1">Temp, ¬∞C <input id="et" class="input" type="range" min="15" max="90" step="0.5" value="32.0"></label>
    </div>
    <div class="row" style="margin-top:6px">
      <button class="btn" id="tick">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ—á–∫—É</button>
      <button class="btn secondary" id="auto">‚ñ∂Ô∏è –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è 30 —Å</button>
      <button class="btn secondary" id="clearLive">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
      <span id="last" class="badge">Pred=‚Äî | Anom=‚Äî</span>
    </div>
    <div class="canvasWrap" style="margin-top:6px"><canvas id="chart" width="1000" height="260"></canvas></div>
    <h3 style="margin-top:10px">üìú –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥</h3>
    <pre id="alog" class="code" style="max-height:170px;overflow:auto">// –¢—Ä–∏–≤–æ–≥ –ø–æ–∫–∏ –Ω–µ–º–∞</pre>
  </div>

  <div class="card">
    <h2>üß© –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∫–µ—Ç—á–∞ Arduino (.ino) –¥–ª—è –∑–±–æ—Ä—É –æ–∑–Ω–∞–∫</h2>
    <div class="row">
      <button class="btn good" id="gen">‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ .ino</button>
      <button class="btn secondary" id="copy">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      <button class="btn secondary" id="dl">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .ino</button>
    </div>
    <pre class="code" id="code">// –ù–∞—Ç–∏—Å–Ω–∏ ¬´‚öôÔ∏è –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ .ino¬ª</pre>
  </div>

  <div class="card">
    <h2>ü§ñ –ü—Ä–æ–º–ø—Ç –¥–æ LLM –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω—å/—Å–ª—É–∂–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</h2>
    <div class="row">
      <button class="btn" id="genPrompt">üìù –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
      <button class="btn secondary" id="copyPrompt">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      <button class="btn secondary" id="savePrompt">‚¨áÔ∏è TXT</button>
    </div>
    <pre class="code" id="prompt">// –°–ø–µ—Ä—à—É –Ω–∞—Ç—Ä–µ–Ω—É–π –º–æ–¥–µ–ª—å –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π –¥–µ–º–æ–¥–∞–Ω—ñ</pre>
  </div>

  <div class="card">
    <h2>üîÅ –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—É (SVG)</h2>
    <svg viewBox="0 0 900 380" role="img" aria-label="–ü–∞–π–ø–ª–∞–π–Ω –®–Ü –¥–ª—è –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ">
      <rect x="30" y="40" width="210" height="80" rx="12" fill="#0e2a47" stroke="#3b82f6"></rect>
      <text x="135" y="70" fill="#e5e7eb" font-size="14" text-anchor="middle">Arduino ‚Üí CSV</text>
      <text x="135" y="88" fill="#93c5fd" font-size="12" text-anchor="middle">Vrms, Irms, PF, THD, Temp</text>

      <rect x="270" y="40" width="210" height="80" rx="12" fill="#14532d" stroke="#22c55e"></rect>
      <text x="375" y="70" fill="#dcfce7" font-size="14" text-anchor="middle">k-NN –Ω–∞–≤—á–∞–Ω–Ω—è</text>
      <text x="375" y="88" fill="#a7f3d0" font-size="12" text-anchor="middle">–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è</text>

      <rect x="510" y="40" width="170" height="80" rx="12" fill="#7c2d12" stroke="#fb923c"></rect>
      <text x="595" y="70" fill="#fed7aa" font-size="14" text-anchor="middle">–ê–Ω–æ–º–∞–ª—ñ—ó</text>
      <text x="595" y="88" fill="#fed7aa" font-size="12" text-anchor="middle">recon error</text>

      <rect x="710" y="40" width="160" height="80" rx="12" fill="#1f2937" stroke="#9ca3af"></rect>
      <text x="790" y="70" fill="#e5e7eb" font-size="14" text-anchor="middle">–ñ—É—Ä–Ω–∞–ª</text>
      <text x="790" y="88" fill="#9ca3af" font-size="12" text-anchor="middle">—Ç—Ä–∏–≤–æ–≥–∏/–µ–∫—Å–ø–æ—Ä—Ç</text>

      <line x1="240" y1="80" x2="270" y2="80" stroke="#93c5fd" stroke-width="3"></line>
      <line x1="480" y1="80" x2="510" y2="80" stroke="#93c5fd" stroke-width="3"></line>
      <line x1="680" y1="80" x2="710" y2="80" stroke="#93c5fd" stroke-width="3"></line>
    </svg>
  </div>

  <div class="card">
    <h2>üìã –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –∑–≤—ñ—Ç—É</h2>
    <ul>
      <li>–ú–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫ (—Å–∫—Ä—ñ–Ω) + –º–µ—Ç—Ä–∏–∫–∏ Acc/F1.</li>
      <li>–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∏–≤–æ–≥ –∑–∞ 2‚Äì3 —Ö–≤–∏–ª–∏–Ω–∏ –µ–º—É–ª—é–≤–∞–Ω–Ω—è.</li>
      <li>model.json —ñ –∫–æ—Ä–æ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è –≤–∏–±–æ—Ä—É –æ–∑–Ω–∞–∫.</li>
    </ul>
  </div>

  <div class="card">
    <h2>üìú –ù–æ—Ç–∞—Ç–∫–∞ –∑ —ñ—Å—Ç–æ—Ä—ñ—ó</h2>
    <p class="muted small">
      –ü–µ—Ä—à—ñ ¬´—Ä–æ–∑—É–º–Ω—ñ¬ª –º–æ–Ω—ñ—Ç–æ—Ä–∏ –º–µ—Ä–µ–∂—ñ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞–ª–∏ –ø–æ–¥—ñ—ó –∑–∞ –ø–æ—Ä–æ–≥–∞–º–∏. –°—å–æ–≥–æ–¥–Ω—ñ –Ω–∞–≤—ñ—Ç—å –ø—Ä–æ—Å—Ç—ñ –º–µ—Ç–æ–¥–∏ ‚Äî 
      <b>k-NN</b> —ñ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π–Ω–∞ –ø–æ—Ö–∏–±–∫–∞ ‚Äî –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∏—è–≤–ª—è—Ç–∏ –Ω–µ–∑–≤–∏—á–Ω—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó PF/THD/—Å—Ç—Ä—É–º—É, —â–æ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–¥—É—é—Ç—å –∞–≤–∞—Ä—ñ—è–º.
    </p>
  </div>

  <div class="footer">
    –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <time datetime="2025-10-18">18.10.2025</time>. –ê–≤—Ç–æ—Ä: –°–µ—Ä–≥—ñ–π –ü–æ–ª—ñ—â—É–∫.
  </div>
</div>

<script>
// ===== –£—Ç–∏–ª—ñ—Ç–∏ =====
const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
function download(name,text,type="text/plain"){const b=new Blob([text],{type:type+";charset=utf-8"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);}
function stamp(){return new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}

// ===== –î–∞–Ω—ñ =====
let data=[]; // {x:[Vrms,Irms,PF,THD,Temp], y:'label'}
const LABELS=['normal','overload','low_pf','high_thd','overtemp'];
let model=null; // {mu:[...], sigma:[...], train:[{x,y}], anom:{center:[...], thr:number}}

// ===== –Ü–º–ø–æ—Ä—Ç/–¥–µ–º–æ =====
function parseCSV(txt){
  data.length=0;
  const lines=(txt||'').trim().split(/\r?\n/).filter(Boolean);
  const head=lines.shift(); const cols=head.split(',').map(s=>s.trim());
  const idx=n=>cols.indexOf(n);
  const need=['Vrms','Irms','PF','THD','Temp','label'];
  for(const n of need){ if(idx(n)===-1) throw new Error('–í—ñ–¥—Å—É—Ç–Ω—ñ–π —Å—Ç–æ–≤–ø–µ—Ü—å: '+n); }
  lines.forEach(line=>{
    const p=line.split(',').map(s=>s.trim());
    const rec={
      x:[parseFloat(p[idx('Vrms')])||0, parseFloat(p[idx('Irms')])||0, parseFloat(p[idx('PF')])||0, parseFloat(p[idx('THD')])||0, parseFloat(p[idx('Temp')])||0],
      y:(p[idx('label')]||'normal').trim()
    };
    data.push(rec);
  });
  $('#badgeN').textContent='–ó–∞–ø–∏—Å—ñ–≤: '+data.length;
}

function genDemo(){
  const rnd=(m,M)=>m+(M-m)*Math.random(), nrm=(mu,s)=>mu+s*(Math.random()*2-1);
  data.length=0;
  for(let i=0;i<120;i++){ // normal
    data.push({x:[nrm(230,3), nrm(3.5,0.8), nrm(0.96,0.02), nrm(4,1), nrm(32,2)], y:'normal'});
  }
  for(let i=0;i<70;i++){ // overload
    data.push({x:[nrm(228,4), nrm(18,3), nrm(0.92,0.04), nrm(6,2), nrm(38,3)], y:'overload'});
  }
  for(let i=0;i<70;i++){ // low_pf
    data.push({x:[nrm(230,4), nrm(7,2), nrm(0.70,0.07), nrm(8,3), nrm(36,3)], y:'low_pf'});
  }
  for(let i=0;i<70;i++){ // high_thd
    data.push({x:[nrm(225,5), nrm(6,2), nrm(0.90,0.05), nrm(18,4), nrm(35,3)], y:'high_thd'});
  }
  for(let i=0;i<70;i++){ // overtemp
    data.push({x:[nrm(231,3), nrm(5,2), nrm(0.95,0.03), nrm(5,2), nrm(68,4)], y:'overtemp'});
  }
  shuffle(data);
  $('#badgeN').textContent='–ó–∞–ø–∏—Å—ñ–≤: '+data.length+' (–¥–µ–º–æ)';
}

// ===== –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è =====
function fitScaler(rows){
  const D=rows[0].x.length, mu=new Array(D).fill(0), sig=new Array(D).fill(0);
  rows.forEach(r=>r.x.forEach((v,i)=>mu[i]+=v)); mu.forEach((v,i)=>mu[i]/=rows.length);
  rows.forEach(r=>r.x.forEach((v,i)=>sig[i]+=(v-mu[i])*(v-mu[i]))); sig.forEach((v,i)=>sig[i]=Math.sqrt(v/Math.max(1,rows.length-1))||1);
  return {mu,sig};
}
function transform(x, mu, sig){ return x.map((v,i)=> (v-mu[i])/sig[i]); }

// ===== k-NN =====
function dist2(a,b){ let s=0; for(let i=0;i<a.length;i++){ const d=a[i]-b[i]; s+=d*d; } return s; }
function knnPredict(xz, train, k){
  const arr=train.map(r=>({d:dist2(xz,r.xz), y:r.y})).sort((a,b)=>a.d-b.d).slice(0,k);
  const votes=new Map(); arr.forEach(o=>votes.set(o.y,(votes.get(o.y)||0)+1));
  let best='normal', bestV=-1; for(const [y,c] of votes){ if(c>bestV){bestV=c; best=y;} }
  return {y:best, d2:arr[0]?.d||0};
}

// ===== –ê–Ω–æ–º–∞–ª—ñ—ó (autoencoder-lite): —Ü–µ–Ω—Ç—Ä –∫–ª–∞—Å—É 'normal' —ñ —Å–µ—Ä–µ–¥–Ω—è –ø–æ—Ö–∏–±–∫–∞ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó =====
function fitAnomaly(train){
  const normals=train.filter(r=>r.y==='normal').map(r=>r.xz);
  const D=normals[0]?.length||5;
  const center=new Array(D).fill(0);
  normals.forEach(v=>v.forEach((t,i)=>center[i]+=t)); center.forEach((v,i,arr)=>arr[i]=v/Math.max(1,normals.length));
  // —Å–µ—Ä–µ–¥–Ω—è –≤—ñ–¥—Å—Ç–∞–Ω—å —è–∫ –ø–æ—Ä—ñ–≥ –±–∞–∑–æ–≤–∏–π ‚Üí –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∏–π —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö
  let err=0; normals.forEach(v=>err+=Math.sqrt(dist2(v,center))); err/=Math.max(1,normals.length);
  return {center, baseErr:err};
}
function anomalyScore(xz, center){ return Math.sqrt(dist2(xz, center)); }

// ===== –ù–∞–≤—á–∞–Ω–Ω—è/—Ç–µ—Å—Ç =====
let TRAIN=[], TEST=[];
function trainModel(){
  if(data.length<50){ alert('–ú–∞–ª–æ –¥–∞–Ω–∏—Ö –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è'); return; }
  const split = Math.max(50,Math.min(90, parseInt($('#split').value)||70));
  const nTrain = Math.round(data.length*split/100);
  const rows=data.slice(); shuffle(rows);
  TRAIN=rows.slice(0,nTrain); TEST=rows.slice(nTrain);

  const scaler = fitScaler(TRAIN);
  TRAIN.forEach(r=>r.xz=transform(r.x, scaler.mu, scaler.sig));
  TEST.forEach(r=>r.xz=transform(r.x, scaler.mu, scaler.sig));

  const anom = fitAnomaly(TRAIN);
  model = {mu:scaler.mu, sigma:scaler.sig, train: TRAIN.map(r=>({xz:r.xz,y:r.y})), anom:{center:anom.center, thr: (parseFloat($('#anomThr').value)||0.25), base: anom.baseErr} };

  $('#badgeRes').textContent='–ú–æ–¥–µ–ª—å –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–æ (train='+TRAIN.length+', test='+TEST.length+')';
}

function testModel(){
  if(!model){ alert('–°–ø–æ—á–∞—Ç–∫—É –Ω–∞—Ç—Ä–µ–Ω—É–π –º–æ–¥–µ–ª—å'); return; }
  const k=Math.max(1, parseInt($('#k').value)||5);
  const cmat = LABELS.map(()=>LABELS.map(()=>0));
  let tp=0, all=0;

  TEST.forEach(r=>{
    const pred = knnPredict(r.xz, model.train, k).y;
    const i=LABELS.indexOf(pred), j=LABELS.indexOf(r.y);
    if(i>=0 && j>=0){ cmat[i][j]++; }
    if(pred===r.y) tp++;
    all++;
  });

  // –º–µ—Ç—Ä–∏–∫–∏
  const acc = (tp/all)*100;
  // micro-F1 ~ acc –¥–ª—è –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤; –ø—Ä–∏–±–ª–∏–∑–Ω–æ:
  const f1 = acc;

  // –æ–Ω–æ–≤–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é
  const tb=$('#cmat tbody').querySelectorAll('tr');
  LABELS.forEach((pred,pi)=>{
    const row=tb[pi].querySelectorAll('td');
    LABELS.forEach((tru,tj)=>{ row[tj].textContent=cmat[pi][tj]; });
  });
  $('#badgeRes').textContent=`Acc: ${acc.toFixed(1)}% | F1‚âà${f1.toFixed(1)}%`;
}

// ===== –ñ–∏–≤–∏–π –º–æ–Ω—ñ—Ç–æ—Ä =====
const cvs=$('#chart'), ctx=cvs.getContext('2d');
const live=[];
const ALOG=$('#alog');

function drawChart(){
  const W=cvs.width,H=cvs.height;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#223049'; ctx.strokeRect(0.5,0.5,W-1,H-1);
  if(live.length<2) return;
  const maxN=200, s=live.slice(-maxN);
  const xs=s.map((_,i)=>i*(W/(s.length-1)));

  // –ú–∞–ª—é—î–º–æ P —ñ THD
  const P=s.map(v=>v.V*v.I*v.PF), maxP=Math.max(1000, Math.max(...P)*1.2);
  ctx.beginPath(); ctx.strokeStyle='#22c55e'; ctx.lineWidth=2;
  xs.forEach((x,i)=>{ const y=H-10-(Math.min(maxP,P[i])/maxP)*(H-20); i?ctx.lineTo(x,y):ctx.moveTo(x,y); }); ctx.stroke();

  const THD=s.map(v=>v.THD), maxT=Math.max(10, Math.max(...THD)*1.3);
  ctx.beginPath(); ctx.strokeStyle='#38bdf8'; ctx.lineWidth=1.5;
  xs.forEach((x,i)=>{ const y=H-10-(Math.min(maxT,THD[i])/maxT)*(H-20); i?ctx.lineTo(x,y):ctx.moveTo(x,y); }); ctx.stroke();

  ctx.fillStyle='#94a3b8'; ctx.font='12px ui-monospace';
  ctx.fillText('P, W', W-42, 14); ctx.fillText('THD, %', W-14, 28);
}

function alarm(msg){
  const t=new Date().toLocaleTimeString();
  if(ALOG.textContent.startsWith('//')) ALOG.textContent='';
  ALOG.textContent += `[${t}] ${msg}\n`;
  ALOG.scrollTop = ALOG.scrollHeight;
  document.title='‚ö†Ô∏è –¢—Ä–∏–≤–æ–≥–∞ ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–µ—Ä–µ–∂—É';
  setTimeout(()=>document.title='–ü–∞—Ä–∞ 22 ‚Äî –®–Ü',1200);
}

function classifyPoint(V,I,PF,THD,Temp){
  if(!model){ $('#last').textContent='Pred=‚Äî | Anom=‚Äî'; return; }
  const x=[V,I,PF,THD,Temp], xz=transform(x, model.mu, model.sigma);
  const k=Math.max(1, parseInt($('#k').value)||5);
  const pred=knnPredict(xz, model.train, k);
  const err = anomalyScore(xz, model.anom.center);
  const scaledErr = err / (model.anom.base||1);
  const isAnom = scaledErr > model.anom.thr;

  $('#last').textContent=`Pred=${pred.y} | Anom=${scaledErr.toFixed(2)} ${isAnom?'(>thr)':'(ok)'}`
  live.push({V,I,PF,THD,Temp, pred:pred.y, anom:scaledErr});
  drawChart();

  // —Ç—Ä–∏–≥–µ—Ä–∏
  if(pred.y!=='normal') alarm(`–ö–ª–∞—Å=${pred.y}; V=${V.toFixed(0)}–í I=${I.toFixed(1)}–ê PF=${PF.toFixed(2)} THD=${THD.toFixed(1)}% T=${Temp.toFixed(1)}¬∞C`);
  if(isAnom) alarm(`–ê–Ω–æ–º–∞–ª—ñ—è err=${scaledErr.toFixed(2)}; –º–æ–∂–ª–∏–≤–µ –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤`);
}

// –∫–Ω–æ–ø–∫–∏ –º–æ–Ω—ñ—Ç–æ—Ä—É
$('#tick').addEventListener('click', ()=>{
  const V=parseFloat($('#ev').value), I=parseFloat($('#ei').value), PF=parseFloat($('#epf').value), THD=parseFloat($('#ethd').value), T=parseFloat($('#et').value);
  classifyPoint(V,I,PF,THD,T);
});
let autoTimer=null; 
$('#auto').addEventListener('click', ()=>{
  if(autoTimer){ clearInterval(autoTimer); autoTimer=null; $('#auto').textContent='‚ñ∂Ô∏è –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è 30 —Å'; return; }
  let c=0; $('#auto').textContent='‚è∏Ô∏è –ó—É–ø–∏–Ω–∏—Ç–∏ –∞–≤—Ç–æ';
  autoTimer=setInterval(()=>{
    // —Ç—Ä—ñ—à–∫–∏ —à—É–º—É –Ω–∞–≤–∫–æ–ª–æ –≤–∏—Å—Ç–∞–≤–ª–µ–Ω–∏—Ö –ø–æ–≤–∑—É–Ω–∫—ñ–≤
    const jitter=(v,s)=>v+s*(Math.random()*2-1);
    classifyPoint(jitter(parseFloat($('#ev').value),1.5),
                  jitter(parseFloat($('#ei').value),0.6),
                  Math.min(1,Math.max(0,jitter(parseFloat($('#epf').value),0.02))),
                  Math.max(0,jitter(parseFloat($('#ethd').value),1.0)),
                  jitter(parseFloat($('#et').value),0.8));
    if(++c>=30){ clearInterval(autoTimer); autoTimer=null; $('#auto').textContent='‚ñ∂Ô∏è –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è 30 —Å'; }
  }, 1000);
});
$('#clearLive').addEventListener('click', ()=>{ live.length=0; ALOG.textContent='// –¢—Ä–∏–≤–æ–≥ –ø–æ–∫–∏ –Ω–µ–º–∞'; drawChart(); });

// ===== –ü–æ–¥—ñ—ó –¥–∞–Ω–∏—Ö =====
$('#demo').addEventListener('click', ()=>{ genDemo(); });
$('#load').addEventListener('click', ()=>{
  try{ parseCSV($('#csv').value); }catch(e){ alert('–ü–æ–º–∏–ª–∫–∞ CSV: '+e.message); }
});
$('#clear').addEventListener('click', ()=>{ data.length=0; $('#badgeN').textContent='–ó–∞–ø–∏—Å—ñ–≤: 0'; });
$('#train').addEventListener('click', trainModel);
$('#test').addEventListener('click', testModel);
$('#exportModel').addEventListener('click', ()=>{
  if(!model){ alert('–ù–µ–º–∞—î –º–æ–¥–µ–ª—ñ'); return; }
  const out = JSON.stringify(model,null,2);
  download('electric_para22_model_'+stamp()+'.json', out, 'application/json');
});

// ===== –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Arduino .ino =====
function genSketch(){
  const code = `/*
  –ü–∞—Ä–∞ 22 ‚Äî –õ–æ–≥–µ—Ä –æ–∑–Ω–∞–∫ –¥–ª—è –®–Ü (Vrms, Irms, PF, THD, Temp)
  –ê–ø–∞—Ä–∞—Ç—É—Ä–∞ (–ø—Ä–∏–∫–ª–∞–¥):
    - SCT-013 (—á–µ—Ä–µ–∑ —à—É–Ω—Ç —ñ –¥—ñ–ª—å–Ω–∏–∫ –Ω–∞ A0)
    - AC-–∞–¥–∞–ø—Ç–µ—Ä 9–í (—á–µ—Ä–µ–∑ –¥—ñ–ª—å–Ω–∏–∫ –Ω–∞ A1) ‚Äî –¥–ª—è Urms/PF/THD
    - DS18B20 (Temp) –∞–±–æ NTC –Ω–∞ A2
  ‚ö† –ë–µ–∑–ø–µ–∫–∞: –º–µ—Ä–µ–∂–∞ 230–í —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—á—ñ (CT/AC).
*/

#include <OneWire.h>
#include <DallasTemperature.h>

#define PIN_I A0
#define PIN_U A1
#define PIN_1WIRE 2

const float CAL_I = 0.0500; // A/ADC (–ø—ñ—Å–ª—è bias)
const float CAL_U = 1.100;  // V/ADC (–ø—ñ—Å–ª—è bias)
const float FREQ  = 50.0;   // –ì—Ü
const unsigned long WINDOW_MS = 500;

OneWire oneWire(PIN_1WIRE);
DallasTemperature sensors(&oneWire);

float readTempC(){
  sensors.requestTemperatures();
  return sensors.getTempCByIndex(0);
}

void setup(){
  Serial.begin(115200);
  analogReference(DEFAULT);
  sensors.begin();
  delay(300);
  Serial.println(F("Vrms,Irms,PF,THD,Temp,label"));
}

void loop(){
  // –û—Ü—ñ–Ω–∫–∞ bias
  long sI=0,sU=0; int n0=0;
  unsigned long t0=millis();
  while(millis()-t0<50){ sI+=analogRead(PIN_I); sU+=analogRead(PIN_U); n0++; }
  float bI=(float)sI/max(1,n0), bU=(float)sU/max(1,n0);

  // –ù–∞–±—ñ—Ä –≤—ñ–∫–Ω–∞
  const unsigned long tend=millis()+WINDOW_MS;
  double accI2=0, accU2=0, accPU=0;
  unsigned long zc=0; int prevU=0, prevSign=0; // –¥–ª—è THD –≥—Ä—É–±–æ ‚Äî —Ä–∞—Ö—É—î–º–æ –Ω—É–ª—å–æ–≤—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏
  unsigned long n=0;
  while(millis()<tend){
    int ai=analogRead(PIN_I), au=analogRead(PIN_U);
    float xi=(ai-bI)*CAL_I;
    float xu=(au-bU)*CAL_U;
    accI2+=xi*xi; accU2+=xu*xu; accPU+=xi*xu;

    int sign = (xu>=0)?1:-1;
    if(prevSign!=0 && sign!=prevSign) zc++;
    prevSign=sign; prevU=au;
    n++;
  }

  float Irms=sqrt(accI2/max(1UL,n));
  float Urms=sqrt(accU2/max(1UL,n));
  float P    =accPU/max(1UL,n);
  float S    =Urms*Irms;
  float PF   = (S>1e-3)? P/S : 1.0;

  // –ì—Ä—É–±–∞ –æ—Ü—ñ–Ω–∫–∞ THD –∑–∞ —á–∏—Å–ª–æ–º –Ω—É–ª—å–æ–≤–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤/—Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—é –∞–º–ø–ª—ñ—Ç—É–¥–∏
  // (–¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó; –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ—ó THD –ø–æ—Ç—Ä—ñ–±–µ–Ω —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑)
  float thd = 100.0f * constrain(abs((float)zc/(FREQ*WINDOW_MS/1000.0f*2) - 1.0f), 0.0f, 1.0f);

  float T = readTempC();
  // label –º–æ–∂–Ω–∞ –∑–∞–ø–æ–≤–Ω—é–≤–∞—Ç–∏ –≤—Ä—É—á–Ω—É —É SerialPlotter –∞–±–æ —É —Ñ–∞–π–ª—ñ –≤ –ø–æ–¥–∞–ª—å—à–æ–º—É (normal/overload/...)
  Serial.print(Urms,1); Serial.print(',');
  Serial.print(Irms,2); Serial.print(',');
  Serial.print(PF,2);   Serial.print(',');
  Serial.print(thd,1);  Serial.print(',');
  Serial.print(T,1);    Serial.print(',');
  Serial.println("normal");

  delay(200);
}
`;
  return code;
}
$('#gen').addEventListener('click', ()=>{ const txt=genSketch(); $('#code').textContent=txt; });
$('#copy').addEventListener('click', ()=>{ const ta=document.createElement('textarea'); ta.value=$('#code').textContent; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); });
$('#dl').addEventListener('click', ()=>{ const txt=$('#code').textContent||genSketch(); download('electric_para22_ai_knn_logger.ino',txt,'text/x-ino'); });

// ===== –ü—Ä–æ–º–ø—Ç LLM =====
function buildPrompt(){
  const acc=$('#badgeRes').textContent;
  return `–¢–∏ ‚Äî –ø–æ–º—ñ—á–Ω–∏–∫ –µ–Ω–µ—Ä–≥–æ–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞. –ü–æ—è—Å–Ω–∏ —Å—Ç–∞–Ω –º–µ—Ä–µ–∂—ñ –∑–∞ –ø–æ—Ç–æ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ —ñ –ø—ñ–¥–∫–∞–∂–∏ –¥—ñ—ó.
–í—Ö—ñ–¥:
‚Ä¢ –û–∑–Ω–∞–∫–∏: Vrms, Irms, PF, THD, Temp
‚Ä¢ –ú–æ–¥–µ–ª—å: k-NN (–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞), –∞–Ω–æ–º–∞–ª—ñ—ó –∑–∞ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π–Ω–æ—é –ø–æ—Ö–∏–±–∫–æ—é (—Ü–µ–Ω—Ç—Ä –∫–ª–∞—Å—É normal)
‚Ä¢ –Ø–∫—ñ—Å—Ç—å: ${acc}
–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:
1) –ö–æ–ª–∏ Pred‚â†normal ‚Äî –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É: —â–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ (—Ñ–∞–∑–∏, –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —Ñ—ñ–ª—å—Ç—Ä–∏, –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è).
2) –Ø–∫—â–æ Anom > –ø–æ—Ä–æ–≥–∞ ‚Äî –æ–ø–∏—à–∏ –º–æ–∂–ª–∏–≤—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –ø—Ä–∏—á–∏–Ω —ñ —è–∫—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–±–∏—Ä–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–æ.
3) –ü–æ—Ä–∞–¥–∏ –∑ –±–µ–∑–ø–µ–∫–∏ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É (–ó–Ü–ó, –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è, lockout-tagout).
4) –ö–æ—Ä–æ—Ç–∫–∏–π —á–µ–∫-–ª—ñ—Å—Ç —ñ —Ç–∞–±–ª–∏—Ü—è ¬´—Å–∏–º–ø—Ç–æ–º‚Üí–º–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏‚Üí–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞¬ª. –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–µ–∑—é–º–µ –∑ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∞–º–∏.`;
}
$('#genPrompt').addEventListener('click', ()=>{ $('#prompt').textContent=buildPrompt(); });
$('#copyPrompt').addEventListener('click', ()=>{ const ta=document.createElement('textarea'); ta.value=$('#prompt').textContent; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); });
$('#savePrompt').addEventListener('click', ()=>{ const txt=$('#prompt').textContent||buildPrompt(); download('electric_para22_prompt_'+stamp()+'.txt',txt); });

// ===== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è =====
drawChart();
if (window.self !== window.top) document.documentElement.classList.add('embedded'); // LMS-friendly
</script>


</body></html>