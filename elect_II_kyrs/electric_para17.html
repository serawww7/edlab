<!-- electric_para17.html
     –ü–∞—Ä–∞ 17 (–ï–ª–µ–∫—Ç—Ä–∏–∫–∏, –∞—É–¥–∏—Ç–æ—Ä–Ω–æ): NFC-–ü–ê–°–ü–û–†–¢ –û–ë–õ–ê–î–ù–ê–ù–ù–Ø ¬∑ –ñ–£–†–ù–ê–õ –¢–û ¬∑ –ù–ê–ö–õ–ï–ô–ö–ò 58 –º–º ¬∑ A4 ¬∑ ICS
     –ú–µ—Ç–∞: —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ—î—Å—Ç—Ä –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è, –≤–∏–ø—É—Å—Ç–∏—Ç–∏ NFC/QR-–ø–∞—Å–ø–æ—Ä—Ç–∏, –ø–ª–∞–Ω –¢–û –∑ –∞–≤—Ç–æ–ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º "–ù–∞—Å—Ç—É–ø–Ω–µ –¢–û",
     –¥—Ä—É–∫ –∫–≤–∏—Ç–∫—ñ–≤ 58 –º–º (—Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä), –µ–∫—Å–ø–æ—Ä—Ç/—ñ–º–ø–æ—Ä—Ç CSV, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–æ–¥—ñ–π .ics.
     –ü—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω, –ø—ñ–¥ GitHub Pages —ñ –≤–±—É–¥–æ–≤—É—î—Ç—å—Å—è —É Moodle (iframe).
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 17 ‚Äî NFC-–ø–∞—Å–ø–æ—Ä—Ç–∏ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è, –∂—É—Ä–Ω–∞–ª –¢–û, 58 –º–º, A4, ICS</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --bg2:#111827; --card:#0f172a; --text:#e2e8f0; --muted:#9aa5b1; --line:#1f2937;
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --info:#60a5fa;
  }
  *{box-sizing:border-box}
  body{margin:0; background:linear-gradient(180deg,var(--bg),var(--bg2) 35%,var(--bg)); color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55}
  .wrap{max-width:1120px; margin:0 auto; padding:24px 16px 96px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:#9aa5b1}
  h1{font-size:32px; margin:6px 0 12px; line-height:1.15; background:linear-gradient(90deg,#60a5fa,#22c55e);
     -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:22px 0 12px}
  h3{font-size:18px; margin:12px 0 8px; color:#cbd5e1}
  p{margin:8px 0}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0;
        box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:1050px){.g3{grid-template-columns:1fr}; .g2{grid-template-columns:1fr}}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid var(--line); background:#0d1a2e; color:#dbeafe;
       text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .small{font-size:12px; color:#93a3b5}
  input,select,textarea{padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e5e7eb; width:100%}
  textarea{min-height:72px}
  table{width:100%; border-collapse:separate; border-spacing:0; border:1px solid #223049; border-radius:12px; overflow:hidden}
  thead th{background:#0c1629; color:#a5b4fc; text-align:left; padding:10px 12px; font-size:14px}
  tbody td{padding:8px 10px; border-top:1px solid #1f2937; font-size:14px; vertical-align:top}
  tbody tr:nth-child(even){background:#0b1324}
  .chip{display:inline-block; padding:2px 8px; border:1px solid #223049; border-radius:999px; font-size:12px; background:#0d1a2e; color:#9aa5b1}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)} .muted{color:#9aa5b1}
  .tickets{display:flex; gap:12px; flex-wrap:wrap}
  .ticket{width:58mm; background:#fff; color:#000; padding:5mm 4mm; border-radius:6px; box-shadow:0 0 0 1px #e5e7eb inset;
          font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 4px; font-size:13px; text-align:center}
  .ticket p{margin:1px 0; font-size:12px}
  .ticket .line{border-top:1px dashed #111; margin:5px 0}
  .ticket small{font-size:10px}
  .ticket .qr{font-size:10px; word-break:break-all}
  #printArea{background:#fff; color:#000; border-radius:12px; border:1px solid #e5e7eb; padding:16px}
  .doc{page-break-after:always; padding:12mm; color:#000; font-family:Georgia,"Times New Roman",serif}
  .doc h2{color:#000; font-size:20px; margin:0 0 6px}
  .doc h3{color:#000; font-size:16px; margin:6px 0}
  .doc p{color:#000; margin:4px 0}
  .doc table{width:100%; border-collapse:collapse; border:1px solid #111}
  .doc th,.doc td{border:1px solid #111; padding:6px 8px; font-size:12px; vertical-align:top}
  .doc .sign{margin-top:10mm; display:flex; gap:10mm; flex-wrap:wrap}
  .doc .sign div{flex:1 1 220px}
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}
  @media print{
    @page{ size:A4; margin:12mm }
    body{ background:#fff; color:#000 }
    .no-print, .card:not(.printable){ display:none !important }
    #printArea{ border:none; padding:0 }
    .ticket{ box-shadow:none; width:auto; padding:0 }
  }
</style>
<meta name="description" content="–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Ä–µ—î—Å—Ç—Ä –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è (ID, –º—ñ—Å—Ü–µ, –∂–∏–≤–ª–µ–Ω–Ω—è, —Å–µ—Ä—ñ–π–Ω–∏–π ‚Ññ, –≤–∞—Ä—Ç—ñ—Å—Ç—å, —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¢–û), –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ NFC/QR-–ø–∞—Å–ø–æ—Ä—Ç, –æ–±—á–∏—Å–ª–∏—Ç–∏ –ù–∞—Å—Ç—É–ø–Ω–µ –¢–û, –¥—Ä—É–∫—É–≤–∞—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫"><link rel="canonical" href="https://edlab.pp.ua/elect_II_kyrs/electric_para17.html"><meta property="og:type" content="article"><meta property="og:title" content="üè∑Ô∏è NFC-–ø–∞—Å–ø–æ—Ä—Ç –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è ‚Üí –∂—É—Ä–Ω–∞–ª –¢–û ‚Üí üßæ –Ω–∞–∫–ª–µ–π–∫–∏ 58 –º–º ‚Üí üìÑ A4 ‚Üí üìÖ .ics"><meta property="og:description" content="–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Ä–µ—î—Å—Ç—Ä –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è (ID, –º—ñ—Å—Ü–µ, –∂–∏–≤–ª–µ–Ω–Ω—è, —Å–µ—Ä—ñ–π–Ω–∏–π ‚Ññ, –≤–∞—Ä—Ç—ñ—Å—Ç—å, —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¢–û), –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ NFC/QR-–ø–∞—Å–ø–æ—Ä—Ç, –æ–±—á–∏—Å–ª–∏—Ç–∏ –ù–∞—Å—Ç—É–ø–Ω–µ –¢–û, –¥—Ä—É–∫—É–≤–∞—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫"><meta property="og:url" content="https://edlab.pp.ua/elect_II_kyrs/electric_para17.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üè∑Ô∏è NFC-–ø–∞—Å–ø–æ—Ä—Ç –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è ‚Üí –∂—É—Ä–Ω–∞–ª –¢–û ‚Üí üßæ –Ω–∞–∫–ª–µ–π–∫–∏ 58 –º–º ‚Üí üìÑ A4 ‚Üí üìÖ .ics","description":"–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Ä–µ—î—Å—Ç—Ä –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è (ID, –º—ñ—Å—Ü–µ, –∂–∏–≤–ª–µ–Ω–Ω—è, —Å–µ—Ä—ñ–π–Ω–∏–π ‚Ññ, –≤–∞—Ä—Ç—ñ—Å—Ç—å, —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¢–û), –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ NFC/QR-–ø–∞—Å–ø–æ—Ä—Ç, –æ–±—á–∏—Å–ª–∏—Ç–∏ –ù–∞—Å—Ç—É–ø–Ω–µ –¢–û, –¥—Ä—É–∫—É–≤–∞—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/elect_II_kyrs/electric_para17.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
<div class="wrap">
  <span class="badge">–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 17 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ</span>
  <h1>üè∑Ô∏è NFC-–ø–∞—Å–ø–æ—Ä—Ç –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è ‚Üí –∂—É—Ä–Ω–∞–ª –¢–û ‚Üí üßæ –Ω–∞–∫–ª–µ–π–∫–∏ 58 –º–º ‚Üí üìÑ A4 ‚Üí üìÖ .ics</h1>

  <div class="card">
    <h2>üéØ –ú–µ—Ç–∞</h2>
    <p>–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Ä–µ—î—Å—Ç—Ä –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è (ID, –º—ñ—Å—Ü–µ, –∂–∏–≤–ª–µ–Ω–Ω—è, —Å–µ—Ä—ñ–π–Ω–∏–π ‚Ññ, –≤–∞—Ä—Ç—ñ—Å—Ç—å, —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¢–û), –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ NFC/QR-–ø–∞—Å–ø–æ—Ä—Ç, 
      –æ–±—á–∏—Å–ª–∏—Ç–∏ <b>–ù–∞—Å—Ç—É–ø–Ω–µ –¢–û</b>, –¥—Ä—É–∫—É–≤–∞—Ç–∏ –µ—Ç–∏–∫–µ—Ç–∫–∏ 58 –º–º —Ç–∞ A4-–∑–≤—ñ—Ç, –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏/—ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ CSV —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–æ–¥—ñ—ó <b>.ics</b> –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è.</p>
    <div class="row">
      <button class="btn" onclick="seedDemo()">üîÑ –ü—Ä–∏–∫–ª–∞–¥</button>
      <button class="btn" onclick="exportCSV()">üì§ –ï–∫—Å–ø–æ—Ä—Ç CSV</button>
      <input id="file" class="btn" type="file" accept=".csv,text/csv">
      <button class="btn" onclick="importCSV()">‚¨ÜÔ∏è –Ü–º–ø–æ—Ä—Ç CSV</button>
      <button class="btn" onclick="downloadICS()">üìÖ –ï–∫—Å–ø–æ—Ä—Ç .ics (–≤—Å—ñ –¢–û)</button>
    </div>
    <p class="small">CSV –ø–æ–ª—è: <span class="mono">id,name,location,circuit,phase,voltage_V,power_W,serial,installed_yyyy_mm_dd,last_yyyy_mm_dd,interval_months,responsible,url,notes</span></p>
  </div>

  <div class="card">
    <h2>‚ûï –î–æ–¥–∞—Ç–∏ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h2>
    <div class="grid g3">
      <div>
        <h3>–ü–∞—Å–ø–æ—Ä—Ç</h3>
        <div class="row"><label class="small" style="min-width:140px">ID</label><input id="id" value="EQ-001"></div>
        <div class="row"><label class="small" style="min-width:140px">–ù–∞–∑–≤–∞</label><input id="name" value="–í–∏—Ç—è–∂–Ω–∏–π –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä 3–§"></div>
        <div class="row"><label class="small" style="min-width:140px">–ú—ñ—Å—Ü–µ</label><input id="location" value="–ú–∞–π—Å—Ç–µ—Ä–Ω—è –ê-101"></div>
        <div class="row"><label class="small" style="min-width:140px">–õ—ñ–Ω—ñ—è/—â–∏—Ç</label><input id="circuit" value="–©–û-1 ¬∑ M-01"></div>
      </div>
      <div>
        <h3>–ï–ª–µ–∫—Ç—Ä–∏–∫–∞</h3>
        <div class="row"><label class="small" style="min-width:140px">–§–∞–∑–∞</label><select id="phase"><option>A</option><option>B</option><option>C</option><option selected="">3–§</option></select></div>
        <div class="row"><label class="small" style="min-width:140px">U, –í</label><input id="voltage" type="number" value="400"></div>
        <div class="row"><label class="small" style="min-width:140px">P, –í—Ç</label><input id="power" type="number" value="1500"></div>
        <div class="row"><label class="small" style="min-width:140px">–°–µ—Ä—ñ–π–Ω–∏–π ‚Ññ</label><input id="serial" value="SN-2309-001"></div>
      </div>
      <div>
        <h3>–¢–û / –ø–æ—Å–∏–ª–∞–Ω–Ω—è</h3>
        <div class="row"><label class="small" style="min-width:140px">–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</label><input id="installed" value="2025-09-10"></div>
        <div class="row"><label class="small" style="min-width:140px">–û—Å—Ç–∞–Ω–Ω—î –¢–û</label><input id="last" value="2025-10-01"></div>
        <div class="row"><label class="small" style="min-width:140px">–Ü–Ω—Ç–µ—Ä–≤–∞–ª, –º—ñ—Å</label><input id="interval" type="number" value="6"></div>
        <div class="row"><label class="small" style="min-width:140px">–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π</label><input id="resp" value="–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞"></div>
        <div class="row"><label class="small" style="min-width:140px">URL (—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è)</label><input id="url" placeholder="https://serawww7.github.io/edlab/..."></div>
        <div class="row"><label class="small" style="min-width:140px">–ù–æ—Ç–∞—Ç–∫–∞</label><input id="notes" placeholder="–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ, –ó–Ü–ó —Ç–æ—â–æ"></div>
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <button class="btn" onclick="addOrUpdate()">üíæ –î–æ–¥–∞—Ç–∏/–û–Ω–æ–≤–∏—Ç–∏</button>
      <button class="btn" onclick="previewNFC()">üì∂ –ó—ñ–±—Ä–∞—Ç–∏ NFC/QR</button>
      <button class="btn" onclick="seedOne()">üîÑ –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Å—É</button>
    </div>
    <p class="small">NFC –ø–æ—Ä–∞–¥–Ω–∏–∫: —Ç–∏–ø NDEF URI –∞–±–æ TEXT. –ú–∏ –≥–µ–Ω–µ—Ä—É—î–º–æ —Ä—è–¥–æ–∫ –¥–ª—è –∑–∞–ø–∏—Å—É (–≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î—Ç–µ —Å–≤–æ—é NFC-–ø—Ä–æ–≥—Ä–∞–º—É –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ).</p>
  </div>

  <div class="card printable">
    <h2>üìã –†–µ—î—Å—Ç—Ä –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h2>
    <table id="tbl">
      <thead>
        <tr>
          <th>#</th><th>ID</th><th>–ù–∞–∑–≤–∞</th><th>–ú—ñ—Å—Ü–µ</th><th>–õ—ñ–Ω—ñ—è</th><th>–§–∞–∑–∞</th><th>U</th><th>P</th>
          <th>–°–µ—Ä‚Ññ</th><th>–í—Å—Ç.</th><th>–û–°–¢ –¢–û</th><th>–ù–∞—Å—Ç –¢–û</th><th>URL</th><th>–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p class="small">–°—Ç–∞—Ç—É—Å –¢–û: <span class="chip ok">OK</span> ‚Äî –¥–æ —Å—Ç—Ä–æ–∫—É ‚â•30 –¥–Ω—ñ–≤; <span class="chip warn">SOON</span> ‚Äî &lt;30 –¥–Ω—ñ–≤; <span class="chip bad">OVERDUE</span> ‚Äî –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ.</p>
  </div>

  <div class="card">
    <h2>üì∂ NFC/QR –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥</h2>
    <div class="grid g2">
      <div>
        <h3>–ó–º—ñ—Å—Ç NDEF TEXT</h3>
        <textarea id="ndefText" readonly=""></textarea>
        <p class="small">–°–∫–æ–ø—ñ—é–π —É NFC-–∑–∞–ø–∏—Å—É–≤–∞—á —è–∫ TEXT (–∞–±–æ URI –∑ –ø–æ–ª—è –ø—Ä–∞–≤–æ—Ä—É—á).</p>
      </div>
      <div>
        <h3>URI –¥–ª—è NDEF/QR</h3>
        <textarea id="ndefURI" readonly=""></textarea>
        <p class="small">–¶–µ–π URI –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏–º–µ –ø–∞—Å–ø–æ—Ä—Ç/—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –ô–æ–≥–æ –∂ –≤–∏–≤–æ–¥–∏–º–æ –Ω–∞ –Ω–∞–∫–ª–µ–π–∫—É 58 –º–º.</p>
      </div>
    </div>
  </div>

  <div class="card printable">
    <h2>üßæ –ù–∞–∫–ª–µ–π–∫–∏ 58 –º–º ¬´–ü–∞—Å–ø–æ—Ä—Ç –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è¬ª</h2>
    <div class="row">
      <button class="btn" onclick="buildTickets()">üß© –î–ª—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤</button>
      <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫ 58 –º–º</button>
      <button class="btn" onclick="downloadTXT()">üì• TXT</button>
    </div>
    <div id="tickets" class="tickets"></div>
  </div>

  <div class="card printable">
    <h2>üìÑ A4-–∑–≤—ñ—Ç (–¥–ª—è –¥—Ä—É–∫—É/PDF)</h2>
    <div class="row">
      <button class="btn" onclick="buildReport()">üß© –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ A4</button>
      <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫/PDF</button>
    </div>
    <div id="printArea"></div>
  </div>
</div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle)
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // ===== –°–¢–ê–ù =====
  let items = []; // –º–∞—Å–∏–≤ –ø–∞—Å–ø–æ—Ä—Ç—ñ–≤
  const tbody = document.querySelector('#tbl tbody');
  const ticketsBox = document.getElementById('tickets');

  // ===== –£–¢–ò–õ–Ü–¢–ò =====
  function esc(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
  function pad(n){ return n.toString().padStart(2,'0'); }
  function dParse(s){ const [y,m,d]=String(s||'').split('-').map(x=>parseInt(x,10)); return new Date(y||2025,(m||1)-1,d||1); }
  function dAddMonths(dt, m){ const d=new Date(dt.getTime()); d.setMonth(d.getMonth()+m); return d; }
  function dFmt(dt){ return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`; }
  function daysDiff(a,b){ return Math.round((a-b)/(1000*60*60*24)); }
  function now(){ return new Date(); }
  function nowStamp(){ const d=now(); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`; }

  // ===== –ú–û–î–ï–õ–¨ –¢–û =====
  function nextService(lastISO, intervalM){
    const last = dParse(lastISO||'2025-10-01');
    const nxt = dAddMonths(last, parseInt(intervalM||'6',10));
    return dFmt(nxt);
  }
  function serviceStatus(nextISO){
    const n = dParse(nextISO); const dd = daysDiff(n, now());
    if(dd < 0) return {txt:'OVERDUE', cls:'bad'};
    if(dd <= 30) return {txt:`SOON (${dd} –¥–Ω)`, cls:'warn'};
    return {txt:`OK (${dd} –¥–Ω)`, cls:'ok'};
  }

  // ===== CRUD =====
  function addOrUpdate(){
    const rec = {
      id:(document.getElementById('id').value||'').trim(),
      name:(document.getElementById('name').value||'').trim(),
      location:(document.getElementById('location').value||'').trim(),
      circuit:(document.getElementById('circuit').value||'').trim(),
      phase:document.getElementById('phase').value,
      voltage:parseFloat(document.getElementById('voltage').value||'230'),
      power:parseFloat(document.getElementById('power').value||'0'),
      serial:(document.getElementById('serial').value||'').trim(),
      installed:(document.getElementById('installed').value||'').trim(),
      last:(document.getElementById('last').value||'').trim(),
      interval:parseInt(document.getElementById('interval').value||'6',10),
      responsible:(document.getElementById('resp').value||'').trim(),
      url:(document.getElementById('url').value||'').trim(),
      notes:(document.getElementById('notes').value||'').trim()
    };
    if(!rec.id){ alert('–£–∫–∞–∂–∏ ID'); return; }
    rec.next = nextService(rec.last, rec.interval);
    const i = items.findIndex(x=>x.id===rec.id);
    if(i>=0) items[i] = {...items[i], ...rec};
    else items.push(rec);
    render();
    previewNFC(rec);
    buildTickets([rec]);
  }

  // ===== –†–ï–ù–î–ï–† =====
  function render(){
    tbody.innerHTML='';
    items.forEach((r,i)=>{
      const st = serviceStatus(r.next);
      const tr=document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td class="editable" data-k="id" data-id="${r.id}">${esc(r.id)}</td>
        <td class="editable" data-k="name" data-id="${r.id}">${esc(r.name)}</td>
        <td class="editable" data-k="location" data-id="${r.id}">${esc(r.location)}</td>
        <td class="editable" data-k="circuit" data-id="${r.id}">${esc(r.circuit)}</td>
        <td class="editable" data-k="phase" data-id="${r.id}">${esc(r.phase)}</td>
        <td class="editable" data-k="voltage" data-id="${r.id}">${esc(r.voltage)}</td>
        <td class="editable" data-k="power" data-id="${r.id}">${esc(r.power)}</td>
        <td class="editable" data-k="serial" data-id="${r.id}">${esc(r.serial)}</td>
        <td class="editable" data-k="installed" data-id="${r.id}">${esc(r.installed)}</td>
        <td class="editable" data-k="last" data-id="${r.id}">${esc(r.last)}</td>
        <td>${esc(r.next)} <span class="chip ${st.cls}">${st.txt}</span></td>
        <td class="editable" data-k="url" data-id="${r.id}">${esc(r.url||'')}</td>
        <td class="mono">
          <button class="btn" data-act="nfc" data-id="${r.id}">NFC/QR</button>
          <button class="btn" data-act="label" data-id="${r.id}">–ù–∞–∫–ª–µ–π–∫–∞</button>
          <button class="btn" data-act="del" data-id="${r.id}">‚úñ</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  // –Ü–Ω–ª–∞–π–Ω —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
  tbody.addEventListener('dblclick',(e)=>{
    const td=e.target.closest('.editable'); if(!td) return;
    const id=td.getAttribute('data-id'); const key=td.getAttribute('data-k');
    const idx=items.findIndex(x=>x.id===id); const r=items[idx];
    const input=document.createElement('input'); input.value=r[key]||''; input.style.width='100%'; input.style.padding='6px 8px';
    input.addEventListener('blur', ()=>{
      let v=input.value.trim();
      if(['voltage','power','interval'].includes(key)) v=parseFloat(v)||r[key];
      r[key]=v;
      if(key==='last' || key==='interval') r.next=nextService(r.last,r.interval);
      render();
    });
    td.innerHTML=''; td.appendChild(input); input.focus(); input.select();
  });

  // –î—ñ—ó
  tbody.addEventListener('click',(e)=>{
    const b=e.target.closest('button'); if(!b) return;
    const id=b.getAttribute('data-id'); const act=b.getAttribute('data-act');
    const r=items.find(x=>x.id===id);
    if(act==='del'){ items = items.filter(x=>x.id!==id); render(); return; }
    if(act==='label'){ buildTickets([r]); ticketsBox.scrollIntoView({behavior:'smooth'}); }
    if(act==='nfc'){ previewNFC(r); document.getElementById('ndefText').scrollIntoView({behavior:'smooth'}); }
  });

  // ===== NFC/QR –ü–†–ï–í'–Æ =====
  function previewNFC(recOpt){
    const r = recOpt || currentFormRecord();
    if(!r) return;
    const uri = r.url && r.url.length ? r.url : `https://serawww7.github.io/edlab/electric_para17.html#${encodeURIComponent(r.id)}`;
    const text = [
      `ID: ${r.id}`,
      `–ù–∞–∑–≤–∞: ${r.name}`,
      `–ú—ñ—Å—Ü–µ: ${r.location}`,
      `–õ—ñ–Ω—ñ—è: ${r.circuit}`,
      `–§–∞–∑–∞/U/P: ${r.phase}/${r.voltage}–í/${r.power}–í—Ç`,
      `–°–µ—Ä‚Ññ: ${r.serial}`,
      `–í—Å—Ç: ${r.installed}  –û–°–¢ –¢–û: ${r.last}  –ù–∞—Å—Ç –¢–û: ${r.next}`,
      `–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π: ${r.responsible}`,
      `URL: ${uri}`
    ].join('\n');
    document.getElementById('ndefText').value = text;
    document.getElementById('ndefURI').value = uri;
  }
  function currentFormRecord(){
    const rec = {
      id:(document.getElementById('id').value||'').trim(),
      name:(document.getElementById('name').value||'').trim(),
      location:(document.getElementById('location').value||'').trim(),
      circuit:(document.getElementById('circuit').value||'').trim(),
      phase:document.getElementById('phase').value,
      voltage:parseFloat(document.getElementById('voltage').value||'230'),
      power:parseFloat(document.getElementById('power').value||'0'),
      serial:(document.getElementById('serial').value||'').trim(),
      installed:(document.getElementById('installed').value||'').trim(),
      last:(document.getElementById('last').value||'').trim(),
      interval:parseInt(document.getElementById('interval').value||'6',10),
      responsible:(document.getElementById('resp').value||'').trim(),
      url:(document.getElementById('url').value||'').trim(),
      notes:(document.getElementById('notes').value||'').trim()
    };
    if(!rec.id) return null;
    rec.next = nextService(rec.last, rec.interval);
    return rec;
  }

  // ===== –ù–ê–ö–õ–ï–ô–ö–ò 58 –º–º =====
  function buildTickets(list){
    const L = list || items;
    ticketsBox.innerHTML='';
    L.forEach(r=>{
      const st = serviceStatus(r.next);
      const el=document.createElement('div'); el.className='ticket';
      const uri = r.url && r.url.length ? r.url : `https://serawww7.github.io/edlab/electric_para17.html#${encodeURIComponent(r.id)}`;
      el.innerHTML = `
        <h4>–ü–ê–°–ü–û–†–¢ –û–ë–õ–ê–î–ù–ê–ù–ù–Ø</h4>
        <p><b>${esc(r.id)} ¬∑ ${esc(r.name)}</b></p>
        <div class="line"></div>
        <p>${esc(r.location)}</p>
        <p>${esc(r.circuit)} ¬∑ ${esc(r.phase)} ¬∑ ${esc(r.voltage)}–í ¬∑ ${esc(r.power)}–í—Ç</p>
        <p>–°–µ—Ä‚Ññ ${esc(r.serial)}</p>
        <p>–û–°–¢ –¢–û: ${esc(r.last)} ¬∑ –ù–ê–°–¢: ${esc(r.next)}</p>
        <p>–°—Ç–∞—Ç—É—Å: ${st.txt}</p>
        <div class="line"></div>
        <p class="qr"><small>URI: ${esc(uri)}</small></p>
        <p><small>${nowStamp()}</small></p>
      `;
      ticketsBox.appendChild(el);
    });
  }
  function downloadTXT(){
    if(!ticketsBox.firstChild){ alert('–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –Ω–∞–∫–ª–µ–π–∫–∏'); return; }
    const arr=['EQUIP PASSPORT 58mm','-------------------'];
    Array.from(ticketsBox.children).forEach(t=>{ arr.push(t.innerText.replace(/\n{2,}/g,'\n')); arr.push('-------------------'); });
    const blob = new Blob([arr.join('\n')],{type:'text/plain;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='equip_passports_58mm.txt'; a.click(); URL.revokeObjectURL(a.href);
  }

  // ===== A4-–ó–í–Ü–¢ =====
  function buildReport(){
    if(!items.length){ alert('–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤'); return; }
    const rows = items.map((r,i)=>{
      const st = serviceStatus(r.next);
      return `
        <tr>
          <td>${i+1}</td><td>${esc(r.id)}</td><td>${esc(r.name)}</td><td>${esc(r.location)}</td>
          <td>${esc(r.circuit)}</td><td>${esc(r.phase)}</td><td>${esc(r.voltage)}</td><td>${esc(r.power)}</td>
          <td>${esc(r.serial)}</td><td>${esc(r.installed)}</td><td>${esc(r.last)}</td><td>${esc(r.next)} (${st.txt})</td>
          <td>${esc(r.responsible)}</td><td>${esc(r.notes||'')}</td>
        </tr>`;
    }).join('');
    const html = `
      <section class="doc">
        <h2>–†–ï–Ñ–°–¢–† –û–ë–õ–ê–î–ù–ê–ù–ù–Ø –¢–ê –ü–õ–ê–ù –¢–û</h2>
        <p>–î–∞—Ç–∞: ${nowStamp()}</p>
        <table>
          <thead><tr>
            <th>#</th><th>ID</th><th>–ù–∞–∑–≤–∞</th><th>–ú—ñ—Å—Ü–µ</th><th>–õ—ñ–Ω—ñ—è</th><th>–§–∞–∑–∞</th><th>U, –í</th><th>P, –í—Ç</th>
            <th>–°–µ—Ä‚Ññ</th><th>–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</th><th>–û—Å—Ç–∞–Ω–Ω—î –¢–û</th><th>–ù–∞—Å—Ç—É–ø–Ω–µ –¢–û</th><th>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π</th><th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>
        <div class="sign"><div>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å: ____________________</div><div>–ü–µ—Ä–µ–≤—ñ—Ä–∏–≤: ____________________</div></div>
        <p class="small">–ù–∞–≤—á–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞; —É —Ä–µ–∞–ª—å–Ω–∏—Ö —É–º–æ–≤–∞—Ö –¥–æ–¥–∞–π—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏ –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å, –∫–∞—Ä—Ç–∏ —Ä–∏–∑–∏–∫—ñ–≤, –ø—ñ–¥–ø–∏—Å–∏ —Ç–∞ —Ñ–æ—Ç–æ—Ñ—ñ–∫—Å–∞—Ü—ñ—é.</p>
      </section>`;
    document.getElementById('printArea').innerHTML = html;
    document.getElementById('printArea').scrollIntoView({behavior:'smooth'});
  }

  // ===== CSV =====
  function exportCSV(){
    const headers=['id','name','location','circuit','phase','voltage_V','power_W','serial','installed_yyyy_mm_dd','last_yyyy_mm_dd','next_yyyy_mm_dd','interval_months','responsible','url','notes','timestamp'];
    const stamp=nowStamp();
    const csv=[headers.join(','), ...items.map(r=>{
      const vals=[r.id,r.name,r.location,r.circuit,r.phase,r.voltage,r.power,r.serial,r.installed,r.last,r.next,r.interval,r.responsible,r.url||'',r.notes||'',stamp];
      return vals.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',');
    })].join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='equipment_registry.csv'; a.click(); URL.revokeObjectURL(a.href);
  }

  async function importCSV(){
    const f=document.getElementById('file').files[0]; if(!f){ alert('–û–±–µ—Ä—ñ—Ç—å CSV'); return; }
    const txt=await f.text();
    const lines=txt.trim().split(/\r?\n/); if(lines.length<2){ alert('CSV –ø–æ—Ä–æ–∂–Ω—ñ–π'); return; }
    const headers=lines[0].split(',').map(h=>h.replace(/^"|"$/g,'').trim());
    const req=['id','name','location','circuit','phase','voltage_V','power_W','serial','installed_yyyy_mm_dd','last_yyyy_mm_dd','interval_months','responsible','url','notes'];
    const miss=req.filter(x=>!headers.includes(x)); if(miss.length){ alert('–í—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è: '+miss.join(', ')); return; }
    const out=[];
    for(let i=1;i<lines.length;i++){
      const cells=splitCSV(lines[i]); if(!cells.length) continue;
      const o={}; headers.forEach((h,j)=> o[h]=(cells[j]||'').replace(/^"|"$/g,''));
      const rec={
        id:o.id,name:o.name,location:o.location,circuit:o.circuit,phase:o.phase||'A',
        voltage:parseFloat(o.voltage_V||'230'), power:parseFloat(o.power_W||'0'), serial:o.serial||'',
        installed:o.installed_yyyy_mm_dd||'', last:o.last_yyyy_mm_dd||'', interval:parseInt(o.interval_months||'6',10),
        responsible:o.responsible||'', url:o.url||'', notes:o.notes||''
      };
      rec.next = nextService(rec.last, rec.interval);
      out.push(rec);
    }
    items = out; render();
  }
  function splitCSV(line){
    const res=[]; let cur=''; let q=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else q=!q; }
      else if(ch===',' && !q){ res.push(cur); cur=''; }
      else { cur+=ch; }
    }
    res.push(cur); return res;
  }

  // ===== ICS =====
  function icsEscape(s){ return String(s).replace(/([,;])/g,'\\$1').replace(/\n/g,'\\n'); }
  function icsFormatDate(d){ // UTC-less –ª–æ–∫–∞–ª—å–Ω–∏–π
    const dt = (d instanceof Date) ? d : dParse(d);
    return dt.getFullYear().toString()
      + pad(dt.getMonth()+1) + pad(dt.getDate()) + 'T' + pad(dt.getHours()) + pad(dt.getMinutes()) + '00';
  }
  function buildICS(){
    const lines=['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//edlab//equip//UA'];
    items.forEach(r=>{
      const start = dParse(r.next); start.setHours(9,0,0,0);
      const uid = `${r.id}-${r.next}@edlab`;
      lines.push('BEGIN:VEVENT');
      lines.push('UID:'+uid);
      lines.push('DTSTAMP:'+icsFormatDate(new Date()));
      lines.push('DTSTART:'+icsFormatDate(start));
      lines.push('SUMMARY:'+icsEscape(`–¢–û: ${r.id} ¬∑ ${r.name}`));
      lines.push('LOCATION:'+icsEscape(r.location));
      lines.push('DESCRIPTION:'+icsEscape(`–õ—ñ–Ω—ñ—è: ${r.circuit}\n–§–∞–∑–∞/U/P: ${r.phase}/${r.voltage}–í/${r.power}–í—Ç\n–°–µ—Ä‚Ññ: ${r.serial}\n–í—ñ–¥–ø.: ${r.responsible}\nURL: ${r.url||''}`));
      lines.push('END:VEVENT');
    });
    lines.push('END:VCALENDAR');
    return lines.join('\n');
  }
  function downloadICS(){
    if(!items.length){ alert('–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤'); return; }
    const blob = new Blob([buildICS()], {type:'text/calendar;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='equipment_maintenance.ics'; a.click(); URL.revokeObjectURL(a.href);
  }

  // ===== –ü–†–ò–ö–õ–ê–î–ò =====
  function seedOne(){
    document.getElementById('id').value='EQ-002';
    document.getElementById('name').value='–ö–æ–º–ø—Ä–µ—Å–æ—Ä 1–§';
    document.getElementById('location').value='–ú–∞–π—Å—Ç–µ—Ä–Ω—è –ê-102';
    document.getElementById('circuit').value='–©–û-1 ¬∑ S-02';
    document.getElementById('phase').value='B';
    document.getElementById('voltage').value=230;
    document.getElementById('power').value=900;
    document.getElementById('serial').value='SN-2310-015';
    document.getElementById('installed').value='2024-10-15';
    document.getElementById('last').value='2025-04-10';
    document.getElementById('interval').value=12;
    document.getElementById('resp').value='–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞';
    document.getElementById('url').value='https://serawww7.github.io/edlab/manuals/compressor.html';
    document.getElementById('notes').value='–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–º—ñ–Ω—å, —Ñ—ñ–ª—å—Ç—Ä';
  }
  function seedDemo(){
    items = [
      {id:'EQ-001',name:'–í–∏—Ç—è–∂–Ω–∏–π –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä 3–§',location:'–ú–∞–π—Å—Ç–µ—Ä–Ω—è –ê-101',circuit:'–©–û-1 ¬∑ M-01',phase:'3–§',voltage:400,power:1500,serial:'SN-2309-001',installed:'2025-09-10',last:'2025-10-01',interval:6,responsible:'–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞',url:'',notes:'–û–ø—ñ—Ä —ñ–∑–æ–ª—è—Ü—ñ—ó —â–æ—Å–µ–∑–æ–Ω—É'},
      {id:'EQ-002',name:'–ö–æ–º–ø—Ä–µ—Å–æ—Ä 1–§',location:'–ú–∞–π—Å—Ç–µ—Ä–Ω—è –ê-102',circuit:'–©–û-1 ¬∑ S-02',phase:'B',voltage:230,power:900,serial:'SN-2310-015',installed:'2024-10-15',last:'2025-04-10',interval:12,responsible:'–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞',url:'https://serawww7.github.io/edlab/manuals/compressor.html',notes:'–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–º—ñ–Ω—å, —Ñ—ñ–ª—å—Ç—Ä'},
      {id:'EQ-003',name:'–ü–∞—è–ª—å–Ω–∞ —Å—Ç–∞–Ω—Ü—ñ—è',location:'–í–µ—Ä—Å—Ç–∞–∫ –°-12',circuit:'–©–û-1 ¬∑ S-01',phase:'C',voltage:230,power:150,serial:'SN-2403-222',installed:'2023-03-22',last:'2025-03-01',interval:12,responsible:'–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞',url:'',notes:'–ö–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è –∂–∞–ª'}
    ];
    items.forEach(r=>{ r.next = nextService(r.last, r.interval); });
    render();
  }

  // –ê–≤—Ç–æ-–¥–µ–º–æ
  seedDemo();
</script>


</body></html>