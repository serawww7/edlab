<!-- electric_para12.html
     –ü–∞—Ä–∞ 12 (–ï–ª–µ–∫—Ç—Ä–∏–∫–∏, –∞—É–¥–∏—Ç–æ—Ä–Ω–æ): –ü–£–°–ö–û–í–Ü –°–¢–†–£–ú–ò –î–í–ò–ì–£–ù–Ü–í
     –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ In, I–ø—É—Å–∫ (–∑–∞ –º–µ—Ç–æ–¥–æ–º –ø—É—Å–∫—É), –¥–æ–±—ñ—Ä –∑–∞—Ö–∏—Å—Ç—ñ–≤ (MCB/MPCB + —Ç–µ–ø–ª–æ–≤–µ —Ä–µ–ª–µ),
     –æ—Ü—ñ–Ω–∫–∞ –ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ –ø—ñ–¥ —á–∞—Å –ø—É—Å–∫—É/—Ä–æ–±–æ—Ç–∏, –Ω–∞–∫–ª–µ–π–∫–∏ 58 –º–º, A4-–∑–≤—ñ—Ç, CSV —ñ–º–ø–æ—Ä—Ç/–µ–∫—Å–ø–æ—Ä—Ç.
     –ü–æ–≤–Ω—ñ—Å—Ç—é –∞–≤—Ç–æ–Ω–æ–º–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è GitHub Pages —ñ –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è –≤ Moodle —á–µ—Ä–µ–∑ <iframe>.
--><!DOCTYPE html><html lang="uk"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 12 ‚Äî –ü—É—Å–∫–æ–≤—ñ —Å—Ç—Ä—É–º–∏ –¥–≤–∏–≥—É–Ω—ñ–≤: In, I–ø—É—Å–∫, –∑–∞—Ö–∏—Å—Ç–∏, ŒîU, 58 –º–º</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg:#0b1220; --bg2:#111827; --card:#0f172a; --text:#e2e8f0; --muted:#9aa5b1; --line:#1f2937;
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --info:#60a5fa;
  }
  *{box-sizing:border-box}
  body{margin:0; background:linear-gradient(180deg,var(--bg),var(--bg2) 30%,var(--bg)); color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55}
  .wrap{max-width:1120px; margin:0 auto; padding:24px 16px 96px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:#9aa5b1}
  h1{font-size:32px; margin:6px 0 12px; line-height:1.15; background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:22px 0 12px}
  h3{font-size:18px; margin:12px 0 8px; color:#cbd5e1}
  p{margin:8px 0}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:1050px){.g3{grid-template-columns:1fr}; .g2{grid-template-columns:1fr}}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .small{font-size:12px; color:#93a3b5}
  .chip{display:inline-block; padding:2px 8px; border:1px solid #223049; border-radius:999px; font-size:12px; margin-right:6px; background:#0d1a2e}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)} .muted{color:#9aa5b1}
  input,select,textarea{padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e5e7eb; width:100%}

  /* –¢–∞–±–ª–∏—Ü—ñ */
  table{width:100%; border-collapse:separate; border-spacing:0; border:1px solid #223049; border-radius:12px; overflow:hidden}
  thead th{background:#0c1629; color:#a5b4fc; text-align:left; padding:10px 12px; font-size:14px}
  tbody td{padding:8px 10px; border-top:1px solid #1f2937; font-size:14px; vertical-align:top}
  tbody tr:nth-child(even){background:#0b1324}

  /* –ö–≤–∏—Ç–∞–Ω—Ü—ñ—ó 58 –º–º */
  .tickets{display:flex; gap:12px; flex-wrap:wrap}
  .ticket{
    width:58mm; background:#fff; color:#000; padding:5mm 4mm; border-radius:6px;
    box-shadow:0 0 0 1px #e5e7eb inset; font-family:"Courier New",ui-monospace,monospace
  }
  .ticket h4{margin:0 0 4px; font-size:13px; text-align:center}
  .ticket p{margin:1px 0; font-size:12px}
  .ticket .line{border-top:1px dashed #111; margin:5px 0}
  .ticket small{font-size:10px}
  .ticket .qr{font-size:10px; word-break:break-all}

  /* A4 */
  #printArea{background:#fff; color:#000; border-radius:12px; border:1px solid #e5e7eb; padding:16px}
  .doc{page-break-after:always; padding:12mm; color:#000; font-family:Georgia,"Times New Roman",serif}
  .doc h2{color:#000; font-size:20px; margin:0 0 6px}
  .doc h3{color:#000; font-size:16px; margin:6px 0}
  .doc p{color:#000; margin:4px 0}
  .doc table{width:100%; border-collapse:collapse; border:1px solid #111}
  .doc th,.doc td{border:1px solid #111; padding:6px 8px; font-size:12px; vertical-align:top}
  .doc .sign{margin-top:10mm; display:flex; gap:10mm; flex-wrap:wrap}
  .doc .sign div{flex:1 1 220px}

  /* –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (iframe/Moodle) */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}

  @media print{
    @page{ size:A4; margin:12mm }
    body{ background:#fff; color:#000 }
    .no-print, .card:not(.printable){ display:none !important }
    #printArea{ border:none; padding:0 }
    .ticket{ box-shadow:none; width:auto; padding:0 }
  }
</style>
<meta name="description" content="–û—Ü—ñ–Ω–∏—Ç–∏ –Ω–æ–º—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç—Ä—É–º In, –ø—É—Å–∫–æ–≤–∏–π —Å—Ç—Ä—É–º I–ø—É—Å–∫ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –ø—É—Å–∫—É (DOL/–∑—ñ—Ä–∫–∞-—Ç—Ä–∏–∫—É—Ç–Ω–∏–∫/—Å–æ—Ñ—Ç-—Å—Ç–∞—Ä—Ç–µ—Ä), –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –∑–∞—Ö–∏—Å—Ç–∏ (MCB/MPCB + —Ç–µ–ø–ª–æ–≤–µ —Ä–µ–ª–µ)"><link rel="canonical" href="https://edlab.pp.ua/elect_II_kyrs/electric_para12.html"><meta property="og:type" content="article"><meta property="og:title" content="üõû –ü—É—Å–∫–æ–≤—ñ —Å—Ç—Ä—É–º–∏ –¥–≤–∏–≥—É–Ω—ñ–≤: In ‚Üí I–ø—É—Å–∫ ‚Üí –∑–∞—Ö–∏—Å—Ç–∏ (MCB/MPCB, –¢–†) ‚Üí ŒîU ‚Üí üßæ 58 –º–º"><meta property="og:description" content="–û—Ü—ñ–Ω–∏—Ç–∏ –Ω–æ–º—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç—Ä—É–º In, –ø—É—Å–∫–æ–≤–∏–π —Å—Ç—Ä—É–º I–ø—É—Å–∫ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –ø—É—Å–∫—É (DOL/–∑—ñ—Ä–∫–∞-—Ç—Ä–∏–∫—É—Ç–Ω–∏–∫/—Å–æ—Ñ—Ç-—Å—Ç–∞—Ä—Ç–µ—Ä), –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –∑–∞—Ö–∏—Å—Ç–∏ (MCB/MPCB + —Ç–µ–ø–ª–æ–≤–µ —Ä–µ–ª–µ)"><meta property="og:url" content="https://edlab.pp.ua/elect_II_kyrs/electric_para12.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"LearningResource","name":"üõû –ü—É—Å–∫–æ–≤—ñ —Å—Ç—Ä—É–º–∏ –¥–≤–∏–≥—É–Ω—ñ–≤: In ‚Üí I–ø—É—Å–∫ ‚Üí –∑–∞—Ö–∏—Å—Ç–∏ (MCB/MPCB, –¢–†) ‚Üí ŒîU ‚Üí üßæ 58 –º–º","description":"–û—Ü—ñ–Ω–∏—Ç–∏ –Ω–æ–º—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç—Ä—É–º In, –ø—É—Å–∫–æ–≤–∏–π —Å—Ç—Ä—É–º I–ø—É—Å–∫ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –ø—É—Å–∫—É (DOL/–∑—ñ—Ä–∫–∞-—Ç—Ä–∏–∫—É—Ç–Ω–∏–∫/—Å–æ—Ñ—Ç-—Å—Ç–∞—Ä—Ç–µ—Ä), –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –∑–∞—Ö–∏—Å—Ç–∏ (MCB/MPCB + —Ç–µ–ø–ª–æ–≤–µ —Ä–µ–ª–µ)","inLanguage":"uk","educationalLevel":"college","url":"https://edlab.pp.ua/elect_II_kyrs/electric_para12.html","provider":{"@type":"Organization","name":"EDLab"}}</script></head>
<body>
  <div class="wrap">
    <span class="badge">–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 12 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ</span>
    <h1>üõû –ü—É—Å–∫–æ–≤—ñ —Å—Ç—Ä—É–º–∏ –¥–≤–∏–≥—É–Ω—ñ–≤: In ‚Üí I–ø—É—Å–∫ ‚Üí –∑–∞—Ö–∏—Å—Ç–∏ (MCB/MPCB, –¢–†) ‚Üí ŒîU ‚Üí üßæ 58 –º–º</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>–û—Ü—ñ–Ω–∏—Ç–∏ –Ω–æ–º—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç—Ä—É–º <b>In</b>, –ø—É—Å–∫–æ–≤–∏–π —Å—Ç—Ä—É–º <b>I–ø—É—Å–∫</b> –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –ø—É—Å–∫—É (DOL/–∑—ñ—Ä–∫–∞-—Ç—Ä–∏–∫—É—Ç–Ω–∏–∫/—Å–æ—Ñ—Ç-—Å—Ç–∞—Ä—Ç–µ—Ä), –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ <b>–∑–∞—Ö–∏—Å—Ç–∏</b> (MCB/MPCB + —Ç–µ–ø–ª–æ–≤–µ —Ä–µ–ª–µ), –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏ <b>ŒîU</b> –ø—ñ–¥ —á–∞—Å –ø—É—Å–∫—É —ñ —Ä–æ–±–æ—Ç–∏ —Ç–∞ —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –º—ñ—Ç–∫–∏ 58 –º–º —ñ A4-–∑–≤—ñ—Ç.</p>
      <p class="small">–§–æ—Ä–º—É–ª–∏: <span class="mono">In = P / (‚àö3¬∑U<sub>L-L</sub>¬∑Œ∑¬∑PF)</span>, <span class="mono">I–ø—É—Å–∫ = k¬∑In</span>, –¥–µ <span class="mono">k</span> –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –º–µ—Ç–æ–¥—É (DOL: 6‚Äì8; Y/Œî: 2‚Äì3; —Å–æ—Ñ—Ç-—Å—Ç–∞—Ä—Ç–µ—Ä: 1.8‚Äì2.5). <span class="mono">ŒîU% ‚âà I¬∑2¬∑L¬∑œÅ / (S¬∑U)¬∑100</span> (–Ω–∞–≤—á–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞; Cu œÅ=0.0175 Œ©¬∑–º–º¬≤/–º).</p>
      <div class="row">
        <button class="btn" onclick="seedDemo()">üîÑ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" onclick="exportCSV()">üì§ –ï–∫—Å–ø–æ—Ä—Ç CSV</button>
        <input id="file" type="file" accept=".csv,text/csv" class="btn">
        <button class="btn" onclick="importCSV()">‚¨ÜÔ∏è –Ü–º–ø–æ—Ä—Ç CSV</button>
      </div>
      <p class="small">CSV –ø–æ–ª—è: <span class="mono">id,name,kW,U_LL,PF,eta,method,cable_mm2,length_m,starter,curve,stdA,run_drop_limit,start_drop_limit,notes,url</span></p>
    </div>

    <div class="card">
      <h2>‚ûï –î–≤–∏–≥—É–Ω / –õ—ñ–Ω—ñ—è</h2>
      <div class="grid g3">
        <div>
          <h3>–î–≤–∏–≥—É–Ω</h3>
          <div class="row"><label class="small" style="min-width:150px">ID</label><input id="mId" value="M-001"></div>
          <div class="row"><label class="small" style="min-width:150px">–ù–∞–∑–≤–∞</label><input id="mName" value="–ù–∞—Å–æ—Å 3 –∫–í—Ç"></div>
          <div class="row"><label class="small" style="min-width:150px">–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å, –∫–í—Ç</label><input id="kW" type="number" step="0.1" value="3.0"></div>
          <div class="row"><label class="small" style="min-width:150px">U<sub>L-L</sub>, –í</label><input id="U" type="number" value="400"></div>
          <div class="row"><label class="small" style="min-width:150px">PF (cosœÜ)</label><input id="pf" type="number" step="0.01" value="0.85"></div>
          <div class="row"><label class="small" style="min-width:150px">Œ∑ (–∫–æ–µ—Ñ. –∫–æ—Ä–∏—Å–Ω–æ—ó –¥—ñ—ó)</label><input id="eta" type="number" step="0.01" value="0.88"></div>
        </div>
        <div>
          <h3>–ú–µ—Ç–æ–¥ –ø—É—Å–∫—É</h3>
          <div class="row"><label class="small" style="min-width:150px">–ú–µ—Ç–æ–¥</label>
            <select id="method">
              <option value="DOL" selected="">DOL (–ø—Ä—è–º–∏–π –ø—É—Å–∫)</option>
              <option value="YŒî">–ó—ñ—Ä–∫–∞-—Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ (Y/Œî)</option>
              <option value="SOFT">–°–æ—Ñ—Ç-—Å—Ç–∞—Ä—Ç–µ—Ä</option>
            </select>
          </div>
          <div class="row"><label class="small" style="min-width:150px">k (–º–Ω–æ–∂–Ω–∏–∫ I–ø—É—Å–∫)</label><input id="k" type="number" step="0.1" value="7.0"></div>
          <div class="row"><label class="small" style="min-width:150px">–°—Ç–∞—Ä—Ç–µ—Ä/–ü—É—Å–∫–∞—á</label><input id="starter" value="–ö–æ–Ω—Ç–∞–∫—Ç–æ—Ä + –¢–†"></div>
          <div class="row"><label class="small" style="min-width:150px">–ö—Ä–∏–≤–∞ MCB</label>
            <select id="curve"><option>B</option><option selected="">C</option><option>D</option></select>
          </div>
          <div class="row"><label class="small" style="min-width:150px">–†—è–¥ In (–ê)</label>
            <select id="stdA"><option>6</option><option>10</option><option>13</option><option selected="">16</option><option>20</option><option>25</option><option>32</option><option>40</option></select>
          </div>
        </div>
        <div>
          <h3>–õ—ñ–Ω—ñ—è</h3>
          <div class="row"><label class="small" style="min-width:150px">–ö–∞–±–µ–ª—å, –º–º¬≤</label>
            <select id="S"><option>2.5</option><option selected="">4</option><option>6</option><option>10</option></select></div>
          <div class="row"><label class="small" style="min-width:150px">–î–æ–≤–∂–∏–Ω–∞ L, –º</label><input id="L" type="number" value="28"></div>
          <div class="row"><label class="small" style="min-width:150px">–õ—ñ–º—ñ—Ç ŒîU (—Ä–æ–±–æ—Ç–∞), %</label><input id="runLimit" type="number" step="0.1" value="5"></div>
          <div class="row"><label class="small" style="min-width:150px">–õ—ñ–º—ñ—Ç ŒîU (–ø—É—Å–∫), %</label><input id="startLimit" type="number" step="0.1" value="10"></div>
          <div class="row"><label class="small" style="min-width:150px">URL (NFC/QR)</label><input id="url" placeholder="https://serawww7.github.io/edlab/..."></div>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" onclick="addOrUpdate()">üíæ –î–æ–¥–∞—Ç–∏/–û–Ω–æ–≤–∏—Ç–∏</button>
        <button class="btn" onclick="calcOne()">üßÆ –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="seedOne()">üîÑ –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Å—É</button>
      </div>
    </div>

    <div class="card printable">
      <h2>üìã –†–µ—î—Å—Ç—Ä –¥–≤–∏–≥—É–Ω—ñ–≤ / –ª—ñ–Ω—ñ–π</h2>
      <table id="tbl">
        <thead>
          <tr>
            <th>#</th><th>ID</th><th>–ù–∞–∑–≤–∞</th><th>kW</th><th>In, –ê</th><th>I–ø—É—Å–∫, –ê</th><th>–ú–µ—Ç–æ–¥</th><th>MCB/MPCB, –ê</th><th>–¢–†, –ê</th><th>–ö–∞–±–µ–ª—å, –º–º¬≤</th><th>ŒîU—Ä–æ–±, %</th><th>ŒîU–ø—É—Å–∫, %</th><th>–°—Ç–∞—Ç—É—Å</th><th>URL</th><th>–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p class="small">–°—Ç–∞—Ç—É—Å: <span class="chip ok">PASS</span> ‚Äî ŒîU –≤ –º–µ–∂–∞—Ö –ª—ñ–º—ñ—Ç—ñ–≤; <span class="chip warn">WARN</span> ‚Äî —Ä–æ–±–æ—Ç–∞ PASS, –ø—É—Å–∫ –±–ª–∏–∑—å–∫–æ –¥–æ –º–µ–∂; <span class="chip bad">FAIL</span> ‚Äî –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è.</p>
    </div>

    <div class="card printable">
      <h2>üßæ –ù–∞–∫–ª–µ–π–∫–∏ 58 –º–º ¬´–õ–Ü–ù–Ü–Ø –î–í–ò–ì–£–ù–ê¬ª</h2>
      <div class="row">
        <button class="btn" onclick="buildTickets()">üß© –ó—ñ–±—Ä–∞—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö</button>
        <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫ 58 –º–º</button>
        <button class="btn" onclick="downloadTXT()">üì• TXT</button>
      </div>
      <div id="tickets" class="tickets"></div>
    </div>

    <div class="card printable">
      <h2>üìÑ A4-–∑–≤—ñ—Ç (–¥–ª—è –¥—Ä—É–∫—É/PDF)</h2>
      <div class="row">
        <button class="btn" onclick="buildReport()">üß© –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ A4</button>
        <button class="btn" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫/PDF</button>
      </div>
      <div id="printArea"></div>
    </div>
  </div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (Moodle) ‚Üí —Å—Ç—Ä–∏–º–∞–Ω–∏–π –≤–∏–≥–ª—è–¥
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // ======= –°–¢–ê–ù =======
  let motors = []; // {id,name,kW,U,PF,eta,method,k,S,L,starter,curve,stdA,runLimit,startLimit,url,calc:{In,Istart,mcb,tr,dropRun,dropStart,status}}
  const tbody = document.querySelector('#tbl tbody');
  const ticketsBox = document.getElementById('tickets');

  // ======= –£–¢–ò–õ–Ü–¢–ò =======
  function esc(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
  function pad(n){ return n.toString().padStart(2,'0'); }
  function nowStamp(){ const d=new Date(); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`; }

  function In_calc(kW,U,eta,PF){
    // In = P / (sqrt(3)*U*eta*PF), P=kW*1000
    if(U<=0 || eta<=0 || PF<=0) return 0;
    return (kW*1000)/(Math.sqrt(3)*U*eta*PF);
  }
  function drop_pct(I, L, S, U){
    // ŒîU% ‚âà I ¬∑ 2¬∑L¬∑œÅ / (S¬∑U) ¬∑ 100  (–æ–¥–Ω–∞ –ª—ñ–Ω—ñ—è —Ç—É–¥–∏-–Ω–∞–∑–∞–¥, 3—Ñ –æ—Ü—ñ–Ω–∫–∞ –¥–ª—è —Ñ–∞–∑–∏)
    const rho = 0.0175; // Œ©¬∑–º–º¬≤/–º (Cu)
    if(S<=0||U<=0) return 0;
    return (I * 2 * L * rho) / (S * U) * 100;
  }
  function pickMCB(Irun, stdA){
    // –ø—ñ–¥–±—ñ—Ä –Ω–æ–º—ñ–Ω–∞–ª—É –∞–≤—Ç–æ–º–∞—Ç–∞ (–Ω–∞–≤—á–∞–ª—å–Ω–æ): In ‚â• 1.25*Irun, –∑ —Ä—è–¥—É —Ç–∞ –Ω–µ –Ω–∏–∂—á–µ stdA
    const row=[6,10,13,16,20,25,32,40,50,63];
    const need = Irun*1.25;
    let pick = row.find(x=>x>=need) || row[row.length-1];
    return Math.max(pick, stdA);
  }
  function pickThermal(Irun){ return Math.round(Irun*1.1*10)/10; } // –¢–† ~ 1.05‚Äì1.15¬∑In ‚Üí –±–µ—Ä–µ–º–æ 1.1¬∑In

  function statusFromDrops(dropRun, dropStart, runLimit, startLimit){
    if(dropRun>runLimit || dropStart>startLimit) return 'FAIL';
    if((startLimit - dropStart) <= 1.0) return 'WARN'; // –±–ª–∏–∑—å–∫–æ –¥–æ –º–µ–∂—ñ
    return 'PASS';
  }

  // ======= –†–û–ó–†–ê–•–£–ù–ö–ò =======
  function calcObj(m){
    const In = In_calc(m.kW, m.U, m.eta, m.PF);
    const Istart = (m.k || 6)*In;
    const Irun = In; // –Ω–æ–º—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–æ–±–æ—á–∏–π
    const mcb = pickMCB(Irun, m.stdA);
    const tr = pickThermal(Irun);
    const dropRun = Math.round(drop_pct(Irun, m.L, m.S, m.U)*100)/100;
    const dropStart = Math.round(drop_pct(Istart, m.L, m.S, m.U)*100)/100;
    const status = statusFromDrops(dropRun, dropStart, m.runLimit, m.startLimit);
    m.calc = {In:round2(In), Istart:round2(Istart), mcb, tr, dropRun, dropStart, status};
    return m;
  }
  function round2(x){ return Math.round(x*100)/100; }

  // ======= –î–û–î–ê–¢–ò/–û–ù–û–í–ò–¢–ò =======
  function addOrUpdate(){
    const rec = {
      id: (document.getElementById('mId').value||'').trim(),
      name: (document.getElementById('mName').value||'').trim(),
      kW: parseFloat(document.getElementById('kW').value||'0'),
      U: parseFloat(document.getElementById('U').value||'400'),
      PF: parseFloat(document.getElementById('pf').value||'0.85'),
      eta: parseFloat(document.getElementById('eta').value||'0.88'),
      method: document.getElementById('method').value,
      k: parseFloat(document.getElementById('k').value||'6'),
      starter: (document.getElementById('starter').value||'').trim(),
      curve: document.getElementById('curve').value,
      stdA: parseInt(document.getElementById('stdA').value||'16',10),
      S: parseFloat(document.getElementById('S').value||'4'),
      L: parseFloat(document.getElementById('L').value||'20'),
      runLimit: parseFloat(document.getElementById('runLimit').value||'5'),
      startLimit: parseFloat(document.getElementById('startLimit').value||'10'),
      url: (document.getElementById('url').value||'').trim()
    };
    if(!rec.id){ alert('–£–∫–∞–∂–∏ ID'); return; }
    const i = motors.findIndex(x=>x.id===rec.id);
    if(i>=0) motors[i] = {...motors[i], ...rec};
    else motors.push(rec);
    calcOne(rec.id);
  }

  function calcOne(idOpt){
    const id = idOpt || (document.getElementById('mId').value||'').trim();
    if(!id){ alert('–ù–µ –≤–∫–∞–∑–∞–Ω–æ ID'); return; }
    const m = motors.find(x=>x.id===id);
    if(!m){ alert('–ù–µ–º–∞—î —Ç–∞–∫–æ–≥–æ –∑–∞–ø–∏—Å—É'); return; }
    // –ê–≤—Ç–æ–ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ k –∑–∞ –º–µ—Ç–æ–¥–æ–º (–ª–∏—à–∞–π –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä—É—á–Ω–æ—ó –∫–æ—Ä–µ–∫—Ü—ñ—ó)
    if(m.method==='YŒî' && (!m.k || m.k>3)){ m.k = 2.5; document.getElementById('k').value=2.5; }
    if(m.method==='SOFT' && (!m.k || m.k>3)){ m.k = 2.2; document.getElementById('k').value=2.2; }
    if(m.method==='DOL' && (!m.k || m.k<5)){ m.k = 7; document.getElementById('k').value=7; }
    calcObj(m); render(); buildTickets([m]);
  }

  // ======= –¢–ê–ë–õ–ò–¶–Ø =======
  function render(){
    tbody.innerHTML='';
    motors.forEach((m,i)=>{
      const c = m.calc || {};
      const badge = `<span class="mono" style="padding:2px 8px;border:1px solid #223049;border-radius:999px;background:#0d1a2e;color:${
        c.status==='PASS'?'#22c55e':(c.status==='WARN'?'#f59e0b':'#ef4444')
      }">${c.status||'‚Äî'}</span>`;
      const tr=document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td class="editable" data-k="id" data-id="${m.id}">${esc(m.id)}</td>
        <td class="editable" data-k="name" data-id="${m.id}">${esc(m.name)}</td>
        <td class="editable" data-k="kW" data-id="${m.id}">${esc(m.kW)}</td>
        <td>${c.In??'‚Äî'}</td>
        <td>${c.Istart??'‚Äî'}</td>
        <td class="editable" data-k="method" data-id="${m.id}">${esc(m.method)}</td>
        <td>${m.curve}${c.mcb??'‚Äî'}</td>
        <td>${c.tr??'‚Äî'}</td>
        <td class="editable" data-k="S" data-id="${m.id}">${esc(m.S)}</td>
        <td>${c.dropRun??'‚Äî'}</td>
        <td>${c.dropStart??'‚Äî'}</td>
        <td>${badge}</td>
        <td class="editable" data-k="url" data-id="${m.id}">${esc(m.url||'')}</td>
        <td class="mono"><button class="btn" data-act="label" data-id="${m.id}">–ù–∞–∫–ª–µ–π–∫–∞</button> <button class="btn" data-act="del" data-id="${m.id}">‚úñ</button></td>`;
      tbody.appendChild(tr);
    });
  }

  // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–ª—ñ—Ç–∏–Ω–æ–∫
  tbody.addEventListener('dblclick', (e)=>{
    const td = e.target.closest('.editable'); if(!td) return;
    const id = td.getAttribute('data-id'); const key = td.getAttribute('data-k');
    const idx = motors.findIndex(x=>x.id===id); const m = motors[idx];
    const input = document.createElement('input'); input.value = m[key] || ''; input.style.width='100%'; input.style.padding='6px 8px';
    input.addEventListener('blur', ()=>{
      let v = input.value.trim();
      if(['kW','S','L'].includes(key)) v = parseFloat(v.replace(',','.'))||0;
      m[key] = v; calcObj(m); render();
    });
    td.innerHTML=''; td.appendChild(input); input.focus(); input.select();
  });

  // –î—ñ—ó
  tbody.addEventListener('click', (e)=>{
    const b = e.target.closest('button'); if(!b) return;
    const id = b.getAttribute('data-id'); const act = b.getAttribute('data-act');
    if(act==='del'){ motors = motors.filter(x=>x.id!==id); render(); return; }
    if(act==='label'){ const m = motors.find(x=>x.id===id); if(!m.calc) calcObj(m); buildTickets([m]); ticketsBox.scrollIntoView({behavior:'smooth'}); }
  });

  // ======= –ù–ê–ö–õ–ï–ô–ö–ò 58 –º–º =======
  function buildTickets(list){
    const L = list || motors;
    ticketsBox.innerHTML='';
    L.forEach(m=>{
      if(!m.calc) calcObj(m);
      const el = document.createElement('div'); el.className='ticket';
      const urlText = m.url ? m.url : `https://serawww7.github.io/edlab/electric_para12.html#${encodeURIComponent(m.id)}`;
      el.innerHTML = `
        <h4>–õ–Ü–ù–Ü–Ø –î–í–ò–ì–£–ù–ê</h4>
        <p><b>${esc(m.id)} ¬∑ ${esc(m.name)}</b></p>
        <div class="line"></div>
        <p>In: ${m.calc.In} A ¬∑ I–ø—É—Å–∫: ${m.calc.Istart} A (${esc(m.method)})</p>
        <p>MCB: ${esc(m.curve)}${m.calc.mcb} ¬∑ –¢–†: ${m.calc.tr} A</p>
        <p>–ö–∞–±–µ–ª—å: ${esc(m.S)} –º–º¬≤ ¬∑ L=${esc(m.L)} –º</p>
        <p>ŒîU —Ä–æ–±: ${m.calc.dropRun}% ¬∑ –ø—É—Å–∫: ${m.calc.dropStart}% ¬∑ ${m.calc.status}</p>
        <div class="line"></div>
        <p class="qr"><small>URL/NFC: ${esc(urlText)}</small></p>
        <p><small>${nowStamp()}</small></p>
      `;
      ticketsBox.appendChild(el);
    });
  }
  function downloadTXT(){
    if(!ticketsBox.firstChild){ alert('–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –Ω–∞–∫–ª–µ–π–∫–∏'); return; }
    const lines=['MOTOR LINE LABELS 58mm','-------------------'];
    Array.from(ticketsBox.children).forEach(t=>{ lines.push(t.innerText.replace(/\n{2,}/g,'\n')); lines.push('-------------------'); });
    const blob = new Blob([lines.join('\n')], {type:'text/plain;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='motor_line_58mm.txt'; a.click(); URL.revokeObjectURL(a.href);
  }

  // ======= A4-–ó–í–Ü–¢ =======
  function buildReport(){
    if(!motors.length){ alert('–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤'); return; }
    const rows = motors.map((m,i)=>{
      if(!m.calc) calcObj(m);
      return `
        <tr>
          <td>${i+1}</td><td>${esc(m.id)}</td><td>${esc(m.name)}</td><td>${m.kW}</td>
          <td>${m.calc.In}</td><td>${m.calc.Istart}</td><td>${esc(m.method)}</td>
          <td>${esc(m.curve)}${m.calc.mcb}</td><td>${m.calc.tr}</td>
          <td>${m.S}</td><td>${m.L}</td><td>${m.calc.dropRun}%</td><td>${m.calc.dropStart}%</td><td>${m.calc.status}</td>
        </tr>`;
    }).join('');
    const html = `
      <section class="doc">
        <h2>–†–û–ó–†–ê–•–£–ù–û–ö –ü–£–°–ö–û–í–ò–• –°–¢–†–£–ú–Ü–í –¢–ê –ó–ê–•–ò–°–¢–Ü–í –î–í–ò–ì–£–ù–Ü–í</h2>
        <p>–î–∞—Ç–∞: ${nowStamp()}</p>
        <table>
          <thead>
            <tr><th>#</th><th>ID</th><th>–ù–∞–∑–≤–∞</th><th>–∫–í—Ç</th><th>In, –ê</th><th>I–ø—É—Å–∫, –ê</th><th>–ú–µ—Ç–æ–¥</th><th>MCB/MPCB</th><th>–¢–†, –ê</th><th>–ö–∞–±–µ–ª—å, –º–º¬≤</th><th>L, –º</th><th>ŒîU —Ä–æ–±, %</th><th>ŒîU –ø—É—Å–∫, %</th><th>–°—Ç–∞—Ç—É—Å</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <h3>–í–∏—Å–Ω–æ–≤–æ–∫</h3>
        <p>PASS: ${motors.filter(m=>m.calc?.status==='PASS').length}; WARN: ${motors.filter(m=>m.calc?.status==='WARN').length}; FAIL: ${motors.filter(m=>m.calc?.status==='FAIL').length}.</p>
        <div class="sign">
          <div>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å: ____________________</div>
          <div>–ü–µ—Ä–µ–≤—ñ—Ä–∏–≤: ____________________</div>
        </div>
        <p class="small">–ü—Ä–∏–º—ñ—Ç–∫–∞: —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –Ω–∞–≤—á–∞–ª—å–Ω—ñ; —É —Ä–µ–∞–ª—å–Ω–∏—Ö –ø—Ä–æ—î–∫—Ç–∞—Ö –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ø—É—Å–∫–æ–≤–∏–π –º–æ–º–µ–Ω—Ç, –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∑–∞–ø—É—Å–∫—É, —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø—É—Å–∫—É, –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –∫–æ—Ä–µ–∫—Ü—ñ—ó –∫–∞–±–µ–ª—é, —É–º–æ–≤–∏ –ü–£–ï/–î–°–¢–£/–≤–∏—Ä–æ–±–Ω–∏–∫–∞.</p>
      </section>`;
    document.getElementById('printArea').innerHTML = html;
    document.getElementById('printArea').scrollIntoView({behavior:'smooth'});
  }

  // ======= CSV =======
  function exportCSV(){
    const headers = ['id','name','kW','U_LL','PF','eta','method','k','cable_mm2','length_m','starter','curve','stdA','run_drop_limit','start_drop_limit','In_A','Istart_A','mcb_A','thermal_A','drop_run_pct','drop_start_pct','status','url','timestamp'];
    const stamp = nowStamp();
    const csv = [headers.join(','), ...motors.map(m=>{
      if(!m.calc) calcObj(m);
      const vals = [m.id,m.name,m.kW,m.U,m.PF,m.eta,m.method,m.k,m.S,m.L,m.starter,m.curve,m.stdA,m.runLimit,m.startLimit,m.calc.In,m.calc.Istart,m.calc.mcb,m.calc.tr,m.calc.dropRun,m.calc.dropStart,m.calc.status,m.url||'',stamp];
      return vals.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',');
    })].join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='motor_startup_registry.csv'; a.click(); URL.revokeObjectURL(a.href);
  }

  async function importCSV(){
    const f=document.getElementById('file').files[0]; if(!f){ alert('–û–±–µ—Ä—ñ—Ç—å CSV'); return; }
    const txt=await f.text();
    const lines = txt.trim().split(/\r?\n/); if(lines.length<2){ alert('CSV –ø–æ—Ä–æ–∂–Ω—ñ–π'); return; }
    const headers = lines[0].split(',').map(h=>h.replace(/^"|"$/g,'').trim());
    const req = ['id','name','kW','U_LL','PF','eta','method','k','cable_mm2','length_m','starter','curve','stdA','run_drop_limit','start_drop_limit','url'];
    const miss = req.filter(x=>!headers.includes(x)); if(miss.length){ alert('–í—ñ–¥—Å—É—Ç–Ω—ñ –ø–æ–ª—è: '+miss.join(', ')); return; }
    const out=[];
    for(let i=1;i<lines.length;i++){
      const cells = splitCSV(lines[i]); if(!cells.length) continue;
      const o={}; headers.forEach((h,j)=> o[h]=(cells[j]||'').replace(/^"|"$/g,''));
      out.push({
        id:o.id,name:o.name,kW:parseFloat(o.kW||'0'),U:parseFloat(o.U_LL||'400'),PF:parseFloat(o.PF||'0.85'),eta:parseFloat(o.eta||'0.88'),
        method:o.method||'DOL',k:parseFloat(o.k||'6'),S:parseFloat(o.cable_mm2||'4'),L:parseFloat(o.length_m||'20'),
        starter:o.starter||'',curve:o.curve||'C',stdA:parseInt(o.stdA||'16',10),
        runLimit:parseFloat(o.run_drop_limit||'5'),startLimit:parseFloat(o.start_drop_limit||'10'),
        url:o.url||''
      });
    }
    motors = out.map(calcObj); render();
  }
  function splitCSV(line){
    const res=[]; let cur=''; let q=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else q=!q; }
      else if(ch===',' && !q){ res.push(cur); cur=''; }
      else { cur+=ch; }
    }
    res.push(cur); return res;
  }

  // ======= –ü–†–ò–ö–õ–ê–î =======
  function seedOne(){
    document.getElementById('mId').value='M-001';
    document.getElementById('mName').value='–ù–∞—Å–æ—Å 3 –∫–í—Ç';
    document.getElementById('kW').value=3.0;
    document.getElementById('U').value=400;
    document.getElementById('pf').value=0.85;
    document.getElementById('eta').value=0.88;
    document.getElementById('method').value='DOL';
    document.getElementById('k').value=7.0;
    document.getElementById('starter').value='–ö–æ–Ω—Ç–∞–∫—Ç–æ—Ä + –¢–†';
    document.getElementById('curve').value='D';
    document.getElementById('stdA').value=16;
    document.getElementById('S').value=4;
    document.getElementById('L').value=28;
    document.getElementById('runLimit').value=5;
    document.getElementById('startLimit').value=10;
  }

  function seedDemo(){
    // 2 –ø—Ä–∏–∫–ª–∞–¥–∏ —Ä—ñ–∑–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤
    motors = [
      {id:'M-001',name:'–ù–∞—Å–æ—Å 3 –∫–í—Ç',kW:3.0,U:400,PF:0.85,eta:0.88,method:'DOL',k:7,starter:'–ö–æ–Ω—Ç–∞–∫—Ç–æ—Ä + –¢–†',curve:'D',stdA:16,S:4,L:28,runLimit:5,startLimit:10,url:''},
      {id:'M-015',name:'–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä 5.5 –∫–í—Ç',kW:5.5,U:400,PF:0.87,eta:0.9,method:'YŒî',k:2.5,starter:'Y/Œî –ø—É—Å–∫–∞—á',curve:'C',stdA:25,S:6,L:45,runLimit:5,startLimit:10,url:''}
    ].map(calcObj);
    render(); buildTickets(motors);
  }

  // –ê–≤—Ç–æ-–¥–µ–º–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
  seedDemo();
</script>


</body></html>