<!-- electric_para6.html
     –ü–∞—Ä–∞ 6 (–ï–ª–µ–∫—Ç—Ä–∏–∫–∏, –∞—É–¥–∏—Ç–æ—Ä–Ω–æ): –°–ï–õ–ï–ö–¢–ò–í–ù–Ü–°–¢–¨ –ó–ê–•–ò–°–¢–Ü–í
     –¢–µ–º–∞: MCB (B/C/D) —Ç–∞ –ü–ó–í (RCD) ‚Äî –ø—ñ–¥–±—ñ—Ä, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ, —Ç–µ—Å—Ç–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó, –¥—Ä—É–∫ 58 –º–º, –µ–∫—Å–ø–æ—Ä—Ç CSV.
     –ü–æ–≤–Ω—ñ—Å—Ç—é –∞–≤—Ç–æ–Ω–æ–º–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è GitHub Pages —ñ –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è –≤ Moodle —á–µ—Ä–µ–∑ <iframe>.
-->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 6 ‚Äî –°–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å MCB/–ü–ó–í, —Ç–µ—Å—Ç, –¥—Ä—É–∫ 58 –º–º</title>
<meta name="color-scheme" content="light dark"/>
<style>
  :root{
    --bg:#0b1220; --bg2:#111827; --card:#0f172a; --text:#e2e8f0; --muted:#9aa5b1; --line:#1f2937;
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --info:#60a5fa;
  }
  *{box-sizing:border-box}
  body{margin:0; background:linear-gradient(180deg,var(--bg),var(--bg2) 30%,var(--bg)); color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; line-height:1.55}
  .wrap{max-width:1024px; margin:0 auto; padding:24px 16px 64px}
  .badge{display:inline-block; padding:6px 10px; border:1px solid var(--line); background:#0b1220; border-radius:999px; font-size:12px; color:var(--muted)}
  h1{font-size:32px; margin:6px 0 12px; line-height:1.15; background:linear-gradient(90deg,#60a5fa,#22c55e); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
  h2{font-size:22px; margin:22px 0 12px}
  h3{font-size:18px; margin:12px 0 8px; color:#cbd5e1}
  p{margin:8px 0}
  .card{background:linear-gradient(180deg,#0f172a,#0b1220); border:1px solid var(--line); border-radius:16px; padding:16px; margin:12px 0; box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid var(--line); background:#0d1a2e; color:#dbeafe; text-decoration:none; cursor:pointer}
  .btn:hover{background:#0f1f39}
  .small{font-size:12px; color:#93a3b5}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}

  /* –§–æ—Ä–º–∏ */
  .grid{display:grid; gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  @media (max-width:900px){.g2{grid-template-columns:1fr}}
  .field{display:flex; gap:8px; margin:6px 0}
  .field label{min-width:180px; color:#cbd5e1}
  .field input,.field select{flex:1; padding:8px 10px; border-radius:10px; border:1px solid #223049; background:#0d1a2e; color:#e5e7eb}

  /* –¢–∞–±–ª–∏—Ü—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ */
  table{width:100%; border-collapse:separate; border-spacing:0; border:1px solid #223049; border-radius:12px; overflow:hidden}
  thead th{background:#0c1629; color:#a5b4fc; text-align:left; padding:10px 12px; font-size:14px}
  tbody td{padding:8px 10px; border-top:1px solid #1f2937; font-size:14px; vertical-align:top}
  tbody tr:nth-child(even){background:#0b1324}

  /* –ö–≤–∏—Ç–∞–Ω—Ü—ñ—è 58 –º–º */
  .ticket{width:58mm; background:#fff; color:#000; padding:6mm 4mm; border-radius:6px; box-shadow:0 0 0 1px #e5e7eb inset; font-family:"Courier New",ui-monospace,monospace}
  .ticket h4{margin:0 0 6px; font-size:13px; text-align:center}
  .ticket p{margin:2px 0; font-size:12px}
  .ticket .center{text-align:center}
  .ticket .line{border-top:1px dashed #111; margin:6px 0}
  .ticket small{font-size:10px}
  .ticket .qr{font-size:10px; word-break:break-all}

  /* –í–±—É–¥–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º (iframe/Moodle) */
  html.embedded body{background:#fff; color:#111}
  html.embedded .card{background:#fff; border:1px solid #e5e7eb; box-shadow:none}
  html.embedded h1{-webkit-text-fill-color:initial; background:none; color:#111}

  @media print{
    @page{ size:58mm auto; margin:4mm }
    body{ background:#fff; color:#000 }
    .no-print, .card:not(.printable){ display:none !important }
    .ticket{ box-shadow:none; width:auto; padding:0 }
  }
</style>
</head>
<body>
  <div class="wrap">
    <span class="badge">–ï–ª–µ–∫—Ç—Ä–∏–∫–∏ ¬∑ –ü–∞—Ä–∞ 6 ¬∑ –∞—É–¥–∏—Ç–æ—Ä–Ω–æ</span>
    <h1>üõ°Ô∏è –°–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–∞—Ö–∏—Å—Ç—ñ–≤: MCB (B/C/D) —Ç–∞ –ü–ó–í (RCD) ¬∑ —Ç–µ—Å—Ç–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó ¬∑ üßæ –¥—Ä—É–∫ 58 –º–º</h1>

    <div class="card">
      <h2>üéØ –ú–µ—Ç–∞</h2>
      <p>–ù–∞–≤—á–∏—Ç–∏—Å—è –ø—ñ–¥–±–∏—Ä–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ –ø–∞—Ä–∏ ¬´–≤–≤—ñ–¥–Ω–∏–π ‚Üí –≤—ñ–¥—Ö—ñ–¥–Ω–∏–π¬ª –¥–ª—è <b>–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏—Ö –≤–∏–º–∏–∫–∞—á—ñ–≤</b> (B/C/D) —Ç–∞ <b>–ü–ó–í</b>, –æ—Ü—ñ–Ω—é–≤–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —É <b>—Ç–µ–ø–ª–æ–≤—ñ–π</b> —ñ <b>–º–∏—Ç—Ç—î–≤—ñ–π</b> –∑–æ–Ω–∞—Ö, –∞ —Ç–∞–∫–æ–∂ –¥–ª—è <b>–ü–ó–í –∑ —á–∞—Å–æ–≤–æ—é –∑–∞—Ç—Ä–∏–º–∫–æ—é (—Ç–∏–ø S)</b>. –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ ¬´–∫–∞—Ä—Ç—É —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ¬ª (58 –º–º) —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç CSV.</p>
      <p class="small">–û—Å–≤—ñ—Ç–Ω—è —Å–ø—Ä–æ—â–µ–Ω–∞ –º–æ–¥–µ–ª—å: –ø–æ—Ä—ñ–≤–Ω—é—î–º–æ –∫—Ä–∞—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ –æ—Ü—ñ–Ω–æ—á–Ω—ñ —á–∞—Å–∏ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è, —Ü—å–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–∫—Ç–∏–∫—É–º—É.</p>
    </div>

    <div class="card">
      <h2>‚öôÔ∏è –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ: –≤–µ—Ä—Ö–Ω—ñ–π (UP) —Ç–∞ –Ω–∏–∂–Ω—ñ–π (DN) –∑–∞—Ö–∏—Å—Ç</h2>
      <div class="grid g2">
        <div>
          <h3>üîº –í–≤—ñ–¥–Ω–∏–π –∑–∞—Ö–∏—Å—Ç (UPSTREAM)</h3>
          <div class="field"><label for="upType">–¢–∏–ø</label>
            <select id="upType">
              <option value="MCB" selected>MCB (–∞–≤—Ç–æ–º–∞—Ç)</option>
              <option value="RCD">–ü–ó–í (RCD)</option>
            </select></div>
          <div id="upMCB">
            <div class="field"><label for="upIn">In, –ê</label><input id="upIn" type="number" value="40"/></div>
            <div class="field"><label for="upCurve">–ö—Ä–∏–≤–∞</label>
              <select id="upCurve"><option>B</option><option selected>C</option><option>D</option></select></div>
          </div>
          <div id="upRCD" style="display:none">
            <div class="field"><label for="upIdn">IŒîn, –º–ê</label><input id="upIdn" type="number" value="100"/></div>
            <div class="field"><label for="upDelay">–ó–∞—Ç—Ä–∏–º–∫–∞</label>
              <select id="upDelay"><option value="0">–º–∏—Ç—Ç—î–≤–∞</option><option value="S" selected>—Ç–∏–ø S (–∑–∞—Ç—Ä–∏–º–∫–∞)</option></select></div>
          </div>
        </div>

        <div>
          <h3>üîΩ –í—ñ–¥—Ö—ñ–¥–Ω–∏–π –∑–∞—Ö–∏—Å—Ç (DOWNSTREAM)</h3>
          <div class="field"><label for="dnType">–¢–∏–ø</label>
            <select id="dnType">
              <option value="MCB" selected>MCB (–∞–≤—Ç–æ–º–∞—Ç)</option>
              <option value="RCD">–ü–ó–í (RCD)</option>
            </select></div>
          <div id="dnMCB">
            <div class="field"><label for="dnIn">In, –ê</label><input id="dnIn" type="number" value="16"/></div>
            <div class="field"><label for="dnCurve">–ö—Ä–∏–≤–∞</label>
              <select id="dnCurve"><option selected>B</option><option>C</option><option>D</option></select></div>
          </div>
          <div id="dnRCD" style="display:none">
            <div class="field"><label for="dnIdn">IŒîn, –º–ê</label><input id="dnIdn" type="number" value="30"/></div>
            <div class="field"><label for="dnDelay">–ó–∞—Ç—Ä–∏–º–∫–∞</label>
              <select id="dnDelay"><option value="0" selected>–º–∏—Ç—Ç—î–≤–∞</option><option value="S">—Ç–∏–ø S (–∑–∞—Ç—Ä–∏–º–∫–∞)</option></select></div>
          </div>
        </div>
      </div>

      <div class="grid g2" style="margin-top:8px">
        <div class="field"><label for="Ik">–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Å—Ç—Ä—É–º –∫.–∑. —É —Ç–æ—á—Ü—ñ DN, A</label><input id="Ik" type="number" value="2000"/></div>
        <div class="field"><label for="resp">–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π</label><input id="resp" type="text" value="–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞"/></div>
      </div>

      <div class="row" style="margin-top:6px">
        <button class="btn" type="button" onclick="demo()">üîÑ –ü—Ä–∏–∫–ª–∞–¥</button>
        <button class="btn" type="button" onclick="check()">üß© –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</button>
        <button class="btn" type="button" onclick="exportCSV()">üì§ –ï–∫—Å–ø–æ—Ä—Ç CSV</button>
      </div>
      <p class="small">–ö—Ä–∏–≤—ñ MCB: <span class="mono">B: 3‚Äì5¬∑In</span>, <span class="mono">C: 5‚Äì10¬∑In</span>, <span class="mono">D: 10‚Äì20¬∑In</span> (–∑–æ–Ω–∞ –º–∏—Ç—Ç—î–≤–æ–≥–æ –≤—ñ–¥—Å—ñ–∫–∞–Ω–Ω—è; –Ω–∞–≤—á–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞).</p>
    </div>

    <div class="card">
      <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</h2>
      <div id="result" class="small">–ù–∞—Ç–∏—Å–Ω–∏ ¬´–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å¬ª</div>
      <table id="scenarios" style="margin-top:10px">
        <thead>
          <tr>
            <th>#</th><th>–°—Ü–µ–Ω–∞—Ä—ñ–π</th><th>–û–ø–∏—Å</th><th>–í–µ—Ä–¥–∏–∫—Ç</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p id="verdict" style="margin-top:10px"></p>
    </div>

    <div class="card printable">
      <h2>üßæ –ö–≤–∏—Ç–∞–Ω—Ü—ñ—è 58 –º–º ‚Äî –ö–∞—Ä—Ç–∞ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</h2>
      <div class="grid g2">
        <div>
          <div id="ticket" class="ticket" aria-live="polite">
            <h4>–ö–ê–†–¢–ê –°–ï–õ–ï–ö–¢–ò–í–ù–û–°–¢–Ü</h4>
            <p class="center"><small id="t-date">–î–∞—Ç–∞: ‚Äî</small></p>
            <div class="line"></div>
            <p><b id="t-pair">UP ‚Üí DN: ‚Äî</b></p>
            <p>Ik(DN): <span id="t-ik">‚Äî</span> A</p>
            <p>–ó–æ–Ω–∏: <span id="t-zones">‚Äî</span></p>
            <p>–í–µ—Ä–¥–∏–∫—Ç: <span id="t-status">‚Äî</span></p>
            <div class="line"></div>
            <p class="center"><small>–í—ñ–¥–ø.: <span id="t-resp">‚Äî</span></small></p>
            <p class="qr"><small id="t-ref">Ref: SEL-0001</small></p>
          </div>
          <div class="row no-print" style="margin-top:8px">
            <button class="btn" type="button" onclick="buildTicket()">üß© –ó—ñ–±—Ä–∞—Ç–∏</button>
            <button class="btn" type="button" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫ 58 –º–º</button>
            <button class="btn" type="button" onclick="downloadTXT()">üì• TXT</button>
          </div>
        </div>
        <div>
          <p class="small">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: –ø—Ä–∏–∫—Ä—ñ–ø–∏ ¬´–∫–∞—Ä—Ç—É —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ¬ª –¥–æ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ —â–∏—Ç–∞ –∞–±–æ –Ω–∞ –æ–±–∫–ª–∞–¥–∏–Ω–∫—É –∂—É—Ä–Ω–∞–ª—É –ü–ü–†.</p>
        </div>
      </div>
    </div>
  </div>

<script>
  // –í–±—É–¥–æ–≤–∞–Ω–æ —É Moodle ‚Üí —Å—Ç—Ä–∏–º–∞–Ω–∞ —Ç–µ–º–∞
  (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();

  // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –º–∏—Ç—Ç—î–≤–æ–≥–æ –≤—ñ–¥—Å—ñ–∫–∞–Ω–Ω—è –¥–ª—è –∫—Ä–∏–≤–∏—Ö (–Ω–∏–∂–Ω—è –º–µ–∂–∞)
  const instLow = { B:3, C:5, D:10 };
  const instHigh= { B:5, C:10, D:20 };

  // –û—Ü—ñ–Ω–æ—á–Ω—ñ —Ç–µ–ø–ª–æ–≤—ñ —á–∞—Å–∏ (–Ω–∞–≤—á–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å): t ‚âà 2s * (1.45/M)^2, –¥–ª—è M<instLow; –º–µ–∂—ñ 0.1..5 c
  function thermalTime(M){
    let t = 2 * Math.pow(1.45/Math.max(M,0.1), 2);
    if (t < 0.1) t = 0.1;
    if (t > 5) t = 5;
    return t;
  }

  function fmt(x){ return (typeof x==='number' ? (Math.round(x*100)/100) : x); }

  function readInputs(){
    const upType = document.getElementById('upType').value;
    const dnType = document.getElementById('dnType').value;
    const Ik = parseFloat(document.getElementById('Ik').value);
    const resp = document.getElementById('resp').value.trim();

    const up = { type: upType };
    const dn = { type: dnType };

    if(upType==='MCB'){
      up.In = parseFloat(document.getElementById('upIn').value);
      up.curve = document.getElementById('upCurve').value;
    } else {
      up.Idn = parseFloat(document.getElementById('upIdn').value);
      up.delay = document.getElementById('upDelay').value; // '0' –∞–±–æ 'S'
    }
    if(dnType==='MCB'){
      dn.In = parseFloat(document.getElementById('dnIn').value);
      dn.curve = document.getElementById('dnCurve').value;
    } else {
      dn.Idn = parseFloat(document.getElementById('dnIdn').value);
      dn.delay = document.getElementById('dnDelay').value;
    }
    return { up, dn, Ik, resp };
  }

  // –õ–æ–≥—ñ–∫–∞ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (—Å–ø—Ä–æ—â–µ–Ω–∞ –Ω–∞–≤—á–∞–ª—å–Ω–∞)
  function evaluate(up, dn, Ik){
    const scenarios = [];
    let overall = 'MARGINAL';
    let color = 'warn';
    let zonesText = '‚Äî';

    if(up.type==='MCB' && dn.type==='MCB'){
      const Mup = Ik / up.In;
      const Mdn = Ik / dn.In;
      const Lup = instLow[up.curve], Ldn = instLow[dn.curve];

      const upInst = Mup >= Lup;
      const dnInst = Mdn >= Ldn;

      if(dnInst && !upInst){
        scenarios.push(['MCB-–º–∞–≥–Ω—ñ—Ç–Ω–∞', 'DN —É –º–∏—Ç—Ç—î–≤—ñ–π –∑–æ–Ω—ñ, UP ‚Äî —â–µ –Ω—ñ', 'PASS']);
        overall = 'PASS'; color='ok';
      } else if(dnInst && upInst){
        scenarios.push(['MCB-–º–∞–≥–Ω—ñ—Ç–Ω–∞', '–û–±–∏–¥–≤–∞ —É –º–∏—Ç—Ç—î–≤—ñ–π –∑–æ–Ω—ñ ‚Üí –º–æ–∂–ª–∏–≤–µ –≤–∏–±–∏–≤–∞–Ω–Ω—è UP', 'FAIL']);
        overall = (overall==='PASS')?'MARGINAL':'FAIL'; color = (overall==='FAIL')?'bad':color;
      } else {
        const t_up = thermalTime(Mup);
        const t_dn = thermalTime(Mdn);
        const ratio = t_up / t_dn;
        const verdict = (ratio>=3) ? 'PASS' : (ratio>=1.5 ? 'MARGINAL' : 'FAIL');
        scenarios.push(['MCB-—Ç–µ–ø–ª–æ–≤–∞', `tUP/tDN = ${fmt(ratio)} (${fmt(t_up)}s / ${fmt(t_dn)}s)`, verdict]);
        if(verdict==='PASS'){ if(overall!=='FAIL'){ overall='PASS'; color='ok'; } }
        else if(verdict==='MARGINAL'){ if(overall!=='FAIL'){ overall='MARGINAL'; color='warn'; } }
        else { overall='FAIL'; color='bad'; }
      }
      zonesText = `MCB: Mdn=${fmt(Mdn)} (${dn.curve}), Mup=${fmt(Mup)} (${up.curve})`;
    }
    else if(up.type==='RCD' && dn.type==='RCD'){
      // –ü—Ä–∞–≤–∏–ª–æ: —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–∞ –ü–ó–í ‚Äî –∫–æ–ª–∏ UP –º–∞—î –±—ñ–ª—å—à—É —á—É—Ç–ª–∏–≤—ñ—Å—Ç—å —Ç–∞ —á–∞—Å–æ–≤—É –∑–∞—Ç—Ä–∏–º–∫—É
      const sensOK = up.Idn >= 3*dn.Idn;  // –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –∫—Ä–∏—Ç–µ—Ä—ñ–π
      const delayOK = (up.delay==='S') && (dn.delay!=='S');
      const v = (sensOK && delayOK) ? 'PASS' : ( (up.Idn>dn.Idn || up.delay==='S') ? 'MARGINAL' : 'FAIL' );
      scenarios.push(['RCD-—Å–µ–Ω—Å/–∑–∞—Ç—Ä–∏–º–∫–∞', `UP ${up.Idn}–º–ê ${up.delay==='S'?'S-Delay':'Inst'}; DN ${dn.Idn}–º–ê ${dn.delay==='S'?'S-Delay':'Inst'}`, v]);
      if(v==='PASS'){ overall='PASS'; color='ok'; } else if(v==='MARGINAL'){ overall='MARGINAL'; color='warn'; } else { overall='FAIL'; color='bad'; }
      zonesText = `RCD: ŒînUP=${up.Idn}–º–ê, ŒînDN=${dn.Idn}–º–ê`;
    }
    else {
      // –†—ñ–∑–Ω–æ—Ä—ñ–¥–Ω—ñ –∑–∞—Ö–∏—Å—Ç–∏ (MCB vs RCD) ‚Äî —Ä—ñ–∑–Ω—ñ —Ñ—ñ–∑–∏—á–Ω—ñ –≤–µ–ª–∏—á–∏–Ω–∏
      scenarios.push(['–ó–º—ñ—à–∞–Ω–æ (MCB/RCD)', '–ó–∞—Ö–∏—Å—Ç–∏ –¥—ñ—é—Ç—å –ø–æ —Ä—ñ–∑–Ω–∏–º –∫–∞–Ω–∞–ª–∞–º (—Å—Ç—Ä—É–º –∫.–∑. vs —Å—Ç—Ä—É–º –≤–∏—Ç–æ–∫—É). –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—é –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ.', 'INFO']);
      overall = 'PASS'; color='ok';
      zonesText = 'MCB/RCD ‚Äî –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ –∫–∞–Ω–∞–ª–∏';
    }

    // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
    const tips = [];
    if(up.type==='MCB' && dn.type==='MCB'){
      if(overall!=='PASS'){
        tips.push('‚Üí –ó–º–µ–Ω—à–∏—Ç–∏ –º–∏—Ç—Ç—î–≤—É —á—É—Ç–ª–∏–≤—ñ—Å—Ç—å UP: –ø–µ—Ä–µ–π—Ç–∏ –∑ C –Ω–∞ D –ê–ë–û –∑–±—ñ–ª—å—à–∏—Ç–∏ In UP (–∑–∞ —É–º–æ–≤–æ—é –∫–∞–±–µ–ª—é).');
        tips.push('‚Üí –ó–º–µ–Ω—à–∏—Ç–∏ In DN –∞–±–æ –æ–±—Ä–∞—Ç–∏ –∫—Ä—É—Ç—ñ—à—É –∫—Ä–∏–≤—É (B‚ÜíC) –ª–∏—à–µ —è–∫—â–æ –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.');
        tips.push('‚Üí –ó–º–µ–Ω—à–∏—Ç–∏ Ik –≤ —Ç–æ—á—Ü—ñ DN (–¥–æ–≤–∂–∏–Ω–∞/—ñ–º–ø–µ–¥–∞–Ω—Å –ª—ñ–Ω—ñ—ó, –¥—Ä–æ—Å–µ–ª—ñ).');
      } else {
        tips.push('‚úî DN –º–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∑–∞ UP. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç–µ–Ω–¥—É.');
      }
    }
    if(up.type==='RCD' && dn.type==='RCD'){
      if(overall!=='PASS'){
        tips.push('‚Üí –û–±—Ä–∞—Ç–∏ UP —Ç–∏–ø—É S (—á–∞—Å–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞) —Ç–∞ IŒîn —â–æ–Ω–∞–π–º–µ–Ω—à–µ —É 3 —Ä–∞–∑–∏ –±—ñ–ª—å—à–µ –∑–∞ DN.');
      } else {
        tips.push('‚úî –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —á–∞—Å–æ–≤—É —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å RCD: UP(S) > DN(instant).');
      }
    }

    return { scenarios, overall, color, zonesText, tips };
  }

  function check(){
    const {up,dn,Ik,resp} = readInputs();
    const r = evaluate(up,dn,Ik);

    // –¢–∞–±–ª–∏—Ü—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤
    const tb = document.querySelector('#scenarios tbody');
    tb.innerHTML = '';
    r.scenarios.forEach((s,i)=>{
      const tr = document.createElement('tr');
      let cls = (s[2]==='PASS'?'ok':(s[2]==='FAIL'?'bad':'warn'));
      tr.innerHTML = `<td>${i+1}</td><td>${s[0]}</td><td>${s[1]}</td><td class="${cls}"><b>${s[2]}</b></td>`;
      tb.appendChild(tr);
    });

    // –ó–∞–≥–∞–ª—å–Ω–∏–π –≤–µ—Ä–¥–∏–∫—Ç
    const res = document.getElementById('verdict');
    res.className=''; res.classList.add(r.color);
    res.innerHTML = (r.overall==='PASS'
      ? '‚úÖ –°–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–æ—Å—è–≥–Ω—É—Ç–∞ (–∑–∞ –Ω–∞–≤—á–∞–ª—å–Ω–æ—é –º–æ–¥–µ–ª–ª—é).'
      : (r.overall==='FAIL' ? '‚ùå –°–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–µ –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–∞.' : '‚ö†Ô∏è –°—É–º–Ω—ñ–≤–Ω–∞ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è.')
    ) + (r.tips.length?('<br><span class="small">'+r.tips.join('<br>')+'</span>'):'');
    document.getElementById('result').textContent = '–ì–æ—Ç–æ–≤–æ. –ü–µ—Ä–µ–≥–ª—è–Ω—å —Å—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏—â–µ.';

    // –û–Ω–æ–≤–∏—Ç–∏ –∫–≤–∏—Ç–∞–Ω—Ü—ñ—é
    lastTicket = {
      up, dn, Ik, resp,
      zones: r.zonesText,
      status: r.overall
    };
    buildTicket();
  }

  function demo(){
    document.getElementById('upType').value='MCB';
    document.getElementById('dnType').value='MCB';
    toggleType('up'); toggleType('dn');
    document.getElementById('upIn').value=40;
    document.getElementById('upCurve').value='C';
    document.getElementById('dnIn').value=16;
    document.getElementById('dnCurve').value='B';
    document.getElementById('Ik').value=2000;
    document.getElementById('resp').value='–°—Ç—É–¥–µ–Ω—Ç –ü–Ü–ë / –≥—Ä—É–ø–∞';
    check();
  }

  function toggleType(which){
    const type = document.getElementById(which+'Type').value;
    document.getElementById(which+'MCB').style.display = (type==='MCB')?'':'none';
    document.getElementById(which+'RCD').style.display = (type==='RCD')?'':'none';
  }
  document.getElementById('upType').addEventListener('change', ()=>toggleType('up'));
  document.getElementById('dnType').addEventListener('change', ()=>toggleType('dn'));
  toggleType('up'); toggleType('dn');

  // –ö–≤–∏—Ç–∞–Ω—Ü—ñ—è 58 –º–º
  let lastTicket = null;
  function buildTicket(){
    const now = new Date(); const pad=n=>n.toString().padStart(2,'0');
    const stamp = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
    document.getElementById('t-date').textContent = `–î–∞—Ç–∞: ${stamp}`;

    const resp = document.getElementById('resp').value.trim() || '‚Äî';
    document.getElementById('t-resp').textContent = resp;

    if(!lastTicket){
      document.getElementById('t-pair').textContent = 'UP ‚Üí DN: ‚Äî';
      document.getElementById('t-ik').textContent = '‚Äî';
      document.getElementById('t-zones').textContent = '‚Äî';
      document.getElementById('t-status').textContent = '‚Äî';
      document.getElementById('t-ref').textContent = 'Ref: SEL-XXXX';
      return;
    }
    const {up,dn,Ik,zones,status} = lastTicket;
    const upTxt = (up.type==='MCB') ? `MCB ${up.curve}${up.In}` : `RCD ${up.Idn}–º–ê ${up.delay==='S'?'S':''}`;
    const dnTxt = (dn.type==='MCB') ? `MCB ${dn.curve}${dn.In}` : `RCD ${dn.Idn}–º–ê ${dn.delay==='S'?'S':''}`;
    document.getElementById('t-pair').textContent = `UP(${upTxt}) ‚Üí DN(${dnTxt})`;
    document.getElementById('t-ik').textContent = Ik;
    document.getElementById('t-zones').textContent = zones;
    document.getElementById('t-status').textContent = status;
    const ref = 'SEL-' + Math.random().toString(36).slice(2,8).toUpperCase();
    document.getElementById('t-ref').textContent = `Ref: ${ref}`;
  }

  function downloadTXT(){
    const lines = [];
    lines.push('SELECTIVITY CARD 58mm');
    lines.push('----------------------');
    lines.push(document.getElementById('t-date').textContent);
    lines.push(document.getElementById('t-pair').textContent);
    lines.push(`Ik(DN): ${document.getElementById('t-ik').textContent} A`);
    lines.push(`–ó–æ–Ω–∏: ${document.getElementById('t-zones').textContent}`);
    lines.push(`–í–µ—Ä–¥–∏–∫—Ç: ${document.getElementById('t-status').textContent}`);
    lines.push(`–í—ñ–¥–ø.: ${document.getElementById('t-resp').textContent}`);
    lines.push(document.getElementById('t-ref').textContent);
    const blob = new Blob([lines.join('\n')], {type:'text/plain;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'selectivity_card_58mm.txt';
    a.click(); URL.revokeObjectURL(a.href);
  }

  // –ï–∫—Å–ø–æ—Ä—Ç CSV
  function exportCSV(){
    const {up,dn,Ik,resp} = readInputs();
    const r = evaluate(up,dn,Ik);
    const headers = ['up_type','up_In','up_curve','up_Idn_mA','up_delay','dn_type','dn_In','dn_curve','dn_Idn_mA','dn_delay','Ik_A','overall','zones','tips','responsible'];
    const tipText = r.tips.join(' | ');
    const vals = [
      up.type, up.In||'', up.curve||'', up.Idn||'', up.delay||'',
      dn.type, dn.In||'', dn.curve||'', dn.Idn||'', dn.delay||'',
      Ik, r.overall, r.zonesText, tipText, resp
    ].map(v=>`"${String(v).replace(/"/g,'""')}"`);
    const csv = headers.join(',')+'\n'+vals.join(',');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'selectivity_check.csv';
    a.click(); URL.revokeObjectURL(a.href);
  }
</script>
</body>
</html>
