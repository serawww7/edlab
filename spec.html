<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EDLab ‚Äî —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Ä–æ–∑–¥—ñ–ª—É</title>
<meta name="color-scheme" content="light dark"/>
<link rel="preload" href="assets/edlab.css" as="style">
<link rel="stylesheet" href="assets/edlab.css"/>
<style>
.header-mini{display:flex;justify-content:space-between;align-items:center;gap:12px}
.grid2{display:grid;gap:16px;grid-template-columns:2fr 1fr}
@media(max-width:980px){.grid2{grid-template-columns:1fr}}
.lesson-list .lesson{position:relative;display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:start}
.lesson-list .btn{position:relative;z-index:2}
.tester-toolbar{display:flex;justify-content:space-between;gap:8px;align-items:center;background:#0d1a2e;color:#e6eef9;border:1px solid #223049;border-bottom:0;border-radius:12px 12px 0 0;padding:8px 12px}
.tester{border:1px solid #223049;border-radius:0 0 12px 12px;overflow:hidden;background:#0b1220}
.tester iframe{width:100%;height:900px;border:0;background:#fff;display:block}
.btn.ghost{background:transparent;border-color:#334155;color:#cbd5e1}
.btn.ghost:hover{background:#0f1f39}
small.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Courier New", monospace}
.note{background:#0c182a;color:#cde1ff;border:1px dashed #274364;padding:10px 12px;border-radius:12px;margin-top:8px}
.note.error{background:#230b0b;color:#ffd4d4;border-color:#8a2b2b}
.selector{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));margin-top:12px}
.selector a{display:block;padding:16px;border:1px solid #223049;border-radius:12px;background:#0b1220;text-decoration:none}
.selector a:hover{background:#0f1f39}

/* === –ê–Ω—ñ–º–æ–≤–∞–Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è (—ñ–∫–æ–Ω–∫–∞) === */
.lesson .thumb{
  width:44px;height:44px;
  display:grid;place-items:center;
  border-radius:12px;
  background:linear-gradient(135deg,#0b1220,#0f1f39);
  border:1px solid #223049;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.02), 0 4px 14px rgba(0,0,0,.25);
}
.lesson .thumb svg{width:24px;height:24px;display:block}
@media (prefers-reduced-motion:no-preference){
  .lesson .thumb .spin{animation:spin 6s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
}
</style>
</head>
<body>
<div class="wrap">
  <header class="header-mini">
    <div class="logo">
      <span class="emoji">üéì</span><b>EDLab</b>
      <span class="badge">—Ü–∏—Ñ—Ä–æ–≤—ñ –ø–∞—Ä–∏ –¥–ª—è –û–ü–ü –∫–æ–ª–µ–¥–∂—É</span>
    </div>
    <a class="btn" href="index.html">‚¨Ö –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </header>

  <h1 id="specTitle">–†–æ–∑–¥—ñ–ª</h1>
  <p class="muted" id="specDesc">‚Äî</p>

  <div class="grid2">
    <div class="card lesson-list" id="listCard">
      <h2 id="listTitle">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</h2>
      <div id="lessons"></div>
      <div id="hintBox" class="note" style="display:none">‚Äî</div>

      <div id="previewBox" style="display:none;margin-top:14px">
        <div class="tester-toolbar">
          <div class="row">
            <strong>–®–≤–∏–¥–∫–µ –ø—Ä–µ–≤‚Äô—é</strong>
            <span class="muted mono" id="previewUrl">‚Äî</span>
          </div>
          <div class="row">
            <button class="btn ghost" type="button" id="toGen">‚öôÔ∏è –î–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞</button>
            <button class="btn" type="button" id="closePrev">‚úñÔ∏è –ó–∞–∫—Ä–∏—Ç–∏ –ø—Ä–µ–≤‚Äô—é</button>
          </div>
        </div>
        <div class="tester">
          <iframe id="previewFrame" src="about:blank"
                  sandbox="allow-same-origin allow-scripts allow-forms allow-modals allow-downloads"
                  referrerpolicy="no-referrer"></iframe>
        </div>
      </div>
      <p class="muted" id="previewNote" style="display:none;margin-top:6px">–ü–æ—Ä–∞–¥–∞: –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ iFrame¬ª ‚Äî –∫–æ–¥ —Å–ø—Ä–∞–≤–∞ –≤–∂–µ –∑ –ø–æ—Ç—Ä—ñ–±–Ω–∏–º URL.</p>
    </div>

    <div class="card" id="generator">
      <h2>üîß –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–¥—É –¥–ª—è Moodle (iFrame)</h2>
      <label for="url">URL —Å—Ç–æ—Ä—ñ–Ω–∫–∏</label>
      <input id="url" type="text" value=""/>

      <div class="inline">
        <div>
          <label for="height">–í–∏—Å–æ—Ç–∞ —Ñ—Ä–µ–π–º–∞ (px)</label>
          <input id="height" type="number" value="1600"/>
        </div>
        <div>
          <label for="sandbox">Sandbox —Ç–æ–∫–µ–Ω–∏</label>
          <input id="sandbox" type="text" value="allow-same-origin allow-scripts allow-forms allow-modals allow-downloads"/>
        </div>
      </div>

      <label for="code">HTML-–∫–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —É Moodle</label>
      <textarea id="code" readonly></textarea>

      <div class="row" style="margin-top:8px">
        <button class="btn" type="button" id="btnGen">üîÅ –û–Ω–æ–≤–∏—Ç–∏ –∫–æ–¥</button>
        <button class="btn" type="button" id="btnCopy">üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      </div>
      <p class="muted" style="margin-top:6px">–†–µ–∂–∏–º–∏ –≤—Å—Ç–∞–≤–∫–∏: <b>Page</b> –∞–±–æ <b>URL (Display: Embed)</b>. –Ø–∫—â–æ –∫–Ω–æ–ø–∫–∏ ¬´–Ω—ñ–º—ñ¬ª ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä —Ñ—ñ–ª—å—Ç—Ä–∏ —Ä–µ—Å—É—Ä—Å—É –∞–±–æ –∑–º–µ–Ω—à –Ω–∞–±—ñ—Ä sandbox.</p>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="footer-inner">
    <div class="col brand">
      <div class="brand-line"><span class="emoji">üåæ</span><strong>EDLab</strong></div>
      <p>–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ñ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏ —Ç–∞ –∫–æ—É—á-—Ç—Ä–µ–Ω—ñ–Ω–≥–∏.</p>
    </div>
    <div class="col legal">
      <h3>–ü—Ä–∞–≤–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
      <p>¬© 2025 <b>–°–µ—Ä–≥—ñ–π –ü–û–õ–Ü–©–£–ö</b>. –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∑–∞—Ö–∏—â–µ–Ω—ñ –∞–≤—Ç–æ—Ä—Å—å–∫–∏–º –ø—Ä–∞–≤–æ–º.</p>
    </div>
    <div class="col links">
      <h3>–û—Ñ—ñ—Ü—ñ–π–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏</h3>
      <ul>
        <li><a href="https://edlab.pp.ua/legal.html" target="_blank" rel="noopener">–ü—Ä–∞–≤–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</a></li>
        <li><a href="https://www.serawww.pp.ua" target="_blank" rel="noopener">–°—Ç–æ—Ä—ñ–Ω–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞</a></li>
        <li><a href="https://www.facebook.com/coach.Sergiy" target="_blank" rel="noopener">facebook.com</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom"><span>–ó—Ä–æ–±–ª–µ–Ω–æ –∑ —Ç—É—Ä–±–æ—Ç–æ—é –ø—Ä–æ –∑—Ä—É—á–Ω—ñ—Å—Ç—å –≤–∏–∫–ª–∞–¥–∞—á–∞ —ñ —Å—Ç—É–¥–µ–Ω—Ç–∞</span></div>
</footer>

<script>
// ===== –ö–æ–ª—å–æ—Ä–∏ –¥–ª—è —Å–µ–∫—Ü—ñ–π + –ø–æ—Ç–æ—á–Ω–∏–π –∫–ª—é—á
const THEME_COLORS = {
  coach:   {accent:'#a855f7', ring:'#7c3aed'},
  electric:{accent:'#22d3ee', ring:'#0891b2'},
  agro:    {accent:'#22c55e', ring:'#15803d'},
  mech:    {accent:'#f59e0b', ring:'#b45309'},
  tech:    {accent:'#ef4444', ring:'#b91c1c'}
};
let CURRENT_SPEC = ''; // –≤–∏—Å—Ç–∞–≤–∏–º–æ –≤ init()

// === SVG-—ñ–∫–æ–Ω–∫–∞ (–∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è –∑ –æ—Ä–±—ñ—Ç–æ—é)
function iconSvgForCurrent(){
  const c = THEME_COLORS[CURRENT_SPEC] || {accent:'#60a5fa', ring:'#1d4ed8'};
  return `
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <defs>
      <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%"  stop-color="${c.accent}"/>
        <stop offset="100%" stop-color="${c.ring}"/>
      </linearGradient>
    </defs>
    <circle cx="12" cy="12" r="8.5" fill="none" stroke="url(#g1)" stroke-width="1.5" opacity="0.9"/>
    <circle cx="12" cy="12" r="3.2" fill="${c.accent}" opacity="0.9"/>
    <g class="spin" style="transform-origin:12px 12px">
      <circle cx="12" cy="3.2" r="2" fill="${c.ring}" />
    </g>
  </svg>`;
}

// ===== –£—Ç–∏–ª—ñ—Ç–∏
const byId = (id)=>document.getElementById(id);
const SECTION_KEYS = ['coach','electric','agro','mech','tech'];
const SECTION_META = {
  coach:   { title:"üß† –ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—ñ —Ç—Ä–µ–Ω—ñ–Ω–≥–∏ (coach)", desc:"–ö–æ—É—á–∏–Ω–≥–æ–≤—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏, —Ä–µ—Ñ–ª–µ–∫—Å—ñ—è, soft skills, —Ä–æ–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–∞—Ö." },
  electric:{ title:"‚ö° –ï–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞",             desc:"–í–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è, –º–∞—Ä–∫—É–≤–∞–Ω–Ω—è, –ü–ü–†, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∏ –ø–µ—Ä–µ—Ä—ñ–∑—ñ–≤, –∂—É—Ä–Ω–∞–ª–∏ –û–ü." },
  agro:    { title:"üåæ –ê–≥—Ä–æ–Ω–æ–º—ñ—è",                     desc:"–ü–æ–ª—å–æ–≤—ñ –∂—É—Ä–Ω–∞–ª–∏, –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è, –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–∏, QR/NFC." },
  mech:    { title:"üöú –ê–≥—Ä–æ—ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è (–º–µ—Ö–∞–Ω—ñ–∫–∏)",      desc:"–¢–û/–ü–ü–†, –æ–±–ª—ñ–∫ –ø–∞–ª—å–Ω–æ–≥–æ, –∑–∞—è–≤–∫–∏, –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, –±–µ–∑–ø–µ–∫–∞." },
  tech:    { title:"üêÑ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏",                     desc:"HACCP/FSMS, SPC, –ø—Ä–æ—Å—Ç–µ–∂—É–≤–∞–Ω—ñ—Å—Ç—å, –∞—É–¥–∏—Ç, CAPA." }
};
const SECTION_TO_DIR = {
  coach:'coach',
  electric:'elect_II_kyrs',
  agro:'agro_II_kyrs',
  mech:'mech_II_kyrs',
  gas:'gas_II_kyrs',
  tech:'tech_II_kyrs'
};

function absoluteUrl(relative){
  if(/^https?:\/\//i.test(relative)) return relative;
  if(relative.startsWith('/')) return location.origin + relative;
  return location.origin + '/' + relative.replace(/^\.?\//,'');
}
function humanizeFromPath(p){
  const name = (p||'').split('/').pop() || p;
  return name.replace(/[-_]/g,' ').replace(/\.html?$/i,'').trim();
}
function lessonCard(item){
  return `
    <div class="lesson">
      <div class="thumb" aria-hidden="true">${iconSvgForCurrent()}</div>
      <div class="meta">
        <b>${item.title}</b>
        <small class="mono">${item.url}</small>
        <p class="muted" style="margin-top:4px">${item.desc||""}</p>
        <div class="row" style="margin-top:8px">
          <a class="btn" href="${item.url}" target="_blank" rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
          <button class="btn secondary js-preview" type="button" data-url="${item.url}">–®–≤–∏–¥–∫–µ –ø—Ä–µ–≤‚Äô—é</button>
          <button class="btn secondary js-iframe"  type="button" data-url="${item.url}">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ iFrame</button>
        </div>
      </div>
    </div>`;
}

// ‚Äî‚Äî‚Äî –í–∏—Ç—è–≥ <title> —ñ description –∑ HTML (–∑ –∫–µ—à–µ–º)
function extractTitleDescFromHTML(html){
  try{
    const doc = new DOMParser().parseFromString(html,'text/html');
    const t1 = doc.querySelector('title')?.textContent || '';
    const t2 = doc.querySelector('meta[name="title"]')?.getAttribute('content') || '';
    const t3 = doc.querySelector('meta[property="og:title"]')?.getAttribute('content') || '';
    const d1 = doc.querySelector('meta[name="description"]')?.getAttribute('content') || '';
    const title = (t1||t2||t3||'').trim();
    const desc  = (d1||'').trim();
    return {title, desc};
  }catch(_){ return {title:'',desc:''}; }
}
async function fetchTitleDesc(url){
  const cacheKey = 'titlecache:'+url;
  const cached = localStorage.getItem(cacheKey);
  if(cached){
    try{ return JSON.parse(cached); }catch{}
  }
  try{
    const abs = absoluteUrl(url);
    const r = await fetch(abs,{method:'GET',cache:'force-cache',mode:'cors'});
    if(!r.ok) return {title:'',desc:''};
    const html = await r.text();
    const {title,desc} = extractTitleDescFromHTML(html);
    const val = {title,desc,ts:Date.now()};
    localStorage.setItem(cacheKey, JSON.stringify(val));
    return val;
  }catch(_){ return {title:'',desc:''}; }
}

// === –õ–æ–∫–∞–ª—å–Ω—ñ –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∏
async function tryFetchJson(url){
  try{
    const r = await fetch(url,{method:'GET',cache:'no-store'});
    if(!r.ok) return null;
    return await r.json();
  }catch(_){ return null; }
}
async function loadManifestFor(key){
  const dir = SECTION_TO_DIR[key];
  if(!dir) return null;

  // 1) –≥–ª–æ–±–∞–ª—å–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç
  const global = await tryFetchJson(absoluteUrl('/assets/manifest.json'));
  if(global && Array.isArray(global[dir])) return { src:'/assets/manifest.json#'+dir, data: global[dir] };

  // 2) –ª–æ–∫–∞–ª—å–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç —Å–µ–∫—Ü—ñ—ó
  const local = await tryFetchJson(absoluteUrl('/'+dir+'/manifest.json'));
  if(Array.isArray(local)) return { src: '/'+dir+'/manifest.json', data: local };

  return null;
}

// === –ü–æ–±—É–¥–æ–≤–∞ —Å–µ–∫—Ü—ñ—ó (–∑ –∞–≤—Ç–æ–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏)
async function buildSection(key){
  const meta = SECTION_META[key];
  byId('specTitle').textContent = meta.title;
  byId('specDesc').textContent  = meta.desc;
  byId('listTitle').textContent = meta.title + ' ‚Äî –º–∞—Ç–µ—Ä—ñ–∞–ª–∏';

  const hint = byId('hintBox');
  hint.style.display = 'none';
  hint.classList.remove('error');

  const man = await loadManifestFor(key);
  if(!man || !Array.isArray(man.data) || !man.data.length){
    hint.textContent = `–ú–∞–Ω—ñ—Ñ–µ—Å—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ –ø–æ—Ä–æ–∂–Ω—ñ–π –¥–ª—è "${key}". –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ —ñ—Å–Ω—É—î /assets/manifest.json –∞–±–æ /${SECTION_TO_DIR[key]}/manifest.json.`;
    hint.classList.add('error'); hint.style.display='';
    return;
  }

  // –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –∑–∞–ø–∏—Å–∏: –∞–±–æ —Ä—è–¥–æ–∫, –∞–±–æ {url,title,desc}
  const rawList = man.data.map(x => (typeof x==='string' ? {url:x} : x));

  // –°–ø–µ—Ä—à—É –≥—Ä—É–±–æ —Ä–µ–Ω–¥–µ—Ä–∏–º–æ humanized, –∞ –ø–æ—Ç—ñ–º –¥–æ–¥–∞—î–º–æ —Å–ø—Ä–∞–≤–∂–Ω—ñ title/desc –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
  const initial = rawList.map(x => ({
    url: x.url,
    title: (x.title && x.title.trim()) || humanizeFromPath(x.url),
    desc: (x.desc && x.desc.trim()) || ''
  }));
  byId('lessons').innerHTML = initial.map(lessonCard).join('');

  // iFrame –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–¥—Ä–∞–∑—É –Ω–∞ –ø–µ—Ä—à–∏–π
  const firstAbs = initial[0]?.url ? absoluteUrl(initial[0].url) : '';
  byId('url').value = firstAbs; gen();

  // –î–æ—Ç—è–≥—É—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑ HTML (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ç–∏—Ö, –¥–µ title –Ω–µ –∑–∞–¥–∞–Ω–æ —è–≤–Ω–æ)
  const promises = initial.map(async (it, idx) => {
    if (rawList[idx].title) return it; // —è–≤–Ω–∏–π title –∑–∞–ª–∏—à–∞—î–º–æ
    const meta = await fetchTitleDesc(it.url);
    const betterTitle = (meta.title || '').trim();
    const betterDesc  = (meta.desc  || '').trim();
    if (betterTitle || betterDesc){
      const cards = byId('lessons').querySelectorAll('.lesson');
      const card = cards[idx];
      if (card){
        if (betterTitle) card.querySelector('.meta b').textContent = betterTitle;
        const p = card.querySelector('.meta p.muted');
        if (betterDesc) p.textContent = betterDesc;
      }
    }
    return it;
  });
  await Promise.allSettled(promises);
}

// === –†–µ–Ω–¥–µ—Ä ¬´–≤–∏–±–æ—Ä—É —Ä–æ–∑–¥—ñ–ª—É¬ª, —è–∫—â–æ spec –Ω–µ –∑–∞–¥–∞–Ω–∏–π
function renderSelector(){
  byId('specTitle').textContent = '–í–∏–±–µ—Ä–∏ —Ä–æ–∑–¥—ñ–ª';
  byId('specDesc').textContent  = '–û–±–µ—Ä—ñ—Ç—å –Ω–∞–ø—Ä—è–º —ñ–∑ –ø–µ—Ä–µ–ª—ñ–∫—É –Ω–∏–∂—á–µ.';
  byId('listTitle').textContent = '–î–æ—Å—Ç—É–ø–Ω—ñ —Ä–æ–∑–¥—ñ–ª–∏';
  byId('lessons').innerHTML = `
    <div class="selector">
      <a href="spec.html?spec=agro">üåæ –ê–≥—Ä–æ–Ω–æ–º—ñ—è</a>
      <a href="spec.html?spec=mech">üöú –ê–≥—Ä–æ—ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è (–º–µ—Ö–∞–Ω—ñ–∫–∏)</a>
      <a href="spec.html?spec=tech">üêÑ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏</a>
      <a href="spec.html?spec=electric">‚ö° –ï–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞</a>
      <a href="spec.html?spec=coach">üß† –ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—ñ —Ç—Ä–µ–Ω—ñ–Ω–≥–∏ (coach)</a>
    </div>`;
}

// === –ü—Ä–µ–≤‚Äô—é + iFrame-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
function openPreview(u){
  const abs = absoluteUrl(u);
  byId('previewUrl').textContent = abs;
  byId('previewFrame').src = abs;
  byId('previewBox').style.display = '';
  byId('previewNote').style.display = '';
  window.scrollTo({top: byId('previewBox').getBoundingClientRect().top + window.scrollY - 20, behavior:'smooth'});
}
function closePreview(){
  byId('previewFrame').src = 'about:blank';
  byId('previewBox').style.display = 'none';
  byId('previewNote').style.display = 'none';
}
function gen(){
  const url = byId('url').value.trim();
  const h   = parseInt(byId('height').value,10) || 1600;
  const sb  = byId('sandbox').value.trim();
  const html =
`<div style="max-width:980px;margin:0 auto;position:relative;z-index:1;">
  <iframe
    src="${url}"
    style="width:100%;height:${h}px;border:0;display:block;pointer-events:auto;background:#fff;"
    loading="eager"
    referrerpolicy="no-referrer"
    sandbox="${sb}">
  </iframe>
</div>`;
  byId('code').value = html;
}
function copyCode(){
  const ta = byId('code');
  ta.select(); ta.setSelectionRange(0, ta.value.length);
  document.execCommand('copy');
  const old = document.title; document.title='‚úÖ HTML —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ';
  setTimeout(()=>document.title=old,900);
}

// === –ü–æ–¥—ñ—ó
document.addEventListener('click', (e)=>{
  const p = e.target.closest('.js-preview');
  if(p){ openPreview(p.dataset.url); return; }
  const i = e.target.closest('.js-iframe');
  if(i){ const u = i.dataset.url; const abs = absoluteUrl(u); byId('url').value = abs; gen(); openPreview(u); return; }
  if(e.target.id==='closePrev'){ closePreview(); }
  if(e.target.id==='toGen'){ document.getElementById('generator').scrollIntoView({behavior:'smooth',block:'start'}); }
  if(e.target.id==='btnGen'){ gen(); }
  if(e.target.id==='btnCopy'){ copyCode(); }
});

// === –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
(async function init(){
  if (window.self !== window.top) document.documentElement.classList.add('embedded');

  const key = (()=>{
    const sp = new URLSearchParams(location.search).get('spec');
    if (sp && SECTION_KEYS.includes(sp.toLowerCase())) return sp.toLowerCase();
    const h = (location.hash||'').replace(/^#/, '').trim();
    if (h.startsWith('spec=')){
      const v = h.slice(5).toLowerCase();
      if (SECTION_KEYS.includes(v)) return v;
    }
    return null;
  })();

  if(!key){ renderSelector(); return; }

  // –í–ê–ñ–õ–ò–í–û: –≤–∏—Å—Ç–∞–≤–ª—è—î–º–æ –ø–æ—Ç–æ—á–Ω—É —Å–µ–∫—Ü—ñ—é –¥–ª—è –∫–æ–ª—å–æ—Ä—ñ–≤ —ñ–∫–æ–Ω–∫–∏
  CURRENT_SPEC = key;

  await buildSection(key);
})();
</script>
</body>
</html>
